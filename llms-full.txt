<SYSTEM>
This is the developer documentation for Needle.
Documentation: https://engine.needle.tools/docs/
Last Updated on 2/10/2026, 10:53:11 PM
</SYSTEM>
Moved to [Getting Started](./getting-started/)
Source: https://engine.needle.tools/docs/getting-started.html

---
home: false
description: Build 3D web experiences with Unity, Blender, or three.js that deploy instantly to any device - no app stores, no waiting, no limitations.
next: ./getting-started/index.md
editLink: false
lastUpdated: false
footer: "Copyright ¬© 2025 Needle Tools GmbH"
---

<video-embed src="https://engine.needle.tools/samples-videos/showcase/hero-trailer-in-arms-reach.mp4" />

# <logo-header logo="/imgs/needle-logo.webp" alt="Needle Engine Logo">Needle Engine</logo-header>

**Build 3D web experiences that work everywhere.** From browser to VR headsets, mobile AR to iOS WebXR ‚Äì create once, deploy anywhere. No app stores, no waiting, no limitations.

## Why Needle Engine?

**üöÄ Deploy Instantly to the Web**
Build on your machine, deploy anywhere. Share your 3D experiences with a simple URL or QR code. No app stores, no waiting for approval, no installation required.

**üåê True Cross-Platform**
One codebase runs everywhere ‚Äì desktop, mobile, VR headsets (Meta Quest, Apple Vision Pro), and mobile AR including native iOS WebXR support. When new XR devices launch, your apps work automatically.

**üé® Work in Powerful 3D Editors**
Use Unity or Blender for modeling, materials, animations, lightmaps, and more. Visual authoring meets web deployment. Perfect for artists and developers collaborating together.

**ü§ù Multiplayer & XR Built-In**
Collaboration and XR aren't afterthoughts ‚Äì they're core features. Add multiplayer or immersive XR with a single component.

**‚ö°Ô∏è Optimized for Performance**
Powerful compression and optimization pipeline ensures your files are small and load fast. Built on the glTF standard for maximum compatibility.

## Choose Your Path

<div class="path-cards">

<div class="path-card">

### üéì Learning

**Start with step-by-step tutorials**

Perfect for newcomers who want to learn the fundamentals.

- [Getting Started](./getting-started/)
- [TypeScript Essentials](./tutorials/fundamentals/typescript-essentials)
- [For Unity Developers](./tutorials/fundamentals/for-unity-developers)
- [**Browse all Tutorials**](./tutorials/)

</div>

<div class="path-card">

### üîß Problem Solving

**Jump straight to practical guides**

Get things done with focused how-to instructions.

- [Create Components](./how-to-guides/scripting/create-components)
- [Deploy to Production](./how-to-guides/deployment/)
- [Add Multiplayer](./how-to-guides/networking/)
- [Enable WebXR](./how-to-guides/xr/)
- [**Browse all How-To Guides**](./how-to-guides/)

</div>

<div class="path-card">

### üìö Understanding

**Explore concepts and architecture**

Deepen your knowledge of how Needle Engine works.

- [Vision & Philosophy](./explanation/core-concepts/vision)
- [Technical Architecture](./explanation/architecture/technical-overview)
- [Project Structure](./explanation/core-concepts/project-structure)
- [**Browse all Explanations**](./explanation/)

</div>

<div class="path-card">

### üìñ Reference

**Look up specific APIs**

Quick reference for components, methods, and configuration.

- [Component Reference](./reference/components)
- [Lifecycle Methods](./reference/api/lifecycle-methods)
- [TypeScript API Docs](https://engine.needle.tools/docs/api/latest)
- [**Browse all Reference**](./reference/)

</div>

</div>

## What Developers Say

<br/>

<quoteslides>

<testimonial
  name="Chris Mahoney"
  role="Founder, Our Computer Company. Ex-Unity, Ex-Lamina1"
  src="https://x.com/mahoneymatic/status/1562981022932684800?t=qNqojoZkk2CZrJa7dGzqng&s=19"
  img="./testimonial/ChrisMahoney.webp"
>
Unbelievable Unity editor integration by an order of magnitude,
  and as straightforward as the docs claim. Wow.
</testimonial>

<testimonial
  name="Kevin Curry"
  role="Founder, Intangible.ai. Ex-Unity"
  src="https://x.com/kmcurry/status/1574333302022062080"
  img="./testimonial/KevinCurry.webp"
>
needle.tools is a wonderful showcase of what @NeedleTools contributes to 3D via the web. I just love it.
</testimonial>

<testimonial
  name="Brit Gardner"
  role="Senior Software Engineer, Coherence. Ex-Blizzard"
  src="https://x.com/britg/status/1562443905580163072"
  img="./testimonial/BritGardner.webp"
>
Played with this a bit this morning ü§Øü§Ø pretty magical
</testimonial>

<testimonial
  name="Marc Wakefield"
  role="Augmented Reality Expert"
  src="https://x.com/mrm_design/status/1567391880169545729"
  img="./testimonial/MarcWakefield.webp"
>
This is huge for WebXR and shared, immersive 3D experiences! Thank you so much for putting in the work on this @NeedleTools crew! Hoping @Apple
 sort out their WebXR situation sooner rather than later. The AR part worked flawlessly on my @SamsungMobile S21.
</testimonial>

<testimonial
  name="Rinesh Thomas"
  role="Game Developer, Assassin's Creed VR"
  src="https://x.com/rineshthomas/status/1566342798063947777?t=z6sG3Z7mol-NfIRfTTKqCQ&s=19"
  img="./testimonial/RineshThomas.webp"
>
    This is the best thing I have seen after cinemachine in unity. Unity should acquire this
</testimonial>

<testimonial
  name="Stella Cannefax"
  role="CTO Dora, Game Developer"
  src="https://x.com/0xstella/status/1574853012585172993"
  img="./testimonial/StellaCannefax.webp"
>
Thanks to @NeedleTools, seeing quite a bit of this solution for web-based real time 3d tools - export scenes from Unity, where you can leverage the extensive 3d editor ecosystem & content, and then render them in your own web-based engine
</testimonial>

<testimonial
  name="Pete Patterson"
  role="Spatial Computing Specialist"
  src="https://x.com/VRSpatialist/status/1572300394285383680"
  img="./testimonial/PetePatterson.webp"
>
Finally checking out @NeedleTools with Unity. Super easy to get something up and running in the cloud using their
 integrations
</testimonial>

<testimonial
  name="Dilmer Valecillos"
  role="Developer Advocate for Mixed Reality @Meta, Tutorial Creator"
  src="https://x.com/Dilmerv/status/1562209049856188420"
  img="./testimonial/DilmerValecillos.webp"
>
 This is amazing and if you are curious about #WebXR with Unity this will help us get there
</testimonial>

<testimonial
  name="VRSpatialist"
  src="https://discord.com/channels/717429793926283276/722046635525537842/1030201907513405530"
  img="./testimonial/VRSpatialist.webp"
>
 I am a long time Unity dev and recently started playing with Needle Tools and I love it! It's a great on ramp for Unity devs who want to learn WebXR and three.js. The runtime engine is awesome and it was pretty easy to create my own custom component
</testimonial>

<testimonial
  name="Unity for Digital Twins"
  role="Powering the enterprise metaverse"
  src="https://x.com/DigitalTwin/status/1576934958681055233"
  img="./testimonial/UnityforDigitalTwins.webp"
>
We just gotta say WOW ü§©
</testimonial>

<testimonial
  name="Matthew Pieri"
  role="Game Developer"
  src="https://discord.com/channels/717429793926283276/1097572505738301571/1097572505738301571"
  img="./testimonial/MatthewPieri.webp"
>
Spent the last 2.5 months building this game, never built a game/never used unity before, but absolutely loving the whole process with needle tools. So rapid!  Would love to make a career building AR experiences!
</testimonial>

<testimonial
  name="Yuzu"
  role="Web Game Developer"
  src="https://discord.com/channels/717429793926283276/1264966222467043433/1265268833485066240"
  img="./testimonial/Yuzu.webp"
>
My workflow has been optimized 10X ever since i started using needle
</testimonial>

</quoteslides>

<br/><br/><br/>

<copyright></copyright>

<ClientOnly>
<removeserviceworker/>
</ClientOnly>
Source: https://engine.needle.tools/docs/index.html

---
title: Using Needle Engine directly from HTML
---

This page has been moved into the [getting started](./getting-started/) guide
Source: https://engine.needle.tools/docs/vanilla-js.html

## Needle AI

Needle AI is trained on the latest code, documentation and our integrations.    

Ask any question about Needle Engine, web development or our editor integrations in our [Needle community forum](https://forum.needle.tools) and get instant help from the Needle AI. 

### Documentation markdown links

Get AI friendly the markdown for any documentation page by changing the URL from `.html` to `.md`   
  Example: <a href="./index.md"><code>/index.md</code></a> or <a href="/docs/index.md"><code>index.md</code></a>

### Private AI Chats on Needle Cloud

For private questions use the integrated [Needle Cloud AI](https://cloud.needle.tools/team#ai)

::: info Got feedback?
Use the feedback buttons in the AI chat on Needle Cloud!
:::

### MCP server

Use the Needle MCP server to connect your own AI tools to Needle Engine projects and three.js scenes.

Learn more about the Needle MCP server and how to connect it to your own AI tools in the [Needle MCP documentation](./needle-mcp-server).

### llms.txt
Needle Engine documentation is also available via the llms.txt standard.    
Download the files below to use as context for your local AI:

- [llms.txt](https://cloud.needle.tools/llms.txt)
- [llms-full.txt](https://cloud.needle.tools/llms-full.txt)
Source: https://engine.needle.tools/docs/ai/index.html

<br/>

<div class="centered" style="display: flex;
    align-items: center;
    gap: 20px;
    font-size: 2em;
    font-weight: 100;">
    <img src="/logo.png" style="max-height:70px;" title="Needle Logo" alt="Needle Logo"/> +
    <img src="/imgs/mcp-logo.webp" style="max-height:70px;" title="MCP Logo" alt="MCP Logo"/>
</div>

# Needle MCP Server ‚Äî Local AI for Needle

Talk to your AI assistant about your 3D scenes! Connect Claude, Cursor, or other AI tools to the Needle Inspector so you can explore your three.js scenes, edit objects, and get help - all through natural conversation.

### Quick Start

1. Start the local MCP server:
   ```bash
   npx needle-cloud start
   ```

2. Connect your AI assistant using the instructions below in the [How to Connect](#how-to-connect) section.

3. Install the [Needle Inspector for Chrome](../three/needle-devtools-for-threejs-chrome-extension.md) to chat with your AI about any three.js scene in the browser.

4. Visit a three.js webpage (e.g. [needle.tools](https://needle.tools))

5. Ask your local AI assistant questions about the scene!

:::tip Works with your favorite AI tools
Works with Claude Desktop, Cursor, VS Code Copilot, Antigravity, and more.
:::

## What Can You Do?

Once connected, open the Needle Inspector on any three.js webpage and chat naturally with your AI assistant:

- **Explore 3D scenes**: "Show me all the lights in my scene"
- **Inspect objects**: "What materials are used in this scene?"
- **Edit properties**: "Change the main light color to warm orange"
- **Get creative help**: "How can I make this scene look more realistic?"
- **Optimize performance**: "Why is my scene running slowly?"
- **Learn techniques**: "How do I add reflections to this material?"
- **Debug issues**: "This object looks weird, what's wrong with it?"

Your AI can actually see your 3D scene through the Inspector and help you work with specific objects, materials, lighting, and settings in real-time.

## How to Connect

### <img src="/imgs/claude-logo.webp" style="height:3em; vertical-align:middle; margin-top:-.1lh; margin-right:.5em;" title="Claude Logo" alt="Claude Logo"/> Using Claude Desktop

**Quick setup:**

1. Open your terminal and run:
   ```bash
   claude mcp add --scope user --transport http needle http://localhost:8424/mcp
   ```

2. Restart Claude Desktop

3. Look for the üîå icon in the bottom-right - you're connected!

### <img src="/imgs/vscode-logo.webp" style="height:3em; vertical-align:middle; margin-top:-.1lh; margin-right:.5em;" title="VS Code Logo" alt="VS Code Logo"/> Using VS Code

**Setup:**

1. Open Command Palette: `Cmd+Shift+P` (Mac) or `Ctrl+Shift+P` (Windows/Linux)

2. Choose "MCP: Add Server"

3. Fill in the details:
   - Name: `needle`
   - Transport: `http`
   - URL: `http://localhost:8424/mcp`

**Using it:**

Type `#needle` in Copilot chat to see Needle tools, or just ask naturally!

### <img src="/imgs/cursor-logo.webp" style="height:3em; vertical-align:middle; margin-top:-.1lh; margin-right:.5em;" title="Cursor Logo" alt="Cursor Logo"/> Using Cursor 

1. In your project folder, create a file: `.cursor/mcp.json`

2. Add this:
   ```json
   {
     "mcpServers": {
       "needle": {
         "transport": "http",
         "url": "http://localhost:8424/mcp"
       }
     }
   }
   ```

3. Restart Cursor

4. **Important**: Switch to Agent Mode (not Ask Mode)

Try it: *"Show me all the meshes in my scene"*

### <img src="/imgs/antigravity-logo.webp" style="height:3em; vertical-align:middle; margin-top:-.1lh; margin-right:.5em;" title="Antigravity Logo" alt="Antigravity Logo"/> Using Antigravity

**Quick setup:**

1. Open Command Palette: `Cmd+Shift+P` (Mac) or `Ctrl+Shift+P` (Windows/Linux)

2. Choose "MCP: Add Server"

3. Fill in the details:
   - Name: `needle`
   - Transport: `http`
   - URL: `http://localhost:8424/mcp`

Antigravity is great at understanding what you want - just describe your goal!

## What to Ask

Here are some examples to get you started. Make sure the Needle Inspector is open in your browser with a three.js scene loaded:

**Exploring scenes:**
> "Show me all the lights in my scene"
> "What materials am I using?"
> "Find all the cameras and tell me where they're positioned"
> "List all the meshes and their triangle counts"
> "Which objects in my scene are invisible?"

**Editing and tweaking:**
> "Change the directional light intensity to 0.5"
> "Make the sphere at position (0, 1, 0) red"
> "Hide all helper objects"
> "Set the fog color to light blue"

**Getting creative help:**
> "How can I make this look more photorealistic?"
> "What's the best way to add shadows to my scene?"
> "How do I create a metallic material?"
> "Suggest ways to improve the lighting"

**Analyzing and debugging:**
> "Why is my scene loading slowly?"
> "Which objects have the most geometry?"
> "Are there any materials with missing textures?"
> "What's causing the low frame rate?"

**Learning:**
> "Explain what this material's properties do"
> "How does the environment map affect the scene?"
> "What's the difference between a point light and a spot light?"
> "Show me best practices for three.js lighting"

Just ask naturally - your AI assistant can see what the Inspector sees and will help you understand and modify your 3D scene.

## How It Works

When you have the Needle Inspector open in Chrome:

1. The Inspector connects to the MCP server running locally (`localhost:8424`)
2. Your AI assistant can query the Inspector for scene information
3. The AI sees the same hierarchy, objects, and properties that you see
4. When you ask the AI to make changes, it sends commands through the Inspector
5. Changes appear instantly in your browser

This creates a powerful workflow where you can use natural language to explore and modify complex 3D scenes without manually clicking through the Inspector interface.

## Troubleshooting

**Claude Desktop not connecting?**
- Quit Claude completely and restart it (not just close the window)
- Look for the üîå icon in the bottom-right corner - that means it's working
- Make sure the MCP server is running: `npx needle-cloud start-server`
- Double-check you followed the setup steps above

**Cursor not seeing Needle?**
- Make sure you're in Agent Mode (not Ask Mode)
- Try restarting Cursor
- Check that you created the `.cursor/mcp.json` file in your project
- Verify the MCP server is running

**VS Code not working?**
- Make sure you have a recent version of VS Code (1.102 or newer)
- Check that GitHub Copilot is active
- Verify the MCP server is running

**Can't see scene information?**
- Open the Needle Inspector extension in your browser
- Make sure you're viewing a page with a three.js scene
- The Inspector should show the scene hierarchy - if not, try refreshing the page
- Check the browser console for any error messages

**AI says it can't access the scene:**
- Verify the Needle Inspector is open and showing your scene
- Make sure the MCP server is running (`npx needle-cloud start-server`)
- Try closing and reopening the Inspector
- Check that your AI tool is properly configured with the MCP server URL

## Example Workflow

Here's a typical workflow using AI with the Needle Inspector:

1. **Open your scene**: Load a webpage with your three.js project
2. **Launch Inspector**: Click the Needle Inspector extension icon
3. **Ask for an overview**: *"What's in this scene?"*
4. **Explore specifics**: *"Show me the properties of the main camera"*
5. **Make changes**: *"Adjust the fog density to 0.02"*
6. **Get suggestions**: *"How can I improve performance here?"*
7. **Learn**: *"Explain what the roughness property does on this material"*

The AI becomes your assistant, helping you understand, debug, and improve your 3D content through conversation.

## What's Next?

Now that you're connected:
- Open the Needle Inspector on any three.js website
- Try asking about the scene structure
- Get AI help with tweaking materials and lighting
- Ask for optimization suggestions
- Learn three.js concepts by exploring real examples

For more help:
- [Needle Engine Docs](/index.md)
- [Needle Inspector Guide](../three/needle-devtools-for-threejs-chrome-extension.md)
- [three.js Integration](../three/index.md)

:::tip Using Needle Engine?
The Inspector has special features when used with Needle Engine projects, and the AI can help you work with Needle-specific components, networking, and XR features.
:::
Source: https://engine.needle.tools/docs/ai/needle-mcp-server.html

---
title: Animation in Blender
description: Export and control animations from Blender to the web
---

# Animation Workflows

Needle Engine offers multiple ways to animate your 3D content on the web, from simple playback to complex state machines and timeline-based sequences.

---

## Simple Animation Component

For basic animation playback, use the `Animation` component.

**When to use:**
- Single animations that play on load
- Simple triggered animations
- Sequential animation clips

**Setup:**

1. Select your animated object in Blender
2. Add an `Animation` component (Needle Components panel)
3. Assign your animation clip
4. Enable `playAutomatically` to start on load

<video-embed limit_height src="/docs/blender/animation.mp4" />

:::tip Multiple Clips
Add additional clips to the `clips` array. By default, only the first clip plays automatically. Trigger others using custom TypeScript or UI buttons.
:::

---

## AnimatorController - State Machine Animations

For complex character animations or interactive state-based systems, use the **AnimatorController**.

<video-embed src="/docs/blender/animatorcontroller-web.mp4" />

*State machine animations for complex character control*

**When to use:**
- Character controllers with multiple states (idle, walk, run, jump)
- Interactive objects with different behaviors
- Complex animation blending and transitions
- Game-like mechanics

**What is an AnimatorController?**
- A visual state machine graph for managing animation transitions
- Define multiple animation states and conditions for switching between them
- Configure blend times and transition rules
- Perfect for character controllers, interactive objects, and game mechanics

---

### Creating an AnimatorController

**1. Open the Editor**

Use the `Editor Type` dropdown (top left of any panel) and select `AnimatorController`.

![Open AnimatorController editor](/blender/animatorcontroller-open.webp)

**2. Create or Select an Asset**

Click `+` to create a new AnimatorController or select from existing assets.

<video-embed limit_height max_height="188px" src="/blender/animatorcontroller-create.mp4" />

---

### Understanding the Graph

![AnimatorController graph overview](/blender/animatorcontroller-overview.webp)

**Graph Elements:**

1. **Create States** - Press `Shift+A` to add new animation states
2. **Parameters Node** - Appears automatically; defines conditions for transitions
3. **Animation States** - Orange state is the starting state (change via Properties panel)
4. **Transitions** - Configure in the Properties panel with conditions and blend settings

**Workflow:**

1. Create states for each animation (idle, walk, run, etc.)
2. Add parameters (bool, float, int, trigger) to control transitions
3. Connect states with transitions
4. Set conditions for when transitions should occur
5. Configure blend times for smooth transitions

---

### Using Your AnimatorController

**In Blender:**

1. Add an `Animator` component to the root of your animated object
2. Assign your AnimatorController asset to the component

![Assign AnimatorController to Animator](/blender/animatorcontroller-assigning.webp)

**Controlling from Code:**

```ts
import { Animator } from "@needle-tools/engine";

// Get the Animator component
const animator = this.gameObject.getComponent(Animator);

// Set parameters to trigger transitions
animator.setBool("isWalking", true);
animator.setFloat("speed", 2.5);
animator.setTrigger("jump");
```

**Controlling from UI:**

Use Button components to set animator parameters without code. In the button's `onClick` event, select your Animator and choose which parameter to set.

---

## PlayableDirector - Timeline Animation

Export Blender's **NLA Tracks** (Non-Linear Animation) directly to the web using the PlayableDirector component.

**When to use:**
- Cinematic sequences
- Scroll-driven storytelling
- Coordinated multi-object animations
- Timeline-based interactive experiences
- Complex choreographed scenes

**Setup:**

1. Create NLA tracks in Blender for your animated objects
2. Add a `PlayableDirector` component to any object
3. In the component settings, add objects to the `animation tracks` list
4. Needle Engine exports those objects' NLA tracks

![Timeline setup](/blender/timeline_setup.webp)

![Timeline tracks](/blender/timeline.webp)

---

### Controlling Timeline Playback

**From Code:**

```ts
import { PlayableDirector } from "@needle-tools/engine";

// Get the PlayableDirector
const timeline = this.gameObject.getComponent(PlayableDirector);

// Control playback
timeline.play();
timeline.pause();
timeline.stop();

// Jump to specific time
timeline.time = 5.0; // seconds

// Evaluate at current time
timeline.evaluate();
```

---

### Example: Scroll-Controlled Timeline

This script controls timeline playback with mouse scrolling - perfect for scroll-based storytelling:

```ts
import { Behaviour, PlayableDirector, serializable, Mathf } from "@needle-tools/engine";

export class ScrollTimeline extends Behaviour {

    @serializable(PlayableDirector)
    timeline?: PlayableDirector;

    @serializable()
    sensitivity: number = .5;

    @serializable()
    clamp: boolean = false;

    private _targetTime: number = 0;

    awake() {
        this.context.domElement.addEventListener("wheel", this.onWheel);
        if (this.timeline) this.timeline.pause();
    }

    private onWheel = (e: WheelEvent) => {
        if (this.timeline) {
            this._targetTime = this.timeline.time + e.deltaY * 0.01 * this.sensitivity;
            if (this.clamp) this._targetTime = Mathf.clamp(this._targetTime, 0, this.timeline.duration);
        }
    }

    update(): void {
        if (!this.timeline) return;
        const time = Mathf.lerp(this.timeline.time, this._targetTime, this.context.time.deltaTime / .3);
        this.timeline.time = time;
        this.timeline.pause();
        this.timeline.evaluate();
    }
}
```

**How it works:**
- Listens for mouse wheel events
- Smoothly interpolates timeline position
- Optional clamping to timeline duration
- Adjustable sensitivity

---

## Animation Tips & Best Practices

**Performance:**
- Use AnimatorController for characters with multiple states
- Use Animation component for simple one-off animations
- Use PlayableDirector for coordinated multi-object sequences

**Organization:**
- Name your animation clips clearly
- Group related animations in AnimatorController states
- Use consistent parameter names across AnimatorControllers

**Optimization:**
- Remove unused animation tracks before export
- Use lower frame rates for background animations
- Consider LOD (Level of Detail) for distant animated objects

---

## Next Steps

- **[Components Overview](/docs/blender/components)** - Learn about other interactive components
- **[Custom Components](/docs/how-to-guides/scripting/create-components)** - Write code to trigger animations
- **[Deployment](/docs/how-to-guides/deployment/)** - Publish your animated scenes

---

**Need Help?**
- [Discord Community](https://discord.needle.tools) - Ask questions about animation workflows
- [Forum](https://forum.needle.tools) - Share your animated projects
- [FAQ](/docs/reference/faq) - Common animation issues
Source: https://engine.needle.tools/docs/blender/animation.html

---
title: Components in Blender
description: Add interactivity using built-in and custom components
---

# Working with Components

Components are the building blocks of interactivity in Needle Engine. Add them to objects in Blender to create interactive behaviors, from simple camera controls to complex game mechanics.

---

## Built-in Components

Needle Engine includes **100+ ready-to-use components** for common interactive features.

### Adding Components

**In Blender:**

1. Select an object in your scene
2. Open the **Needle Components** panel (usually in the Properties area)
3. Click `Add Component`
4. Search for and select the component you need
5. Adjust component settings in the panel

![Needle Components panel](/blender/components-panel.webp)

**Component settings** appear immediately after adding. Each component has different properties you can configure directly in Blender.

---

### Example: Camera Controls

Add `OrbitControls` to your camera for instant mouse/touch controls on all devices:

![Add OrbitControls component](/blender/components-panel-select.webp)

**OrbitControls settings:**
- `target` - What the camera orbits around
- `autoRotate` - Automatic rotation
- `enableDamping` - Smooth camera movement
- `minDistance` / `maxDistance` - Zoom limits
- `enablePan` - Allow panning with right-click

---

### Popular Components by Category

**Camera Controls:**
- `OrbitControls` - Orbit around a target with mouse/touch

**Animation:**
- `Animation` - Play animation clips
- `Animator` - State machine animations
- `PlayableDirector` - Timeline-based sequences
- [Learn more about animation ‚Üí](/docs/blender/animation)

**Interaction:**
- `DragControls` - Make objects draggable in 3D space
- `ObjectRaycaster` - Detect clicks and hover on objects

**UI & UX:**
- `Button` - Interactive buttons
- `Canvas` - UI container

**Media:**
- `VideoPlayer` - Play video files and streams

**Physics:**
- `Rigidbody` - Add physics simulation
- `BoxCollider` / `SphereCollider` / `MeshCollider` - Collision shapes

**Audio:**
- `AudioSource` - 3D spatial audio
- `AudioListener` - Hear 3D audio (usually on camera)

**Effects:**
- `ParticleSystem` - Visual effects
- `Light` - Dynamic lighting

**Optimization:**
- `ViewBox` - Ensure content stays framed

**XR (Virtual & Augmented Reality):**
- `WebXR` - Enable VR/AR with one click
- [Learn more about WebXR ‚Üí](/docs/how-to-guides/xr/)

**Actions & Events:**
- `EverywhereActions` - Trigger actions on various events (click, hover, collision, etc.)

[See all 100+ components ‚Üí](/docs/reference/components)

---

### Removing Components

Click the `X` button in the lower right of any component panel.

![Remove component](/blender/remove-component.webp)

---

## Custom Components

Want behavior that doesn't exist yet? Write your own TypeScript components that automatically appear in Blender.

### Creating Custom Components

**1. Open Your Project Code**

Click `Code Editor` in the Needle Project panel to open VS Code with your web project.

**2. Create a Component File**

In your project, navigate to `src/scripts/` and create a new `.ts` file (e.g., `RotateObject.ts`).

**3. Write Your Component**

```ts
import { Behaviour, serializable } from "@needle-tools/engine";

export class RotateObject extends Behaviour {

    @serializable()
    speed: number = 1;

    @serializable()
    axis: "x" | "y" | "z" = "y";

    update() {
        const delta = this.context.time.deltaTime;
        switch(this.axis) {
            case "x": this.gameObject.rotateX(delta * this.speed); break;
            case "y": this.gameObject.rotateY(delta * this.speed); break;
            case "z": this.gameObject.rotateZ(delta * this.speed); break;
        }
    }
}
```

**4. Save and Use**

- Save the file
- The component automatically compiles
- It appears in Blender's component list
- Add it to objects just like built-in components
- Your `@serializable()` properties appear as editable fields in Blender

---

### Component Lifecycle

Components have lifecycle methods you can override:

```ts
import { Behaviour } from "@needle-tools/engine";

export class MyComponent extends Behaviour {

    // Called once when component is created
    awake() {
        console.log("Component created");
    }

    // Called when component becomes active
    onEnable() {
        console.log("Component enabled");
    }

    // Called every frame
    update() {
        // Your per-frame logic
    }

    // Called at fixed intervals (physics)
    fixedUpdate() {
        // Physics calculations
    }

    // Called when component is disabled
    onDisable() {
        console.log("Component disabled");
    }

    // Called when component is destroyed
    onDestroy() {
        console.log("Component destroyed");
    }
}
```

**[Learn more about lifecycle hooks ‚Üí](/docs/how-to-guides/scripting/use-lifecycle-hooks)**

---

### Accessing Other Components

**Find components on the same object:**

```ts
import { Behaviour, Animation } from "@needle-tools/engine";

export class MyComponent extends Behaviour {

    start() {
        // Get a component on this object
        const anim = this.gameObject.getComponent(Animation);
        if (anim) {
            anim.play();
        }
    }
}
```

**Find components in children:**

```ts
// Get component in any child
const light = this.gameObject.getComponentInChildren(Light);

// Get all components in children
const allLights = this.gameObject.getComponentsInChildren(Light);
```

**Find components in parents:**

```ts
const canvas = this.gameObject.getComponentInParent(Canvas);
```

**Find components anywhere in scene:**

```ts
import { GameObject } from "@needle-tools/engine";

// Find by name
const player = GameObject.find("Player");

// Find first component of type
const camera = GameObject.findObjectOfType(Camera);

// Find all components of type
const allEnemies = GameObject.findObjectsOfType(Enemy);
```

**[Learn more about finding objects and components ‚Üí](/docs/how-to-guides/scripting/find-objects-and-components)**

---

### Serializable Properties

Use `@serializable()` to expose properties in Blender:

```ts
import { Behaviour, serializable } from "@needle-tools/engine";
import { Vector3, Color } from "three";

export class MyComponent extends Behaviour {

    // Basic types
    @serializable()
    speed: number = 5;

    @serializable()
    enabled: boolean = true;

    @serializable()
    name: string = "Default";

    // Three.js types
    @serializable(Vector3)
    direction: Vector3 = new Vector3(0, 1, 0);

    @serializable(Color)
    color: Color = new Color(1, 0, 0);

    // References to other components
    @serializable(Light)
    targetLight?: Light;

    // Arrays with primitives (number, string, boolean)
    @serializable()
    speeds: number[] = [1, 2, 3];

    // Arrays with object references need the type specified
    @serializable(Light)
    lights: Light[] = [];

    @serializable(Object3D)
    waypoints: Object3D[] = [];
}
```

All these properties become editable in Blender's component panel!

:::tip Learn More
- [Creating Components & Serialization ‚Üí](/docs/how-to-guides/scripting/create-components#serialization)
- [@serializable Decorator Reference ‚Üí](/docs/reference/typescript-decorators#serializable)
:::

---

### Component Communication

**Using Events:**

```ts
import { Behaviour, serializable } from "@needle-tools/engine";

export class Button extends Behaviour {

    @serializable()
    onClick: EventList = new EventList(); // Can assign in Blender!

    onPointerClick() {
        this.onClick.invoke();
    }
}

export class Door extends Behaviour {

    open() {
        console.log("Door opening!");
        // Animation logic here
    }
}
```

In Blender, assign the Door's `open()` method to the Button's `onClick` event.

**Direct References:**

```ts
export class PlayerController extends Behaviour {

    @serializable(Animator)
    animator?: Animator;

    jump() {
        this.animator?.setTrigger("jump");
    }
}
```

Assign the animator reference in Blender by dragging the component.

---

### Best Practices

**Component Design:**
- Keep components small and focused (single responsibility)
- Use `@serializable()` for values artists should control
- Provide sensible defaults
- Add comments to explain parameters

**Performance:**
- Avoid heavy calculations in `update()` - use `onEnable()` when possible
- Cache component references in `awake()` or `start()`
- Use object pooling for frequently created/destroyed objects

**Organization:**
- Group related components in the same file or folder
- Use clear, descriptive class names
- Follow TypeScript naming conventions

---

## Requirements

:::warning Component Compiler Required
Make sure `@needle-tools/needle-component-compiler` 2.x is in your `package.json` devDependencies for component hot-reloading to work.
:::

This is included by default in new projects. If components aren't appearing in Blender, check your `package.json`.

---

## Next Steps

- **[Create Components Guide](/docs/how-to-guides/scripting/create-components)** - Detailed scripting tutorial
- **[Component API Reference](https://engine.needle.tools/docs/api/)** - Complete API documentation
- **[Animation Workflows](/docs/blender/animation)** - Use animation components
- **[TypeScript Essentials](/docs/tutorials/fundamentals/typescript-essentials)** - Learn TypeScript basics

---

**Need Help?**
- [Discord Community](https://discord.needle.tools) - Ask about component development
- [Forum](https://forum.needle.tools) - Share your custom components
- [Component Catalog](/docs/reference/components) - Browse all built-in components
Source: https://engine.needle.tools/docs/blender/components.html

---
title: Needle Engine for Blender
description: Create interactive web experiences directly from Blender
editLink: true
---

# <logo-header logo="/blender/logo.png" alt="Blender">Needle Engine for Blender</logo-header>

**Create interactive 3D web experiences directly from Blender.** This tutorial will guide you through installing the add-on and creating your first interactive web project in under 10 minutes.

:::tip What You'll Learn
By the end of this tutorial, you'll have the Blender add-on installed, a web project running locally, and understand how to add basic interactivity to your scenes.
:::

---

## Prerequisites

Before starting, make sure you have:

<ClientOnly>

- <a target="_blank" href="https://www.blender.org/download/"><strong>Blender 4.5+ LTS</strong></a>
- <os-link windows_url="https://nodejs.org/dist/v20.9.0/node-v20.9.0-x64.msi" osx_url="https://nodejs.org/dist/v20.9.0/node-v20.9.0.pkg"><strong>Node.js 20 LTS</strong></os-link>

</ClientOnly>

---

## Step 1: Install the Add-on

### Download

<NoDownloadYet>
    <needle-button
        event_goal="download_blender"
        event_position="getting_started"
        large
        href="https://engine.needle.tools/downloads/blender?utm_source=needle_docs&utm_content=getting_started"
        same_tab
        next_url="/docs/blender/"
        >
        <strong>Download Needle Engine for Blender</strong>
    </needle-button>
</NoDownloadYet>

### Install

1. In Blender, go to `Edit > Preferences > Add-ons`
2. Click the dropdown arrow ‚Üí Select `Install from Disk`
3. Choose the downloaded `.zip` file ‚Üí Click `Install Add-on`
4. Search for "Needle" and **check the box** to enable it

![Blender Add-on Settings](/blender/settings.webp "2x")

**‚úì Checkpoint:** You should now see "Needle Engine Exporter for Blender" in your add-ons list with a checkmark.

---

## Step 2: Create Your First Project

Let's start with a sample project to see how everything works.

### Get Sample Projects

[Download Blender Samples](https://engine.needle.tools/downloads/blender/download-samples?utm_source=needle_docs&utm_content=blender)

Download and **open any sample `.blend` file** in Blender. These samples show what's possible and help you learn by example.

### Generate the Web Project

1. **Find the Needle Engine Panel**
   - Open the Properties panel (right side)
   - Click the **Scene Properties** tab (scene icon with geometric shapes)
   - Scroll to find the **Needle Engine** panel

2. **Set Project Path**
   - Click the folder icon next to `Project Path`
   - Choose a location for your web project folder
   - This folder will contain all your web files

3. **Generate Project**
   - Click the `Generate Project` button
   - Wait while Needle Engine:
     - Creates your web project files
     - Installs dependencies (may take 1-2 minutes)
     - Starts the local development server
   - Your browser should open automatically!

<video-embed src="/docs/blender/environment-light.mp4" />

**‚úì Checkpoint:** You should see your 3D scene running in a web browser. Try rotating the view with your mouse!

:::tip Auto-Export
When you save your `.blend` file, Needle Engine automatically re-exports your scene and refreshes the browser. This hot reload makes iteration super fast!
:::

---

## Step 3: Add Basic Interactivity

Now let's add camera controls so users can explore your scene.

### Add OrbitControls

1. **Select your camera** in Blender
2. Find the **Needle Components** panel (in Properties)
3. Click `Add Component`
4. Search for `OrbitControls` and select it
5. **Save your Blender file** (Ctrl/Cmd + S)
6. Watch the browser refresh automatically

**‚úì Checkpoint:** You can now click and drag in the browser to orbit the camera around your scene!

![Add OrbitControls component](/blender/components-panel-select.webp)

### Understanding Components

Components are reusable behaviors you add to objects. Needle Engine includes 100+ built-in components:
- **OrbitControls** - Mouse/touch camera controls
- **Animation** - Play animation clips
- **WebXR** - Enable VR/AR with one click
- **DragControls** - Make objects draggable
- And many more!

**[Learn more about components ‚Üí](/docs/blender/components)**

---

## Step 4: Configure Essential Settings

Before going further, let's fix two common issues.

### Fix Color Management

By default, Blender uses `Filmic` which makes colors look different in the browser.

**To fix:**
1. Go to **Render Properties** tab
2. Find **Color Management** section
3. Set `View Transform` to **Standard**

![Color management settings](/blender/settings-color-management.webp)

**‚úì Checkpoint:** Colors now match between Blender and the web!

### Setup Environment Lighting

Your HDRI environment exports automatically, but you need to make it visible.

**To show skybox:**
1. Open **Viewport Shading** options (top right of 3D viewport)
2. Assign an HDRI cubemap
3. Set `World Opacity` to **1**

<video-embed limit_height max_height="300px" src="/docs/blender/environment.mp4" />

**‚úì Checkpoint:** Save and see your skybox appear in the browser!

---

## What You've Learned

Congratulations! You've just:
- ‚úÖ Installed the Needle Engine add-on
- ‚úÖ Created and launched a web project
- ‚úÖ Added interactive camera controls
- ‚úÖ Configured colors and environment lighting

Your Blender scenes are now running on the web with hot reload!

---

## Next Steps

### Continue Learning (Tutorials)

**[For Blender Artists ‚Üí](/docs/tutorials/fundamentals/for-blender-artists)**
Comprehensive guide for 3D artists covering what you can create without code, workflow tips, and when you might want scripting.

**[TypeScript Essentials ‚Üí](/docs/tutorials/fundamentals/typescript-essentials)**
Learn TypeScript basics to create custom interactive behaviors.

---

### Add More Interactivity (How-To Guides)

Now that you have the basics, explore specific features:

**[Animation Workflows ‚Üí](/docs/blender/animation)**
Learn all animation methods: simple Animation component, AnimatorController state machines, and PlayableDirector timeline export.

**[Components Guide ‚Üí](/docs/blender/components)**
Master the 100+ built-in components and learn to create your own custom TypeScript components.

**[Lightmapping ‚Üí](/docs/blender/lightmapping)**
Bake photorealistic lighting for stunning visuals with great performance.

**[Deploy Your Project ‚Üí](/docs/how-to-guides/deployment/)**
Publish your interactive scene to the web for everyone to see.

**[Enable WebXR ‚Üí](/docs/how-to-guides/xr/)**
Add VR and AR support to your scenes.

---

### Look Things Up (Reference)

**[Component Catalog ‚Üí](/docs/reference/components)**
Browse all 100+ built-in components with descriptions and settings.

**[API Documentation ‚Üí](https://engine.needle.tools/docs/api/)**
Complete TypeScript API reference for advanced development.

**[FAQ ‚Üí](/docs/reference/faq)**
Common questions and troubleshooting.

---

### Get Inspired

**[Sample Projects ‚Üí](https://engine.needle.tools/samples)**
Explore interactive examples to see what's possible.

**[Download More Samples ‚Üí](https://engine.needle.tools/downloads/blender/download-samples)**
Get working `.blend` files to learn from.

---

## Getting Help

**[Discord Community ‚Üí](https://discord.needle.tools)**
Ask questions and get real-time help from the community.

**[Forum ‚Üí](https://forum.needle.tools)**
Detailed discussions and solutions.

**Bug Reporter:**
Built-in tool in Blender (`Help > Needle`) for complex issues.

![Bug reporter](/blender/bugreporter.webp)

---

:::tip Share Your Feedback
Your feedback helps us improve! [Tell us what you think in the forum](https://forum.needle.tools/?utm_source=needle_docs&utm_content=content)
:::
Source: https://engine.needle.tools/docs/blender/index.html

---
title: Lightmapping in Blender
description: Bake beautiful lighting for optimal web performance
---

# Lightmapping

Bake realistic lighting and shadows directly in Blender and export them to the web for stunning visuals with excellent performance.

<video-embed limit_height max_height="800px" src="/docs/blender/lightmapping.mp4" />

---

## What is Lightmapping?

Lightmapping is the process of pre-calculating lighting and baking it into textures. This gives you:

**Benefits:**
- ‚ú® **Photorealistic lighting** - Bake complex lighting calculations once
- ‚ö° **Great performance** - No real-time lighting calculations needed
- üé® **Artistic control** - Fine-tune lighting in Blender
- üì¶ **Small file sizes** - Compressed lightmap textures
- üîÑ **Multiple instances** - Each instance can have unique lightmaps

**Use Cases:**
- Architectural visualization
- Product showcases with dramatic lighting
- Art galleries and museum experiences
- Any scene with static lighting

---

## Requirements

**Before you start:**
- At least one light in your scene
- Objects marked as `Lightmapped` in the Needle Object panel
- Blender's lighting set up the way you want it

:::tip Download Example
Get the complete lightmapping example to learn from: [lightmaps.blend](https://engine.needle.tools/downloads/blender/lightmaps.blend)
:::

---

## Quick Start

### Step 1: Mark Objects for Lightmapping

**For Mesh Objects:**

1. Select your mesh object
2. Open the **Needle Object** panel (Object Properties tab)
3. Enable the `Lightmapped` checkbox

**For Lights:**

1. Select your light
2. Open the **Needle Object** panel
3. Enable `Lightmapped` to include it in baking

![Enable lightmapping on objects](/blender/lightmapping-object.webp)

:::tip What to Lightmap
- Mark static geometry (buildings, furniture, environments)
- Mark lights that should affect lightmaps
- **Don't** mark dynamic objects that move
:::

---

### Step 2: Configure Settings

You can configure lightmapping from two places:

**Option A: Scene Panel (Quick Access)**

Open the **Needle** tab in the 3D viewport's sidebar (press `N` to toggle).

![Lightmap settings - Scene panel](/blender/lightmapping-scene-panel.webp)

**Option B: Render Properties (Full Settings)**

Go to **Render Properties** tab and find the **Lightmapping** panel.

![Lightmap settings - Render properties](/blender/lightmapping-panel.webp)

---

### Step 3: Bake Lightmaps

1. Click the **Bake** button (in either panel)
2. Wait for baking to complete (progress shows in Blender)
3. Lightmaps are automatically exported with your scene

**What Happens:**
- Needle Engine generates lightmap UVs automatically (no manual UV unwrapping needed!)
- Blender bakes lighting into textures
- Textures are saved in your project
- Export includes lightmap data

---

## Lightmap Settings Explained

### Resolution

**`Lightmap Resolution`** - Texels per unit
- Higher = better quality, larger files
- Lower = faster baking, smaller files
- **Recommended:** 10-50 for most scenes

### Quality

**`Samples`** - Render samples for baking
- More samples = cleaner results, slower baking
- Fewer samples = faster but noisier
- **Recommended:** 128-512 for production

**`Denoise`** - Remove noise from baked lightmaps
- Enable for cleaner results
- Requires Blender's denoiser

### Advanced

**`Max Lightmap Size`** - Maximum texture size
- Limits memory usage
- **Recommended:** 2048 or 4096

**`Pack Margin`** - Padding between UV islands
- Prevents light bleeding between objects
- **Recommended:** 4-16 pixels

---

## Automatic UV Generation

Needle Engine's lightmapping plugin automatically generates lightmap UVs - no manual unwrapping required!

**How it works:**
- Analyzes your geometry
- Creates optimal UV layouts
- Packs efficiently into texture space
- Handles multiple instances intelligently

**This means:**
- ‚úÖ No second UV channel needed
- ‚úÖ Works with complex models
- ‚úÖ Supports instanced objects with unique lighting

---

## Best Practices

### Scene Setup

**Lighting:**
- Use area lights for soft, natural lighting
- Combine sun light with fill lights for outdoor scenes
- Add rim lights to highlight edges
- Consider color temperature (warm/cool)

**Geometry:**
- Ensure clean topology (no overlapping faces)
- Lightmap static architecture, not characters
- Use separate objects for elements that need different lightmap resolution

**Performance:**
- Only lightmap objects that benefit from it
- Use lower resolution for background elements
- Compress textures in production builds

---

### Troubleshooting

**Black or dark lightmaps:**
- Check that lights are marked as `Lightmapped`
- Increase render samples
- Verify normals are correct (consistent face orientation)

**Seams or artifacts:**
- Increase `Pack Margin` setting
- Check for overlapping UV islands
- Ensure geometry is watertight (no gaps)

**Too slow:**
- Reduce lightmap resolution
- Reduce render samples
- Bake in sections (bake one object at a time)

**File too large:**
- Lower lightmap resolution
- Reduce `Max Lightmap Size`
- Enable texture compression in production builds

---

## Workflow Tips

### Iterative Baking

While developing:
1. Use lower resolution and fewer samples for fast iteration
2. Mark only key objects as lightmapped initially
3. Test in browser frequently
4. Increase quality for final bake

### Combining with Real-Time Lighting

You can mix lightmaps with dynamic lights:
- Use lightmaps for static ambient lighting
- Add dynamic point lights for moving elements
- Result: Beautiful base lighting + interactive highlights

### Multiple Lightmap Scenarios

Bake different lighting conditions:
- Day/night versions
- Different seasons
- Dramatic vs. natural lighting
- Switch between them at runtime

---

## Exporting Lightmaps

Lightmaps are exported automatically when you:
1. Save your `.blend` file (if auto-export is enabled)
2. Click `Export` in the Needle Project panel
3. Run `Build: Production`

**Output:**
- Lightmap textures saved in your project's `assets` folder
- GLB file includes lightmap data
- Ready to use on the web - no additional setup needed

---

## Advanced: Runtime Control

You can control lightmaps from TypeScript:

```ts
import { Behaviour, Renderer } from "@needle-tools/engine";

export class LightmapSwitcher extends Behaviour {

    switchToNightLightmaps() {
        const renderers = this.gameObject.getComponentsInChildren(Renderer);
        for (const renderer of renderers) {
            // Access and modify lightmap data
            // (specific API depends on your setup)
        }
    }
}
```

---

## Experimental Feature Notice

:::warning Lightmapping is Experimental
The lightmapping plugin is currently experimental. We recommend:
- **Creating backups** of your `.blend` files before baking
- **Testing thoroughly** before production use
- **[Reporting issues](https://forum.needle.tools/?utm_source=needle_docs&utm_content=content)** you encounter

Your feedback helps us improve the feature!
:::

---

## Next Steps

- **[Texture Compression](/docs/how-to-guides/deployment/#texture-compression)** - Optimize lightmap file sizes
- **[Deployment Guide](/docs/how-to-guides/deployment/)** - Publish your lightmapped scenes
- **[Components Overview](/docs/blender/components)** - Add interactivity to lit scenes

---

**Need Help?**
- [Discord Community](https://discord.needle.tools) - Ask about lightmapping workflows
- [Forum](https://forum.needle.tools) - Share your lightmapped scenes
- [Download Example](https://engine.needle.tools/downloads/blender/lightmaps.blend) - Working lightmap sample
Source: https://engine.needle.tools/docs/blender/lightmapping.html

---
title: Needle Cloud
description: 'Needle Cloud is an online service. It helps you store, manage, and share 3D assets and apps on the web.
 A variety of file formats are supported, including glTF, USD, FBX, VRM, and more. Spatial web apps made with Needle can be deployed to the cloud directly from the Unity integration, and via command line (CLI).'
---

<br/>
<discountbanner/>

# Needle Cloud

## Overview

**Needle Cloud is the official hosting and optimization platform for Needle Engine**‚Äîa core part of Needle Services. Store, manage, and share 3D assets and apps on the web. Deploy spatial web apps, optimize 3D files, and collaborate with your team‚Äîall from one platform.

:::tip Quick Links
**Get Started:** [Create a free account](https://cloud.needle.tools)

**Deploy Apps:** [From Unity](#deploy-from-unity) ‚Ä¢ [From Blender](#deploy-from-blender) ‚Ä¢ [From CLI](#deploy-from-the-cli)

**Manage Assets:** [Upload 3D Assets](#cloud-assets) ‚Ä¢ [Supported Formats](#supported-3d-formats)
:::

![Needle Cloud Overview](/cloud/cloud-overview-page.webp)

## Why Use Needle Cloud?

Needle Cloud offers significant advantages over traditional hosting solutions like FTP, self-hosting, or generic cloud storage.

### vs. Self-Hosting / FTP

| Feature | Needle Cloud | Self-Hosting / FTP |
| --- | --- | --- |
| **Global CDN** | ‚úÖ Instant worldwide delivery | ‚ùå Single server location, slow for distant users |
| **Automatic Optimization** | ‚úÖ Draco, KTX2, Progressive Loading | ‚ùå Manual optimization required |
| **Version Control** | ‚úÖ Built-in with labeled versions | ‚ùå Manual file management |
| **Preview URLs** | ‚úÖ Each upload gets unique URL | ‚ùå Must manage URLs manually |
| **Deploy from Editor** | ‚úÖ One-click from Unity | ‚ùå Manual export and upload |
| **Password Protection** | ‚úÖ Built-in per-project | ‚ùå Server configuration required |
| **Setup Time** | ‚úÖ Minutes | ‚ùå Hours or days |
| **Maintenance** | ‚úÖ Zero‚Äîwe handle it | ‚ùå Ongoing server management |

### Key Benefits

**üåç Global CDN Performance**  
Your apps and assets are served from servers closest to your users worldwide. No need to configure or pay for CDN separately‚Äîit's included.

**‚ö° Automatic Optimization**  
Upload any format (glTF, USD, FBX, VRM) and get automatic compression with Draco, KTX2, and Progressive Loading. Saves ~90% bandwidth and memory compared to unoptimized files.

**üè∑Ô∏è Version Control & Preview URLs**  
Every upload gets a unique URL. Label versions as `main`, `experimental`, or `dev`. Share a labeled link once‚Äîit auto-updates when you move the label. Perfect for client reviews.

**üöÄ Deploy from Anywhere**  
One-click from Unity, command-line from any web project, or automated via GitHub Actions. No manual FTP uploads or SSH commands.

**üîí Built-in Security**  
Password-protect projects with one click. Role-based access control for teams. Private by default‚Äînot a marketplace or social network.

**üë• Team Collaboration**  
Multiple team members can deploy and manage assets. Role-based permissions (Owner, Manager, Member, Billing) ensure the right access levels.

**ü§ñ CI/CD Ready**  
Deploy automatically on every commit with GitHub Actions integration or custom CI/CD pipelines via the CLI.

:::tip Perfect for Agencies & Studios
Needle Cloud is designed for professional workflows. Spend time creating, not managing servers and build pipelines.
:::

## <logo-header logo="/imgs/unity-logo.webp" alt="Unity">Deploy from Unity</logo-header>

Needle Cloud is integrated into the Unity Editor. This allows you to deploy your apps directly from Unity to Needle Cloud. You can also upload and download assets from Needle Cloud directly in Unity.

1. **Install the Unity integration, if you haven't already.**   
   See [this page](./../unity/) for more info.

2. **Add the `Needle Engine` component (formerly ExportInfo) to your scene.**   
   This component is used to configure the export settings for your app.  
   You can use the menu item `GameObject > Needle Engine > Add Export Info` or create a new scene from a Needle template via the menu item `File > New Scene`.

3. **Click on `Upload to Needle Cloud`.**  
   This will build your app, and upload it to Needle Cloud. You can also choose to deploy to a specific team and project. The _upload name_ of the project, visible next to the button, is saved in the scene. Future uploads will use the same upload name, and all uploaded versions will be grouped together on the Needle Cloud website.

   ![Needle Cloud Unity Integration](/cloud/cloud-deploy-v3.webp)

## <logo-header logo="/blender/logo.png" alt="Blender">Deploy from Blender</logo-header>

Needle Cloud is integrated into Blender. This allows you to deploy your apps directly from Blender to Needle Cloud.

1. **Install the Blender integration, if you haven't already.**  
   See [this page](./../blender/) for more info.

2. **Find the `Needle Engine` panel in the scene tab.**  
   This panel is used to configure the export settings for your web project and app.

3. **Click on `Upload to Needle Cloud`.**  
   This will build your app, and upload it to Needle Cloud.

   ![Needle Cloud Blender Integration](/blender/blender-deploy-to-needle-cloud.webp)

## <logo-header logo="/imgs/needle-logo.webp" alt="Needle Cloud">Deploy from the CLI</logo-header>

Deploy to Needle Cloud from the command line‚Äîperfect for web projects, automation, and CI/CD pipelines.

**Prerequisites:** [Node.js](https://nodejs.org/) installed on your machine. Check with `node -v` in your terminal.

### Basic Usage

**Option 1: npx (Recommended)**

No installation needed‚Äîuse `npx` to run the CLI directly:

```bash
npx needle-cloud deploy '/dist' --team 'My team' --name 'some-project-id'
```

**Option 2: Global Installation**

Install once, use everywhere:

```bash
npm install -g needle-cloud
needle-cloud deploy '/dist' --team 'My team' --name 'some-project-id'
```

### <logo-header logo="/imgs/github-logo.webp" alt="GitHub">CI/CD & Automated Deployments</logo-header>

Deploy automatically from GitHub Actions, GitLab CI, or other CI/CD platforms using access tokens.

**Create an Access Token:**
1. Go to [your team page](https://cloud.needle.tools/team) on Needle Cloud
2. Create a token with `read/write` permissions
3. Add it as a secret in your CI/CD platform

**GitHub Actions Example:**

Use the official [Needle Cloud GitHub Action](https://github.com/marketplace/actions/deploy-to-needle-cloud):

```yml
- name: Deploy to Needle Cloud
  uses: needle-tools/deploy-to-needle-cloud-action@v1
  with:
    token: ${{ secrets.NEEDLE_CLOUD_TOKEN }}
    dir: ./dist
    name: my-project
```

**CLI Command with Token:**

```bash
npx needle-cloud deploy '/path/to/output' \
  --team 'My team' \
  --name 'project-id' \
  --token '<access_token>'
```

### Starting the Needle License Server

For CI/CD systems and automated builds, you can start the Needle license server using:

```bash
npx --yes needle-cloud start-server
```

This is required when running automated builds on CI/CD systems to validate your Needle Engine PRO license.

### Getting Help

```bash
# See all available commands
npx needle-cloud help

# Get help for a specific command
npx needle-cloud help deploy
```

[üì¶ Full CLI documentation on npm](https://www.npmjs.com/package/needle-cloud)

## Deployment URLs & Version Management

Needle Cloud gives you powerful URL-based version control for your deployments. Every upload creates a permanent URL, and you can use labels to manage which version users see.

### Two Types of URLs

**1. Pinned URLs** ‚Äì Link to exactly one version (never changes)

Each deployment gets a unique, permanent URL that always points to that specific version:

- [collaborativesandbox-zubcks1qdkhy<strong>-1qdkhy</strong>.needle.run](https://collaborativesandbox-zubcks1qdkhy-1qdkhy.needle.run/) ‚Üí Version 1
- [collaborativesandbox-zubcks1qdkhy<strong>-2e2spt</strong>.needle.run](https://collaborativesandbox-zubcks1qdkhy-2e2spt.needle.run/) ‚Üí Version 2

These URLs never change, even when you upload new versions. Perfect for archiving or testing specific builds.

**2. Labeled URLs** ‚Äì Dynamic links that update when you move the label

Labels are pointers you can move between versions. Share the labeled URL once, then update what it points to:

| Label URL | Purpose | Updates When |
| --- | --- | --- |
| `projectname-`**`latest`**`.needle.run` | Always shows newest upload | Automatically on every new upload |
| `projectname.needle.run` (or `-`**`main`**) | Production/stable version | You manually promote a version to `main` |

### Typical Workflow

1. **Deploy a new version** ‚Üí Gets pinned URL like `project-abc123.needle.run`
2. **`latest` label auto-updates** ‚Üí Your team sees it at `project-latest.needle.run`
3. **Review and test** ‚Üí Share the pinned URL or `latest` with your team
4. **Promote to `main`** ‚Üí Move the `main` label to this version
5. **Clients see the update** ‚Üí `project.needle.run` now shows the new version

:::tip Why This Matters
- **Client links never break** ‚Äì Share `project.needle.run` once, update behind the scenes
- **No more "v2 link"** ‚Äì Labels let you update what users see without new URLs
- **Safe rollbacks** ‚Äì Move the `main` label back to a previous version instantly
- **Preview specific builds** ‚Äì Send pinned URLs for exact version testing
:::

### Managing Labels

On the Needle Cloud website, click <kbd>‚ãÆ</kbd> next to any version to move labels:
- **Set main label** ‚Äì Promote this version to production
- **Remove main label** ‚Äì Unpromote (label stays on previous version)

:::info Custom Labels Coming Soon
The ability to create custom labels like `staging`, `beta`, or `client-preview` is planned for a future release. Currently, you can use `main` and `latest`, plus access any version via its pinned URL.
:::

![Needle Cloud Version List](/cloud/cloud-edit-page.webp)

## Securing Pages

The Needle Cloud dashboard allows you to password-protect your pages and assets to ensure data remains confidential until a product's release. This is particularly useful when collaborating with clients.

<video-embed src="https://www.youtube.com/watch?v=6JsC9TruZQY" limit_height />

### How to Set a Password

1. Navigate to the project you wish to protect.
2. Click on "edit info".
3. Locate the password section.
4. Enter the desired password.
5. Click on "save changes".

A small lock icon üîí will now appear next to the project name, indicating that the pages are protected.

### How to Remove the Password Protection

If you wish to make the pages public under the same URL, you must remove the password protection.

1. Navigate back to the project's "edit info"
2. Remove the existing password.
3. Save the changes.

The pages will now be accessible again without requiring a password.

### Accessing Protected Pages

When a user attempts to access the latest version of the asset, they will be greeted with a page that asks for authentication. They must enter the correct password to access the content.

:::important
All pages for this asset will be password-protected, including the main one.
:::

## Cloud Assets

Needle Cloud is not just for hosting apps‚Äîit's a powerful asset management system for 3D files.

### Upload & Optimize

**Drag and drop** files into the website or select them from your computer. Supported formats include glTF, USD, FBX, VRM, OBJ, and more.

- Non-glTF files are automatically converted to glTF for optimization
- Original files are kept for download
- Automatic compression with Draco, KTX2, and Progressive Loading
- Typically saves 90% or more bandwidth and memory

### Version Control & Sharing

**Track multiple versions** of each asset:
- Upload new versions anytime
- Label versions as `main`, `experimental`, `dev`, etc.
- `Latest` always points to the most recent upload
- Share tagged links that auto-update when you move labels

**Share with your team:**
- Create direct download links
- Share Needle Cloud viewer links
- Password-protect sensitive assets

### Use Assets in Your Projects

**In Needle Engine:**

Use the `Needle Cloud Asset` component to load assets at runtime. Keeps project sizes small and enables cloud updates.

:::tip Progressive Loading
Cloud assets automatically load only what's needed using our Progressive Loading technology. This saves ~90% bandwidth and memory compared to loading full assets.
:::

**In Other Engines (Unity, Unreal, etc.):**

Three ways to use cloud assets:

1. **Download and Import** ‚Äì Standard workflow
2. **Direct Link** ‚Äì Link to cloud asset for automatic updates
   - Progressive Loading: Use `Progressive-World` or `Progressive-Product` link ([learn more](https://www.npmjs.com/package/@needle-tools/gltf-progressive))
   - Draco + KTX2: Use `Optimized` link
   - Basic glTF: Use `Upload` or `Converted` link
3. **Needle Cloud Asset Component** ‚Äì For Needle Engine projects (works in Unity builds too)

### Embed on Your Website

**Option 1: Needle Cloud Viewer** (Quick embed)

Go to asset's Edit Page ‚Üí <kbd>Embed</kbd> ‚Üí Copy iframe code. Embed specific versions or tagged versions that auto-update.

**Option 2: Choose Your Framework**

Get optimized embed code for:
- **Needle Engine** ‚Äì Full-featured [web component](./../three/)
- **three.js** ‚Äì With Progressive Loading support
- **React-Three-Fiber** ‚Äì With Progressive Loading support
- **model-viewer** ‚Äì Simple, non-interactive 3D viewer
- **Unity** ‚Äì Needle Cloud Asset component for direct integration

### CLI for Batch Processing

Automate uploads and optimization with the `needle-cloud` CLI:

```bash
# Upload and optimize files
npx needle-cloud upload path/to/file.fbx --team 'My Team'

# Batch process entire folders
npx needle-cloud upload path/to/folder --recursive
```

**Use cases:**
- Part of a build step (replace assets with optimized versions)
- Batch processing large numbers of files
- CI/CD integration

[üì¶ Full CLI documentation](https://www.npmjs.com/package/needle-cloud)

## Supported 3D Formats

1. **glTF and GLB** <a href="https://cloud.needle.tools/view?file=2oAMeWZ1hWL3C-latest-product" target="_blank">Example</a>   
   The glTF format is the most widely supported format for 3D on the web. It is a lightweight format that can store 3D models, animations, and textures. GLB files are binary versions of glTF files, where all data is stored in a single file.
   glTF supports advanced compression techniques like Draco, KTX2, and Meshopt, which are fully supported by Needle Cloud and Needle Engine.

2. **OpenUSD**   
   USD is a powerful format for 3D data interchange. It is known for its use in the film and VFX industry, and is gaining popularity in the game industry. Needle Cloud supports USDZ and USD files natively through our work on USD-WASM, and also converts USD files to glTF for further processing and optimization.

3. **FBX**  
   FBX has been a popular format for 3D data interchange for many years, but is lacking a number of modern features like PBR materials and extensions. Needle Cloud converts FBX files to glTF for further processing and optimization.  

4. **VRM**  
   VRM is a format for humanoid avatars. It is based on glTF with additional constraints through the use of glTF extensions. Needle Cloud supports VRM files natively, and can optimize them like other glTF files, including complex VRM extensions like phonemes, toon shading and dynamic bones.

5. **OBJ**  
   OBJ is a simple text-based format for 3D models. It supports basic materials through MTL files, animations, and hierarchies of objects. Needle Cloud converts OBJ files to glTF for further processing and optimization. 

:::tip Use glTF or USD when possible
We recommend glTF and USD as the primary formats for 3D data interchange. They are widely supported, have modern features and a good material model.
:::

## RBAC (role-based access control)

Teams consist of members, and each member of a team can get assigned a role. These roles define what you can and cannot do within a team on Needle Cloud.

As your project scales and you add more team members, you can assign them roles to ensure that they have the right permissions to work on your projects.

| | |
| -- | -- |
| **Owner** | Highest level of authority. The owner role can manage the whole team (including billing and member roles), see all projects, uploads and deployments  |
| **Manager** | The manager role can manage the whole team (including billing and member roles), see all projects, uploads and deployments |
| **Billing** | The billing role is specialized for financial operations, can oversee the team's billing information, review and manage project cost and handle payment options. <br/>The billing role has view-only access to deployments and assets and can not perform deployments or upload assets. <br/>The billing role can be assigned at no extra cost. The role is limited to one member per team. |
| **Member** | The member role (developer role) can create deployments, upload/download assets for optimization or use AI features. |

## FAQ

1. **What is Needle Cloud?**   
   It‚Äôs an online service to upload, compress and share 3D assets and scenes.

2. **How do I upload assets to Needle Cloud?**   
   You can upload files by dragging them onto the website, or by uploading them directly from supported integrations. If you have many files, you can use the CLI (command line interface) or the API (application programming interface).

3. **How do I download optimized files from Needle Cloud?**   
   You can download files from the website. Click on `Share` and then `Download`. You can also use the CLI to download files.

4. **Can I share my files with others?**   
   Yes, you can create links to share your files. Links can either be direct download links, or links to the Needle Cloud viewer.

5. **Is there a limit to file sizes?**   
   Upload limits depend on your plan. Check your account details for more info.

6. **Can Needle Cloud files be used with other tools?**   
   Yes, you can use your files in other programs by exporting them as glTF. USD export is coming at a later point.

7. **What happens if I run out of storage space?**   
   You might need to upgrade your plan or delete old files to make room.

8. **More answers**   
   Visit the [Needle Cloud FAQ](https://cloud.needle.tools/faq)
Source: https://engine.needle.tools/docs/cloud/index.html

<br/>
<!-- <div class="centered" style="display: flex;
    align-items: center;
    gap: 20px;
    font-size: 2em;
    font-weight: 100;">
    <img src="/logo.png" style="max-height:70px;" title="Needle Logo" alt="Needle Logo"/> 
    +
    <span style="font-size: 50px;">‚ú®</span> 
</div> -->

# Integrate with other tools

Needle Engine is designed to be flexible and extensible. It can be integrated with other tools and services to improve your workflow for bringing rich, interactive 3D to the web from any software.

At the core of a custom integration with Needle Engine is the glTF 3D format. This is the most widely supported format for 3D on the web, and the most versatile. This lightweight format can store 3D models, animations, textures, and all kinds of extra data. glTF is extensible, which is exactly why we chose it as the basis for Needle Engine. It allows us to add rich features and interactive capabilities to 3D files, including better rendering, physics, interactions, XR, networking, and more.

As a result of using the standardized glTF format for interchange, creating a basic integration into any software is easy ‚Äì just export your 3D assets as glTF files and import them into Needle Engine. From there, you can add more features to your integration, to support our scripting extensions. Usually, this is done via a plugin, extension or export hook in your 3D software.

## Structure of a custom integration
The structure of a custom integration looks like this:

1. Export your 3D assets as glTF files. At this point, your integration is likely as simple as clicking the export button in your 3D software.
2. Use the glTF file in a web project using Needle Engine.
   - This can be a web project created with another integration, downloaded from a sample, or a new web project made with `npx needle-create`.
   - Export the glTF file into the `assets` folder. Your web app should automatically refresh whenever you re-export the glTF file.
3. At this point, you have a basic functional integration, and you could already add custom functionality via TypeScript in the web project.
4. The next step is to add a way to create and adjust components in your software. Depending on the software, this can be done through a custom UI, a script, or a plugin.
   - To start, try with a component like `DragControls`. It has a few options, but the defaults are good enough to get started.
   - Then, move onto components that require configuration. A good starting point are our `Everywhere Actions`, because they allow creators to build a wide range of interactive experiences without needing to write any code.
5. Export those components as part of the `NEEDLE_components` glTF extension for each node. Usually, this is done by adding a custom glTF extension or hook to the existing glTF exporter in your software.
6. Integrate with a web project so that UI can be generated for custom components. For Unity and Blender, we call this `Component Compiler` ‚Äì it automatically creates a UI for the components in your project, and serves as a bridge between TypeScript components and your 3D software.

## Integrate the web project workflow

A fully-flegded integration might also manage more of the web project workflow. All of these operations can be done from the command line, but for ease of use, they can be neatly wrapped in a GUI or a custom menu in your 3D software. This includes:

1. Creating a new project or changing the location of the web project
2. Running the web project from within your 3D software
   - Our [Unity integration](./../unity/) overrides the "Play" button to run the web project.
   - The [Blender integration](./../blender/) has a custom "Play" button that runs the web project.
3. Building the web project to a folder
4. Uploading the built project to Needle Cloud or another platform, and remembering the Project ID and Team ID
   - Our Unity integration additionally shows the last uploads for your team, and allows you to jump to the last deployment of a project.
5. Uploading/downloading individual assets to Needle Cloud or another platform

:::tip Reach out if you're planning to build a custom integration!
Please reach out to us if you are interested in building a custom integration. We are happy to help you with the process, and explain more of the details. For Enterprise customers, we also provide custom integrations as a service.
:::
Source: https://engine.needle.tools/docs/custom-integrations/index.html

---
lang: en-US
title: Getting Started & Installation
description: Install Needle Engine and create your first interactive 3D web experience with Unity, Blender, or JavaScript in minutes.
next: ../project-structure.md
---

<discountbanner />

# Getting Started with Needle Engine

**Build fully interactive 3D websites using your favorite tools.** Needle Engine works with professional 3D editors and modern web frameworks, giving you the power to create rich web experiences that deploy anywhere.

## What You'll Get

With Needle Engine, you get:
- üé® **Visual authoring** in Unity or Blender
- üöÄ **Automatic optimization** with state-of-the-art compression (up to 100x smaller files)
- üì± **Cross-platform** support (desktop, mobile, VR, AR)
- ‚ö° **Hot reload** for instant feedback during development
- üåê **Deploy anywhere** on the web with a single command

---

## Choose Your Workflow

Pick the tool that matches your skills and project needs:

<tool-tiles></tool-tiles>

### Which Tool Is Right for You?

**<logo-header logo="/imgs/unity-logo.webp" alt="Unity">Unity Integration</logo-header>**
- üíº Professional game development workflows
- üéÆ Extensive asset ecosystem
- üìú C# scripting support
- üîß Advanced editor features
- [Learn more about Unity Integration](../unity/)

**<logo-header logo="/blender/logo.png" alt="Blender">Blender Add-on</logo-header>**
- üÜì Free and open-source
- üé® Powerful modeling and animation tools
- üêç Python scripting
- üí™ Industry-standard workflows
- [Learn more about Blender Integration](../blender/)

**<logo-header logo="/imgs/threejs-logo.webp" alt="three.js">Vanilla JavaScript</logo-header>**
- üíª No 3D editor needed
- üåê Pure web development
- üì¶ Use with any framework (React, Vue, Svelte, etc.)
- ‚ú® Full three.js compatibility
- [Learn more about three.js Integration](../three/)

---

## Install a Code Editor

**Visual Studio Code is recommended** for creating and editing JavaScript, TypeScript, HTML, and CSS files. It's a free, open-source editor that works on all platforms and integrates seamlessly with Needle Engine.

<ClientOnly>

<os-link windows_url="https://code.visualstudio.com/sha/download?build=stable&os=win32-x64-user" osx_url="https://code.visualstudio.com/sha/download?build=stable&os=darwin-universal">Download Visual Studio Code</os-link>

</ClientOnly>

**Why VS Code?**
- Built-in TypeScript support
- Excellent debugging tools
- Rich extension ecosystem
- Live Server support for local development
- Git integration

---

## Required Tools

:::tip Automatic Installation with Unity or Blender
When using the Unity or Blender integration, we'll guide you through installing these tools automatically. You don't need to install them manually.
:::

The following tools are used by Needle Engine to create, preview, and build your web app:

<ClientOnly>

### Node.js (Required)

<os-link windows_url="https://fwd.needle.tools/needle-engine/nodejs/win" osx_url="https://fwd.needle.tools/needle-engine/nodejs/osx">Download Node.js 20 LTS or 22 LTS</os-link>

**What it does:**
- Manages your web project dependencies
- Runs a local development server with hot reload
- Builds and optimizes your project for production
- Handles deployment to hosting platforms

### KTX Software (Recommended)

<os-link windows_url="https://fwd.needle.tools/needle-engine/toktx/win" osx_url="https://fwd.needle.tools/needle-engine/toktx/osx" osx_silicon_url="https://fwd.needle.tools/needle-engine/toktx/osx-silicon">Download toktx texture tools</os-link>

**What it does:**
- Compresses textures for optimal web performance
- Reduces file sizes dramatically without quality loss
- Creates GPU-compressed formats (KTX2)
- Required for production builds

[Learn more about production builds](../deployment#production-builds)

</ClientOnly>

---

## Quick Start Paths

Choose your path based on your preferred tool and workflow:

### Path 1: Start with Unity

**Best for:** Game developers, Unity users, teams with existing Unity projects

<logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="https://engine.needle.tools/downloads/unity?utm_source=needle_docs&utm_content=getting_started">Download Needle Engine for Unity</a></logo-header>

**What you'll learn:**
- Install Needle Engine in Unity
- Create your first interactive 3D scene
- Export and preview in the browser
- Add interactivity with components

**üëâ [Start Unity Tutorial ‚Üí](/docs/unity/)**

**Supported Unity versions:** 2020.3.16+, 2021.3.9+, 2022.3.0+

---

### Path 2: Start with Blender

**Best for:** 3D artists, Blender users, open-source enthusiasts

<logo-header logo="/blender/logo.png" alt="Blender"><a href="https://engine.needle.tools/downloads/blender?utm_source=needle_docs&utm_content=getting_started">Download Needle Engine for Blender</a></logo-header>

**What you'll learn:**
- Install the Blender add-on
- Set up your first web project
- Export scenes to the web
- Add Needle components

**üëâ [Start Blender Tutorial ‚Üí](/docs/blender/)**

**Supported Blender versions:** 4.1+

---

### Path 3: Start with Web Code

**Best for:** Web developers, three.js users, integration into existing sites

**Quick options:**

**CDN (Fastest):**
```html
<script type="module" src="https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js"></script>
<needle-engine src="your-scene.glb"></needle-engine>
```

**NPM (Production):**
```bash
npm install @needle-tools/engine
```

**üëâ [Start three.js Tutorial ‚Üí](/docs/three/)**

---

## Your First Project

Ready to build something? Follow one of our step-by-step tutorials:

### üéì For Unity Users
**[Your First Unity Project ‚Üí](/docs/unity/)** - Create an interactive 3D scene in Unity and export it to the web in minutes.

### üéì For Blender Users
**[Your First Blender Project ‚Üí](/docs/blender/)** - Build a web-ready 3D experience using the Blender add-on.

### üéì For Web Developers
**[Your First Web Project ‚Üí](/docs/three/)** - Integrate Needle Engine into your existing web project with JavaScript.

### üöÄ Beyond the Basics

After completing your first project, explore these tutorials:

- **[TypeScript Essentials](/docs/tutorials/fundamentals/typescript-essentials)** - Learn TypeScript for custom components
- **[Create Custom Components](/docs/how-to-guides/scripting/create-components)** - Add interactivity with code
- **[Deploy Your Project](/docs/how-to-guides/deployment/)** - Publish your 3D experience to the web

1. **[TypeScript Essentials](/docs/tutorials/fundamentals/typescript-essentials)** - Learn TypeScript for custom components
2. **[Create Custom Components](/docs/how-to-guides/scripting/create-components)** - Add interactivity with code
3. **[Deploy Your Project](/docs/how-to-guides/deployment/)** - Publish your 3D experience to the web

---

## Next Steps

### üìö Learn by Doing (Tutorials)

New to Needle Engine? Start with these learning-oriented guides:

- **[TypeScript Essentials](/docs/tutorials/fundamentals/typescript-essentials)** - Learn TypeScript basics for web development
- **[Needle Engine for Unity Developers](/docs/tutorials/fundamentals/for-unity-developers)** - Key differences from traditional Unity
- **[Your First Interactive Scene](/docs/unity/)** - Build something real (Unity)
- **[Your First Interactive Scene](/docs/blender/)** - Build something real (Blender)

### üõ†Ô∏è Solve Specific Problems (How-To Guides)

Know what you want to build? Jump straight to task-oriented guides:

- **[Export 3D Content](/docs/how-to-guides/export/)** - Get your models and assets web-ready
- **[Create Custom Components](/docs/how-to-guides/scripting/create-components)** - Add interactivity with code
- **[Deploy Your Project](/docs/how-to-guides/deployment/)** - Publish to hosting platforms
- **[Enable WebXR](/docs/how-to-guides/xr/)** - Build VR and AR experiences
- **[Add Multiplayer](/docs/how-to-guides/networking/)** - Create networked experiences

### üí° Understand the Concepts (Explanation)

Want to understand how Needle Engine works under the hood?

- **[Project Structure](/docs/explanation/core-concepts/project-structure)** - Editor vs web project architecture
- **[Technical Architecture](/docs/explanation/architecture/technical-overview)** - How glTF extensions work
- **[Component System](/docs/explanation/core-concepts/component-system)** - Component lifecycle and design

### üìñ Look Things Up (Reference)

Need to find specific information quickly?

- **[Component Catalog](/docs/reference/components)** - All 100+ built-in components
- **[API Documentation](https://engine.needle.tools/docs/api/)** - Complete TypeScript API
- **[Features Overview](/docs/explanation/core-concepts/features-overview)** - Platform compatibility matrix
- **[FAQ](/docs/reference/faq)** - Common questions and troubleshooting

### üé® Get Inspired

- **[Samples & Showcase](https://samples.needle.tools/#showcase)** - Explore interactive samples and see what others have built

### üí¨ Get Help

- **[Discord](https://discord.needle.tools)** - Join our community for live support
- **[Forum](https://forum.needle.tools/?utm_source=needle_docs&utm_content=content)** - Ask questions and share projects
- **[FAQ](/docs/reference/faq)** - Common issues and solutions

---

:::tip Need Help?
If you run into issues during setup, check out our [FAQ](../reference/faq) or join our [Discord community](https://discord.needle.tools) where we're happy to help!
:::
Source: https://engine.needle.tools/docs/getting-started/index.html

---
title: Explanation
description: Understand how Needle Engine works under the hood
---

# Explanation

**Deepen your understanding.** These pages explain concepts, design decisions, and architecture. They help you build a mental model of how Needle Engine works.

**Not sure what you need?**
- Need to **learn the basics**? See [Tutorials](../tutorials/)
- Want to **solve a specific problem**? See [How-To Guides](../how-to-guides/)
- Looking for **API reference**? See [Reference](../reference/)

---

## What is Explanation?

Explanation is **understanding-oriented** documentation that provides context and clarification. It:
- Discusses concepts and ideas
- Provides historical context and reasoning
- Explains design decisions and trade-offs
- Connects topics across the system

---

## Core Concepts

Fundamental concepts to understand:

- [Vision & Philosophy](./core-concepts/vision) - Why Needle Engine exists
- [Technical Architecture](./architecture/technical-overview) - How it all works
- [Project Structure](./core-concepts/project-structure) - Editor vs web projects
- [Features Overview](./core-concepts/features-overview) - Complete feature set
- [Component Compiler](./core-concepts/component-compiler) - TypeScript to C# generation

---

## Architecture

Deep dives into system architecture:

- [Technical Overview](./architecture/technical-overview) - Complete system overview including glTF pipeline, three.js integration, and build types

---

## Need Help?

- **Want to learn by doing?** See [Tutorials](../tutorials/)
- **Need to solve a problem?** See [How-To Guides](../how-to-guides/)
- **Looking for API docs?** See [Reference](../reference/)
- **Have questions?** Ask in [Discord](https://discord.needle.tools)
Source: https://engine.needle.tools/docs/explanation/index.html

---
title: Help & Community
description: Get help and connect with the Needle Engine community
---

# Help & Community

**Get support.** Find answers, ask questions, and connect with the Needle Engine community.

## Quick Help

### Debugging & Tools
- [Needle Inspector](/docs/three/needle-devtools-for-threejs-chrome-extension) - Chrome DevTools extension for three.js
- [Debugging Parameters & Options](/docs/how-to-guides/debugging/) - URL parameters, VSCode debugging, mobile debugging
- [Local Development Help](/docs/how-to-guides/testing) - Testing on phones, tablets, VR headsets, certificates
- [FAQ](/docs/reference/faq) - Frequently asked questions and troubleshooting

### AI Assistant
- [AI Assistant & MCP Server](/docs/ai/) - Use Claude and other AI tools with Needle Engine

### Documentation
- [Tutorials](/docs/tutorials/) - Learn step-by-step
- [How-To Guides](/docs/how-to-guides/) - Solve specific problems
- [Reference](/docs/reference/) - API documentation

## Community Support

### Discord Server
Join our active Discord community for real-time help:

<actiongroup>
<action href="https://discord.needle.tools" icon="üí¨">
Join Discord Server ‚Üí
</action>
</actiongroup>

**Best for:** Quick questions, real-time discussions, community showcase

### Forum
Ask detailed questions and get thorough answers:

<actiongroup>
<action href="https://forum.needle.tools/?utm_source=needle_docs&utm_content=help_page" icon="üí≠">
Visit Forum ‚Üí
</action>
</actiongroup>

**Best for:** In-depth technical questions, sharing projects, long-form discussions

## Official Support

### Email Support
For commercial support, licensing, and partnership inquiries:

<actiongroup>
<action href="mailto:hi+docs@needle.tools" icon="üìß">
Email Support ‚Üí
</action>
</actiongroup>

### Feedback
Help us improve Needle Engine:

<actiongroup>
<action href="https://fwd.needle.tools/needle-engine/feedback" icon="üìù">
Submit Feedback ‚Üí
</action>
</actiongroup>

## Stay Updated

### Newsletter
Get updates on new features and releases:

<actiongroup>
<action href="https://fwd.needle.tools/needle-engine/newsletter" icon="üì¨">
Subscribe to Newsletter ‚Üí
</action>
</actiongroup>

### Social Media
Follow us for updates and community highlights:

- [Twitter/X](https://twitter.com/needletools) - News and updates
- [YouTube](https://www.youtube.com/@needle-tools) - Video tutorials and demos
- [GitHub](https://github.com/needle-tools) - Source code and issues

## Learning Resources

### Video Tutorials
- [Tutorials on YouTube](https://www.youtube.com/playlist?list=PLJ4BaFFEGP1GVTmPhKDC6QzL8Am9700Wo) - Step-by-step video guides
- [Interviews on YouTube](https://www.youtube.com/playlist?list=PLJ4BaFFEGP1EOHCjYszc__d2yO7RkB-iw) - Developer interviews

### Documentation
- [Getting Started](/docs/getting-started/) - Installation and setup
- [Tutorials](/docs/tutorials/) - Learn by building projects
- [How-To Guides](/docs/how-to-guides/) - Task-oriented guides

## Report Issues

### Bug Reports
Found a bug? Report it on GitHub:

<actiongroup>
<action href="https://github.com/needle-tools/needle-engine-support/issues" icon="üêõ">
Report Bug ‚Üí
</action>
</actiongroup>

### Documentation Issues
Found an error in the docs?

<actiongroup>
<action href="https://github.com/needle-tools/needle-engine-support/issues" icon="üìÑ">
Report Documentation Issue ‚Üí
</action>
</actiongroup>

## Testimonials

See what developers are saying about Needle Engine:

- [Testimonials](/docs/help/testimonials) - Community feedback and quotes

---

## Need Help Right Now?

1. **Check the FAQ** - [FAQ](/docs/reference/faq)
2. **Search the docs** - Use the search bar above
3. **Try AI Assistant** - [Needle MCP Server](/docs/ai/) for AI-powered help
4. **Ask on Discord** - [Discord Server](https://discord.needle.tools)
5. **Post on Forum** - [Forum](https://forum.needle.tools)
Source: https://engine.needle.tools/docs/help/index.html

# Needle Support

## Links

- **[Community Forum](https://forum.needle.tools)** ‚Äî Ask questions and get help in our community forum  
- **[Discord](https://discord.needle.tools/?utm_source=needle_docs&utm_content=content)** ‚Äî Chat with the community and share your projects
- **[Needle AI](./ai/index)** ‚Äî Get instant answers from our AI assistant trained on Needle Engine, documentation and integrations

### Devlogs

<video-embed src="https://www.youtube.com/watch?v=9v0C7Xa6TUE" />

<video-embed src="https://www.youtube.com/watch?v=z_w3Hrzq-7o&ab_channel=Needle" />

<video-embed src="https://www.youtube.com/watch?v=gQ0lXGCrzi8&t=1s&ab_channel=Needle" />

<br/>
<br/>
<br/>

### User Interviews

<video-embed src="https://www.youtube.com/watch?v=naPlw5aDJHs" />

<video-embed src="https://www.youtube.com/watch?v=1KKfct3Zpcw" />

<video-embed src="https://www.youtube.com/watch?v=gZuC40Alr88" />

<video-embed src="https://www.youtube.com/watch?v=F6_buCHZhWk" />

<video-embed src="https://www.youtube.com/watch?v=3oHyrx8e20g" />

### Find more [interviews on youtube](https://www.youtube.com/playlist?list=PLJ4BaFFEGP1EOHCjYszc__d2yO7RkB-iw)

<br/>
<br/>

::: info You made a cool project?
Don't hestitate to [reach out](mailto:hi@needle.tools) ‚Äì we always love seeing what you built üíö 
:::
Source: https://engine.needle.tools/docs/help/support.html

---
next: getting-started/
---

# Testimonials

<p></p>

<testimonial
  name="Chris Mahoney"
  role="Founder, Our Computer Company. Ex-Unity, Ex-Lamina1"
  src="https://x.com/mahoneymatic/status/1562981022932684800?t=qNqojoZkk2CZrJa7dGzqng&s=19"
  img="./testimonial/ChrisMahoney.webp"
>
Unbelievable Unity editor integration by an order of magnitude,  
  and as straightforward as the docs claim. Wow.
</testimonial>

<testimonial 
  name="Kevin Curry" 
  role="Founder, Intangible.ai. Ex-Unity"
  src="https://x.com/kmcurry/status/1574333302022062080"
  img="./testimonial/KevinCurry.webp"
>
needle.tools is a wonderful showcase of what @NeedleTools contributes to 3D via the web. I just love it.
</testimonial>

<testimonial
  name="Brit Gardner"
  role="Senior Software Engineer, Coherence. Ex-Blizzard"
  src="https://x.com/britg/status/1562443905580163072"
  img="./testimonial/BritGardner.webp"
>
Played with this a bit this morning ü§Øü§Ø pretty magical
</testimonial>

<testimonial
  name="Marc Wakefield"
  role="Augmented Reality Expert"
  src="https://x.com/mrm_design/status/1567391880169545729"
  img="./testimonial/MarcWakefield.webp"
>
This is huge for WebXR and shared, immersive 3D experiences! Thank you so much for putting in the work on this @NeedleTools crew! Hoping @Apple
 sort out their WebXR situation sooner rather than later. The AR part worked flawlessly on my @SamsungMobile S21.
</testimonial>

<testimonial
  name="Rinesh Thomas"
  role="Game Developer, Assassin's Creed VR"
  src="https://x.com/rineshthomas/status/1566342798063947777?t=z6sG3Z7mol-NfIRfTTKqCQ&s=19"
  img="./testimonial/RineshThomas.webp"
>
    This is the best thing I have seen after cinemachine in unity. Unity should acquire this
</testimonial>

<testimonial
  name="Stella Cannefax"
  role="CTO Dora, Game Developer"
  src="https://x.com/0xstella/status/1574853012585172993"
  img="./testimonial/StellaCannefax.webp"
>
Thanks to @NeedleTools, seeing quite a bit of this solution for web-based real time 3d tools - export scenes from Unity, where you can leverage the extensive 3d editor ecosystem & content, and then render them in your own web-based engine
</testimonial>

<testimonial
  name="Pete Patterson" 
  role="Spatial Computing Specialist"
  src="https://x.com/VRSpatialist/status/1572300394285383680"
  img="./testimonial/PetePatterson.webp"
>
Finally checking out @NeedleTools with Unity. Super easy to get something up and running in the cloud using their
 integrations
</testimonial>

<testimonial 
  name="Dilmer Valecillos" 
  role="Developer Advocate for Mixed Reality @Meta, Tutorial Creator"
  src="https://x.com/Dilmerv/status/1562209049856188420"
  img="./testimonial/DilmerValecillos.webp"
>
 This is amazing and if you are curious about #WebXR with Unity this will help us get there
</testimonial>

<testimonial 
  name="VRSpatialist" 
  src="https://discord.com/channels/717429793926283276/722046635525537842/1030201907513405530"
  img="./testimonial/VRSpatialist.webp"
>
 I am a long time Unity dev and recently started playing with Needle Tools and I love it! It's a great on ramp for Unity devs who want to learn WebXR and three.js. The runtime engine is awesome and it was pretty easy to create my own custom component
</testimonial>

<testimonial
  name="Unity for Digital Twins"
  role="Powering the enterprise metaverse"
  src="https://x.com/DigitalTwin/status/1576934958681055233"
  img="./testimonial/UnityforDigitalTwins.webp"
>
We just gotta say WOW ü§©
</testimonial>

<testimonial
  name="Matthew Pieri" 
  role="Game Developer"
  src="https://discord.com/channels/717429793926283276/1097572505738301571/1097572505738301571"
  img="./testimonial/MatthewPieri.webp"
>
Spent the last 2.5 months building this game, never built a game/never used unity before, but absolutely loving the whole process with needle tools. So rapid!  Would love to make a career building AR experiences! 
</testimonial>

<testimonial 
  name="Yuzu" 
  role="Web Game Developer"
  src="https://discord.com/channels/717429793926283276/1264966222467043433/1265268833485066240"
  img="./testimonial/Yuzu.webp"
>
My workflow has been optimized 10X ever since i started using needle
</testimonial>
Source: https://engine.needle.tools/docs/help/testimonials.html

---
title: How-To Guides
description: Task-oriented guides for solving specific problems
---

# How-To Guides

**Get things done.** These guides show you how to solve specific problems and accomplish particular tasks. They assume you already know what you want to achieve.

**Not sure what you need?**
- Need to **learn the basics**? See [Tutorials](/docs/tutorials/)
- Want to **understand concepts**? See [Explanation](/docs/explanation/)
- Looking for **API reference**? See [Reference](/docs/reference/)

---

## What are How-To Guides?

How-To Guides are **task-oriented** instructions. They are:
- Focused on accomplishing specific goals
- Action-oriented with clear steps
- Assume you understand the basics
- Get straight to the point

---

## Setup & Installation

Get Needle Engine installed and configured:

- [Install for Unity](/docs/unity/) - Unity-specific workflows and features
- [Install for Blender](/docs/blender/) - Blender-specific workflows and features
- [Install for Web Projects](/docs/getting-started/) - Getting started guide

---

## Export & Assets

Get your 3D content ready for the web:

- [Export 3D Content](./export/) - Overview of export workflow
- [Use MaterialX](./export/materialx) - Complex material networks

---

## Components

Use built-in components for common features:

- [Camera Controls (OrbitControls)](./components/orbit-controls) - The core camera controller for navigating 3D scenes
- [Contact Shadows](./components/contact-shadows) - Add realistic ground shadows to your scene
- [Cursor Follow](./components/cursor-follow) - Make objects follow the mouse or touch position
- [Drag and Drop Files](./components/droplistener) - Let users drop 3D models into your scene
- [Drag Objects (DragControls)](./components/drag-controls) - Make objects draggable with mouse, touch, or VR controllers
- [Duplicate Objects (Duplicatable)](./components/duplicatable) - Spawn copies by clicking and dragging
- [Scene Switcher](./components/scene-switcher) - Load and switch interactive glTF content (full scenes or individual assets)
- [Scroll-Based Animations (ScrollFollow)](./components/scroll-follow) - Link scroll position to timelines and animations for storytelling
- [Video Player](./components/video-player) - Play videos, streams, and broadcasts in your scene

---

## <logo-header logo="/imgs/webxr-logo.webp" alt="WebXR">XR Development (VR & AR)</logo-header>

Build immersive experiences:

- [WebXR Overview](/docs/how-to-guides/xr/) - VR and AR development guide
- [iOS WebXR Support](/docs/how-to-guides/xr/ios-webxr-app-clip) - Native iOS WebXR via App Clips
- [Image Tracking](/docs/how-to-guides/xr/image-tracking) - AR image tracking
- [Everywhere Actions](/docs/how-to-guides/everywhere-actions/) - Cross-platform interactive actions (iOS QuickLook)

---

## Multiplayer & Networking

Create real-time collaborative experiences:

- [Networking Overview](/docs/how-to-guides/networking/) - Multiplayer and networking guide
- [Set Up Networking](/docs/how-to-guides/networking/setup) - Quick start (5 minutes)
- [Sync Component State](/docs/how-to-guides/networking/sync-state) - Automatic networking with @syncField
- [Manual Networking](/docs/how-to-guides/networking/manual-networking) - Custom messages and control
- [Custom Servers](/docs/how-to-guides/networking/custom-servers) - Self-hosted infrastructure

---

## Web Integration

Embed Needle Engine in websites and web apps:

- [Web Integration Overview](/docs/how-to-guides/web-integration/) - Frameworks, bundlers, and integration
- [Create Responsive 3D Layouts](/docs/how-to-guides/web-integration/responsive-design) - Focus Rect and ViewBox for adaptive designs
- [Embed in Websites](/docs/how-to-guides/deployment/embedding) - iframe, CDN, direct integration
- <logo-header logo="/imgs/framer-logo.webp" alt="Framer"><a href="/docs/how-to-guides/integrations/framer">Integrate with Framer</a></logo-header> - Framer websites
- <logo-header logo="/imgs/wordpress-logo.webp" alt="WordPress"><a href="/docs/how-to-guides/integrations/wordpress">Integrate with WordPress</a></logo-header> - WordPress sites
- <logo-header logo="/imgs/adobe-experience-manager-logo.webp" alt="Adobe Experience Manager"><a href="/docs/how-to-guides/integrations/adobe-experience-manager">Integrate with Adobe Experience Manager</a></logo-header> - AEM sites and components

---

## Scripting & Development

Build interactive experiences with code:

**Core Concepts:**
- [Create Components](/docs/how-to-guides/scripting/create-components) - Write custom TypeScript components
- [Use Lifecycle Hooks](/docs/how-to-guides/scripting/use-lifecycle-hooks) - awake, start, update, and more
- [Use Coroutines](/docs/how-to-guides/scripting/use-coroutines) - Time-based sequences

**Interaction & Input:**
- [Handle User Input](/docs/how-to-guides/scripting/handle-input) - Mouse, touch, keyboard, VR controllers
- [Perform Raycasting](/docs/how-to-guides/scripting/perform-raycasting) - Detect objects and hit points
- [Use Physics](/docs/how-to-guides/scripting/use-physics) - Rigidbodies, forces, collisions, and triggers

**Platform & Device:**
- [Detect Mobile Devices](/docs/how-to-guides/scripting/detect-mobile-devices) - Platform detection for iOS, Android, and browsers

**Reference & Examples:**
- [Scripting Examples](/docs/reference/scripting-examples) - Code examples and snippets
- [Lifecycle Methods](/docs/reference/api/lifecycle-methods) - Complete lifecycle API reference
- [Input Events](/docs/reference/api/input-events) - Input event reference
- [Physics Events](/docs/reference/api/physics-events) - Collision and trigger events
- [XR Events](/docs/reference/api/xr-events) - WebXR AR/VR events

---

## Deployment & Hosting

Get your projects live on the web:

- [Deployment Platforms](/docs/how-to-guides/deployment/) - Netlify, Vercel, GitHub Pages, and more
- [Embed in Websites](/docs/how-to-guides/deployment/embedding) - iframe, CDN, direct integration
- [Deploy to Needle Cloud](/docs/cloud/) - Official Needle hosting

---

## Optimization & Performance

Make your experiences fast and small:

- [Optimization & Compression](/docs/how-to-guides/optimization/) - Texture/mesh compression, progressive loading, LODs
- [Export Best Practices](/docs/how-to-guides/export/) - Optimize 3D assets for the web

---

## Debugging & Testing

Find and fix issues:

- [Needle Inspector](/docs/three/needle-devtools-for-threejs-chrome-extension) - Chrome DevTools extension
- [Debugging Parameters & Options](/docs/how-to-guides/debugging/) - URL parameters, VSCode debugging, mobile debugging
- [Local Development Help](/docs/how-to-guides/testing) - Testing on phones, tablets, VR headsets, certificates

---

## Need Help?

- **Want to learn the basics?** See [Tutorials](/docs/tutorials/)
- **Want to understand how things work?** See [Explanation](/docs/explanation/)
- **Looking for API docs?** See [Reference](/docs/reference/)
- **Stuck?** Visit [Help & Community](/docs/help/) or check [FAQ](/docs/reference/faq)
Source: https://engine.needle.tools/docs/how-to-guides/index.html

---
title: Local Development Help
---

# Local Development Help

**Test your Needle Engine projects on phones, tablets, VR headsets, and other devices** on your local network.

<logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="/docs/unity/">Unity</a></logo-header> ‚Ä¢ <logo-header logo="/blender/logo.png" alt="Blender"><a href="/docs/blender/">Blender</a></logo-header>

:::tip Also See
- **[Debugging Parameters & Options](/docs/how-to-guides/debugging/)** - URL parameters, VSCode debugging, mobile debugging
- **[Help & Community](/docs/help/)** - Get support and ask questions
:::

## Quick Start for Unity & Blender Users

:::tip Just Press Play!
If you're using the **Unity integration** or **Blender add-on**, you're already set up! Simply press Play and your project automatically opens in your default browser with a local development server running.

**To test on other devices:**
1. Look for the local network URL in the console (e.g., `https://192.168.0.123:3000`)
2. Open that URL on your phone, tablet, VR headset, or other device on the same network
3. If you see a certificate warning, you can either:
   - Click through the warning (works on most platforms)
   - Or follow the [certificate installation steps](#setting-up-a-self-signed-certificate-for-development) below for a smoother experience

**That's it!** The information below is for advanced users who want to understand how the local server works or need to set up custom certificates.
:::

## Advanced: How Local Testing Works

When using our templates, Needle Engine runs a local development server for you. Simply press play, and a website will open in your default browser, ready for testing on your local device. For testing on other devices in the same network, you may have to install a self-signed certificate (see below).

When using a custom setup / framework, please refer to your framework's documentation on how to run a secure local development server.  

::: tip
Our local server uses the IP address in your local network (e.g. `https://192.168.0.123:3000`) instead of `localhost:3000`.  This allows you to quickly view and test your project from mobile devices, VR glasses, and other machines in the same network.   

We're using HTTPS instead of the older HTTP, because modern powerful web APIs like WebXR require a secure connection ‚Äì the S stands for "secure".
:::

## <logo-header logo="/imgs/ssl-icon.webp" alt="SSL">Setting up a self-signed certificate for development</logo-header>

Different operating systems have different security requirements for local development. Typically, displaying a website will work even with a auto-generated untrusted certificate, but browsers may warn about the missing trust and some features are not available. Here's a summary:

::: tip
Installing trusted self-signed certificates on your development devices is recommended for a smooth development experience. Find the steps at the bottom of this page.
:::

**Default ‚Äì with auto-generated untrusted certificate**  
_Displays a certificate warning upon opening the project in a browser._
_Uses the [vite-plugin-basic-ssl](https://github.com/vitejs/vite-plugin-basic-ssl) npm package._

We're using websocket connections to communicate between the browser and the local development server. Websockets require a secure connection (HTTPS) in order to work. Depending on the platform, you might need to set up a custom certificate for local development. Android and Windows don't need a custom certificate, but iOS and MacOS do.

| OS | Viewing in the browser<br/>(with a security warning) | Automatic reloads |
| --- | --- | --- |
| Windows | (‚úì) | ‚úì |
| Linux | (‚úì) | ‚úì |
| Android | (‚úì) | ‚úì |
| macOS | (‚úì) | ‚ùå |
| iOS | (‚úì Safari and Chrome, after page reload)<br/>‚ùå Mozilla XR Viewer | ‚ùå |
| Xcode Simulators | (‚úì after page reload) | ‚ùå |

**With a self-signed, trusted root certificate**  
_No security warning is displayed. You need to install the generated certificate on your device(s)._  
_Uses the [vite-plugin-mkcert](https://github.com/liuweiGL/vite-plugin-mkcert) npm package._

| OS | Viewing in the browser | Automatic reloads |
| --- | --- | --- |
| Windows | ‚úì | ‚úì |
| Linux | ‚úì | ‚úì |
| Android | ‚úì | ‚úì |
| macOS | ‚úì | ‚úì |
| iOS | ‚úì | ‚úì |

### <logo-header logo="/imgs/ssl-icon.webp" alt="SSL">Generating a self-signed development certificate</logo-header>

- in Unity/Blender, click on "Open Workspace" to open VS Code  

- check that you're using `vite-plugin-mkcert` instead of `vite-plugin-basic-ssl` (the latter doesn't generate a trusted root certificate, which we need) in your `vite.config.ts` file:
  - open `package.json`
  - remove the line with `"@vitejs/plugin-basic-ssl"` from `devDependencies`
  - open a Terminal in VS Code and run `npm install vite-plugin-mkcert --save-dev` which will add the latest version
  - open `vite.config.ts` and replace `import basicSsl from '@vitejs/plugin-basic-ssl'` with `import mkcert from'vite-plugin-mkcert'`
  - in `plugins: [`, replace `basicSsl(),` with `mkcert(),`
  - package.json looks like this now: 
  ![](/testing/switch-to-mkcert.webp)
- run `npm run start` once from VS Code's terminal
  - on Windows, this will open a new window and guide you through the creation and installation of the certificate
  - on MacOS, the terminal prompts for your password and then generates and installs the certificate.
  - if you're getting an error `Error: Port 3000 is already in use`, please close the server that may still be running from Unity.
- the generated certificate will automatically be installed on the machine you generated it on.
- you can stop the terminal process again.
- from now on, pressing Play in Unity/Blender will use the generated certificate for the local server, and no "security warning" will be shown anymore, since your browser now trusts the local connection.

## <logo-header logo="/imgs/ssl-icon.webp" alt="SSL">Installing the certificate on your development devices</logo-header>

On your development devices, you need to _install_ the generated certificate and allow the OS to _trust_ it. This is different for each OS. For each of them, you'll need the rootCA.pem file that was generated, and send it to the device you want to authenticate.

**On Windows:** find the certificate in `Users/<your-user>/.vite-plugin-mkcert/rootCA.pem`  
**On MacOS:** find the certificate in `Users/<your-user>/.vite-plugin-mkcert/rootCA.pem`  

Send the device to yourself (e.g. via E-Mail, AirDrop, iCloud, USB, Slack, ...) so that you can access it on your development devices.

### <logo-header logo="/imgs/android-logo.webp" alt="Android">Installing the certificate on Android</logo-header>

1. Open the file. You'll be prompted to install the certificate.

### <logo-header logo="/imgs/ios-logo.webp" alt="iOS">Installing the certificate on iOS / iPadOS / VisionOS</logo-header>
1. Open the file.
2. You'll be prompted to _add_ the profile to your device. Confirm.
3. Go to Settings
4. There will be a new entry "Profile". Select it and allow the profile to be _active_ for this device.
5. On iOS / iPadOS, you also need to allow "Root Certificate Trust". For this, search for `Trust` or go to `Settings > General > About > Info > Certificate Trust Settings` and enable full trust for the root certificate.

::: tip
The certificate is automatically installed on the machine you generated it on. For other machines in the local network, follow the steps below to also establish a trusted connection.
:::

### <logo-header logo="/imgs/macos-logo.webp" alt="macOS">Installing the certificate on another macOS machine</logo-header>
1. Open the file. Keychain Access will open and allow you to install the certificate.
2. You may have to set "Trust" to "Always allow".

### <logo-header logo="/imgs/microsoft-logo.webp" alt="Windows">Installing the certificate on another Windows machine</logo-header>
1. Open `certmgr` ("Manage user certificates") by typing <kbd>Windows key</kbd> + `certmgr`.
2. In the left sidebar, select "Trusted Root Certification Authorities".
3. Right-click on "Certificates" and select "All Tasks > Import".
4. Select the `rootCA.pem` file (you may have to change the file type to "all") and follow the instructions.

---

## Related Documentation

- **[Debugging Parameters & Options](/docs/how-to-guides/debugging/)** - URL parameters, VSCode debugging, mobile debugging tools
- **[Needle Inspector](/docs/three/needle-devtools-for-threejs-chrome-extension)** - Chrome DevTools extension for three.js
- **[FAQ](/docs/reference/faq)** - Frequently asked questions and troubleshooting
- **[Help & Community](/docs/help/)** - Get support, ask questions, and connect with the community
Source: https://engine.needle.tools/docs/how-to-guides/testing.html

---
title: Needle Core Components
description: Complete catalog of 100+ built-in components for audio, animation, physics, networking, XR, UI, and more - ready to use in your projects.
---

# Needle Core Components

**Built-in components** that map to Unity, Blender, and three.js functionality.

:::tip Complete Reference
For the full API documentation, see [engine.needle.tools/docs/api](https://engine.needle.tools/docs/api)
:::

:::tip Custom Components
You can always create your own components or add wrappers for components we haven't provided yet.

[Learn scripting](/how-to-guides/scripting/create-components) ‚Ä¢ [For Unity Developers](/tutorials/fundamentals/for-unity-developers)
:::

## üîä Audio

| Component | Description |
| --- | --- |
| [`AudioListener`](https://engine.needle.tools/docs/api/AudioListener) | Receives audio in the scene (attach to camera) |
| [`AudioSource`](https://engine.needle.tools/docs/api/AudioSource) | Plays audio clips with spatial audio support |

## üé¨ Animation

| Component | Description |
| --- | --- |
| [`Animator`](https://engine.needle.tools/docs/api/Animator) | State machine with AnimatorController, transitions, and conditions |
| [`Animation`](https://engine.needle.tools/docs/api/Animation) | Basic animation playback (single clip) |
| [`PlayableDirector`](https://engine.needle.tools/docs/api/PlayableDirector) | Timeline sequences for animation, audio, state control |

## üì∑ Camera & Controls

| Component | Description |
| --- | --- |
| [`Camera`](https://engine.needle.tools/docs/api/Camera) | Scene rendering viewpoint (perspective/orthographic) |
| [`OrbitControls`](https://engine.needle.tools/docs/api/OrbitControls) | Rotate, zoom, and pan around target ‚Ä¢ [Sample](https://samples.needle.tools/collaborative-sandbox) |
| [`ViewBox`](https://engine.needle.tools/docs/api/ViewBox) | Defines visible area bounds |

## üé® Rendering

| Component | Description |
| --- | --- |
| [`Light`](https://engine.needle.tools/docs/api/Light) | Directional, Point, Spot lights with shadow support and baking |
| [`MeshRenderer`](https://engine.needle.tools/docs/api/MeshRenderer) | Renders meshes with lightmapping and instancing |
| [`SkinnedMeshRenderer`](https://engine.needle.tools/docs/api/SkinnedMeshRenderer) | Renders animated/deformable meshes |
| [`SpriteRenderer`](https://engine.needle.tools/docs/api/SpriteRenderer) | Renders 2D sprites and animations ‚Ä¢ [Sample](https://samples.needle.tools/spritesheet-animation) |
| [`ParticleSystem`](https://engine.needle.tools/docs/api/ParticleSystem) | Particle effects system ‚Ä¢ [Sample](https://samples.needle.tools/particles) |
| [`VideoPlayer`](https://engine.needle.tools/docs/api/VideoPlayer) | Video playback, streaming (MediaStream, M3U8) ‚Ä¢ [Sample](https://samples.needle.tools/video-playback) |
| [`XRFlag`](https://engine.needle.tools/docs/api/XRFlag) | Control visibility by mode (VR/AR/Desktop) |
| [`DeviceFlag`](https://engine.needle.tools/docs/api/DeviceFlag) | Control visibility by device type |
| [`GroundProjection`](https://engine.needle.tools/docs/api/GroundProjectedEnv) | Project environment texture on ground ‚Ä¢ [Sample](https://samples.needle.tools/ground-projection) |
| [`SeeThrough`](https://engine.needle.tools/docs/api/SeeThrough) | Fade objects obscuring view ‚Ä¢ [Sample](https://samples.needle.tools/see-through) |
| [`ShadowCatcher`](https://engine.needle.tools/docs/api/ShadowCatcher) | Invisible shadow receiver ‚Ä¢ [Sample](https://samples.needle.tools/shadow-catcher) |
| [`ContactShadows`](https://engine.needle.tools/docs/api/ContactShadows) | Realtime contact shadows ‚Ä¢ [Sample](https://samples.needle.tools/contact-shadows) |
| [`Volume`](https://engine.needle.tools/docs/api/Volume) | Post-processing effects (see below) ‚Ä¢ [Sample](https://samples.needle.tools/postprocessing) |

### Postprocessing

Postprocessing effects use the [pmndrs postprocessing library](https://www.npmjs.com/package/postprocessing) under the hood. This means you can also easily add your own custom effects and get an automatically optimized postprocessing pass.

:::tip For Unity Users
For Needle Engine Postprocessing in Unity you need to use URP (Universal Render Pipeline)
:::

|  | |
| --- | --- | 
| [`Volume`](https://engine.needle.tools/docs/api/Volume) | Add effects below |
| **Effects** | |
| [`Antialiasing`](https://engine.needle.tools/docs/api/Antialiasing) | *extra Unity Component* |
| [`BloomEffect`](https://engine.needle.tools/docs/api/BloomEffect) | *via Volume asset* |
| [`Chromatic Aberration`](https://engine.needle.tools/docs/api/ChromaticAberration) | *via Volume asset* |
| [`Color Adjustments / Color Correction`](https://engine.needle.tools/docs/api/ColorAdjustments) | *via Volume asset* | 
| [`Depth Of Field`](https://engine.needle.tools/docs/api/DepthOfField) | *via Volume asset* |
| [`Tilt Shift Effect`](https://engine.needle.tools/docs/api/TiltShiftEffect) | *via Volume asset or separate component* |
| [`Vignette`](https://engine.needle.tools/docs/api/Vignette) | *via Volume asset* |
| [`ToneMappingEffect`](https://engine.needle.tools/docs/api/ToneMappingEffect) | *via Volume asset or separate component* |
| [`PixelationEffect`](https://engine.needle.tools/docs/api/PixelationEffect) | *via Volume asset or separate component* |
| [`Screenspace Ambient Occlusion N8`](https://engine.needle.tools/docs/api/ScreenSpaceAmbientOcclusionN8) | *via Volume asset or separate component* |
| [`Screenspace Ambient Occlusion`](https://engine.needle.tools/docs/api/ScreenSpaceAmbientOcclusion) | *via Volume asset or separate component* |
| [`SharpeningEffect`](https://engine.needle.tools/docs/api/SharpeningEffect) | *via Volume asset or separate component* |
| *Your custom effect* | [Example on Stackblitz](https://stackblitz.com/edit/needle-engine-custom-postprocessing-effect), [Example in docs](/reference/scripting-examples#adding-new-postprocessing-effects) |

## üåê Networking & Multiplayer

| Component | Description |
| --- | --- |
| [`SyncedRoom`](https://engine.needle.tools/docs/api/SyncedRoom) | Enable multiplayer networking (required for all networked features) |
| [`Networking`](https://engine.needle.tools/docs/api/Networking) | Configure custom backend server (defaults to Needle servers) |
| [`SyncedTransform`](https://engine.needle.tools/docs/api/SyncedTransform) | Sync object position, rotation, scale across clients |
| [`SyncedCamera`](https://engine.needle.tools/docs/api/SyncedCamera) | Sync camera view to other users with custom rendering |
| [`PlayerSync`](https://engine.needle.tools/docs/api/PlayerSync) | Instantiate object per connected user (avatars, etc.) |
| [`Voip`](https://engine.needle.tools/docs/api/Voip) | Voice chat with spatial audio ‚Ä¢ [Sample](https://samples.needle.tools/collaborative-sandbox) |
| [`ScreenCapture`](https://engine.needle.tools/docs/api/ScreenCapture) | Screen sharing capabilities ‚Ä¢ [Sample](https://samples.needle.tools/screensharing) |

## üñ±Ô∏è Interaction

| Component | Description |
| --- | --- |
| [`DragControls`](https://engine.needle.tools/docs/api/DragControls) | Drag objects in scene (requires raycaster in parent, e.g. ObjectRaycaster) |
| [`Duplicatable`](https://engine.needle.tools/docs/api/Duplicatable) | Duplicate objects by dragging (requires DragControls) |
| [`OrbitControls`](https://engine.needle.tools/docs/api/OrbitControls) | Camera orbit, zoom, and pan controls |
| [`SmoothFollow`](https://engine.needle.tools/docs/api/SmoothFollow) | Smooth interpolation to another object's transform |
| [`DeleteBox`](https://engine.needle.tools/docs/api/DeleteBox) | Destroys Deletable objects entering the box |
| [`Deletable`](https://engine.needle.tools/docs/api/Deletable) | Object can be deleted when entering DeleteBox |
| [`DropListener`](https://engine.needle.tools/docs/api/DropListener) | Receive file drop events for uploads |
| [`SpatialTrigger`](https://engine.needle.tools/docs/api/SpatialTrigger) | Raise events when objects enter space/area |
| [`SpatialTriggerReceiver`](https://engine.needle.tools/docs/api/SpatialTriggerReceiver) | Receive events from SpatialTrigger |
| [`CursorFollow`](https://engine.needle.tools/docs/api/CursorFollow) | Make object follow cursor ‚Ä¢ [Sample](https://engine.needle.tools/samples/scrollytelling-and-cursor-interaction) |
| [`ScrollFollow`](https://engine.needle.tools/docs/api/ScrollFollow) | Bind scroll to animations/timeline ‚Ä¢ [Sample](https://engine.needle.tools/samples/scrollytelling-and-cursor-interaction) |
| [`HoverAnimation`](https://engine.needle.tools/docs/api/HoverAnimation) | Animate on hover |

## <logo-header logo="/imgs/rapier-physics-logo.webp" alt="Rapier">Physics</logo-header>

Powered by [Rapier](https://rapier.rs/) physics engine.

| Component | Description |
| --- | --- |
| [`Rigidbody`](https://engine.needle.tools/docs/api/Rigidbody) | Physical body with gravity, mass, drag (dynamic/kinematic/static) |
| [`BoxCollider`](https://engine.needle.tools/docs/api/BoxCollider) | Box-shaped collision volume |
| [`SphereCollider`](https://engine.needle.tools/docs/api/SphereCollider) | Sphere-shaped collision volume |
| [`CapsuleCollider`](https://engine.needle.tools/docs/api/CapsuleCollider) | Capsule-shaped collision volume |
| [`MeshCollider`](https://engine.needle.tools/docs/api/MeshCollider) | Complex collision matching mesh geometry |
| *Physics Materials* | Control friction, bounciness, and other physical properties |
| [`Attractor`](https://engine.needle.tools/docs/api/Attractor) | Attract or repel rigidbodies ‚Ä¢ [Sample](https://engine.needle.tools/samples/scrollytelling-and-cursor-interaction) |

:::tip Colliders as Triggers
Set any collider to `isTrigger = true` to detect overlaps without physical collision response.
:::

## ü•Ω XR / WebXR

[Read the full XR documentation](/how-to-guides/xr/)

| Component | Description |
| --- | --- |
| [`WebXR`](https://engine.needle.tools/docs/api/WebXR) | Enable VR, AR, passthrough, and avatar rendering |
| [`USDZExporter`](https://engine.needle.tools/docs/api/USDZExporter) | Enable QuickLook AR on iOS (USDZ format) |
| [`WebARSessionRoot`](https://engine.needle.tools/docs/api/WebARSessionRoot) | AR scene placement and scale (defines center/alignment) |
| [`XRRig`](https://engine.needle.tools/docs/api/XRRig) | Define user start position in VR |
| [`WebARCameraBackground`](https://engine.needle.tools/docs/api/WebARCameraBackground) | Access AR camera feed for effects/rendering |
| [`WebXRImageTracking`](https://engine.needle.tools/docs/api/WebXRImageTracking) | Track images and instantiate objects ‚Ä¢ [Sample](https://engine.needle.tools/samples/image-tracking) |
| [`WebXRPlaneTracking`](https://engine.needle.tools/docs/api/WebXRPlaneTracking) | Create meshes/colliders for tracked planes |
| [`XRControllerModel`](https://engine.needle.tools/docs/api/XRControllerModel) | Render VR controllers or hand models |
| [`XRControllerMovement`](https://engine.needle.tools/docs/api/XRControllerMovement) | Default movement and teleport controls |
| [`XRControllerFollow`](https://engine.needle.tools/docs/api/XRControllerFollow) | Make objects follow hands or controllers |
| [`XRFlag`](https://engine.needle.tools/docs/api/XRFlag) | Control visibility by mode (VR/AR/FirstPerson/ThirdPerson) |

## üîß Debugging

| Component | Description |
| --- | --- |
| [`GridHelper`](https://engine.needle.tools/docs/api/GridHelper) | Draws debug grid |
| [`BoxGizmo`](https://engine.needle.tools/docs/api/BoxGizmo) | Draws debug box |
| [`AxesHelper`](https://engine.needle.tools/docs/api/AxesHelper) | Draws XYZ axes |

:::tip Gizmos in Code
Use static `Gizmos` methods for drawing debug lines and shapes in your scripts. [See Gizmos API](/reference/scripting-examples#debug-gizmos)
:::

## üìÅ Runtime File Input/Output

| Component | Description |
| --- | --- |
| [`GltfExport`](https://engine.needle.tools/docs/api/GltfExport) | Export glTF from runtime (experimental) |
| [`DropListener`](https://engine.needle.tools/docs/api/DropListener) | Receive file drop events for uploads and networking |

## üñºÔ∏è UI

Spatial UI components map from Unity UI (Canvas, not UI Toolkit) to [three-mesh-ui](https://github.com/felixmariotto/three-mesh-ui). UI can be animated.

| Component | Description |
| --- | --- |
| [`Canvas`](https://engine.needle.tools/docs/api/Canvas) | Unity UI system (World Space mode required) |
| [`Text`](https://engine.needle.tools/docs/api/Text) | Render text with custom fonts (auto-generated atlas). Use Legacy/Text, not TextMeshPro |
| [`Button`](https://engine.needle.tools/docs/api/Button) | Click events with onClick. Works in 3D and UI. Use Legacy/Text for labels |
| [`Image`](https://engine.needle.tools/docs/api/Image) | Renders sprite images |
| [`RawImage`](https://engine.needle.tools/docs/api/RawImage) | Renders textures |
| [`InputField`](https://engine.needle.tools/docs/api/InputField) | Text input field |

:::tip HTML + Spatial UI
For cross-platform projects (VR, AR, desktop), mix spatial and HTML UI:
- **HTML**: 2D interfaces for best accessibility
- **Spatial UI**: 3D interfaces with depth (e.g., button hover states)
:::  

## üîÄ Scene Management

| Component | Description |
| --- | --- |
| [`SceneSwitcher`](https://engine.needle.tools/docs/api/SceneSwitcher) | Load/unload scenes, prefabs, glTF files with preload, swipe, keyboard, URL navigation |

## üõ†Ô∏è Editor Only (Unity/Blender)

| Component | Description |
| --- | --- |
| `Needle Engine` | Main component for managing web project(s) (install, start, deploy) |
| `EditorSync` | Sync material/component changes to runtime without reload (hot reload) |

---

## Complete API Documentation

For detailed TypeScript API documentation with all methods, properties, and types:

**[üìñ View Complete API Reference ‚Üí](https://engine.needle.tools/docs/api/)**

The API documentation includes:
- All component classes and their methods
- Component lifecycle hooks
- Event handlers and callbacks
- Type definitions and interfaces
- Code examples and usage patterns

---

## Related Documentation

### Learn How to Use Components

- **[Create Custom Components](/docs/how-to-guides/scripting/create-components)** - Build your own interactive components
- **[Component Lifecycle Methods](/docs/reference/api/lifecycle-methods)** - awake, start, update, onEnable, etc.
- **[Input Event Methods](/docs/reference/api/input-events)** - Handle pointer, touch, and keyboard input
- **[Physics Event Methods](/docs/reference/api/physics-events)** - Collision and trigger callbacks
- **[XR Event Methods](/docs/reference/api/xr-events)** - WebXR-specific events

### Integration Guides

- **[Unity Integration](/docs/unity/)** - Using components in Unity
- **[Blender Integration](/docs/blender/)** - Using components in Blender
- **[three.js Integration](/docs/three/)** - Using components in web projects

### Tutorials

- **[TypeScript Essentials](/docs/tutorials/fundamentals/typescript-essentials)** - Learn TypeScript for components
- **[For Unity Developers](/docs/tutorials/fundamentals/for-unity-developers)** - Component system differences from Unity

### How-To Guides

- **[Handle User Input](/docs/how-to-guides/scripting/handle-input)** - Mouse, touch, keyboard, VR controllers
- **[Enable Networking](/docs/how-to-guides/networking/)** - Multiplayer and sync
- **[Enable WebXR](/docs/how-to-guides/xr/)** - VR and AR experiences
- **[Export 3D Content](/docs/how-to-guides/export/)** - Meshes, materials, animations

### Additional Reference

- **[Scripting Examples](/docs/reference/scripting-examples)** - Common code patterns
- **[TypeScript Decorators](/docs/reference/typescript-decorators)** - @serializable and more
- **[Time API](/docs/reference/api/time)** - deltaTime and time management
Source: https://engine.needle.tools/docs/reference/components.html

---
title: Questions and Answers (FAQ) üí°
description: Frequently asked questions and troubleshooting solutions for Needle Engine - from installation issues to licensing, rendering, and deployment.
---

## How do I get a license for Needle Engine?

Commercial use of Needle Engine requires a valid license. You can purchase a license on our website: [https://www.needle.tools/pricing](https://www.needle.tools/pricing).

## How can I activate my Needle Engine License?

### Activating the license in Unity

:::: tabs
@tab Needle Engine 4.x

Go to `Project Settings/Needle` and click on the <kbd>Login</kbd> button. Follow the steps and log in to your Needle account.   

After that, you'll see your account information in the Unity project settings window. Select the licensed team from the dropdown.   

@tab Needle Engine 3.x
Open `Edit/Project Settings/Needle` to get the Needle Engine plugin settings. At the top of the window you'll find fields for entering your license information.
- `Email` - Enter the email you purchased the license with
- `Invoice ID` - Enter one of the invoice ids that you received by email

Note: You might need to restart the local webserver to apply the license.

![unity license window](/imgs/unity-needle-engine-license.jpg)

::::

### Activating the license in Blender

Follow the steps in [Install the Add-On](/docs/blender/#step-1-install-the-add-on), 
then click the <kbd>Login</kbd> button in the Add-on settings and follow the steps to log in to your Needle account.

## License not found in CI/CD builds

**Problem:** When running automated builds on CI/CD systems (GitHub Actions, GitLab CI, etc.), you may encounter "license not found" errors even with a valid Needle Engine PRO license.

**Solution:** Start the Needle License Server before running your build:

```bash
npx --yes needle-cloud start-server
```

This command validates your Needle Engine PRO license and allows automated builds to proceed.

**Why is this needed?** CI/CD environments are headless and can't use the standard Unity Editor license validation. The license server provides an alternative authentication method specifically designed for automated workflows.

**Learn more:** [Needle Cloud Documentation - Starting the License Server](/docs/cloud/#starting-the-needle-license-server)

## My local website shows an SSL error e.g. 'Your connection is not private'

You might see a warning in your browser about SSL Security depending on your local configuration.  

![SLL warning on chrome](/videos/ssl-warning.gif)

This is because while the connection is encrypted, by default there's no SSL certificate that the browser can validate.
If that happens: click `Advanced` and `Proceed to Site`. In Safari, you might need to refresh the page afterwards, because it does not automatically proceed. Now you should see your scene in the browser!  

The dialogue should only show up once for the same local server

::: tip
Connections are secured, because we're enforcing HTTPS to make sure that WebXR and other modern web APIs work out-of-the-box. Some browsers will still complain that the SSL connection (between your local development server and the local website) can't be automatically trusted, and that you need to manually verify you trust that page. Automatic Page Reload and Websocket connections may also be affected depending on the browser and system settings.  

See [the Testing docs](/docs/how-to-guides/testing) for information on how to set up a self-signed certificate for a smoother development experience.
:::

  
  

## My local website stays black

If that happens there's usually an exception either in engine code or your code. Open the dev tools (<kbd>Ctrl + Shift + I</kbd> or <kbd>F12</kbd> in Chrome) and check the Console for errors.  
In some cases, especially when you just updated the Needle Engine package version, this can be fixed by stopping and restarting the local dev server.  
For that, click on the running progress bar in the bottom right corner of the Editor, and click the little <kbd>‚úï</kbd> to cancel the running task. Then, simply press Play again.  

## My objects are white after export
This usually happens when you're using custom shaders or materials and their properties don't cleanly translate to known property names for glTF export.
You can either make sure you're using glTF-compatible materials and shaders, or mark shaders as "custom" to export them directly.
- Read more about recommended glTF workflows: [Exporting Materials](/docs/how-to-guides/export/#-exporting-materials)
- Read more about custom shaders: [Custom Shaders](/docs/how-to-guides/export/#custom-shaders)

## Uncaught ReferenceError: NEEDLE_ENGINE_META is not defined / NEEDLE_USE_RAPIER is not defined

If you are using Vite or next.js make sure to add the Needle Engine plugins to your config.
Example for Vite:
```js
const { needlePlugins } = await import('@needle-tools/engine/plugins/vite/index.js');
plugins: [needlePlugins(command, needleConfig)]
```
Example for next.js
```js
const { needleNext } = await import("@needle-tools/engine/plugins/next/index.js");
return needleNext({}, { modules: { webpack } });
```
You can also just declare the missing variables in e.g. your root `index.html` in a script tag like so:
```html
<script>
  var NEEDLE_ENGINE_META = {}
  var NEEDLE_USE_RAPIER = true;
</script>
```

## THREE.EXRLoader: provided file doesnt appear to be in OpenEXR format

Please make sure that sure that you have set Lightmap Encoding to **Normal Quality**.   
Go to `Edit/Project Settings/Player` for changing the setting.  

![](/faq/lightmap_encoding.jpg)  

## My website becomes too large / is loading slow (too many MB)
  
This can have many reasons, but a few common ones are:
- too many textures or textures are too large
- meshes have too many vertices
- meshes have vertex attributes you don't actually need (e.g. have normals and tangents but you're not using them)
- objects are disabled and not ignored ‚Äì disabled objects get exported as well in case you want to turn them on at runtime! Set their Tag to `EditorOnly` to completely ignore them for export.
- you have multiple ``GltfObject`` components in your scene and they all have ``EmbedSkybox`` enabled (you need to have the skybox only once per scene you export)
  
If loading time itself is an issue you can **try to split up your content into multiple glb files** and load them on-demand (this is what we do on our website). For it to work you can put your content into Prefabs or Scenes and reference them from any of your scripts. Please have a look at [Scripting Examples in the documentation](/docs/reference/scripting-examples#assetreference-and-addressables).

## My UI is not rendering Text

- For Unity: Make sure that you use the `UI/Legacy/Text` component and **not** the `TextMeshPro - Text` component

## My scripts don't work after export
  
- Your existing C# code will *not* export as-is, you have to write matching typescript / javascript for it.  
- Needle uses typescript / javascript for components and generates C# stubs for them.  
- Components that already have matching JS will show that in the Inspector.  

## My lightmaps look different / too bright

Ensure you're following [best practices for lightmaps](/docs/how-to-guides/export/#recommended-lightmap-settings) and read about [mixing baked and non-baked objects](/docs/how-to-guides/export/#mixing-baked-and-non-baked-objects)

## My scene is too bright / lighting looks different than in Unity
Make sure that your lights are set to "Baked" or "Realtime". "Mixed" is currently not supported.  
  
- Lights set to mixed (with lightmapping) do affect objects twice in three.js, since there is currently no way to exclude lightmapped objects from lighting
- The ``Intensity Multiplier`` factor for Skybox in ``Lighting/Environment`` is currently not supported and has no effect in Needle Engine  
  ![image](https://user-images.githubusercontent.com/5083203/185429006-2a5cd6a1-8ea2-4a8e-87f8-33e3afd080ec.png)
- Light shadow intensity can currently not be changed due to a three.js limitation.
  
Also see the docs on [mixing baked and non-baked objects](/docs/how-to-guides/export/#mixing-baked-and-non-baked-objects).

## My skybox resolution is low? How to change my skybox resolution

  - **If you use a custom cubemap**: You can override the texture import settings of the skybox texture (assigned to your cubemap)
  
    ![image](https://user-images.githubusercontent.com/5083203/188179104-1e078cda-3397-4ebe-aaf9-7faa23ee4904.png)   

 
  - **If you use the default skybox**: Add a ``SkyboxExportSettings`` component anywhere in your scene to override the default resolution   
  
    ![image](https://user-images.githubusercontent.com/5083203/188171443-578380ab-2036-4d70-a8a7-f8cd9da9f603.png)

## My Shadows are not visible or cut off 
  
Please the following points:   
  
  - Your light has shadows enabled (either Soft Shadow or Hard Shadow)
  - Your objects are set to "Cast Shadows: On" (see MeshRenderer component)
  - For directional lights the position of the light is currently important since the shadow camera will be placed where the light is located in the scene.

## My colors look wrong
  
Ensure your project is set to Linear colorspace.

![image](https://user-images.githubusercontent.com/5083203/191774978-66e9feb1-0551-4549-85d3-3e5b8021f162.png)

## I'm using networking and Glitch and it doesn't work if more than 30 people visit the Glitch page at the same time
  
- Deploying on Glitch is a fast way to prototype and might even work for some small productions. The little server there doesn't have the power and bandwidth to host many people in a persistent session.  
- We're working on other networking ideas, but in the meantime you can host the website somewhere else (with node.js support) or simply remix it to distribute load among multiple servers. You can also host the [networking backend package](https://www.npmjs.com/package/@needle-tools/needle-tiny-networking-ws) itself somewhere else where it can scale e.g. Google Cloud.

## My website doesn't have AR/VR buttons
  
- Make sure to add the `WebXR` component somewhere inside your root `GltfObject`.
- Optionally add a `AR Session Root` component on your root `GltfObject` or within the child hierarchy to specify placement, scale and orientation for WebXR.
- Optionally add a `XR Rig` component to control where users start in VR

## I created a new script in a sub-scene but it does not work
  When creating new scripts in npmdefs in sub-scenes (that is a scene that is exported as a reference from a script in your root export scene) you currently have to re-export the root scene again. This is because the code-gen that is responsible for registering new scripts currently only runs for scenes with a ``Needle Engine`` component. This will be fixed in the future.

## My local server does not start / I do not see a website

The most likely reason is an incorrect installation.
Check the console and the `Needle Engine` component for errors or warnings.

If these warnings/errors didn't help, try the following steps in order. Give them some time to complete. Stop once your problem has been resolved. Check the console for warnings and errors.

- Make sure you follow the [Prerequisites](/docs/getting-started/#prerequisites).
- Install your project by selecting your `Needle Engine` component and clicking `Install`
- Run a clean installation by selecting your `Needle Engine` component, holding Alt and clicking `Clean Install`
- Try opening your web project directory in a command line tool and follow these steps:
  - run ``npm install`` and then ``npm run dev-host``
  - Make sure both the local runtime package (``node_modules/@needle-tools/engine``) as well as three.js (``node_modules/three``) did install. 
  - You may run ``npm install`` in both of these directories as well.

## Does C# component generation work with javascript only too?
  While generating C# components does technically run with vanilla javascript too we don't recommend it and fully support it since it is more guesswork or simply impossible for the generator to know which C# type to create for your javascript class. Below you find a minimal example on how to generate a Unity Component from javascript if you really want to tho.    
  
```js
import { Behaviour } from "@needle-tools/engine";

export class MyScript extends Behaviour
{
    //@type float
    myField = 5;
}
```

## I don't have any buttons like "Generate Project" in my components/inspector
  
Please check that you're not accidentally in the Inspector's `Debug` mode ‚Äì switch back to `Normal`:  
![20220824-025011-S2GQ-Unity_lKlT-needle](https://user-images.githubusercontent.com/2693840/186291615-56e7ebdb-1221-4326-813d-f88526fa126c.png)

## Toktx can not be found / toktx is not installed

- Make sure to [download and install toktx](/docs/getting-started/#install-these-tools-for-production-builds)

- On Windows: Make sure you have added toktx to your system environment variables. You may need to restart your computer after adding it to refresh the environment variables. The default install location is ``C:\Program Files\KTX-Software\bin``   

![image](/imgs/ktx-env-variable.webp)

## Installing the web project takes forever / does never finish / EONET: no such file or directory
- **Make sure to not create a project on a drive formatted as exFAT** because exFAT does not support symlinks, which is required for Needle Engine for Unity prior to version 3.x.    
  You can check the formatting of your drives using the following steps:
  1. Open "System Information" (either windows key and type that or enter "msinfo32" in cmd)
  2. Select Components > Storage > Drives
  3. Select all (Ctrl + A) on the right side of the screen and copy that (<kbd>Ctrl + C</kbd>) and paste here (<kbd>Ctrl + V</kbd>)

## NPM install fails and there are errors about hard drive / IO
Make sure your project is on a disk that is known to work with node.js. Main reason for failures is that the disk doesn't support symlinks (symbolic links / softlinks), which is a requirement for proper functioning of node.js.  
<kbd>NTFS</kbd> formatting should always work. Known problematic file system formattings are <kbd>exFAT</kbd> and <kbd>FAT32</kbd>. 

To check the format of your drives, you can:
1. Open "System Information" (either <kbd>Windows key</kbd> and type "System Information" or enter `msinfo32` in cmd <kbd>Windows + R</kbd>)
2. Select "Components > Storage > Drives"
3. There, you can see all drives and their formatting listed. Put your projects on a drive that is NTFS formatted.

## I'm getting errors with "Unexpected token `@`. Expected identifier, string literal, numeric literal or ..."

Needle Engine uses typescript decorators for serialization.   
To fix this error make sure to enable `experimentalDecorators` in your tsconfig.json 

## I'm getting an error 'failed to load config ... vite.config.js' when running npm commands on Mac OS

You're likely using an x86_64 version of Unity on an (ARM) Apple Silicon processor. Unity 2020.3 is only available for x86_64, later versions also have Apple Silicon versions.  
Our Unity integration calling npm will thus do so from an x86_64 process, resulting in the x86_64 version of node and vite/esbuild being used. When you afterwards try to run npm commands in the same project from an Apple Silicon app (e.g. VS Code), npm will complain about mismatching architectures with a long error message.  

To fix this, use an Apple Silicon version of Unity (2021.1 or later).  

You can also temporarily fix it on 2020.3 by deleting the `node_modules` folder and running `npm install` again from VS Code. You'll have to delete `node_modules` again when you switch back to Unity.

## Circular reference error

This can happen when you have e.g. a `SceneSwitcher` (or any other component that loads a scene or asset) and the referenced Asset in Unity contains a `GltfObject` that has the same name as your original scene with the `SceneSwitcher`. You can double check this in Unity if you get an error that says something like:

```
Failed to export ‚Üë YourSceneName.glb
you seem to have objects with the same name referencing each other.
```

To fix this you can:
- Remove the `GltfObject` in the referenced Prefab or Scene
- Rename the GameObject with the component that loads the referenced scenes

If this doesn't fix the problem please ask [in our forum](https://forum.needle.tools/?utm_source=needle_docs&utm_content=content).

## My scene is not loading and the console contains a warning with 'circular references' or 'failed to update active state'
Please see the [circular reference error](#circular-reference-error) section.

## Does my machine support WebGL 2?

Use a detector [like this one](https://get.webgl.org/webgl2/) to determine if your device supports WebGL 2, it also hints at what could be the cause of your problem, but generally make sure you have updated your browser and drivers. WebGL 1 is not supported.

#### Known devices to cause issues:
- Lenovo Thinkpad - T495  

## I want to use Needle AI with my local AI model

If you want (or have to) run your AI locally you can use the Needle llms.txt files as context for your local AI (e.g. Ollama):

- [llms.txt](https://cloud.needle.tools/llms.txt)
- [llms-full.txt](https://cloud.needle.tools/llms-full.txt)

## Still have questions? 
[Ask in our forum](https://forum.needle.tools/?utm_source=needle_docs&utm_content=content) 

<a href="https://discord.needle.tools" target="_blank"><img height=20 src="https://img.shields.io/discord/717429793926283276?color=5562ea&label=Discord" /></a>
Source: https://engine.needle.tools/docs/reference/faq.html

---
title: Reference
description: Complete API and configuration reference
---

# Reference

**Look things up.** Complete technical reference for Needle Engine APIs, configuration, and capabilities.

**Not sure what you need?**
- Need to **learn the basics**? See [Tutorials](../tutorials/)
- Want to **solve a specific problem**? See [How-To Guides](../how-to-guides/)
- Want to **understand concepts**? See [Explanation](../explanation/)

---

## What is Reference?

Reference documentation is **information-oriented** and provides:
- Complete API listings
- Configuration specifications
- Platform compatibility matrices
- Technical facts and data

---

## API Documentation

### Needle Engine API
- [**Needle Engine API Documentation**](https://engine.needle.tools/docs/api/latest) - Complete API reference
- [Component Lifecycle Methods](./api/lifecycle-methods) - awake, start, update, onEnable, etc.
- [Physics Event Methods](./api/physics-events) - Collision and trigger events
- [Input Event Methods](./api/input-events) - Mouse, touch, keyboard events
- [XR Event Methods](./api/xr-events) - WebXR-specific events
- [Time API](./api/time) - Time and deltaTime reference

### three.js API
- [three.js Documentation](https://threejs.org/docs/index.html) - Official three.js API

## Components

- [Built-in Components Catalog](/docs/reference/components) - All 100+ built-in components
- [**Needle Engine API Documentation**](https://engine.needle.tools/docs/api/latest) - Complete API reference

## Configuration

- [needle.config.json](/docs/reference/needle-config-json) - Project configuration file
- [Needle Engine Attributes](/docs/reference/needle-engine-attributes) - Component attributes and metadata
- [TypeScript Decorators](/docs/reference/typescript-decorators) - @serializable and other decorators
- [Needle Cloud](/docs/cloud/) - Official hosting platform and license server

## Platform & Format Support

- [Features Overview](/docs/explanation/core-concepts/features-overview) - Complete feature matrix
- [Needle Cloud](/docs/cloud/) - Official hosting platform and license server

## Troubleshooting

- [FAQ](./faq) - Frequently asked questions

## Code Examples

- [Scripting Examples](./scripting-examples) - Code snippets and patterns

## Need Help?

- **Want to learn by doing?** See [Tutorials](../tutorials/)
- **Need to solve a problem?** See [How-To Guides](../how-to-guides/)
- **Want to understand concepts?** See [Explanation](../explanation/)
- **Have questions?** Ask in [Discord](https://discord.needle.tools) or check [FAQ](./faq)
Source: https://engine.needle.tools/docs/reference/index.html

---
title: Additional Modules
---

Projects can be composed of re-usable pieces that we call [**NpmDef**](/docs/reference/npm-definition-files) (which stands for Npm Defintion File). 

Below you can find links to other repositories that contain Unity packages. These packages can be installed like any Unity package and used in your own projects. They usually contain eihter examples or modules that we use ourselves, but that are not ready to be part of the core Needle Engine.  

   - **Custom Timeline Tracks**  
     Video Track (sync video playback to a Timeline)
     CssTrack (control css properties from the Timeline)
     
   - **Splines (for Unity 2022.1+)**  
     Export splines to three.js
     SplineWalker for controlling camera motion based on a spline
     Timeline track to control SplineWalker

   - **Google Drive Integration**  
     Sketches around drag-drop integration of Google Drive, file picking, app integration

    
[Github repository](https://github.com/needle-tools/needle-engine-modules)
Source: https://engine.needle.tools/docs/reference/modules.html

---
title: needle.config.json
---

The `needle.config.json` is used to provide configuration for the Needle Editor integrations and for the Needle Engine build pipeline plugins.

| | |
| --- | --- | 
| **Paths** | |
| `buildDirectory` | This is where the built project files are being copied to |
| `assetsDirectory` | This is where the Editor integration assets will be copied to or created at (e.g. the `.glb` files exported from Unity or Blender) |
| `scriptsDirectory` | This is the directory the Editor integration is watching for code changes to re-generate components |
| `codegenDirectory` | This is where the Editor integration is outputting generated files to. |
| `baseUrl` | Required for e.g. next.js or SvelteKit integration. When baseUrl is set, relative paths for codegen and inside files are using baseUrl, not assetsDirectory. This is useful in cases where the assetDirectory does not match the server url.<br/>For example, the path on disk could be `"assetsDirectory": "public/assets"`, but the framework serves files from `"baseUrl": "assets"`. |
| **Tools** | |
| `build : { copy: ["myFileOrDirectory"] }` | Array of string paths for copying additional files or folders to the `buildDirectory`. These can either be absolute or relative. |

#### Basic Example 
```json
{
  "buildDirectory": "dist",
  "assetsDirectory": "assets",
  "scriptsDirectory": "src/scripts",
  "codegenDirectory": "src/generated"
}
```

#### Copy Example
```json
{
  "buildDirectory": "dist",
  "assetsDirectory": "assets",
  "scriptsDirectory": "src/scripts",
  "codegenDirectory": "src/generated",
  "build": {
    "copy": [
      "cards"
    ]
  }
}
```

#### Example with different baseUrl (e.g. SvelteKit, Next.js)
Files are exported to `static/assets` but the framework serves them from `/assets`. In this case, the `baseUrl` needs to be set to `assets` so that relative paths in files are correct.

```json
{
  "baseUrl": "assets",
  "buildDirectory": "dist",
  "assetsDirectory": "static/assets",
  "scriptsDirectory": "src/scripts",
  "codegenDirectory": "src/generated"
}
```

#### Related Links
- [Project Structure](../project-structure.md)
Source: https://engine.needle.tools/docs/reference/needle-config-json.html

---
title: <needle-engine> Attributes
---

## Attributes of the Needle Engine Web Component

Needle Engine is typically used as a web component: `<needle-engine>`. This component can be used to load and display 3D scenes, models, and more in a web browser. It comes with a set of attributes that allow you to configure its behavior, look and feel. All those settings can be overwritten by code, but the attributes are a convenient way to set them up in HTML. The tables below show a list of available attributes and what they do.

::: tip The web component is in `index.html`
Whether creating a project via Unity or Blender, or directly in code, you can use and adjust the `<needle-engine>` web component. Usually, you will find it in the `index.html` file of your web project.
:::

### File Loading and Events
| | |
| --- | --- |
| `src` | Path to one or multiple glTF or glb files.<br/>Supported types are `string`, `string[]` or a stringified array (comma-separated). |
| `loadstart` | Name of the function to call when loading starts. Note that the arguments are `(ctx:Context, evt:Event)`. You can call `evt.preventDefault()` to hide the default loading overlay | 
| `progress` | Name of the function to call when loading updates. `onProgress(ctx:Context, evt: {detail: {context:Context, name:string, index:number, count:number, totalProgress01:number, progress:ProgressEvent}) { ... }`   |
| `loadfinished` | Name of the function to call when loading finishes |

### Custom Branding
Available attributes to change the Needle Engine loading and custom branding
| | |
| --- | --- |
| `loading-blur` | Optional: Blur the scene until LODs are loaded (if any). Default: disabled |
| `poster` | Optional: Set the `poster` attribute to show a placeholder image while loading. Example: `<needle-engine poster="https://yourdomain.com/poster.png">`. By just using the attribute without a url the poster in `include/poster.webp` will be used if it exists (e.g. `<needle-engine poster>`) |
| `loading-background` | **PRO** ‚Äî Default: `transparent`. Change the loading background color (e.g. `#dd5500`) |
| `hide-loading-overlay` | **PRO** ‚Äî Do not show the loading overlay |
| `logo-src` | **PRO** ‚Äî Change the logo image (e.g. `https://yourdomain.com/logo.png` or `/logo.png`). This logo will then be used in the QR code and XR session loading |
| `qrcode-logo-src` | **PRO** ‚Äì Change the logo image for the QR code (e.g. `https://yourdomain.com/logo.png` or `/logo.png`). If not provided the `logo-src` attribute will be used.

### Visual Settings
| | |
| --- | --- |
| `background-color` | optional, hex color to be used as a background color. Examples: `rgb(255, 200, 100)`, `#dddd00` | 
| `background-image` | optional, URL to a skybox image (background image) or a preset string: `studio`, `blurred-skybox`, `quicklook`, `quicklook-ar`. Supports [FastHDR](https://cloud.needle.tools/hdris) | 
| `background-blurriness` | optional, bluriness value between 0 (no blur) and 1 (max blur) for the `background-image`. Example: `background-blurriness="0.5"` | 
| `environment-image` | optional, URL to a environment image (environment light) or a preset string: `studio`, `blurred-skybox`, `quicklook`, `quicklook-ar`. Supports [FastHDR](https://cloud.needle.tools/hdris) |
| `contactshadows` | optional, render contact shadows |
| `tone-mapping` | optional, supported values are `none`, `linear`, `neutral`, `agx` |
| `tone-mapping-exposure` | optional number e.g. increase exposure with `tone-mapping-exposure="1.5"`, requires `tone-mapping` to be set |

### Interaction and Camera
| | | 
| -- | - |
| `autoplay` | add or set to `true` to auto play animations e.g. `<needle-engine autoplay` | 
| `camera-controls` | add or set to `true` to automatically add OrbitControls if no camera controls are found in the scene |
| `auto-rotate` | add to enable auto-rotate (only used with `camera-controls`) |
| `focus-rect` | Query string to select an HTML element on your website to be used as the [camera-focus-rect](https://engine.needle.tools/docs/api/classes/Engine_Core.Context.html#setcamerafocusrect) - [Demo](https://focus-rect-demo-z23hmxbztexgt-z19e07i.needle.run/). Note that you can also set it programmatically with `ctx.setCameraFocusRect(<element>\|DOMRect)` |

### Decoder Settings
For files that require a decoder (e.g. Draco compressed glb files), we automatically load an efficient decoder from the Needle CDN. If you want to create fully self-contained projects, can specify the path to the decoder with the following attributes.

| | |
| --- | --- |
| `dracoDecoderPath` | URL to the draco decoder e.g. `./include/draco/` to use the local Draco decoder |
| `dracoDecoderType` | draco decoder type. Options are `wasm` or `js`. See [three.js documentation](https://threejs.org/docs/#examples/en/loaders/DRACOLoader.setDecoderConfig) |
| `ktx2DecoderPath` | URL to the KTX2 decoder e.g. `./include/ktx2/` to use the local KTX2 decoder |

### Other
| | |
| --- | --- |
| `hash` | Used internally, is appended to the files being loaded to force an update (e.g. when the browser has cached a GLB file). Should not be edited manually. |

**Upgrade notice**:   
- Removed attributes in Needle Engine 4.5.0: `loading-style`, `loading-background-color`, `loading-text-color`, `primary-color`, `secondary-color`
- Replaced `loading-logo-src` (old) with `logo-src` (new). 
- Since Needle Engine 4.10.0 the `<needle-engine>` loading display has been modified and will not render a logo anymore

## Examples

```html
<!-- Setting the path to a custom glb to be loaded -->
<needle-engine src="path/to/your.glb"></needle-engine>
```

```html
<!-- Overriding where the draco decoder is located -->
<needle-engine src="path/to/your.glb" dracoDecoderPath="./include/draco/"></needle-engine>
```

Setting environment images, playing animation and automatic camera controls. [See it live on stackblitz](https://stackblitz.com/edit/needle-engine-cycle-src?file=index.html)
```html
<needle-engine
      camera-controls
      auto-rotate
      autoplay
      skybox-image="https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/industrial_sunset_puresky_1k.hdr"
      environment-image="https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/industrial_sunset_puresky_1k.hdr"
      src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Embedded/DamagedHelmet.gltf"
      >
      </needle-engine>
```

Receiving loading events:
```html
<needle-engine progress="onProgress" loadfinished="onLoadFinished"> </needle-engine>
<script>
    function onProgress(ctx, event) {
        const progress01 = evt.detail.totalProgress01;
        console.log(progress01);
    }

    function onLoadFinished() {
        console.log("Needle Engine has finished loading");
    }
</script>
```

:::tip Need more control?
For further customization or callbacks see the [scripting documentation](/scripting.md) or [Needle Engine hooks](/scripting.md#hooks). Needle Engine is fully scriptable.
:::

:::tip Prefer working visually?
These attributes can also be changed from within our Editor integrations, like [Unity](/unity/index.md) and [Blender](/blender/index.md).
:::
Source: https://engine.needle.tools/docs/reference/needle-engine-attributes.html

---
title: Scripting Examples
description: A collection of useful script snippets and examples.
---

# Scripting Examples

**Code snippets and examples** for common tasks in Needle Engine.

:::tip New to Scripting?
Start with these guides first:
- [TypeScript Essentials](/docs/tutorials/fundamentals/typescript-essentials) - Language basics
- [For Unity Developers](/docs/tutorials/fundamentals/for-unity-developers) - Unity ‚Üí Web guide
- [Create Custom Components](/docs/how-to-guides/scripting/create-components) - Complete component guide
- [Video: How to write custom components](https://youtu.be/uf5UK0bLHlY?si=82U_2L4n2V7XL7RJ)
:::

**More Examples:**
- [100+ Sample Scenes](https://engine.needle.tools/samples?utm_source=needle_docs&utm_content=scripting_examples) - Live interactive examples
- [Stackblitz Collection](https://stackblitz.com/@marwie/collections/needle-engine) - Edit in browser
- [API Documentation](https://engine.needle.tools/docs/api) - Complete reference

---

## üéØ Getting Started

### Basic Component

Every component extends `Behaviour` and uses lifecycle methods like `start()` and `update()`.

<stackblitz file="@code/basic-component.ts"></stackblitz>
@[code ts twoslash](@code/basic-component.ts)

[See all lifecycle methods](/docs/reference/api/lifecycle-methods) ‚Ä¢ [Component Architecture](/docs/how-to-guides/scripting/create-components#component-lifecycle)

---

## üì¶ References & Assets

### Reference an Object from Unity

Reference scene objects and access them at runtime.

@[code ts twoslash](@code/component-object-reference.ts)

**How it works:**
1. In Unity/Blender, you assign an object to the field in the Inspector
2. During export, the reference is saved in the glTF file with a unique identifier
3. At runtime, Needle Engine resolves the reference and assigns the actual three.js `Object3D` to your field
4. The reference is available in `awake()` or `start()` lifecycle methods

:::tip Type Safety
Use `@serializable(Object3D)` so TypeScript knows the type. Without it, you still get the reference, but as a plain object.
:::

[Understanding references](/docs/tutorials/fundamentals/for-unity-developers#components) ‚Ä¢ [Serialization guide](/docs/how-to-guides/scripting/create-components#serializable-fields)

### Reference and Load a Prefab

Load prefabs or scene assets dynamically at runtime.

@[code ts twoslash](@code/component-prefab.ts)

**How it works:**
1. Assign a prefab or scene asset in Unity/Blender Inspector
2. The asset path is exported to the glTF
3. Use `AssetReference` to load the asset on demand
4. Call `instantiate()` to create instances in your scene
5. Assets are cached after first load for better performance

:::tip Lazy Loading
Prefabs are only loaded when you call `instantiate()`, not on scene load. This keeps initial load times fast!
:::

[AssetReference API](https://engine.needle.tools/docs/api/AssetReference) ‚Ä¢ [GameObject.instantiate](/docs/how-to-guides/scripting/create-components#instantiate-objects)

### Reference and Load Scenes

Load and unload scenes dynamically for multi-scene projects.

@[code ts twoslash](@code/component-scene.ts)

**How it works:**
1. Reference Unity Scene assets or glTF files
2. Scenes are exported as separate glTF files
3. Use `SceneSwitcher` or load manually with `AssetReference`
4. Previous scene is unloaded automatically (or kept loaded if desired)
5. Perfect for level-based games or multi-room experiences

:::tip Live Example
Try the [multi-scene loading sample](https://engine.needle.tools/samples/multi-scenes-(dynamic-loading))
:::

[SceneSwitcher component](https://engine.needle.tools/docs/api/SceneSwitcher) ‚Ä¢ [Scene management guide](/docs/reference/components#scene-management)

---

## üñ±Ô∏è Input & Interaction

### Receive Clicks on Objects

Make objects clickable by adding this script. Requires `ObjectRaycaster` component in parent hierarchy.

<stackblitz file="@code/component-click.ts"></stackblitz>
@[code ts twoslash](@code/component-click.ts)

[Input events reference](/docs/reference/api/input-events) ‚Ä¢ [Interaction components](/docs/reference/components#interaction)

### Networking Clicks (Multiplayer)

Sync clicks across all connected clients. The click event is sent to all users and can trigger animations, hide objects, etc.

@[code ts twoslash](@code/component-click-networking.ts)

:::tip Unity/Blender Integration
Assign functions to the `onClick` event in Unity/Blender to trigger animations or other actions!
:::

[Networking guide](/docs/how-to-guides/networking/) ‚Ä¢ [SyncedRoom component](https://engine.needle.tools/docs/api/SyncedRoom)

---

## üé¨ Animation

### Play Animation on Click

Trigger animations when objects are clicked.

@[code ts twoslash](@code/component-animation-onclick.ts)

### Reference Animation Clips

Access animation clips for custom animation logic. You can also export arrays of clips.

@[code ts twoslash](@code/component-animationclip.ts)

[Animation components](/docs/reference/components#animation) ‚Ä¢ [Animator API](https://engine.needle.tools/docs/api/Animator)

---

## üì¢ Events & Serialization

### Create and Invoke Unity Events

Use `EventList` to create events that can be configured in Unity/Blender Editor.

@[code ts twoslash](@code/component-unityevent.ts)

:::tip Component-Level Events
`EventList` events can also be subscribed to at the component level:
```ts
myComponent.addEventListener("my-event", evt => {...});
```
This is an experimental feature. [Share feedback on our forum](https://forum.needle.tools/?utm_source=needle_docs&utm_content=content)
:::

### Custom Event Types

Expose custom events with specific arguments (e.g., strings, numbers) to Unity/Blender.

@[code ts twoslash](@code/component-customevent.ts)

**Unity Editor integration:**

![Custom event in Unity](https://user-images.githubusercontent.com/2693840/204370950-4c89b877-90d7-4e6f-8266-3352e6da16f4.png)

### Nested Objects & Serialization

Nest custom objects with automatic serialization using `@serializable` decorators.

**TypeScript:**
@[code ts twoslash](@code/component-nested-serialization.ts)

**C# (Unity/Blender):**
@[code](@code/component-nested-serialization-cs.cs)

:::tip Automatic Deserialization
Data without type decorators still works - you'll get plain objects. Add types as needed for strongly-typed access.
:::

[Type system guide](/docs/tutorials/fundamentals/typescript-essentials#types) ‚Ä¢ [Serialization reference](/docs/how-to-guides/scripting/create-components#serializable-fields)

---

## üåê Web APIs & Browser Features

:::tip Full Web Platform Access
Needle Engine gives you access to **all web APIs** and **any npm package**. Use geolocation, notifications, media devices, and more!

[Browse npm packages](https://npmjs.org) ‚Ä¢ [Web APIs reference](https://developer.mozilla.org/en-US/docs/Web/API)
:::

### Geolocation - Display Current Location

Access the browser's Geolocation API to get the user's position.

@[code ts twoslash](@code/component-location.ts)

[Geolocation API docs](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API)

### Display Current Time (with Coroutine)

Use coroutines for time-based updates without blocking the main thread.

@[code ts twoslash](@code/component-time.ts)

<video-embed src="./videos/component-time.mp4" limit_height />

[Coroutines guide](/docs/how-to-guides/scripting/use-coroutines)

---

## üé® Rendering & Visual Effects

### Change Custom Shader Properties

Modify shader properties at runtime (e.g., `_Speed` float value).

<!-- SAMPLE modify custom shader material property -->

[Shader samples](https://engine.needle.tools/samples/shaders/) ‚Ä¢ [Materials guide](https://threejs.org/docs/#api/en/materials/Material)

### Switching src Attribute

Dynamically change the scene being loaded.

[Live example on StackBlitz](https://stackblitz.com/edit/needle-engine-cycle-src?file=index.html)

### Adding Custom Post-Processing Effects

Create custom post-processing effects using the [pmndrs/postprocessing](https://github.com/pmndrs/postprocessing) library.

**Installation:**
```bash
npm i postprocessing
```

Add the effect to the same object as your `Volume` component. Example wrapping the [Outline effect](https://pmndrs.github.io/postprocessing/public/demo/#outline):

@[code](@code/custom-post-effect.ts)

[Post-processing components](/docs/reference/components#postprocessing) ‚Ä¢ [Volume API](https://engine.needle.tools/docs/api/Volume)

### Custom ParticleSystem Behaviour

Extend the ParticleSystem with custom behavior.

@[code ts twoslash](@code/custom-particle-system-behaviour.ts)

[ParticleSystem API](https://engine.needle.tools/docs/api/ParticleSystem) ‚Ä¢ [Particles sample](https://engine.needle.tools/samples/particles)

---

## üîä Audio & Media

### Custom 2D Audio Component

Create a custom audio component (though `AudioSource` covers most use cases).

@[code ts twoslash](@code/component-2d-audio.ts)

[AudioSource component](https://engine.needle.tools/docs/api/AudioSource) ‚Ä¢ [Audio guide](/docs/reference/components#audio)

---

## üìÅ File Handling

### Load External Files

Use `FileReference` to load external files like JSON, images, or other assets.

@[code ts twoslash](@code/component-filereference.ts)

[DropListener component](https://engine.needle.tools/docs/api/DropListener) ‚Ä¢ [File API](https://developer.mozilla.org/en-US/docs/Web/API/File)

---

## <logo-header logo="/imgs/html-logo.webp" alt="HTML">HTML Integration</logo-header>

### Receiving HTML Button Clicks in Components

Bridge HTML UI and 3D components by listening to DOM events.

**How it works:**
1. Add a button or element in your HTML (`index.html`)
2. Query the element with `document.querySelector()`
3. Add event listener in your component's `onEnable()`
4. Remove listener in `onDisable()` to prevent memory leaks

**Example:**
```ts
import { Behaviour } from "@needle-tools/engine";

export class HtmlButtonHandler extends Behaviour {
    private button?: HTMLButtonElement;

    onEnable() {
        this.button = document.querySelector("#my-button") as HTMLButtonElement;
        this.button?.addEventListener("click", this.onButtonClick);
    }

    onDisable() {
        this.button?.removeEventListener("click", this.onButtonClick);
    }

    private onButtonClick = () => {
        console.log("HTML button clicked!");
        // Trigger 3D scene changes here
    };
}
```

[HTML DOM access](/docs/how-to-guides/scripting/create-components#accessing-html-dom) ‚Ä¢ [DOM Events](https://developer.mozilla.org/en-US/docs/Web/Events)

---

## üîÜ Environment & Lighting

### Disable Environment Light

Control scene lighting by disabling environment maps at runtime.

```ts
import { Behaviour } from "@needle-tools/engine";

export class DisableEnvironment extends Behaviour {
    start() {
        // Disable environment map
        this.context.scene.environment = null;

        // Or reduce intensity
        if (this.context.scene.environment) {
            this.context.scene.environmentIntensity = 0.5;
        }
    }
}
```

[three.js Scene.environment](https://threejs.org/docs/#api/en/scenes/Scene.environment) ‚Ä¢ [Lighting guide](https://threejs.org/manual/#en/lights)

---

## ü§ñ Advanced Integrations

### MediaPipe Hand Tracking

Control your 3D scene with hand gestures using Google's MediaPipe library.

**Installation:**
```bash
npm i @mediapipe/hands @mediapipe/camera_utils
```

**Try it live:** [MediaPipe Hands Sample](https://engine.needle.tools/samples/mediapipe-hands/) (requires webcam)

**How it works:**
1. MediaPipe tracks hand landmarks from webcam feed
2. Hand positions are mapped to 3D world coordinates
3. Use landmarks to control objects, UI, or interactions
4. Runs in real-time with excellent performance

[MediaPipe Hands docs](https://google.github.io/mediapipe/solutions/hands.html) ‚Ä¢ [GitHub sample](https://github.com/needle-tools/needle-engine-samples)

---

## ‚öõÔ∏è Physics Examples

### Change Color on Collision

Detect physics collisions and change material colors.

```ts
import { Behaviour, Collision } from "@needle-tools/engine";

export class ColorOnCollision extends Behaviour {
    onCollisionEnter(col: Collision) {
        const renderer = this.gameObject.getComponent(Renderer);
        if (renderer?.sharedMaterial) {
            renderer.sharedMaterial.color.setHex(0xff0000); // Red
        }
    }
}
```

[Physics events](/docs/reference/api/physics-events) ‚Ä¢ [Collision API](https://engine.needle.tools/docs/api/Collision)

### Physics Trigger Relay

Invoke events when objects enter/exit trigger zones.

```ts
import { Behaviour, Collision, EventList, serializable } from "@needle-tools/engine";

export class PhysicsTriggerRelay extends Behaviour {
    @serializable(EventList)
    onEnter?: EventList;

    @serializable(EventList)
    onExit?: EventList;

    onTriggerEnter(col: Collision) {
        this.onEnter?.invoke();
    }

    onTriggerExit(col: Collision) {
        this.onExit?.invoke();
    }
}
```

[Trigger events](/docs/reference/api/physics-events) ‚Ä¢ [EventList guide](#create-and-invoke-unity-events)

### Auto Reset Position

Reset object position when it leaves a trigger zone (e.g., respawn objects).

```ts
import { Behaviour, Collision, serializable } from "@needle-tools/engine";
import { Vector3 } from "three";

export class AutoReset extends Behaviour {
    private startPosition?: Vector3;

    awake() {
        this.startPosition = this.gameObject.position.clone();
    }

    onTriggerExit(col: Collision) {
        if (this.startPosition) {
            this.gameObject.position.copy(this.startPosition);
        }
    }
}
```

### Play Audio on Collision

Trigger sound effects on physics collisions.

```ts
import { Behaviour, Collision, AudioSource } from "@needle-tools/engine";

export class PlayAudioOnCollision extends Behaviour {
    private audio?: AudioSource;

    awake() {
        this.audio = this.gameObject.getComponent(AudioSource);
    }

    onCollisionEnter(col: Collision) {
        this.audio?.play();
    }
}
```

[AudioSource component](https://engine.needle.tools/docs/api/AudioSource) ‚Ä¢ [Audio guide](/docs/reference/components#audio)

[Physics documentation](/docs/reference/components#physics) ‚Ä¢ [Rapier physics engine](https://rapier.rs/)

---

## üé≤ Utility Scripts

### Set Random Color

Randomize object colors on start (useful for spawned objects, testing).

```ts
import { Behaviour, Renderer } from "@needle-tools/engine";
import { Color } from "three";

export class SetRandomColor extends Behaviour {
    start() {
        const renderer = this.gameObject.getComponent(Renderer);
        if (renderer?.sharedMaterial) {
            // Clone material to avoid affecting other objects
            renderer.sharedMaterial = renderer.sharedMaterial.clone();
            renderer.sharedMaterial.color = new Color(
                Math.random(),
                Math.random(),
                Math.random()
            );
        }
    }
}
```

:::tip Material Cloning
Always clone materials when modifying them to avoid affecting other objects using the same material!
:::

### Spawn Objects Over Time

Instantiate objects at intervals (e.g., enemy spawning, particle effects).

```ts
import { Behaviour, AssetReference, serializable } from "@needle-tools/engine";

export class TimedSpawn extends Behaviour {
    @serializable(AssetReference)
    prefab?: AssetReference;

    @serializable()
    interval: number = 1; // seconds

    @serializable()
    maxCount: number = 10;

    private spawnCount = 0;

    async start() {
        while (this.spawnCount < this.maxCount) {
            await new Promise(resolve => setTimeout(resolve, this.interval * 1000));

            if (this.prefab) {
                const instance = await this.prefab.instantiate();
                if (instance) {
                    instance.position.copy(this.gameObject.position);
                    this.spawnCount++;
                }
            }
        }
    }
}
```

[Prefab loading](#reference-and-load-a-prefab) ‚Ä¢ [Coroutines alternative](/docs/how-to-guides/scripting/use-coroutines)
Source: https://engine.needle.tools/docs/reference/scripting-examples.html

---
title: "@serializable and other decorators"
description: Complete reference for TypeScript decorators in Needle Engine. Learn how to use @serializable for editor properties, @syncField for multiplayer networking, @validate for change callbacks, and @prefix for component injection.
---

The following table contains available Typescript decorators that Needle Engine provides.  
 
You can think of them as Attributes on steroids (if you are familiar with C#) - they can be added to classes, fields or methods in Typescript to provide additional functionality. 

|  |  | 
| --- | --- |
| **Field & Property Decorators** | |
| `@serializable()` | Add to exposed / serialized fields. Is used when loading glTF files that have been exported with components from Unity or Blender. |
| `@syncField()` | Add to a field to network the value when it changes. You can pass in a method to be called when the field changes |
| `@validate()` | Add to receive callbacks in the component event method `onValidate` whenever the value changes. This behaves similar to Unity's onValidate. |
| **Method Decorators** | |
| `@prefix(<type>)` (experimental) | Can be used to easily inject custom code into other components. Optionally return `false` to prevent the original method from being executed. See the [example below](#prefix) |
| **Class Decorators** | |
| `@registerType` | No argument. Can be added to a custom component class to be registered to the Needle Engine types and to enable hot reloading support. |

## Examples

### Serializable

```ts twoslash
import { Behaviour, serializable, EventList } from "@needle-tools/engine";
import { Object3D } from "three";

export class SomeComponentType extends Behaviour {}

export class ButtonObject extends Behaviour {
    // you can omit the type if it's a primitive 
    // e.g. Number, String or Bool
    @serializable()
    myNumber: number = 42;

    // otherwise add the concrete type that you want to serialize to
    @serializable(EventList)
    onClick?: EventList;

    @serializable(SomeComponentType)
    myComponent?: SomeComponentType;

    // Note that for arrays you still add the concrete type (not the array)
    @serializable(Object3D)
    myObjects?: Object3D[];
}
```

### SyncField

The `@syncField` decorator can be used to automatically network properties of your components for all users (visitors of your website) connected to the same networking room. It can optionally take a callback function that will be invoked whenever the value changes.     

- To notify the system that a reference value (like an object or an array) has changed you need to re-assign the field. E.g. like this: `myField = myField`   
- The callback function can *not* be an arrow function (e.g. `MyScript.prototype.onNumberChanged` works for `onNumberChanged() { ... }` but it does not for `myNumberChanged = () => { ... }`)

```ts twoslash
import { Behaviour, serializable, syncField } from "@needle-tools/engine";

export class MyScript extends Behaviour {

    @syncField(MyScript.prototype.onNumberChanged)
    @serializable()
    myNumber: number = 42;

    private onNumberChanged(newValue: number, oldValue: number){
        console.log("Number changed from ", oldValue, "to", newValue)
    }
}
```

### Validate
```ts twoslash
import { Behaviour, serializable, validate } from "@needle-tools/engine";

export class MyScript extends Behaviour {

    @validate()
    @serializable()
    myNumber?: number;

    start() { setInterval(() => this.myNumber = Math.random(), 1000) }

    onValidate(fieldName: string) {
        console.log("Validate", fieldName, this.myNumber);
    }
}
```

### Prefix
[Live example](https://stackblitz.com/edit/needle-engine-prefix-example?file=src%2Fmain.ts)
```ts twoslash
import { Camera, prefix } from "@needle-tools/engine";
class YourClass {
    @prefix(Camera) // < this is type that has the method you want to change
    awake() { // < this is the method name you want to change

        // this is now called before the Camera.awake method runs
        // NOTE: `this` does now refer to the Camera instance and NOT `YourClass` anymore. This allows you to access internal state of the component as well
        console.log("Hello camera:", this)
        // optionally return false if you want to prevent the default behaviour
    }
}
```
Source: https://engine.needle.tools/docs/reference/typescript-decorators.html

---
title: Using Needle Engine with three.js
---

# <logo-header logo="/imgs/threejs-logo.webp" alt="three.js">Needle Engine + three.js</logo-header>

**Welcome!** If you're here because you know three.js, you're in the right place. Needle Engine is a **web-based 3D engine built on top of three.js** that makes it easier and faster to create interactive 3D experiences for the web.

## What is Needle Engine?

Think of Needle Engine as **three.js with superpowers**:
- All the power of three.js (since it's built on it)
- Plus a component system for better code organization
- Plus built-in features like physics, XR, networking, and particles
- Plus visual editing tools (Unity and Blender integrations)
- Plus automatic optimization and compression

**All three.js APIs remain fully accessible** ‚Äì you can write vanilla three.js code, use any three.js-compatible library, or mix and match as needed.

:::tip Try It in 30 Seconds
Want to see what Needle Engine can do? Create a new project instantly:

üöÄ **[engine.needle.tools/new](https://engine.needle.tools/new)** - Opens a ready-to-go project in StackBlitz

No installation, no setup. Just click and start experimenting with three.js + Needle Engine in your browser!
:::

## Why Choose Needle Engine Over Vanilla three.js?

**Enhanced Developer Experience:**
- üß© **Component system** for organizing and reusing 3D logic
- ‚ö° **Built-in features** like physics, XR, networking, particles, and UI
- üé® **Editor integrations** with Unity and Blender for visual scene creation
- üöÄ **Optimized build pipeline** with automatic 3D asset compression and optimization
- üí® **Faster development** with less boilerplate and better tooling

**Full Flexibility:**
Whether you're building a simple scene with pure three.js or a complex application with Needle's components, you have complete freedom. The component system is an enhancement, not a replacement ‚Äì use what makes sense for your project.

:::tip Want Visual Editing?
Check out our editor integrations for powerful visual creation workflows:
- <logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="../unity/">Unity Integration</a></logo-header> ‚Äì Full-featured 3D editor with C# scripting support
- <logo-header logo="/blender/logo.png" alt="Blender"><a href="../blender/">Blender Integration</a></logo-header> ‚Äì Open-source 3D creation suite with Python scripting
:::

:::tip Inspect and Debug
Use the [Needle Inspector](./needle-devtools-for-threejs-chrome-extension.md) Chrome extension to inspect, debug, and edit any three.js scene directly in your browser ‚Äì perfect for development and learning.
:::

[[toc]]

---

## Quick Start: Web Component

The easiest way to get started is using the `<needle-engine>` web component. Display rich, interactive 3D scenes directly in HTML with just a few lines of code.

### Basic Example

<codewrap>

```html
<!-- Import the component -->
<script type="module" src="https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js"></script>

<!-- Use it like any other HTML element -->
<needle-engine
    src="https://cloud.needle.tools/-/assets/Z23hmXBZ21QnG-Z21QnG-world/file"
    background-color="transparent">
</needle-engine>
```

</codewrap>

<iframe src="/docs/code-samples/basic-webcomponent.html" style="
    width: 100%;
    aspect-ratio: 16/9;
    outline: none;
    border: none;
    "
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking"
    allowfullscreen
    ></iframe>

[Open this example on StackBlitz](https://stackblitz.com/edit/needle-engine-prebundled?file=index.html) ‚Ä¢ [View all web component attributes](../reference/needle-engine-attributes.md)

---

## Extending with Vanilla three.js

The web component works seamlessly with vanilla three.js code. Use Needle Engine's lifecycle hooks to access the scene and add your own three.js objects, modify materials, or write custom logic.

### Adding Objects with onStart

```html
<!-- Import Needle Engine -->
<script type="module" src="https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js"></script>

<!-- Add the web component -->
<needle-engine src="your-scene.glb"></needle-engine>

<!-- Extend with vanilla three.js -->
<script type="module">
  import { onStart } from 'https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js';
  import * as THREE from 'three';

  onStart(context => {
    // Access the three.js scene
    console.log("Scene loaded:", context.scene);

    // Add objects using vanilla three.js
    const geometry = new THREE.BoxGeometry(1, 1, 1);
    const material = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
    const cube = new THREE.Mesh(geometry, material);
    cube.position.set(0, 0.5, 0);

    context.scene.add(cube);
  });
</script>
```

### Animating Objects with onUpdate

```typescript
import { onStart, onUpdate } from '@needle-tools/engine';
import * as THREE from 'three';

let rotatingCube;

onStart(context => {
  // Create a rotating cube
  const geometry = new THREE.BoxGeometry(1, 1, 1);
  const material = new THREE.MeshStandardMaterial({ color: 0xff0000 });
  rotatingCube = new THREE.Mesh(geometry, material);
  context.scene.add(rotatingCube);
});

onUpdate(context => {
  // Rotate every frame using deltaTime
  if (rotatingCube) {
    rotatingCube.rotation.y += context.time.deltaTime;
  }
});
```

### Modifying Loaded Scene Objects

```typescript
import { onStart } from '@needle-tools/engine';

onStart(context => {
  // Find and modify objects from your loaded glb
  const myObject = context.scene.getObjectByName("MyObjectName");
  if (myObject) {
    myObject.position.y = 2;
    myObject.scale.setScalar(1.5);
  }

  // Or traverse the entire scene
  context.scene.traverse(obj => {
    if (obj.isMesh && obj.material) {
      // Modify all materials in the scene
      obj.material.metalness = 0.5;
      obj.material.roughness = 0.3;
    }
  });
});
```

### Available Lifecycle Hooks

| Hook | When it's called |
| --- | --- |
| `onInitialized(callback)` | When the context is initialized (before first frame) |
| `onStart(callback)` | At the beginning of the first frame after scene loads |
| `onUpdate(callback)` | Every frame (perfect for animations) |
| `onBeforeRender(callback)` | Before the scene renders |
| `onAfterRender(callback)` | After the scene renders |

**Context Object Properties:**

All hooks provide the `context` object with access to:
- `context.scene` - The three.js Scene
- `context.camera` - The active Camera
- `context.renderer` - The WebGLRenderer
- `context.time` - Time data (deltaTime, frame count, etc.)
- And much more...

:::tip Learn More About Scripting
- [Scripting Documentation](../scripting.md#hooks) - Detailed information about lifecycle hooks
- [Scripting Examples](../scripting-examples.md) - More code samples and patterns
- [Custom Components](../scripting.md#component-architecture) - Build reusable components
:::

---

## Installation Options

### Install from CDN

Use Needle Engine directly with vanilla JavaScript ‚Äì no bundler required. The prebundled version includes core components, physics, particles, networking, XR, and more.

<codewrap>

```html
<script type="module" src="https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js">
</script>
```

</codewrap>

**When to use:**
- Quick prototypes and experiments
- Simple integrations into existing websites
- Learning and exploring Needle Engine
- Projects without a build pipeline

### Install from NPM

For projects using modern JavaScript tooling and bundlers:

```bash
npm install @needle-tools/engine
```

**When to use:**
- Production applications
- Projects using bundlers (Vite, Webpack, etc.)
- TypeScript projects
- When you need tree-shaking and optimal bundle size

**Example usage:**

```typescript
import { NeedleEngine } from '@needle-tools/engine';
import * as THREE from 'three';

// Your code here
```

---

## Development Setup

### Rapid Prototyping on StackBlitz

For quick experiments, create a new project instantly:

üöÄ **[engine.needle.tools/new](https://engine.needle.tools/new)** - Start a new project in seconds

üìö **[StackBlitz Collection](https://stackblitz.com/@marwie/collections/needle-engine)** - Browse example projects

**Perfect for:**
- Learning and experimentation
- Sharing code snippets
- Quick proof-of-concepts
- Testing ideas without local setup

### Local Development with VS Code

For more control and offline development:

**Setup:**

1. Open your project folder in Visual Studio Code
2. Install the [Live Server extension](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)
3. Click **Go Live** in the VSCode footer
4. Open `http://localhost:5500` in your browser (usually opens automatically)

**Benefits:**
- Full control over your development environment
- Works offline
- Better performance for large projects
- Easier integration with version control

:::tip Sample glTF Files
Need a test scene? [Download this sample glb](https://github.com/needle-tools/needle-engine-samples/raw/main/vanilla/myScene.glb) to get started quickly.
:::

---

## Complete HTML Example

Here's a minimal but complete example showing how to use Needle Engine with vanilla HTML:

@[code](@code/basic-html.html)

[View on GitHub](https://github.com/needle-tools/needle-engine-samples/tree/main/vanilla) ‚Ä¢ [View on StackBlitz](https://stackblitz.com/edit/needle-engine-prebundled?file=index.html)

---

## three.js Compatibility

Needle Engine uses a fork of [three.js](https://threejs.org/) that includes additional features and improvements, especially for:
- **WebXR** - Enhanced XR session management and features
- **Animation** - Improved animation playback and blending
- **USDZ Export** - Better support for iOS AR

**Full Compatibility:**
All standard three.js functionality is available in Needle Engine. You can:
- Use any three.js-compatible library
- Follow three.js tutorials and examples
- Import existing three.js code
- Mix vanilla three.js with Needle components

---

## Next Steps

**Learn More:**
- [Web Component Attributes](../reference/needle-engine-attributes.md) - Configure the `<needle-engine>` component
- [Scripting Guide](../scripting.md) - Create custom scripts and components
- [Scripting Examples](../scripting-examples.md) - Code samples and patterns
- [Needle DevTools](./needle-devtools-for-threejs-chrome-extension.md) - Debug and inspect scenes

**Build Bigger:**
- <logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="../unity/">Unity Integration</a></logo-header> - Visual editing with full-featured 3D editor
- <logo-header logo="/blender/logo.png" alt="Blender"><a href="../blender/">Blender Integration</a></logo-header> - Open-source 3D creation workflow
- [Features Overview](../features-overview.md) - See what's possible with Needle Engine

**Get Help:**
- [Forum](https://forum.needle.tools) - Ask questions and share projects
- [Discord](https://discord.needle.tools) - Join the community
- [Examples](https://engine.needle.tools/samples) - Browse sample projects

---

:::tip Using Editor Integrations
Did you know that Needle Engine seamlessly integrates with Blender and Unity? Create complex 3D scenes visually and export them directly to the web. Perfect for large projects and team collaboration.

<logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="../unity/">Learn about Unity Integration</a></logo-header> ‚Ä¢ <logo-header logo="/blender/logo.png" alt="Blender"><a href="../blender/">Learn about Blender Integration</a></logo-header>
:::
Source: https://engine.needle.tools/docs/three/index.html

<br/>

<div class="centered" style="display: flex;
    align-items: center;
    gap: 20px;
    font-size: 2em;
    font-weight: 100;">
    <img src="/imgs/threejs-logo.webp" style="max-height:70px;" title="three.js Logo" alt="three.js Logo"/> +
    <img src="/imgs/chrome-logo.webp" style="max-height:70px;" title="Chrome Logo" alt="Chrome Logo"/>
</div>

# Needle Inspector ‚Äî DevTools for three.js

The **Needle Inspector** is a powerful Chrome DevTools extension for inspecting and debugging three.js, react-three-fiber, and Needle Engine projects directly in your browser. Think of it as the browser's built-in inspector, but specifically designed for 3D scenes.

<video-embed src="https://www.youtube.com/watch?v=zSFqZSqzGGw" />

### Quick Start

1. Install the extension from the [Chrome Web Store](https://chromewebstore.google.com/detail/needle-inspector-%E2%80%94-devtoo/jonplpbnhmanoekkgcepnedhghflblmo)
2. Enable the inspector by clicking the Needle icon in the browser toolbar
3. Navigate to any webpage with a three.js scene
4. The inspector will automatically detect the scene and appear
5. Start exploring your 3D content!

:::tip Works on any three.js website
The Needle Inspector works on **any** website using three.js, react-three-fiber, or Needle Engine ‚Äì not just your own projects. Use it to learn from other developers' work or debug production sites.
:::

## Features

### Real-time Scene Inspection

The inspector gives you a complete view of your 3D scene hierarchy, similar to how the browser's Elements panel shows your HTML structure.

- **Scene Hierarchy**: Browse through all objects, meshes, lights, and cameras in an expandable tree view
- **Search & Filter**: Quickly find specific objects by name or type
- **Live Updates**: See changes to your scene in real-time as they happen

### Property Editing

Edit any property of your 3D objects directly in the browser ‚Äì no need to reload or rebuild your project.

- **Transform Controls**: Adjust position, rotation, and scale with intuitive number inputs
- **Material Properties**: Change colors, textures, opacity, and rendering settings
- **Boolean Toggles**: Show/hide objects, enable/disable features
- **Texture Inspection**: View and analyze texture properties

All changes are applied instantly to the running scene, making it perfect for tweaking values until they look just right.

### Performance Monitoring

Keep track of your scene's performance with built-in stats:

- **FPS Counter**: Monitor frame rate in real-time
- **Scene Statistics**: View object counts, triangle counts, and geometry stats
- **Download Size**: See estimated bandwidth usage

### AI-Powered Assistance <div style="display:inline-flex;gap:.5em;vertical-align:middle;padding-left:.5em;"> <img style="max-height:1.2em;" src="/imgs/vscode-logo.webp" title="VS Code Logo" alt="VS Code Logo"/> <img style="max-height:1.2em;" src="/imgs/claude-logo.webp" title="Claude Logo" alt="Claude Logo"/> <img style="max-height:1.2em;" src="/imgs/cursor-logo.webp" title="Cursor Logo" alt="Cursor Logo"/> <img style="max-height:1.2em;" src="/imgs/antigravity-logo.webp" title="Antigravity Logo" alt="Antigravity Logo"/> </div>

Connect the inspector to AI tools like Claude or Cursor for intelligent debugging and development assistance.

- **MCP Integration**: Exposes inspector capabilities to AI assistants
- **Natural Language Queries**: Ask questions about your scene
- **Automated Analysis**: Get suggestions for optimization and improvements

Setup is simple:
```bash
npx needle-cloud start
```

Then connect your AI tool to explore your scene with natural language.   
**Learn how to connect your local AI tools**: [Needle MCP documentation](../ai/needle-mcp-server).

### Export Changes

Made some tweaks you want to keep? Export your changes for later use:

- **JSON Export**: Save property modifications as structured data
- **Text Export**: Get a readable summary of your changes
- **Version Control**: Perfect for sharing modifications with your team

## How It Works

The Needle Inspector automatically detects three.js scenes on any webpage you visit. When a scene is found:

1. An inspector panel appears showing the scene hierarchy
2. Click any object to view and edit its properties
3. Changes are applied immediately to the live scene
4. Use the search and filter tools to navigate complex scenes

### Supported Platforms

- three.js (all versions)
- react-three-fiber
- Needle Engine
- A-frame (via three.js)
- Threlte
- Any three.js-based framework

## Installation

1. Visit the [Needle Inspector page on the Chrome Web Store](https://chromewebstore.google.com/detail/needle-inspector-%E2%80%94-devtoo/jonplpbnhmanoekkgcepnedhghflblmo)
2. Ensure you are using Google Chrome or a Chromium-based browser
3. Click "Add to Chrome" and you're ready to go!

## Usage Tips

:::tip Toggle the inspector
Click the Needle Inspector extension icon to show or hide the inspector panel at any time.
:::

:::tip Multiple scenes
If a page has multiple three.js scenes, you can switch between them using the scene selector at the top of the inspector.
:::

:::tip Inspect in isolation
Right-click any object in the hierarchy and select "Inspect" to view it in an isolated 3D view, making it easier to focus on specific parts of your scene.
:::

## Use Cases

### Development & Debugging
- Quickly test different property values without recompiling
- Debug complex scene hierarchies
- Identify performance bottlenecks

### Learning & Exploration
- Inspect how other developers build their scenes
- Understand three.js best practices by examining production sites
- Learn new techniques by exploring example projects

### Optimization
- Monitor performance metrics
- Identify heavy objects or excessive geometry
- Test optimization strategies in real-time

## Next Steps

- [Learn about Needle Engine](/docs/)
- [Explore three.js integration](/docs/three/)
- [Get started with Needle in Unity](/docs/unity/)
- [Get started with Needle in Blender](/docs/blender/)
- [AI-Powered Development](/docs/ai/) - Connect AI assistants to the inspector

:::tip Using Needle Engine?
The inspector has special features when used with Needle Engine projects, including component editing, networking inspection, and XR debugging tools.
:::
Source: https://engine.needle.tools/docs/three/needle-devtools-for-threejs-chrome-extension.html

---
title: Tutorials
description: Learn Needle Engine step-by-step with hands-on tutorials
---

# Tutorials

**Learn by doing.** These tutorials will guide you through building complete projects from start to finish. Each tutorial is designed to teach you the fundamentals while creating something real.

:::tip New to Needle Engine?
Start with [Getting Started](../getting-started/) to install and set up your development environment first.
:::

---

## What are Tutorials?

Tutorials are **learning-oriented** guides that take you from zero to a working project. They are:
- Step-by-step and easy to follow
- Guaranteed to work if you follow along
- Designed to build confidence through hands-on practice
- Perfect for beginners and those learning new features

**Not sure what you need?**
- Want to **learn the basics**? Start here with Tutorials
- Need to **solve a specific problem**? See [How-To Guides](../how-to-guides/)
- Want to **understand concepts**? See [Explanation](../explanation/)
- Looking for **API reference**? See [Reference](../reference/)

---

## Getting Started

### Fundamentals

Build your foundation with these essential tutorials:

- [For Blender Artists](./fundamentals/for-blender-artists) - 3D artists guide to interactive web experiences (~20 min, Beginner)
- [For Unity Developers](./fundamentals/for-unity-developers) - Learning path for Unity developers (Beginner)
  - [Working with Unity Integration](./fundamentals/unity-integration) - Unity workflow and glTF export (~15 min, Intermediate)
  - [C# to TypeScript Translation](./fundamentals/c-sharp-to-typescript) - Translate your C# knowledge (~15 min, Intermediate)
- [TypeScript Essentials](./fundamentals/typescript-essentials) - Learn TypeScript basics for Needle Engine (~20 min, Beginner)

### Your First Project

Choose your preferred tool and create your first Needle Engine scene:

- <logo-header logo="/imgs/unity-logo.webp" alt="Unity"><strong>Unity:</strong></logo-header> <a href="../unity/">Unity Integration</a> - Install and create your first interactive web scene
- <logo-header logo="/blender/logo.png" alt="Blender"><strong>Blender:</strong></logo-header> <a href="../blender/">Blender Add-on</a> - Install the add-on and export to the web
- <logo-header logo="/imgs/threejs-logo.webp" alt="three.js"><strong>Web:</strong></logo-header> <a href="../getting-started/">Getting Started</a> - Use Needle Engine with JavaScript/TypeScript

---

## Build Interactive Experiences

:::tip Coming Soon
The following comprehensive tutorials are planned and will be added soon. In the meantime, check out our [Samples](https://engine.needle.tools/samples) for interactive examples.
:::

Learn by building complete, real-world projects:

- **Interactive Product Viewer** - Create a professional 3D product viewer (Coming soon)
- **VR Gallery Experience** - Build a complete WebXR gallery (Coming soon)
- **Multiplayer Game** - Create a real-time multiplayer experience (Coming soon)

---

## Scripting & Components

Learn to create interactive functionality with code:

- [Create Components](../how-to-guides/scripting/create-components) - Write custom TypeScript components
- [Scripting Examples](../reference/scripting-examples) - Code examples and snippets

---

## Platform-Specific Workflows

### <logo-header logo="/imgs/unity-logo.webp" alt="Unity">Unity Workflows</logo-header>
- [Unity Integration](../unity/) - Unity-specific features and workflows

### <logo-header logo="/blender/logo.png" alt="Blender">Blender Workflows</logo-header>
- [Blender Add-on](../blender/) - Blender-specific features and workflows

### <logo-header logo="/imgs/threejs-logo.webp" alt="three.js">Web-First Development</logo-header>
- [three.js Integration](../three/) - Working with three.js directly

---

## Need Help?

- **Stuck on a tutorial?** Check the [FAQ](../reference/faq) or ask in [Discord](https://discord.needle.tools)
- **Want to solve a specific problem?** See [How-To Guides](../how-to-guides/)
- **Need to understand concepts?** See [Explanation](../explanation/)
- **Looking for API docs?** See [Reference](../reference/)

---

## Next Steps

After completing tutorials:
1. **Solve specific problems** - [How-To Guides](../how-to-guides/)
2. **Deepen your understanding** - [Explanation](../explanation/)
3. **Look up APIs** - [Reference](../reference/)
4. **Get inspired** - [Samples & Showcase](https://samples.needle.tools/#showcase)
5. **Get help** - [Help & Community](../help/)
Source: https://engine.needle.tools/docs/tutorials/index.html

# Editor Sync

Needle allows for a very fast, iterative workflow between Unity and the browser. Usually, exports take less than a few seconds. However, once scenes become more complex, for some types of changes (adjusting material properties, nudging objects around), we provide an even faster way to see your changes ‚Äì **Editor Sync**.

## How to use Editor Sync

You can enable Editor Sync by adding the `EditorSync` component to your scene. This component will connect your Unity Editor with your browser project and automatically sync applicable changes between the two.

:::tip
**Editor Sync** is currently an experimental feature. Please let us know about your experience with it! We're eager to hear your feedback.
:::

## Video Tutorial

This tutorial shows the Editor Sync workflow in action:

<video-embed src="https://www.youtube.com/watch?v=gZX_sqrne8U" limit_height />
Source: https://engine.needle.tools/docs/unity/editor-sync.html

---
title: Getting Started with Unity
description: Complete tutorial for setting up your first Needle Engine project in Unity - from samples to manual setup, TypeScript components, and NpmDef packages
---

# Getting Started with Unity

Learn how to create your first interactive web project with Needle Engine in Unity.

:::tip Already Installed?
If you haven't installed Needle Engine for Unity yet, see the [Unity Integration page](./index) first.
:::

:::tip Unity Developer?
New to web development? Start with **[For Unity Developers](../tutorials/fundamentals/for-unity-developers)** to learn how Unity concepts translate to Needle Engine and TypeScript.
:::

:::details Video: Getting Started with Unity (16 minutes)
This comprehensive video tutorial walks you through setting up Needle Engine in Unity and creating your first interactive web project.

<video-embed src="https://www.youtube.com/watch?v=3dB-d1Jo_Mk" limit_height />
:::

---

## Choose Your Starting Point

There are three ways to get started. Pick the one that fits your workflow:

### üé® Start from a Sample (Recommended)

**Best for:** Learning, exploring features, getting inspired

**100+ samples** covering a wide range of topics, use cases, and industries.

**Browse online:** [Samples page](https://engine.needle.tools/samples/)

**Install in Unity:**
1. Open `Needle Engine > Explore Samples`
2. Click **"Install Samples"** (or [download manually](http://engine.needle.tools/downloads/unity/samples))
3. Choose any sample and click **"Open Scene"**
4. Press Play!

:::tip Samples are Read-Only (Easy Updates!)
Samples are UPM packages, so they're read-only by design.

**To modify:**
- **Scenes:** When you open a sample via the Samples window, it's automatically copied to your `Assets/` folder where you can edit it
- **Additional Assets:** Some materials or assets may need to be manually copied to your `Assets/` folder, depending on the sample
- **Scripts:** Copy to your web project's `src/` folder to customize behavior
:::

---

### üöÄ Start from a Scene Template (Fast!)

**Best for:** Quick prototypes, starting fresh projects

**Go from idea to prototype in seconds** with pre-built scene templates.

**Steps:**
1. Click `File > New Scene`
2. Select a template with **(needle)** in the name
3. Click **"Create"**
4. Press Play!

**Recommended:** [Collaborative Sandbox](https://engine.needle.tools/samples/collaborative-sandbox) - includes interactivity, multiplayer, and physics.

![Unity Scene Templates with Needle Engine](https://user-images.githubusercontent.com/2693840/185917275-a147cd90-d515-4086-950d-78358185b1ef.png)

---

### ‚öôÔ∏è Start from Scratch (Manual Setup)

**Best for:** Full control, understanding the workflow

Want full control? Follow these steps to recreate the "Minimal (Needle)" template manually.

**1. Create a new empty scene**

**2. Set up your scene for exporting**
- Add an empty GameObject, name it **"Exporter"**
- Add the **`Needle Engine`** component to it
- This component:
  - Creates and manages your web project
  - Shows warnings for outdated packages
  - Provides quick access to project settings

**3. Choose a web project template**

Select a template for your project. Default: <logo-header logo="/imgs/vite-logo.webp" alt="Vite">Vite</logo-header> (fast web bundler)

![Unity Needle Engine local templates](/imgs/unity-project-local-template.jpg)

**4. Press Play** to install and start your web project

:::tip Project Name & Location
By default, the project name matches your scene name. Change it via **"Directory Name"** (path is relative to your Unity project).
:::

:::tip Custom Templates
Create your own templates: `Project View > Create > Needle Engine > Project Template`

**Template types:**
- **Local:** Folder copied from disk
- **Remote:** GitHub repository cloned
:::

---

## Understanding Project Structure

When you create a Needle Engine project, you get both Unity assets and a web project:

:::: file-tree name="Unity Project" showall="true"
::: file Assets/
This is where project specific/exclusive assets live.
:::
::: file Packages/
This is where packages installed for this project live. A package can contain any asset type, and can be added to multiple Unity projects. It therefore is a great method to share code or assets. To learn more about packages, see [the Unity documentation about packages](https://docs.unity3d.com/Manual/PackagesList.html).
:::
::: file Packages/Needle Engine/
Needle Engine for Unity is a package that contains all the necessary files to export your Unity scene to a web project. It also contains the built-in components and tools for creating interactive web projects. You can update the package via the Unity Package Manager.
:::
::: file Packages/Needle Engine/Core/
:::
::: file Packages/Needle Engine/Core/Runtime/
:::
::: file Packages/Needle Engine/Core/Runtime/Components/
Contains all built-in components for Needle Engine. You can learn more about them in the [Components Reference](../reference/components). Looking at samples and going through this folder are great ways to see what components are available and how they can be used in your projects.
:::
::::

**Web Project Location:**

When creating a new web project in Unity, you can choose to create it from a local template (by default we ship a Vite based web template). The web project lives alongside your Unity project:

```
MyUnityProject/
‚îú‚îÄ‚îÄ Assets/
‚îî‚îÄ‚îÄ MyUnityProject-Web/    ‚Üê Your web project
```

### Use Web Projects Directly from Github

Besides the web project templates that already ship with the Unity integration you can setup your web project directly from github by entering the Github repository URL in the Project Folder field.

When creating a new web project the repository will be cloned (or downloaded if you don't have git installed). The repository is then searched for a `needle.config.json` file. If none can be found in the cloned repository the root directory will be used.

Examples of remote template projects can be found on [github.com/needle-engine](https://github.com/needle-engine)

![Unity Needle Engine remote templates](/imgs/unity-project-remote-template.jpg)

### Temporary Projects

If you're planning to only add custom files via NpmDefs and not change the project config (e.g. for a quick fullscreen test), you can prefix the project path with `Library`. The project will be generated in the Unity Project Library and does not need to be added to source control (the Library folder should be excluded from source control). We call these projects _temporary projects_. They're great for quickly testing out ideas!

---

## <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">Writing TypeScript Components</logo-header>

Write TypeScript code that automatically becomes available in Unity as C# stub components.

**How it works:**
1. Write TypeScript classes in your web project
2. C# stubs are generated automatically
3. Attach components in Unity Editor
4. Properties marked with `@serializable` appear in Inspector
5. See changes in seconds (hot reload)

:::tip Perfect Team Workflow
**Web Developer:** Writes components, manages web project

**3D Designer:** Edits scenes, content, and settings in Unity

**Result:** Both see changes instantly with hot reload üî•
:::

### Option 1: <logo-header logo="/imgs/folder-icon.webp" alt="Folder">Scripts Directory</logo-header> (Simple)

**Best for:** Single projects, quick prototyping

Add components in the `scripts` folder (usually `src/scripts/`). C# stubs are generated automatically.

**Example:**
```ts
import { Behaviour, serializable } from "@needle-tools/engine";
import { Object3D } from "three";

export class MyComponent extends Behaviour {
  @serializable(Object3D)
  otherObject?: Object3D;

  start() {
    console.log("Hello World", this.otherObject);
  }
}
```

**What happens next:**
1. Save the TypeScript file
2. A C# stub is generated in `Assets/Needle/Components.codegen/`
3. The component appears in Unity's Add Component menu
4. Attach it to GameObjects and configure properties in the Inspector

[Learn more about creating components ‚Üí](../how-to-guides/scripting/create-components)

---

### Option 2: <logo-header logo="/imgs/npm-logo.webp" alt="npm">NpmDef</logo-header> (Advanced)

**Best for:** Sharing code between multiple projects, team workflows

**NPM Definitions** (NpmDef) are [NPM packages](https://docs.npmjs.com/about-packages-and-modules) integrated into Unity Editor.

**Benefits:**
- Share scripts across multiple web or Unity projects
- C# stubs generated automatically
- Version-controlled packages
- Easier collaboration and code reuse

#### Creating an NpmDef

**1. Create:**
- Right-click in Unity Project browser
- Select `Create > NPM Definition`

**2. Install to project:**
- Select your `Needle Engine` component
- Add the NpmDef to the **dependencies** list
- Click **"Install"**
- Restart the dev server

**3. Edit code:**
- Double-click the NpmDef asset
- Opens VSCode workspace automatically

![NpmDef in Unity](https://user-images.githubusercontent.com/5083203/170374130-d0e32516-a1d4-4903-97c2-7ec9fa0b17d4.png)

:::tip How it Works
Adding an NpmDef to dependencies adds the local NPM package to `package.json`:
```bash
# Equivalent to:
npm i <path/to/package>
```
:::

**Example NpmDef structure:**
```
MyPackage/
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ MyComponent.ts
‚îî‚îÄ‚îÄ README.md
```

[Learn more about scripting ‚Üí](../how-to-guides/scripting/create-components)

---

## Troubleshooting

**Common issues:**

| Issue | Solution |
| --- | --- |
| Server won't start | [Install Node.js](../getting-started/#prerequisites) (version 18.x or newer) |
| Can't edit code | [Install VSCode](../getting-started/#code-editor-and-tools) (recommended editor) |
| Components not showing in Unity | Restart Unity or click "Generate C# Components" on Needle Engine component |
| Hot reload not working | Check console for errors, restart dev server with "Install" button |
| Web project not found | Check the Directory Name field points to correct location |
| Port already in use | Change port in `vite.config.js` or close other dev servers |

**Still having issues?**
- Check the [FAQ](../reference/faq) for more solutions
- Ask in [Discord](https://discord.needle.tools) for community help
- Review the [full troubleshooting guide](../reference/faq)

---

## Next Steps

Now that you have your first project set up, continue learning:

### Learn the Unity Workflow
- [Working with Unity Integration](../tutorials/fundamentals/unity-integration) - Complete Unity workflow guide
- [Exporting Assets](../how-to-guides/export/) - What gets exported and how
- [Editor Sync](./editor-sync) - Live sync between Unity and browser

### Start Scripting
- [For Unity Developers](../tutorials/fundamentals/for-unity-developers) - Complete learning path
- [C# to TypeScript Translation](../tutorials/fundamentals/c-sharp-to-typescript) - Translate your C# knowledge
- [TypeScript Essentials](../tutorials/fundamentals/typescript-essentials) - Language basics

### Explore Features
- [Component Reference](../reference/components) - All built-in components
- [XR/AR Support](/docs/how-to-guides/xr/) - VR and AR experiences
- [Networking](/docs/how-to-guides/networking/) - Multiplayer and collaboration
- [Deployment](../how-to-guides/deployment/) - Share your website

### Get Inspired
- [100+ Samples](https://engine.needle.tools/samples/) - Interactive examples
- [Showcase](https://samples.needle.tools/#showcase) - Community projects
- [Video Tutorials](https://www.youtube.com/@needle-tools) - Step-by-step guides
Source: https://engine.needle.tools/docs/unity/getting-started.html

---
title: Needle Engine for Unity
description: Create interactive 3D web experiences with Unity. Export scenes to optimized glTF, write TypeScript components with C# stubs, and deploy anywhere on the web.
editLink: true
---

# <logo-header logo="/imgs/unity-logo.webp" alt="Unity">Needle Engine for Unity</logo-header>

Create **highly interactive, flexible, and lightweight web applications** right inside Unity.

**What you can do:**
- Use Unity's powerful editor tools for 3D scenes, animation, and design
- Export scenes to optimized glTF format automatically
- Write TypeScript code that appears as C# components in Unity
- Integrate seamlessly with any web frontend framework
- Deploy anywhere on the web with hot reload support

---

## Install the Unity Package

<NoDownloadYet>
  <br/>
  <needle-button
    event_goal="download_unity"
    event_position="getting_started"
    large
    href="https://engine.needle.tools/downloads/unity?utm_source=needle_docs&utm_content=getting_started"
    same_tab
    next_url="/docs/unity/"
    >
    <strong>Download Needle Engine for Unity</strong>
  </needle-button>
</NoDownloadYet>

<!-- [Mirror](https://package-installer.glitch.me/v1/installer/needle/com.needle.engine-exporter?registry=https://packages.needle.tools&scope=com.needle&scope=org.khronos)    -->

**Installation steps:**

1. **Drop the downloaded .unitypackage file** into a Unity project and confirm that you want to import it

2. **Wait a moment** for the installation and import to finish. A window may open stating that "A new scoped registry is now available in the Package Manager." This is our Needle Package registry. You can safely close that window

3. **Explore Samples**
   Select the menu option `Needle Engine > Explore Samples` to view, open and modify all available [sample scenes](https://engine.needle.tools/samples)

---

## Quick Start Video

<video-embed src="https://www.youtube.com/watch?v=3dB-d1Jo_Mk" limit_height />

---

## Getting Started

Choose how you want to start your first project:

### üé® [Start from a Sample](./getting-started#start-from-a-sample-recommended) (Recommended)

Browse **100+ samples** online or install them in Unity via `Needle Engine > Explore Samples`.

**Perfect for:** Learning features, exploring capabilities, getting inspired

[Browse Samples ‚Üí](https://engine.needle.tools/samples/)

---

### üöÄ [Start from a Scene Template](./getting-started#start-from-a-scene-template-fast)

Create a new scene from a Needle Engine template via `File > New Scene`.

**Perfect for:** Quick prototypes, starting fresh projects

---

### ‚öôÔ∏è [Manual Setup](./getting-started#start-from-scratch-manual-setup)

Add a `Needle Engine` component to your scene and configure your web project manually.

**Perfect for:** Understanding the workflow, full control

---

**Ready to build?**

**[‚Üí Complete Getting Started Tutorial](./getting-started)** - Step-by-step guide for your first project

---

## Key Features

### TypeScript Components with C# Stubs

Write TypeScript code in your web project that automatically appears as components in Unity:

```ts
import { Behaviour, serializable } from "@needle-tools/engine";

export class MyComponent extends Behaviour {
  @serializable()
  speed: number = 5;

  update() {
    this.gameObject.position.x += this.speed * this.context.time.deltaTime;
  }
}
```

The component appears in Unity's Add Component menu with editable fields in the Inspector.

[Learn more: For Unity Developers ‚Üí](../tutorials/fundamentals/for-unity-developers)

---

### Hot Reload & Editor Sync

Make changes in Unity or your code editor and see them instantly in the browser:

- **Scene changes** update automatically on save
- **TypeScript changes** hot-reload without page refresh
- **Material properties** sync live with EditorSync component

[Learn more: Editor Sync ‚Üí](./editor-sync)

---

### NPM Integration

Share code across projects with **NPM Definitions (NpmDef)**:
- Create reusable component packages
- Version control your code
- Share across multiple Unity and web projects

[Learn more: Getting Started Tutorial ‚Üí](./getting-started#option-2-npmdef-advanced)

---

## Learning Resources

### Tutorials (Learning-Oriented)
- **[Getting Started with Unity](./getting-started)** - Your first project step-by-step (~20 min)
- **[For Unity Developers](../tutorials/fundamentals/for-unity-developers)** - Complete learning path for Unity devs
- **[TypeScript Essentials](../tutorials/fundamentals/typescript-essentials)** - JavaScript/TypeScript basics (~20 min)

### How-To Guides (Problem-Oriented)
- **[Export Assets](../how-to-guides/export/)** - Control what gets exported
- **[Create Components](../how-to-guides/scripting/create-components)** - Write interactive components
- **[Deploy Your Project](../how-to-guides/deployment/)** - Publish to the web

### Explanation (Understanding-Oriented)
- **[Unity Integration Concepts](../tutorials/fundamentals/unity-integration)** - How Unity and Needle Engine work together
- **[Features Overview](../explanation/core-concepts/features-overview)** - Platform compatibility and features
- **[Technical Overview](../explanation/architecture/technical-overview)** - Architecture and design

### Reference (Information-Oriented)
- **[Component Reference](../reference/components)** - All built-in components
- **[API Documentation](https://engine.needle.tools/docs/api/)** - Complete TypeScript API
- **[FAQ](../reference/faq)** - Common questions and troubleshooting

---

## Troubleshooting

**Common issues:**

| Issue | Solution |
| --- | --- |
| Server won't start | [Install Node.js](../getting-started/#prerequisites) (18.x or newer) |
| Can't edit code | [Install VSCode](../getting-started/#code-editor-and-tools) |
| Components not showing | Restart Unity or click "Generate C# Components" |
| Hot reload not working | Check console, restart dev server |

[See full troubleshooting guide ‚Üí](../reference/faq)

---

## Community & Support

- **[Discord](https://discord.needle.tools)** - Live community chat and support
- **[Forum](https://forum.needle.tools)** - In-depth discussions and examples
- **[Samples](https://engine.needle.tools/samples/)** - 100+ interactive examples
- **[Showcase](https://samples.needle.tools/#showcase)** - See what others have built
- **[GitHub](https://github.com/needle-tools/needle-engine-support)** - Report issues and contribute

---

## What's Next?

1. **Start building:** Follow the [Getting Started Tutorial](./getting-started)
2. **Learn the workflow:** Read [Unity Integration Concepts](../tutorials/fundamentals/unity-integration)
3. **Master scripting:** Complete [For Unity Developers](../tutorials/fundamentals/for-unity-developers) learning path
4. **Get inspired:** Browse [Samples](https://engine.needle.tools/samples/) and [Showcase](https://samples.needle.tools/#showcase)
Source: https://engine.needle.tools/docs/unity/index.html

# Networking Architecture

**Understanding how multiplayer works in Needle Engine.**

Needle Engine includes a comprehensive networking solution built on WebSockets and modern web technologies. This page explains the concepts and architecture behind Needle's networking system.

## Overview

Networking in Needle Engine is based on [WebSockets](https://github.com/jjxxs/websocket-ts). For most use cases, automatic networking uses JSON data for ease of use. For complex use cases and high-performance requirements, Needle uses [Flatbuffers](https://google.github.io/flatbuffers/) for efficient binary message transfer.

## Core Concepts

### Rooms and State

At the heart of networking in Needle Engine is the concept of **synchronized rooms**. Each room has a unique ID, and users connect to a room by providing this ID. Rooms are stored on a server, and users can join and leave rooms at any time.

**The Room Lifecycle:**

1. **Joining** - When a user joins a room, they receive the current state of the room
2. **Synchronization** - The client applies the current state to their scene
3. **Live Updates** - The client listens for changes to the room state
4. **Leaving** - When a user leaves a room, they stop listening for changes

**State Persistence:**

Room state is stored as JSON data on the server, making all changes persistent. This means:
- Room state survives user disconnects
- Useful not only for multiplayer, but also for single-user persistence
- Users joining later see the same state as everyone else

**View-Only Access:**

Needle can provide _view-only IDs_ for rooms. When accessing a room with a view-only ID, the user:
- Cannot interact with or modify the room state
- Can see the current state and get live updates
- Useful for presentations, demonstrations, or spectator modes

### Ownership

Objects in a room can be _owned_ by a specific user. This ensures that only the owner of an object can change its state.

**Ownership Rules:**

- By default, objects have no owner
- Components like `DragControls` automatically request ownership before modifying objects
- In custom components, you control how ownership is handled:
  - No ownership required
  - Automatic ownership transfer
  - Manual ownership transfer only

**Ownership and Disconnection:**

When a user leaves a room, objects owned by that user will either be:
- Deleted from the room (if marked as temporary)
- Have ownership reset (allowing others to take control)

This behavior depends on how the object was created and whether `deleteOnDisconnect` was specified.

## Message Types

Needle Engine supports two types of messages:

### JSON Messages (Default)

- **Easy to use and debug**
- Human-readable format
- Ideal for most use cases
- Used by automatic networking (`@syncField`)
- Good for up to 15-20 concurrent users

### Binary Messages (Flatbuffers)

- **High performance**
- Compact binary format
- Lower bandwidth usage
- Faster serialization/deserialization
- Ideal for high-frequency updates (transforms, animations)
- Required for larger deployments

## Architecture Components

### Client-Side

**Connection API** - Available via `this.context.connection` in components:
- Send and receive messages
- Join and leave rooms
- Request and manage ownership
- Subscribe to networking events

**Automatic Networking** - High-level API using decorators:
- `@syncField()` - Automatically sync component fields
- `syncInstantiate()` - Create objects across the network
- `syncDestroy()` - Destroy objects across the network

**Manual Networking** - Low-level API for custom control:
- `send()` - Send JSON messages
- `sendBinary()` - Send binary (Flatbuffer) messages
- `beginListen()` / `stopListen()` - Subscribe to message types

### Server-Side

**Default Needle Servers:**
- Managed cloud infrastructure
- No setup required
- Free for typical usage (15-20 concurrent users)
- Handles rooms, state persistence, and message routing

**Custom Servers:**
- Full control over infrastructure
- Self-hosted networking server (Node.js package)
- Supports Fastify, Express, or custom frameworks
- Configurable storage (disk, S3-compatible services)
- Scalable for larger deployments

## Message Persistence

Messages can be:

### Persistent Messages
- Saved in room state
- Include a `guid` field
- Sent to users who join later
- Used for object state, transforms, etc.

### Non-Persistent Messages
- Only sent to users currently in the room
- No `guid` field, or `dontSave: true`
- Used for effects, sounds, temporary notifications
- Not replayed for late-joining users

### Conditional Persistence
- `deleteOnDisconnect: true` - Saved in room state but deleted when the user disconnects
- Useful for player-specific state that shouldn't persist

## WebRTC for Voice and Video

For voice chat and screen sharing, Needle Engine uses [peer.js](https://peerjs.com/) which is built on WebRTC. This provides:
- Direct peer-to-peer audio/video connections
- Lower latency than server-relayed streams
- Built-in NAT traversal with ICE/STUN/TURN servers
- Configurable server infrastructure

## Next Steps

**Want to get started?**
- [Enable Networking](/docs/how-to-guides/networking/setup) - Add multiplayer to your project
- [Sync Component State](/docs/how-to-guides/networking/sync-state) - Automatic networking with `@syncField`

**Want to dive deeper?**
- [Manual Networking](/docs/how-to-guides/networking/manual-networking) - Low-level message API
- [Custom Servers](/docs/how-to-guides/networking/custom-servers) - Host your own networking infrastructure

**Looking for reference?**
- [Networking Events API](/docs/reference/api/networking-events) - Complete event reference
- [Built-in Networking Components](/docs/reference/components#networking) - Component catalog
Source: https://engine.needle.tools/docs/explanation/networking/architecture.html

---
title: Automatic Component Generation
tags:
  - codegen
  - components
  - unity
  - blender
  - editor
  - typescript
  - csharp
---

## Automatically generating Editor components

When working in Unity or Blender then you will notice that when you create a new Needle Engine component in Typescript or Javascript it will automatically generate a Unity C# stub component OR a Blender panel for you.  

This is thanks to the magic of the [Needle component compiler](https://www.npmjs.com/package/@needle-tools/needle-component-compiler) that runs behind the scenes in an editor environment and watches changes to your script files. When it notices that you created a new Needle Engine component, it will then generate a stub Unity component or Blender panel. This component includes public variables, properties and methods, that you can then set from within the Editor. You can also wire up events to methods in your components.

**Note**: The component compiler currently **only generates components**. You can reference custom classes and types (like ScriptableObjects or enums), but you need to make sure that the class exists in both C# and TypeScript with a matching name.

## Component Compiler in Unity
If you want to add scripts inside the ``src/scripts`` folder in your project then you need to have a ``Component Generator`` on the GameObject with your ``Needle Engine`` component.
Now when adding new components in ``your/threejs/project/src/scripts``it will automatically generate Unity scripts in `Assets/Needle/Components.codegen`.
If you want to add scripts to any NpmDef file you can just create them - each NpmDef automatically watches script changes and handles component generation, so you don't need any additional component in your scene.

For C# fields to be correctly generated, it is important that you declare a Typescript type. The types can either be basic types like `number`, `string`, `boolean`, or custom classes. Custom classes need to be available in the Unity project as well.

Here is an example. The TypeScript file is what has been placed in `src/scripts/MyCustomComponent.ts`. The component compiler automatically generates the C# stub component.

::: code-tabs
@tab Typescript
```ts twoslash
import { AssetReference, Behaviour, serializable } from "@needle-tools/engine";
import { Object3D } from "three";

export class MyCustomComponent extends Behaviour {
    @serializable()
    myFloatValue: number = 42;

    @serializable(Object3D)
    myOtherObject?: Object3D;

    @serializable(AssetReference)
    prefabs: AssetReference[] = [];

    start() {
        this.sayHello();
    }

    private sayHello() {
        console.log("Hello World", this);
    }
}
```
@tab Generated CSharp
```csharp
// NEEDLE_CODEGEN_START
// auto generated code - do not edit directly

#pragma warning disable

namespace Needle.Typescript.GeneratedComponents
{
	public partial class MyCustomComponent : UnityEngine.MonoBehaviour
	{
		public float @myFloatValue = 42f;
		public UnityEngine.Transform @myOtherObject;
		public UnityEngine.Transform[] @prefabs = new UnityEngine.Transform[]{ };
		public void start(){}
		public void update(){}
	}
}

// NEEDLE_CODEGEN_END
```
@tab Extending the generated component
```csharp
using UnityEditor;

// you can add code above or below the NEEDLE_CODEGEN_ blocks

// NEEDLE_CODEGEN_START
// auto generated code - do not edit directly

#pragma warning disable

namespace Needle.Typescript.GeneratedComponents
{
	public partial class MyCustomComponent : UnityEngine.MonoBehaviour
	{
		public float @myFloatValue = 42f;
		public UnityEngine.Transform @myOtherObject;
		public UnityEngine.Transform[] @prefabs = new UnityEngine.Transform[]{ };
		public void start(){}
		public void update(){}
	}
}

// NEEDLE_CODEGEN_END

namespace Needle.Typescript.GeneratedComponents
{
    // Extend the generated component (namespace and class name must match!)
	public partial class MyCustomComponent : UnityEngine.MonoBehaviour
	{
		public void MyAdditionalMethod() { /* ... */ }
		private void OnValidate() { myFloatValue = 42; }
	}

    // Of course you can also add custom editors
	[CustomEditor(typeof(MyCustomComponent))]
	public class MyCustomComponentEditor : Editor
	{
		public override void OnInspectorGUI()
		{
			EditorGUILayout.HelpBox("This is my sample component", MessageType.None);
			DrawDefaultInspector();
		}
	}
}
```
:::

## Extending generated components
The generated C# classes for components are generated with the [`partial`](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/partial-classes-and-methods) flag so that it is easy to extend them with functionality. This is helpful to draw gizmos, add context menus or add additional fields or methods that are not part of a built-in component.

See the code tabs above for an example of how to extend the generated component. You can add custom methods, properties, or even custom editors for your component. Just make sure to add code outside the `// NEEDLE_CODEGEN_` blocks so that it does not get overwritten by the component compiler.

:::tip Member Casing
Exported members will start with a lowercase letter. For example if your C# member is named ``MyString`` it will be assigned to ``myString``.
:::

## Controlling component generation
You can use the following comments in your typescript code to control C# code generation behavior:  
| Attribute | Result |
| -- | -- |
| `// @generate-component` | Force generation of next class|
| `// @dont-generate-component` | Disable generation of next class, this is useful in cases where you already have an existing C# script in your project |
| `// @serializeField` | Decorate generated field with `[SerializeField]` |
| `// @type UnityEngine.Camera` | Specify generated C# field type |
| `// @nonSerialized` | Skip generating the next field or method |

### Examples

Force the component compiler to generate a C# AudioClip field named `myAudioClip`
```ts twoslash
import { Behaviour, serializable } from "@needle-tools/engine";

export class MyComponent extends Behaviour {
	//@type UnityEngine.AudioClip
	@serializable()
	myAudioClip?: string;
}

```

Force the component compiler to derive from a specific subclass
```ts twoslash
import { Behaviour } from "@needle-tools/engine";
export class MyCustomBaseClass extends Behaviour { /* ... */ }
// ---cut-before---
//@type MyNamespace.MyCustomBaseClass
export class MyComponent extends MyCustomBaseClass {
}
```
Source: https://engine.needle.tools/docs/explanation/core-concepts/component-compiler.html

---
description: Complete feature overview of Needle Engine - graphics, animation, physics, networking, XR, UI, and more cross-platform capabilities.
---

# Feature Overview

**Needle Engine is a fully-fledged 3D engine for the web** with everything you'd expect from a modern 3D engine, and more. Build stunning web experiences that work everywhere ‚Äì from browsers to VR headsets to mobile AR.

:::tip See It In Action
Explore our [Samples and Showcase](https://engine.needle.tools/samples) to experience what's possible.
:::

[[toc]]

## Cross-Platform: Desktop, Mobile, VR, and AR

**One codebase, every platform.** Needle Engine runs everywhere web technology does ‚Äì desktop, mobile, AR, and VR. We build Needle Engine [with XR in mind](/docs/how-to-guides/xr/) as an integral part of responsive web design.

### Native iOS WebXR Support

**Full WebXR on iPhone and iPad** ‚Äì no app required! üéâ

Native [iOS WebXR support](/docs/explanation/core-concepts/ios-webxr-app-clip) is now available through App Clip technology. Users can experience your WebXR AR content instantly via QR codes or links, without installing an app. Powered by ARKit, it provides:

- Hit testing and plane detection
- DOM overlays for UI elements
- Image tracking
- Anchor creation and tracking (work in progress)
- Lighting estimation (work in progress)

[Try it now](https://appclip.needle.tools) ‚Ä¢ [Read iOS WebXR docs](/docs/explanation/core-concepts/ios-webxr-app-clip)

### Everywhere Actions for iOS and Android

Use [Everywhere Actions](/docs/how-to-guides/everywhere-actions/) for **interactive AR experiences** on both iOS and Android using USDZ and QuickLook. Perfect for product configurators, marketing experiences, and interactive storytelling.

**Platform Support:**
- **VR Headsets**: Meta Quest, Apple Vision Pro, Pico, HTC Vive, Valve Index
- **Mobile AR**: Android (WebXR), iOS (WebXR via App Clips + USDZ/QuickLook)
- **Desktop**: All modern browsers
- **Future devices work automatically** ‚Äì that's the power of web standards

[Learn more about XR support](/docs/how-to-guides/xr/)

## Graphics and Rendering

### Shaders and Materials

**Professional-grade rendering on the web.** Export both [PBR Materials](/docs/how-to-guides/export/#physically-based-materials-pbr) and [Custom shaders](/docs/how-to-guides/export/#custom-shaders) created with Shader Graph or other systems.

<img src="https://user-images.githubusercontent.com/5083203/186012027-9bbe3944-fa56-41fa-bfbb-c989fa87aebb.png" alt="Shader Graph Example" />

Use Unity's node-based ShaderGraph to create shaders for the web. Artists can keep creating without worrying about syntax or web-specific code.

Read more: [PBR Materials](/docs/how-to-guides/export/#physically-based-materials-pbr) ‚Ä¢ [Custom Shaders](/docs/how-to-guides/export/#custom-shaders)

### Lightmaps

**Beautiful baked lighting, automatically exported to the web.**

![lightmaps](https://user-images.githubusercontent.com/5083203/186163693-093c7ae2-96eb-4d75-b98f-bf19f78032ff.gif)

Lightmaps can be baked in Unity or Blender and automatically exported to your web experience. Just mark objects as static, add lights (or use emissive materials), click bake, and Needle Engine handles the rest. What you see in the editor is what you get on the web.

**Flexible Setup:**
- Works with Unity's built-in lightmapper
- Compatible with third-party lightmappers like [Bakery](https://assetstore.unity.com/packages/tools/level-design/bakery-gpu-lightmapper-122218)
- Per-scene lightmaps automatically loaded

[Read more about exporting Lightmaps](/docs/how-to-guides/export/#exporting-lightmaps)

### Post-Processing Effects

**Industry-standard post-processing for the web.**

Built-in effects include Bloom, Screen Space Ambient Occlusion (SSAO), Depth of Field, and Color Correction. You can also create custom effects tailored to your project.

<sample src="https://engine.needle.tools/samples-uploads/postprocessing/" />

[See all post-processing components](/docs/reference/components#postprocessing)

## Animation and Sequencing

**Powerful animation tools that translate directly to the web.** From simple animations to complex state machines and cinematic sequences ‚Äì Needle Engine brings professional animation workflows to web experiences.

### Animator State Machines

<img src="https://user-images.githubusercontent.com/5083203/186011302-176524b3-e8e5-4e6e-9b77-7faf3561bb15.png" alt="Unity Animator" />

Unity's [Animator and AnimatorController](https://docs.unity3d.com/Manual/class-AnimatorController.html) let you set up animations and define conditions for blending between them. Needle Engine exports:

- Animation state machines
- StateMachineBehaviours with `OnStateEnter`, `OnStateUpdate`, and `OnStateExit` events
- Transitions and layers
- Parameter-driven state changes

::: tip Limited support for sub-states and blend trees
Sub-states and Blend Trees are not yet supported.
:::

### Timeline Sequencing

![Timeline Example](https://user-images.githubusercontent.com/5083203/186037829-ee99340d-b19c-484d-b551-94797519c9d9.png)

Create cinematic sequences with [Unity's Timeline](https://unity.com/features/timeline). Needle Engine translates Timeline setups into web-ready format.

**Supported Tracks:**
- AnimationTrack
- AudioTrack
- ActivationTrack
- ControlTrack
- SignalTrack

::: tip Limited support for sub-timelines
 Sub-Timelines are not yet supported. Custom timeline tracks can be exported ‚Äì [see example](https://github.com/needle-tools/needle-engine-modules/tree/main/package/TimelineHtml).

### Blender Support

Animation support extends to Blender too! Create animation state machines and export NLA tracks as timelines directly from Blender.

[Read more about Animation Components](/docs/reference/components#animation)

## Physics

**Real-time physics simulation in the browser.**

Add realistic physics interactions using familiar components:
- Rigidbodies for dynamic objects
- Colliders: Box, Sphere, and Mesh
- Physics materials for friction and bounce
- Raycasting and collision detection

<sample src="https://engine.needle.tools/samples-uploads/physics-animation/" />

[Read more about Physics Components](/docs/reference/components#physics)

## Particle Systems

**Create stunning visual effects with Unity's Shuriken particle system.**

Export Unity ParticleSystems to the web with support for:
- World/local space simulation
- Box and sphere emitter shapes
- Emission over time and burst emission
- Velocity and color over lifetime
- Emission influenced by velocity
- Texture sheet animation
- Basic trails

<sample src="https://engine.needle.tools/samples-uploads/particles/" />

[Try live particle samples](https://engine.needle.tools/samples/particles)

## User Interface

**Build interactive UIs using Unity's Canvas system.**

Export Unity UI components including:
- Text (with custom fonts)
- Images and sprites
- Buttons with events
- Layout groups
- World-space and screen-space canvases

<sample src="https://engine.needle.tools/samples-uploads/screenspace-ui" />

[See supported UI components](/docs/reference/components#ui)

## Multiplayer and Networking

**Real-time multiplayer, built-in.**

Networking is integrated into the core runtime. Deploy multiplayer 3D environments in seconds with built-in networked components. Synchronizing variables and state is incredibly simple.

**Features:**
- Built-in networking components
- Easy variable synchronization
- Voice chat support (VoIP)
- Works seamlessly with XR
- Quick deployment to Glitch with included server

[Read more about Networking](/docs/how-to-guides/networking/) ‚Ä¢ [Scripting Guide](/docs/how-to-guides/scripting/)

## Editor Integrations

**Visual authoring meets web deployment.**

Powerful integrations for Unity and Blender allow artists and developers to collaborate seamlessly. Set up and export complex scenes visually, with flexible workflows for both technical and creative team members.

**Unity Integration:**
- Full component support
- Visual scene authoring
- Asset pipeline integration
- Hot reload during development

**Blender Addon:**
- Export glTF with Needle Engine components
- Animation support (NLA tracks, state machines)
- Material and lighting export
- Node-based workflow

## Scripting and Development

**Flexible, powerful, and developer-friendly.**

Needle Engine uses a [component-based architecture](/docs/how-to-guides/scripting/create-components#component-architecture) familiar to Unity developers. Create custom components in TypeScript or JavaScript.

**Developer Features:**
- Component-based workflow (like Unity)
- TypeScript and JavaScript support
- [Modular npm-based packages](/docs/reference/npm-definition-files)
- [TypeScript to C# component compiler](/docs/reference/component-compiler) ‚Äì write TypeScript, get Unity components automatically
- Hot module replacement for fast iteration
- Full three.js access for advanced use cases

[Read more: Scripting Reference](/docs/how-to-guides/scripting/create-components) ‚Ä¢ [Npm Definition Files](/docs/reference/npm-definition-files)

## Additional Features

**Even more capabilities to power your projects:**

- **EditorSync** ‚Äì Live synchronize editing in Unity to your running web application for instant feedback during development
- **Compression Pipeline** ‚Äì Automatic optimization for web delivery with glTF compression and texture optimization
- **Audio Support** ‚Äì Spatial audio, audio sources, and audio listeners
- **Image Tracking** ‚Äì WebXR image tracking on Android, QuickLook image tracking on iOS
- **Custom Components** ‚Äì Extend the engine with your own components and systems
- **Framework Integration** ‚Äì Works with React, Vue, Svelte, and other web frameworks
- **Deployment Tools** ‚Äì Built-in deployment to Glitch, Vercel, and other platforms

---

## Where to Go Next

**Get Started:**
- [Getting Started Guide](/docs/getting-started/) ‚Äì Download and set up Needle Engine
- [Unity Integration](/docs/unity/) ‚Äì Set up the Unity integration
- [Blender Addon](/docs/blender/) ‚Äì Install the Blender addon

**Learn More:**
- [Our Vision](./vision) ‚Äì Learn about our goals and philosophy
- [Technical Overview](../architecture/technical-overview) ‚Äì Deep dive into glTF and architecture
- [XR Documentation](/docs/how-to-guides/xr/) ‚Äì Build immersive AR and VR experiences
- [Browse Samples](https://engine.needle.tools/samples) ‚Äì See what's possible

**Start Building:**
- [Scripting Guide](/docs/how-to-guides/scripting/create-components) ‚Äì Create custom components
- [Component Reference](/docs/reference/components) ‚Äì Browse all available components
- [Deployment Guide](/docs/how-to-guides/deployment/) ‚Äì Publish your experiences

---

Have questions? Join our [Discord community](https://discord.needle.tools) or check out our [support resources](/docs/help/).
Source: https://engine.needle.tools/docs/explanation/core-concepts/features-overview.html

---
title: Structure of a Needle Engine project
description: Understanding Needle Engine project structure - how editor projects work with web projects, file organization, and build workflows.
---

# Structure of a Needle Engine project

Needle Engine integrates deeply with 3D softwares like Unity and Blender, and at the same time has the full flexibility of modern web development. For this reason, a project made with Needle usually consists of **two parts**: an **Editor Project** and a **Web Project**. We'll often refer to the Editor Project as "Unity Project" or "Blender Project", depending on which editor you use.

```mermaid
flowchart TD
    A[**Editor Project**<br>Unity or Blender,<br>with Needle Integration] -->|exports 3D content to| B[**Web Project**<br>with Needle Engine,<br>HTML, CSS, JS]
    B -->|runs in| C[**Web Browser**]
```

## Editor project and web project

The **Editor Project** is where you create your 3D scenes, add components to objects, add materials and lights, set up the environment, animate and so on. You can use all the powerful tools of your 3D software to create the content that will be exported to the web. If you're working with Unity or Blender, you'll want to install the [Needle Engine for Unity](/docs/unity/) package or the [Needle Engine for Blender](/docs/blender/) add-on.

The **Web Project** is where your web app comes together. It contains the exported 3D assets, the scripts that control the behavior of your app, and the HTML and CSS that define the look and feel. The web project is powered by Needle Engine, which is responsible for loading and displaying your 3D content, managing script components and their lifecycle, and utilizing the web platform's capabilities like WebXR, audio, networking, and more.

## Creating a web project

By default, the web project is **created and managed by Needle**, which means that you don't have to worry about how to set up the package, add dependencies, or building ‚Äì you can focus on creating your content. The integrations for Unity and Blender make it easy to create a web project right from your editor.

:::: tabs
@tab Unity

Find the Needle Engine component in your scene or add it, then click on <kbd>Generate Project</kbd>. This will create a new web project in the folder you specify.

![Creating a web project from Unity](/imgs/unity-generate-project.jpg)

@tab Blender

Find the Scene panel and Needle Engine section, then click on <kbd>Generate Web Project</kbd>. This will create a new web project in the folder you specify.

![Creating a web project from Blender](/imgs/blender-generate-project.jpeg)

@tab From the command line

Open a terminal and run the command `npx create needle` to create a new Needle Engine web project. The command will prompt you for the project name, framework, and other settings. You can also specify the folder where the project should be created.

:::tip Install Node.js first
Make sure you have [Node.js](https://nodejs.org/) installed on your system.
You can check if you have it installed by running `node -v` in your terminal.
If you don't have it installed, download and install it from the [Node.js website](https://nodejs.org/).
:::

```bash
% npm create needle

> create-needle

create-needle version 0.1.1-alpha

‚îå  Welcome to Needle Engine! üåµ
‚îÇ
‚óá  Where should we create your project?
‚îÇ  my-project
‚îÇ
‚óá  What framework do you want to use?
‚îÇ  HTML, CSS, JavaScript with Vite
‚îÇ
‚îî  Your project is ready!

Next steps:
  1: cd my-project
  2: npm install (or npm i)
  3: npm start (or npm run dev)
  4: Connect an integration (Unity, Blender, ...)
```

::::

::: tip Bring your own project
Needle Engine is very flexible. You can modify the existing web project or use your own. That allows you to integrate into existing projects, use a different build system, or use a different framework like React, Vue, or Angular.
::: 

## Opening the web project in a code editor

We recommend [Visual Studio Code](https://code.visualstudio.com/) as code editor, because it has great support for web development in general, and TypeScript in particular. When you generate a web project, we automatically create a `.code-workspace` file that you can open in Visual Studio Code. This file contains the configuration for the workspace, including the folders to include and the settings for the editor.

::: tabs
@tab Unity

Click on <kbd>Open Code Editor</kbd> on the **Needle Engine** component. This will open the web project in Visual Studio Code, with all the folders and files included.

![Opening the Code Editor from Unity](/imgs/unity-open-code-editor.jpeg)

@tab Blender

Click on <kbd>Open Code Editor</kbd> on the **Scene > Needle Engine** panel. This will open the web project in Visual Studio Code, with all the folders and files included.

![Opening the Code Editor from Blender](/imgs/blender-open-code-editor.jpeg)

@tab Find it in Explorer or Finder

Double-click the `.code-workspace` file. This will open the web project in Visual Studio Code, with all the folders and files included. You can of course also open the web project folder in other code editors if you prefer.

![Opening the Code Editor from Finder](/imgs/finder-open-code-editor.jpeg)

:::

## Understanding files and folders in the web project

The default web project is based on a standard structure that follows modern web development practices. It uses the excellent [Vite](https://vitejs.dev/) as development environment, bundler, and build tool. The following sections describe the structure of a typical Needle Engine web project. 

:::tip The places you'll most commonly interact with are `src/scripts/` and `build/`.
Add your own components to `src/scripts/`. You write them in TypeScript.

When building your web project, either by clicking "Build" in the editor or running `npm run build`, the final files are placed in the `dist/` folder. This is the folder you can upload to a web server to host your web app.
:::

:::: file-tree name="Web Project File"

::: file index.html
The start page of your web project. You can add additional HTML, stylesheets or script imports here. Custom Needle components should be put into the `src/scripts/` folder.  
<br>
You also find the `<needle-engine>` web component here, which displays your 3D content. You can modify its attributes to change the environment, loading style, contact shadows, and more. See the [Web Component Attributes Reference](/docs/reference/needle-engine-attributes) for a list of available attributes.

:::

::: file assets/
The asset folder contains 3D and other files exported by the integration. This includes  `.glb` files, audio or video files. The folder is managed by the integration, so if you want to add additional assets, put them into `include/`instead.
:::

::: file assets/MyScene.glb
The exported 3D scene from Unity or Blender is automatically placed here. The filename depends on how your Unity or Blender scene is named. There may be more files in this folder, depending on how your project is set up. For example, if you have multiple scenes, or use audio or video files, they will be here as well.
:::

::: file src/
The source code of your web project. This is where you write your scripts, styles, and other code that makes up your web app. Needle places some generated files here, and you can add your own code as well.
:::

::: file src/main.ts
This script is included from `index.html` and runs at startup. It imports `@needle-tools/engine` and loads the main engine code. You can add plugins for Needle Engine here.
:::

::: file src/scripts/
Add your custom scripts in this folder. Our [component compiler](/docs/explanation/core-concepts/component-compiler) will automatically generate stub components for Unity and Blender from them.
:::

::: file src/scripts/MyComponent.ts
An example of a custom script that will be compiled into a Unity C# component or Blender panel. You can add your own scripts here, and they will be automatically picked up by the component compiler.
:::

::: file src/styles/
The styles folder contains the stylesheets for your web project. You can add additional stylesheets here and import them in `index.html`.
:::

::: file src/styles/main.css
The default stylesheet for your web project. Add your own styles here, or create additional stylesheets in the `src/styles/` folder. You can import them in `index.html`.
:::

::: file src/generated/
The files in this folder are **generated and managed** by the Needle integration. Do not edit them manually ‚Äì they will be overwritten on export.
:::

::: file src/generated/gen.js
**This file is generated**. It tells the `<needle-engine>` web component which file to load initially.
:::

::: file src/generated/meta.json
**This file is generated**. It contains metadata about the project, such as the name of the main scene, the version of Needle Engine used, and other information.
:::

::: file src/generated/register_types.ts
**This file is generated**. It automatically imports custom components that your project uses, both from your code and from dependency packages.
:::

::: file include/
If you have custom assets that you want to load at runtime, add them to the include folder. On build this folder will be copied to the output folder.
:::

::: file dist/
The output folder where the built web project is placed. This is where the final web app is generated. It contains the bundled and minified files that are ready to be published to a server.
:::

::: file needle.config.json
The [Needle config](/docs/reference/needle-config-json). Needle integrations and build tools use this file. It contains information on where to export assets to, and where the build folder is.
:::

::: file vite.config.js
The [vite config](https://vitejs.dev/config/). Settings for building the distribution and hosting the development server are made here. Usually, you don't need to change this file, but you can add additional plugins or modify the build process if needed.
:::

::: file package.json
Project configuration containing name, version, dependencies and development scripts. You can add additional npm packages as dependencies here.
:::

::: file tsconfig.json
This is the Typescript compiler configuration. It tells TypeScript that we're using modern scripting features.
:::

::: file .gitignore
This file specifies which files and folders should be ignored by the git version control system. The default web project excludes the `/dist`, `node_modules`, and `.vite` folders. If you're using some other version control system than git, you should exclude these folders.
::: 

::::

Our exporter can be used with other project structures as well. We chose Vite as bundler because of its speed and flexibility. Feel free to set up your own project structure, or use a different bundler like Webpack. Needle Engine is designed to be flexible and can usually be adapted to your needs. [Learn more about bundling and other frameworks](/docs/how-to-guides/web-integration/).

## Extending the web project

The web project uses an industry-standard structure:

- [Node.js](https://nodejs.org/) and npm for package management and build scripts
- [TypeScript](https://www.typescriptlang.org/) for scripting
- [Vite](https://vitejs.dev/) for running the development server and building the production version
- [HTML](https://developer.mozilla.org/en-US/docs/Web/HTML) and [CSS](https://developer.mozilla.org/en-US/docs/Web/CSS) for the web app's structure and style

You can extend the web project by adding your own scripts, styles, and assets. You can add additional npm packages to the project as needed, and you can customize the build process by modifying the `vite.config.js` file. For some customizations, like adding PWA support to your app, Needle already provides helpers to make them easier. Generally, you can freely modify the web project as you see fit, which sets Needle Engine apart from other engines that require you to use their specific project structure.

:::tip Copying additional files to the output folder
You can add additional files to your project that you want to be copied to the output folder when building. Either put them into the `include/` folder, or [configure copying](/docs/reference/needle-config-json) them in the `needle.config.json` file.
:::

## Adding HTML interfaces to your web project

Your Needle Engine project is not limited to 3D content. You can create 2D user interfaces using HTML and CSS, and wire it up with your 3D scenes. This allows you to create rich, interactive web applications that combine 3D and 2D elements.

If your HTML and CSS gets more complex, you may want to use a **frontend framework** like Svelte, React, or Vue. Needle Engine is designed to work well with these frameworks, and we provide examples and documentation on how to integrate them. See our [Frontend Framework Samples](https://engine.needle.tools/samples/#combine-2d-and-3d-with-any-framework) for more information.

Here are some resources to get you started with 2D UIs in Needle Engine:
- [Using HTML and CSS in Needle Engine](/docs/how-to-guides/web-integration/)
- [SvelteKit Sample](https://engine.needle.tools/samples/svelte-integration/)
- [React Sample](https://engine.needle.tools/samples/react-sample/)
- [Vue Sample](https://engine.needle.tools/samples/vue.js-integration)

Needle Engine provides a configuration file (`needle.config.json`) that allows you to customize the build process, add additional assets, and configure how the web project is built.

## Using an Editor without integration

The Unity and Blender integrations are not required to use Needle Engine. In other words, the web project does not depend on the editor project ‚Äì it only uses the exported 3D assets. If you prefer to use a different editor or create your 3D assets manually, you can do so. Export your 3D assets in glTF or GLB format, and add them to your web project.

## Using the integration with an existing web project

If you already have a web project that you want to integrate with Needle Engine, you can do so by following these steps:

1. Install the Needle Engine package for Unity or Blender.
2. Set up your scene
3. Tell the integration where your web project is located.
4. Configure where in your web project the exported files should be placed. This is done in the `needle.config.json` file.
4. Load the exported assets in your web project using Needle Engine's API.

#### Continue Reading

- [Typescript Guide for Unity Developers](/docs/tutorials/fundamentals/for-unity-developers)
- [Typescript Essentials](/docs/tutorials/fundamentals/typescript-essentials)
- [Writing custom scripts](/docs/how-to-guides/scripting/create-components)
- [Everywhere Actions](/docs/how-to-guides/everywhere-actions/)
Source: https://engine.needle.tools/docs/explanation/core-concepts/project-structure.html

---
description: Our vision for the 3D web - bridging artist-friendly workflows with modern web technologies using open standards like glTF and WebXR.
next: features-overview
---

# Our Vision üîÆ

## The Future of the 3D Web

We believe the use of 3D on the web will expand considerably in the next years. While today native apps are the norm, more and more content is made available as a web app or [PWA](https://web.dev/progressive-web-apps/).  New VR and AR devices will [extend into the web](https://immersive-web.github.io/webxr-samples/), creating an interesting problem: responsive suddenly not only means  "small screen" or "large screen", you're also dealing with spaces, 3D, spatial placement and potentially glasses and controllers!  

Add to that a push towards more interactivity and collaboration, and you have an interesting mix of challenges.  

At Needle, we believe ideating and creating in this space should be easy. We've set out to speed things up ‚Äì creating our own runtime to reach these goals. That's why we're baking the ability to deploy to AR and VR right into our core components, and continually test that new ideas work across platforms. 

## Why another platform for 3D on the web? Aren't there enough options already?

There's numerous options, that's true! We found that current systems<sup>1</sup> can be roughly sorted into two categories: some have great asset handling, tools, and artist-friendly workflows but output some sort of binary blob, and others are more code-focussed, developer-friendly and allow for great integration into modern web workflows<sup>2</sup>.  

We want to bridge these worlds and combine the best of both worlds: artist-friendly workflows and modern web technologies. Combined with modern formats and a snappy workflow, we believe this will allow many more creators to bring their content to the web. We also saw an opportunity to get AR, VR and collaboration right from the start.  
  
<sup>1</sup>: _Examples include Unity, PlayCanvas, three.js, react-three-fiber, Babylon, A-Frame, Godot, and many more._
<sup>2</sup>: _There's more nuance to this than fits into an introductory paragraph! All engines and frameworks have their strengths and weaknesses, and are constantly evolving._
  
## Creating a Workflow, not an Editor
  
We think the next wave of 3D apps on the web will come with better _workflows_: everyone should be able to put together a 3D scene, an art gallery, present a product or 3D scan on the web or make simple games. Reaching this goal will require more than just supporting one particular system and exporting to the web from there.
  
Our goal is to allow people to bring data to the web from _their_ creative tools: be it Unity, Blender, Photoshop, or something else. We're aware that this is a big goal ‚Äì but instead of doing everything at once, we want to iterate and get closer to it together.  
  
## Open Standards instead of Proprietary Containers

At the core of Needle Engine stands the [glTF](https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html) format and its ability to be extended with custom extensions. The goal is: a single `.glb` file can contain your entire application's data. 
  
It's worth noting that it's not a goal to ship actual code inside glTF; shipping and running code is the job of modern web runtimes and bundling. We certainly can imagine that abstract representations of logic (e.g. graphs, state machines, and so on) can be standardized to a certain degree and allow for interoperable worlds, but we're not there yet.  
  
[Read more about our use of glTF and extensions](/explanation/architecture/technical-overview)

# Goals and Non-Goals

## Goals
- Iteration should be rapid and deployment should be fast. 
- Working on 3D web projects should be the as easy as working 2D web projects.   
- Developers and artists should be able to collaborate directly.   
- Responsive web extends beyond screens ‚Äì AR and VR should be built in, not afterthoughts.   
- We want to contribute back to open-source projects. 
- Open discussion regarding 3D and web standards. 
- Ability to bring and take your data in open formats. 
- Ability to choose what web framework you use, not lock-in to particular frameworks and vendors. 
- Common usecases work without or with limited coding experience.  

## Non-Goals
- It's not a goal to have 100% coverage of all combinations of Editor versions, feature sets, render pipelines.  
- It's not a goal to provide a full no-code environment.  
- It's not a goal to match the feature set, capabilities, or runtime performance of other engines.  
  
# Relation to other engines and frameworks  

## Needle Engine and Unity WebGL

From working with Unity for many years we've found that while the engine and editor progress at a great pace, WebGL output has somewhat lacked behind. Integration of Unity players into web-based systems is rather hard, "talking" to the surrounding website requires a number of workarounds, and most of all, iteration times are very slow due to the way that Unity packs all code into WebAssembly via IL2CPP. These technologies are awesome, and result in great runtime performance and a lot of flexibility. But they're so much slower and walled off compared to modern web development workflows that we decided to take matters into our own hands.  

## Needle Engine and three.js

Needle Engine builds on three.js. All rendering goes through it, glTF files are loaded via three's extension interfaces, and our component system revolves around three's Object3D and scene graph. We're committed to upstreaming some of our changes and improvements, creating pull requests and reporting issues along the way.
Source: https://engine.needle.tools/docs/explanation/core-concepts/vision.html

---
description: Deep dive into Needle Engine architecture - glTF extensions, component system, three.js rendering, and how editor projects export to the web.
---

# Technical Overview

## How it works

Needle Engine roughly consists of three parts:
- a number of **components and tools** that allow you to set up scenes for Needle Engine from e.g. the Unity Editor.  
- an **exporter** that turns scene and component data into glTF.
- a **web runtime** that loads and runs the produced glTF files and their extensions.

The web runtime uses three.js for rendering, adds a component system on top of the three scene graph and hooks up extension loaders for our custom glTF extensions.  

Effectively, this turns tools like Unity or Blender into spatial web development powerhouses ‚Äì adding glTF assets to the typical HTML, CSS, JavaScript and bundling workflow.  

## glTF Assets

Models, textures, animations, lights, cameras and more are stored as [glTF 2.0 files](https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html) in Needle Engine.  
Custom data is stored in [vendor extensions](#vendor-specific-gltf-extensions-needle_). These cover everything from interactive components to physics, sequencing and lightmaps.  

### Supported glTF extensions

A typical production glTF created by Needle Engine uses the following extensions:  
```
KHR_lights_punctual
KHR_materials_unlit
KHR_texture_transform
KHR_animation_pointer
NEEDLE_techniques_webgl
NEEDLE_gameobject_data
NEEDLE_components
NEEDLE_persistent_assets
NEEDLE_lightmaps
NEEDLE_lighting_settings
KHR_texture_basisu
KHR_draco_mesh_compression
```

Other supported extensions:
```
EXT_meshopt_compression
EXT_mesh_gpu_instancing (import and export)
```

Supported material extensions:  

```
KHR_materials_clearcoat
KHR_materials_ior
KHR_materials_specular
KHR_materials_transmission
KHR_materials_iridescence
KHR_materials_unlit
KHR_materials_volume
```

More extensions and custom extensions can be added using the export callbacks of UnityGLTF (not documented yet) and the [glTF import extensions](https://threejs.org/docs/#examples/en/loaders/GLTFLoader) of three.js.  

::: tip Built-in export support for glTF PBR materials
Materials using these extensions can be exported from Unity via UnityGLTF's `PBRGraph` material.  
::: 

::: tip Built-in support for Audio, Variants and more
Audio and variants are already supported in Needle Engine through `NEEDLE_components` and `NEEDLE_persistent_assets`, but there are some options for more alignment to existing proposals such as `KHR_audio` and `KHR_materials_variants`.
:::

[Learn more about GLTF loading in three.js](https://threejs.org/docs/#examples/en/loaders/GLTFLoader)

## Vendor-specific glTF Extensions (NEEDLE_*)

Needle Engine stores custom data in glTF files through our vendor extensions. These extensions are designed to be flexible and allow relatively arbitrary data to put into them. Notably, no code is stored in these files. Interactive components is restored from the data at runtime. This has some similarities to how AssetBundles function in Unity ‚Äì the receiving side of an asset needs to have matching code for components stored in the file.  

::: tip Extension Design and Future Changes
We're currently not prodiving schemas for these extensions as they are still undergoing changes. The JSON snippets below demonstrates extension usage by example and includes notes on architectural choices and what we may change in future releases.  

References between pieces of data are currently constructed through a mix of indices into other parts of the glTF file and JSON pointers. We may consolidate these approaches in a future release. We're also storing string-based GUIDs for cases where ordering is otherwise hard to resolve (e.g. two components referencing each other).  
:::

### NEEDLE_components

This extension contains per-node component data. The component names map to type names on both the JavaScript and C# side.  
Multiple components with the same name can be added to the same node.  

Data in `NEEDLE_components` can be animated via the currently not ratified [`KHR_animation_pointer`](https://github.com/ux3d/glTF/tree/extensions/KHR_animation_pointer/extensions/2.0/Khronos/KHR_animation_pointer) extension.  

```json
"NEEDLE_components": {
  "builtin_components": [
    {
      "name": "WebARSessionRoot",
      "guid": "1516450550",
      "arScale": 50,
      "invertForward": true,
      "enabled": true,
      "gameObject": {
        "node": 0
      }
    },
    {
      "name": "SyncedRoom",
      "guid": "1516450552",
      "roomName": "network-room",
      "urlParameterName": "room",
      "joinRandomRoom": true,
      "requireRoomParameter": false,
      "autoRejoin": true,
      "enabled": true,
      "gameObject": {
        "node": 0
      }
    },
    {
      "name": "PlayableDirector",
      "guid": "2243275882009986562_1668529989451832962",
      "state": 0,
      "extrapolationMode": 1,
      "playableAsset": "extensions/NEEDLE_persistent_assets/4",
      "playableGraph": {},
      "playOnAwake": true,
      "timeUpdateMode": 0,
      "time": 0,
      "initialTime": 0,
      "duration": 135.383333333332,
      "enabled": true,
      "gameObject": {
        "node": 0
      }
    }
  ]
}
```

::: tip Component Type Names and Versioning
Storing only the component type name means that type names currently need to be unique per project.

Currently there's no versioning information in the extension (which npm packaage does a component belong to, which version of that package was it exported against).  

All components are in the `builtin_components` array. We might rename this to just `components` in a future release.  
:::

### NEEDLE_gameobject_data

This extension contains additional per-node data related to state, layers, and tags. Layers are used for both rendering and physics, similar to how [three.js](https://threejs.org/docs/#api/en/core/Layers) and [Unity](https://docs.unity3d.com/Manual/Layers.html) treat them.  

```json
"NEEDLE_gameobject_data": {
  "layers": 0,
  "tag": "Untagged",
  "hideFlags": 0,
  "static": false,
  "activeSelf": true,
  "guid": "1516450549"
}
```

::: tip Separate from `NEEDLE_components`
Object information is semantically different from component data.
:::

### NEEDLE_lighting_settings

This is a root extension defining ambient lighting properties per glTF file.   

```json
"NEEDLE_lighting_settings": {
  "ambientMode": 0,
  "ambientLight": [
    0.212,
    0.227,
    0.259,
    1
  ],
  "ambientIntensity": 1,
  "defaultReflectionMode": 0
}
```

::: tip Future Plans
This extension might have to be defined per-scene instead of per-file.
:::

### NEEDLE_lightmaps

This is a root extension defining a set of lightmaps for the glTF file.

```json
"NEEDLE_lightmaps": {
  "textures": [
    {
      "pointer": "textures/20",
      "type": 1,
      "index": 0
    }
  ]
}
```

::: tip Lightmap Types
At the moment this extension also contains environment texture references.
::: 

| Texture Type | Value |
| -- | -- |
| Lightmap | 0 |
| Environment Map  | 1 |
| Reflection Map | 2 |

How lightmaps are applied is defined in the `MeshRenderer` component inside the [`NEEDLE_components`](#needle_components) extension per node:  

```json
"NEEDLE_components": {
  "builtin_components": [
    {
      "name": "MeshRenderer",
      ...
      "lightmapIndex": 0,
      "lightmapScaleOffset": {
        "x": 1.00579774,
        "y": 1.00579774,
        "z": -0.00392889744,
        "w": -0.00392889744
      },
      ...
    }
  ]
}
```

::: tip Future Plans
We may change that in a future release and move lightmap-related data to a `NEEDLE_lightmap` extension entry per node. 
:::

### NEEDLE_persistent_assets

Components in `NEEDLE_components` can reference data via JSON Pointers. The data in `NEEDLE_persistent_assets` is often referenced multiple times by different components and is thus stored separately in a root extension. By design, they are always referenced by something else (or have references within each other), and thus do not store type information at all: they're simply pieces of JSON data and components referencing them currently need to know what they expect. 

Examples for assets/data stored in here are:  
- AnimatorControllers, their layers and states
- PlayableAssets (timelines), their tracks and embedded clips
- SignalAssets
- ...

Data in `persistent_assets` can reference other `persistent_assets` via JSON Pointer, but by design can't reference `NEEDLE_components`. This is similar to the separation beween "Scene data" and "AssetDatabase content" in Unity. 

```json
{
  "name": "LampionController",
  "guid": "9100000_ecab75bc7ab51a747a4c5c14236a43cd",
  "parameters": [],
  "layers": [
    {
      "name": "Base Layer",
      "stateMachine": {
        "name": "Base Layer",
        "defaultState": 0,
        "states": [
          {
            "name": "LampionFlying",
            "hash": 677739540,
            "motion": {
              "name": "LampionFlying",
              "isLooping": false,
              "guid": "7400000_c296c4d76e956b34f8b5833ba90653c1",
              "clips": [
                {
                  "node": "nodes/4",
                  "clip": "animations/0"
                },
                {
                  "node": "nodes/9",
                  "clip": "animations/6"
                },
                {
                  "node": "nodes/14",
                  "clip": "animations/12"
                }
              ]
            },
            "transitions": [
              {
                "isExit": false,
                "exitTime": 1,
                "hasFixedDuration": true,
                "offset": 0,
                "duration": 0,
                "hasExitTime": true,
                "destinationState": 0,
                "conditions": []
              }
            ]
          }
        ],
        "entryTransitions": []
      }
    }
  ]
},
{
  "name": "TrongCom Website",
  "guid": "11400000_93a8f856fe26af8498d94efe4835af36",
  "tracks": [
    {
      "name": "Markers",
      "type": "MarkerTrack",
      "muted": false,
      "outputs": [
        null
      ],
      "clips": [],
      "markers": [],
      "trackOffset": null
    },
    {
      "name": "Animation Track",
      "type": "AnimationTrack",
      "muted": false,
      "outputs": [
        "5017454109690854928_1668529989451832962"
      ],
      "clips": [
        {
          "start": 0,
          "end": 0.9833333333333333,
          "duration": 0.9833333333333333,
          "timeScale": 1,
          "asset": {
            "clip": "animations/78",
            "loop": false,
            "duration": 8,
            "position": {
              "x": 0,
              "y": 0,
              "z": 0
            },
            "rotation": {
              "x": 0,
              "y": 0,
              "z": 0,
              "w": 1
            },
            "removeStartOffset": true
          },
          "clipIn": 0,
          "easeInDuration": 0,
          "easeOutDuration": 0.41666666666666663,
          "preExtrapolationMode": 1,
          "postExtrapolationMode": 1
        },
        ... 
      ]
    }
  ]
}
```
::: tip Component Type Names and Versioning
We might include more type and versioning information in the future. 
:::

### NEEDLE_techniques_webgl

This extension builds upon the archived [`KHR_techniques_webgl`](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Archived/KHR_techniques_webgl) extension and extends it in a few crucial places. While the original extension was specified against WebGL 1.0, we're using it with WebGL 2.0 here and have added a number of  uniform types.  

```json
"KHR_techniques_webgl": {
  "programs": [
    {
      "vertexShader": 1,
      "fragmentShader": 0,
      "id": 0
    }
  ],
  "shaders": [
    {
      "name": "Pass-FRAGMENT",
      "type": 35632,
      "uri": "<embedded WebGL fragment shader code ...>",
      "id": 1
    },
    {
      "name": "Pass-VERTEX",
      "type": 35633,
      "uri": "<embedded WebGL vertex shader code ...>",
      "id": 0
    }
  ],
  "techniques": [
    {
      "program": 0,
      "attributes": {},
      "uniforms": {
        "_TimeParameters": {
          "name": "_TimeParameters",
          "type": 35666,
          "semantic": null,
          "count": 1,
          "node": 0
        },
        "hlslcc_mtx4x4unity_MatrixVP": {
          "name": "hlslcc_mtx4x4unity_MatrixVP",
          "type": 35666,
          "semantic": "_VIEWPROJECTION",
          "count": 4,
          "node": 0
        }
      },
      "defines": []
    }
  ]
}     
```

::: tip Embedding vs. bufferViews
Currently, vertex and fragment shaders are always embedded as URI. Some properties are redundant for embedded shaders, but kept for ease of export.
:::

## Why aren't you compiling to WebAssembly?

While Unity's compilation process from C# to IL to C++ (via IL2CPP) to WASM (via emscripten) is ingenious, it's also relatively slow. Building even a simple project to WASM takes many minutes, and that process is pretty much repeated on every code change. Some of it can be avoided through clever caching and ensuring that dev builds don't try to strip as much code, but it still stays slow.  

When looking into modern web workflows, we found that code reload times during development are neglectible, usually in sub-second ranges. This of course trades some performance (interpretation of JavaScript on the fly instead of compiler optimization at build time) for flexibility, but browsers got really good at getting the most out of JavaScript.  

We believe that for iteration and tight testing workflows, it's beneficial to be able to test on device and on the target platform (the browser, in this case) as quickly and as often as possible - which is why we're skipping Unity's entire play mode, effectively always running in the browser. 

::: tip Needle Engine is fast because we skip the entire "build" step
A really nice side effect is avoiding the entire slow "domain reload" step that usually costs 15-60 seconds each time you enter Play Mode. You're just "live" in the browser the moment you press Play.
Source: https://engine.needle.tools/docs/explanation/architecture/technical-overview.html

---
title: Debugging Parameters & Options
---

# Debugging Parameters & Options

**Debug and inspect your Needle Engine projects** using built-in tools, browser DevTools, and the Needle Inspector.

:::tip Also See
- **[Local Development Help](/docs/how-to-guides/testing)** - Test on mobile devices, VR headsets, and set up certificates
- **[Help & Community](/docs/help/)** - Get support and ask questions
:::

---

## Needle Inspector ‚Äî DevTools for three.js

The **Needle Inspector** is a powerful Chrome extension for inspecting and debugging three.js, react-three-fiber, and Needle Engine projects directly in your browser.

<actiongroup>
<action href="https://chromewebstore.google.com/detail/needle-inspector-%E2%80%94-devtoo/jonplpbnhmanoekkgcepnedhghflblmo">
Install Needle Inspector ‚Üí
</action>
</actiongroup>

**Key features:**
- Real-time scene hierarchy inspection
- Edit properties and see changes instantly
- Performance monitoring (FPS, stats)
- AI-powered assistance with MCP integration
- Works on any three.js website

**[Learn more about the Needle Inspector ‚Üí](/docs/three/needle-devtools-for-threejs-chrome-extension)**

---

## Useful resources for working with glTF

To inspect glTF or glb files online:
- [gltf.report](https://gltf.report/) - three.js based
- [modelviewer.dev/editor](https://modelviewer.dev/editor) - three.js based
- [Khronos glTF Sample Viewer](https://github.khronos.org/glTF-Sample-Viewer-Release/)
- [Babylon Sandbox](https://sandbox.babylonjs.com/)
- [glTF Validator](https://github.khronos.org/glTF-Validator/)

To inspect them locally:
- use the [glTF Shell Extension for Windows](https://apps.microsoft.com/store/detail/gltf-shell-extensions/9NPGVJ9N57MV?hl=en-us&gl=US) to convert between glTF and glb
- use the [glTF Tools VS Code Extension](https://marketplace.visualstudio.com/items?itemName=cesium.gltf-vscode) to see validation errors and in-engine previews locally

## Built-in URL parameters

Debug Flags can be appended as URL query parameters.  
Use ``?help`` to get a list of ALL parameters available.  

Here are some of the most commonly used:

- ``help`` print all available url parameter in the console
- ``console`` opens an on-screen dev console, useful for mobile debugging
- ``printGltf`` logs loaded gltf files to the console
- ``stats`` shows FPS module and logs threejs renderer stats every few seconds
- ``showcolliders`` visualizes physics colliders
- ``gizmos`` enables gizmo rendering (e.g. when using BoxCollider or AxesHelper components)
- and a lot more: please use ``help`` to see them all

## Debug Methods

Needle Engine also has some very powerful and useful debugging methods that are part of the static `Gizmos` class. See the [scripting documentation](/docs/how-to-guides/scripting/create-components#gizmos) for more information.

## Local Testing of release builds
- First, install http-server: `npm install -g http-server`
- make a build (development or production)
- open the *dist* folder with a commandline tool
- run `http-server -g` | *`-g` enables gzip support*  
- optional: if you want to test WebXR, generate a [self-signed SSL certificate](https://stackoverflow.com/a/35231213), then run `http-server -g -S` to enable https (required for WebXR).

## VSCode

You can attach VSCode to the running local server to set breakpoints and debug your code. You can read more about [debugging with VSCode](https://code.visualstudio.com/docs/editor/debugging) here.    

Create a launch.json file at `.vscode/launch.json` in your web project with the following content:  
```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "type": "chrome",
            "request": "launch",
            "name": "Attach Chrome",
            "url": "https://localhost:3000",
            "webRoot": "${workspaceFolder}"
        }
    ]
}
```

If you have changed the port on which your server starts make sure to update the `url` field accordingly.  
You can then start your local server from within VSCode:  
  
![](/debugging/vscode-start-debugging.webp)

## Mobile Debugging

### <logo-header logo="/imgs/android-logo.webp" alt="Android">Android Debugging</logo-header>

For **Android** debugging, you can attach Chrome Dev Tools to your device and see logs right from your PC. You have to switch your device into development mode and connect it via USB.

See the official chrome documentation [here](https://developer.chrome.com/docs/devtools/remote-debugging/)
- Make sure [Developer Mode](https://developer.android.com/studio/debug/dev-options) is enabled on your phone
- Connect your phone to your computer via USB
- Open this url in your browser ``chrome://inspect/#devices``
- On your mobile device allow the USB connection to your computer
- On your computer in chrome you should see a list of open tabs after a while (on ``chrome://inspect/#devices``)
- Click ``Inspect`` on the tab you want to debug

### <logo-header logo="/imgs/ios-logo.webp" alt="iOS">iOS Debugging</logo-header>

For easy iOS debugging add the ``?console`` URL parameter to get a useful on-screen JavaScript console.

If you have a Mac, you can also attach to Safari (similar to the Android workflow above).

WebXR usage and debugging on iOS requires using a third-party browser: [Mozilla WebXR Viewer](https://labs.mozilla.org/projects/webxr-viewer/).

### <logo-header logo="/imgs/meta-logo.webp" alt="Meta Quest">Quest Debugging</logo-header>

Quest is just an Android device - see the [Android Debugging](#android-debugging) section for steps.

---

## Related Documentation

- **[Local Development Help](/docs/how-to-guides/testing)** - Testing on mobile devices, VR headsets, and certificate setup
- **[Needle Inspector](/docs/three/needle-devtools-for-threejs-chrome-extension)** - Chrome DevTools extension for three.js
- **[FAQ](/docs/reference/faq)** - Frequently asked questions and troubleshooting
- **[Help & Community](/docs/help/)** - Get support, ask questions, and connect with the community
Source: https://engine.needle.tools/docs/how-to-guides/debugging/index.html

---
title: Embedding Needle Engine
---

# Embedding Needle Engine on Your Website

**Add interactive 3D to any website.** Needle Engine can be integrated into existing websites, embedded in CMSs like WordPress, or deployed as standalone web apps. This guide covers all the ways to get your 3D content live.

## Quick Test: 2-Minute Integration

Want to see how Needle Engine looks on your website? Add these two lines anywhere on your page:

<codewrap>

```html
<!-- Import the component -->
<script type="module" src="https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js"></script>

<!-- Use it like any other HTML element -->
<needle-engine src="https://cloud.needle.tools/-/assets/Z23hmXBZ21QnG-Z21QnG-world/file" background-color="transparent"></needle-engine>
```

</codewrap>

<iframe src="/docs/code-samples/basic-webcomponent.html" style="
    width: 100%;
    aspect-ratio: 16/9;
    outline: none;
    border: none;
    "
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking"
    allowfullscreen
    ></iframe>

[Open this example on StackBlitz](https://stackblitz.com/edit/needle-engine-prebundled?file=index.html)

---

## Deployment Methods

Choose the approach that fits your workflow:

### 1. One-Click Deployment Components (Recommended)

**Best for:** Quick iterations, multiple hosting platforms, team workflows

Our Unity and Blender integrations include built-in deployment components. Deploy to multiple platforms with just a few clicks.

**Supported platforms:**
- [Needle Cloud](/docs/cloud/#deploy-from-unity) ‚Äì Official hosting with CLI support
- [Netlify](/docs/how-to-guides/deployment/#deploy-to-netlify) ‚Äì Professional hosting
- [Vercel](/docs/how-to-guides/deployment/#deploy-to-vercel) ‚Äì Frontend-optimized
- [GitHub Pages](/docs/how-to-guides/deployment/#deploy-to-github-pages) ‚Äì Free static hosting
- [FTP](/docs/how-to-guides/deployment/#deploy-to-ftp) ‚Äì Any web server
- [itch.io](/docs/how-to-guides/deployment/#deploy-to-itchio) ‚Äì Game hosting

**How it works:**

*From Unity or Blender:*
1. Add the "Deploy to..." component to your scene
2. Configure the necessary options
3. Click "Deploy"

*From Command Line (Needle Cloud):*
```bash
# Deploy to Needle Cloud from any web project
npx needle-cloud deploy
```

[Learn more about deployment options](/docs/how-to-guides/deployment/) ‚Ä¢ [Needle Cloud CLI docs](/docs/cloud/)

:::tip Recommended Workflow
This is the easiest and fastest option. Iterate locally, then upload a new version in seconds.
:::

### 2. Command-Line Deployment (Needle Cloud)

**Best for:** CI/CD pipelines, automation, web-only projects, developers

Deploy to Needle Cloud directly from the command line without Unity or Blender.

**Steps:**

1. Navigate to your web project folder (the one with `package.json`)
2. Run the deploy command:

```bash
npx needle-cloud deploy
```

3. Follow the prompts to:
   - Log in to your Needle Cloud account (if not already logged in)
   - Choose or create a project
   - Confirm deployment

**Features:**
- ‚úÖ **Works from any web project** ‚Äì No editor needed
- ‚úÖ **Automatic builds** ‚Äì Builds and optimizes before uploading
- ‚úÖ **Fast updates** ‚Äì Incremental uploads for quick iterations
- ‚úÖ **CI/CD ready** ‚Äì Perfect for automated workflows

[Learn more about Needle Cloud CLI ‚Üí](/docs/cloud/)

:::tip Automated Deployment
Add `npx needle-cloud deploy --ci` to your GitHub Actions or other CI/CD pipeline for automatic deployments on every commit.
:::

### 3. Manual Build & Upload

**Best for:** Custom workflows, unsupported hosting platforms

Build your project and manually upload the distribution files to any web server.

**Steps:**
1. Create a production build of your web project
   - This generates a `dist/` folder with all files
2. Upload the contents of the `dist/` folder to your web host
   - Use FTP, SFTP, or your host's file manager
3. Your web app is live!

:::tip URL Structure
The folder location determines your app's URL:
- Domain: `https://your-website.com/` points to `/var/www/html`
- Upload to: `/var/www/html/my-app/`
- Your URL: `https://your-website.com/my-app/`
:::

### 4. iframe Embedding

**Best for:** Limited website access, CMS platforms (WordPress, Wix), quick embeds

Embed your Needle Engine scene like you would a YouTube video.

**Steps:**
1. Build and upload your project to any web host
2. Add an iframe to your website:

```html
<iframe
    src="https://your-website.com/needle-files/dist/index.html"
    allow="xr; xr-spatial-tracking; fullscreen;"
    style="width: 100%; height: 600px; border: none;">
</iframe>
```

:::tip Required Permissions
The `allow` attribute depends on your app's features:
- **XR apps:** `xr; xr-spatial-tracking`
- **Fullscreen:** `fullscreen`
- **Camera/Mic:** `camera; microphone`
- **More features:** `accelerometer; gyroscope; display-capture; geolocation`

[See full list of iframe permissions ‚Üí](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Permissions-Policy#directives)
:::

### 5. Direct Integration (Advanced)

**Best for:** Existing websites, custom layouts, advanced control

Embed a Needle Engine project directly into an existing webpage's HTML.

**Steps:**

1. Build your project (creates a `dist/` folder)
2. Upload the `dist/` folder to your web host
3. Open `dist/index.html` in a text editor and find these lines:

```html
<head>
    <script type="module" crossorigin src="./assets/index-732f0764.js"></script>
</head>
<body>
    <needle-engine src="assets/scene.glb"></needle-engine>
</body>
```

4. Copy both lines to your target website, updating paths:

```html
<script type="module" src="/your-upload-folder/assets/index-732f0764.js"></script>
<needle-engine src="/your-upload-folder/assets/scene.glb"></needle-engine>
```

---

### 6. CDN for Core Components Only

**Best for:** Projects without custom scripts, quick prototypes, simple scenes

Use Needle Engine directly from a CDN without uploading any JavaScript bundles.

**Requirements:** Your project must use only core Needle Engine components (no custom scripts).

**Steps:**

1. Add the CDN script to your website:

```html
<script type="module" src="https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js"></script>
<needle-engine src="https://your-website.com/assets/MyScene.glb"></needle-engine>
```

2. Upload your `assets/` folder to your web host
   - Contains `.glb` files and other assets (audio, video, skybox, etc.)
3. Update the `src` attribute to point to your uploaded `.glb` file

### 7. Needle Cloud iframe

**Best for:** Projects hosted on Needle Cloud, quick sharing, portfolios

If you've deployed to [Needle Cloud](/docs/cloud/), embed it anywhere with a simple iframe.

**How to get the embed code:**
1. Go to your asset page on Needle Cloud
2. Click the "Embed" button
3. Copy the generated iframe code

```html
<iframe
    src="https://cloud.needle.tools/view/embed?file=Z23hmXBZ21QnG-Z21QnG-world"
    title="Your Project | Hosted on Needle Cloud"
    style="width: 100%; height: 600px"
    frameborder="0"
    allow="xr-spatial-tracking; accelerometer; gyroscope; display-capture; geolocation; camera; microphone"
    allowfullscreen>
</iframe>
```

<iframe src="https://cloud.needle.tools/view/embed?file=Z23hmXBZ21QnG-Z21QnG-world" title="The forgotten knight | Hosted on Needle Cloud" style="width: 100%; height: 600px" frameborder="0" allow="xr-spatial-tracking; accelerometer; gyroscope; display-capture; geolocation; camera; microphone" allowfullscreen></iframe>

## Common Workflows

### Client Projects: Professional Deployment

When building a web app for a client, consider these factors:

#### 1. Determine the Type of Application

- **Standalone app** ‚Äì Accessible via a link on the client's domain
- **Integrated app** ‚Äì Part of existing website with server-side/client-side components
- **Embedded experience** ‚Äì Inside a CMS or existing page

#### 2. Choose the URL Structure

The app can be hosted at:

| Option | Example | When to Use |
| --- | --- | --- |
| **Needle Cloud** | `myproject.needle.run` | Prototypes, development, demos |
| **Subpage** | `client-site.com/app` | Part of existing site |
| **Subdomain** | `app.client-site.com` | Separate but branded |
| **Domain** | `my-app.com` | Standalone product |

:::tip Development to Production
Start on [Needle Cloud](/docs/cloud/) for prototypes and development, then move to the client's domain for the final version. This approach balances speed with branding requirements.
:::

#### 3. Plan Deployment & Maintenance

**Access & Updates:**
- Will you have FTP/SFTP access to upload updates?
- Will the client manage deployments?
- How often does content need updating?

:::tip FTP Access
Request FTP/SFTP access to a folder on the client's server. Use our [Deploy to FTP](/docs/how-to-guides/deployment/#deploy-to-ftp) component for easy uploads. The client's IT team handles URL configuration.
:::

**Content Type:**
- **Static content** ‚Äì Occasional updates via new builds
- **Dynamic content** ‚Äì May need CMS or database integration

**Target Audience:**
- Which devices and browsers do users have?
- Test on actual target devices (especially for AR/VR)

#### 4. Set Up Test & Production Environments

Test the deployment process early:
1. Set up a test environment (your own server or subdomain)
2. Practice the deployment workflow
3. Get client approval on test environment
4. Deploy to production environment

#### 5. Development Workflow

Iterate efficiently:
1. Develop and test locally
2. Deploy to test server for client review
3. After approval, deploy to production server
4. Repeat as needed

## Platform-Specific Integrations

### <logo-header logo="/imgs/aem-logo.webp" alt="Adobe Experience Manager"><a href="../integrations/adobe-experience-manager">Adobe Experience Manager</a></logo-header>

Integrate Needle Engine into AEM with custom components, Experience Fragments, and author-friendly workflows.

### <logo-header logo="/imgs/framer-logo.webp" alt="Framer"><a href="../integrations/framer">Framer</a></logo-header>

Integrate Needle Engine scenes into Framer websites.

### <logo-header logo="/imgs/wordpress-logo.webp" alt="WordPress"><a href="../integrations/wordpress">WordPress</a></logo-header>

Embed Needle Engine in WordPress posts, pages, and custom themes.

### <logo-header logo="/imgs/shopify-logo.webp" alt="Shopify">Shopify</logo-header>

:::warning Under Construction
Shopify integration guide coming soon. In the meantime, use the [iframe method](#4-iframe-embedding) for quick integration.
:::

### <logo-header logo="/imgs/webflow-logo.webp" alt="Webflow">Webflow</logo-header>

:::warning Under Construction
Webflow integration guide coming soon. In the meantime, use the [iframe method](#4-iframe-embedding) for quick integration.
:::

## Next Steps

**Configuration & Customization:**
- [Web Component Attributes](/docs/reference/needle-engine-attributes) ‚Äì Configure the `<needle-engine>` element
- [Scripting Guide](/docs/how-to-guides/scripting/create-components) ‚Äì Add custom functionality
- [Deployment Options](/docs/how-to-guides/deployment/) ‚Äì Explore all hosting platforms

**Editor Integrations:**
- <logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="./unity/">Unity Integration</a></logo-header> ‚Äì Visual scene creation with Unity
- <logo-header logo="/blender/logo.png" alt="Blender"><a href="./blender/">Blender Integration</a></logo-header> ‚Äì Visual scene creation with Blender

**Get Help:**
- [Forum](https://forum.needle.tools) ‚Äì Ask questions and share projects
- [Discord](https://discord.needle.tools) ‚Äì Join our community
- [FAQ](/docs/reference/faq) ‚Äì Common questions and troubleshooting

:::tip Visual Scene Creation
Did you know Needle Engine integrates with Unity and Blender? Create complex 3D scenes visually and export them directly to the web. Perfect for non-coders or teams with 3D artists.

<logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="./unity/">Learn about Unity Integration</a></logo-header> ‚Ä¢ <logo-header logo="/blender/logo.png" alt="Blender"><a href="./blender/">Learn about Blender Integration</a></logo-header>
:::
Source: https://engine.needle.tools/docs/how-to-guides/deployment/embedding.html

---
title: Deployment Platforms
description: Deploy your Needle Engine projects to the web with one click. Learn how to publish to Netlify, Vercel, GitHub Pages, itch.io, FTP servers, and more. Includes optimization tips for production builds with KTX2 and Draco compression.
---

# Deployment Platforms

**Get your Needle Engine projects live on the web.** Deploy to popular hosting platforms like Netlify, Vercel, GitHub Pages, and more.

:::tip Optimize Your Build First
Before deploying to production, optimize your project for best performance:
**[Optimization & Compression ‚Üí](/docs/how-to-guides/optimization/)**

Learn about texture compression (KTX2), mesh compression (Draco/Meshopt), progressive loading, and build types.
:::

## What does deployment mean?

Deployment is the process of making your application available to the public on a website. Needle Engine ensures that your project is as small and fast as possible by using the latest compression techniques such as **KTX2**, **Draco**, and **Meshopt**. Learn more about [Optimization & Compression](/docs/how-to-guides/optimization/).

## Quick Start: Choose Your Platform

Pick a hosting platform that fits your needs:

- **[Needle Cloud](/docs/cloud/#deploy-from-unity)** ‚Äì Official Needle hosting. Great for all kinds of spatial web apps and 3D assets.
- **[Netlify](#deploy-to-netlify)** ‚Äì Professional hosting with custom domains and CI/CD.
- **[Vercel](#deploy-to-vercel)** ‚Äì Optimized platform for frontend developers with excellent performance.
- **[GitHub Pages](#deploy-to-github-pages)** ‚Äì Free static hosting, great for open source projects.
- **[itch.io](#deploy-to-itchio)** ‚Äì Perfect for games and interactive experiences.
- **[Facebook Instant Games](#deploy-to-facebook-instant-games)** ‚Äì Reach users on Facebook and Messenger.
- **[FTP Upload](#deploy-to-ftp)** ‚Äì Deploy directly to any server with FTP/SFTP support.
- **[Build to Folder](#build-to-folder)** ‚Äì Upload manually to any web server or hosting service.
- **[Glitch](#deploy-to-glitch-)** *(Deprecated)* ‚Äì Glitch has discontinued their hosting service.

:::tip Need Help?
Can't find what you're looking for? Let us know in our [forum](https://forum.needle.tools/?utm_source=needle_docs&utm_content=content)!
:::

---

## Deployment Options

### <logo-header logo="/imgs/needle-logo.webp" alt="Needle Cloud">Deploy to Needle Cloud</logo-header>

**Official Needle hosting** ‚Äì The fastest way to get your Needle Engine projects online with built-in networking support.

Needle Cloud provides instant deployment, automatic HTTPS, and seamless integration with multiplayer and networking features.

:::details Unity: Deploy to Needle Cloud

1. Add the **Needle Engine** component to your scene (if not already present)
2. Click **Upload to Needle Cloud** in the component inspector
3. Sign in to your Needle Cloud account when prompted
4. Choose your team and project name, then click **Upload**

Your project will be live at `https://<your-project-name>.needle.run` with automatic updates on every deployment.

![Deploy to Needle Cloud from Unity](/cloud/cloud-deploy-v3.webp)

:::

:::details Blender: Deploy to Needle Cloud

1. Open the **Needle Engine** panel in your scene (if not already present)
2. Sign in to your Needle Cloud account when prompted
3. Then click **Upload to Needle Cloud**

Your project will be live at `https://<your-blendfile-name>.needle.run` with automatic updates on every deployment.  
Note: The deployment url will by default be based on your blend file name.

![Deploy to Needle Cloud from Blender](/blender/blender-deploy-to-needle-cloud.webp)

:::

**Features:**
- **Instant deployment** ‚Äì Get your project online in seconds
- **Built-in networking** ‚Äì Multiplayer and real-time features work out of the box
- **Automatic HTTPS** ‚Äì Secure connections by default
- **Version management** ‚Äì Keep track of all your deployments
- **Custom domains** ‚Äì Use your own domain name (Pro plan)

**Learn more:** [Needle Cloud Documentation](/docs/cloud/)

### <logo-header logo="/imgs/netlify-logo.webp" alt="Netlify">Deploy to Netlify</logo-header>

Professional hosting with custom domains, automatic HTTPS, and continuous deployment.

:::details Unity: Deploy to Netlify
Add the `DeployToNetlify` component to your scene and follow the instructions. You can create new projects or deploy to existing ones with a single click.

![Deploy to Netlify Component](/deployment/deploytonetlify-2.jpg)

![Deploy to Netlify](/deployment/deploytonetlify.jpg)
:::

### <logo-header logo="/imgs/vercel-logo.webp" alt="Vercel">Deploy to Vercel</logo-header>

Optimized platform for frontend developers with excellent performance and DX.

**Setup:**
1. Create a new project on Vercel
2. Add your web project to a GitHub repository
3. Connect the repository to your Vercel project

See our [Next.js sample project](https://github.com/needle-engine/nextjs-sample) for configuration reference.

### <logo-header logo="/imgs/itch-logo.webp" alt="itch.io">Deploy to itch.io</logo-header>

Perfect for games and interactive experiences with a built-in community.

:::details Unity: Deploy to itch.io step-by-step

1. Create a new project on [itch.io](https://itch.io/game/new)

2. Set **Kind of project** to **HTML**
   ![itch.io Project Type](https://user-images.githubusercontent.com/5083203/191211856-8a114480-bae7-4bd1-868e-2e955587acd7.png)

3. Add the `DeployToItch` component to your scene and click **Build**
   ![Deploy to itch Component](https://user-images.githubusercontent.com/5083203/193812540-1881837e-ed9e-49fc-9658-52e5a914299a.png)

4. Wait for the build to finish. It will open a folder with the final zip

5. Upload the final zip to itch.io
   ![Upload to itch.io](https://user-images.githubusercontent.com/5083203/191212661-f626f0cb-bc8e-4738-ad2c-3982aca65f39.png)

6. Select **This file will be played in the browser**
   ![Browser Playback](https://user-images.githubusercontent.com/5083203/191212967-00b687f3-bf56-449e-880c-d8daf8a52247.png)

7. Save your itch page and view the project page
   Your Needle Engine project should now load! üòä

**Optional settings:**

![Optional Settings](https://user-images.githubusercontent.com/5083203/191217263-355d9b72-5431-4170-8eca-bfbbb39ae810.png)

:::

:::details Troubleshooting: Failed to find index.html
![Failed to find index.html error](https://user-images.githubusercontent.com/5083203/191213162-2be63e46-2a65-4d41-a713-98c753ccb600.png)

If you see this error, make sure you're not uploading a gzipped index.html.

**Fix:** Disable gzip compression in `vite.config.js` in your Needle web project folder. Remove the line with `viteCompression({ deleteOriginFile: true })`, rebuild, and upload to itch.
:::

### <logo-header logo="/imgs/github-logo.webp" alt="GitHub">Deploy to GitHub Pages</logo-header>

Free static hosting, perfect for open source projects and documentation.

:::details Unity: Deploy to GitHub Pages

Add the `DeployToGithubPages` component to your scene and copy-paste your GitHub repository URL or GitHub Pages URL.

![Deploy To GitHub Pages Component](/deployment/deploytogithubpages.jpg)

<video-embed src="https://www.youtube.com/watch?v=Vyk3cWB6u-c" />

:::

#### Troubleshooting GitHub Pages

**Deployed but website is not live:**
- First deployment can take a few minutes. Check the **Actions** tab on GitHub (`/actions`) to see deployment progress.
- If not live after a few minutes or no workflow appears in **Actions**, go to **Settings ‚Üí Pages** (`/settings/pages`) and ensure **Branch** is set to `gh-pages`.

### <logo-header logo="/imgs/facebook-logo.webp" alt="Facebook">Deploy to Facebook Instant Games</logo-header>

Reach users on Facebook and Facebook Messenger with instant-loading games.

**No manual adjustments required** ‚Äì Needle Engine handles everything automatically.

:::details Unity: Deploy to Facebook Instant Games

1. Add the `Deploy To Facebook Instant Games` component to your scene
   ![Deploy to Facebook Instant Games](/deployment/deploytofacebookinstantgames.jpg)

2. Click **Build For Instant Games**

3. After the build finishes, you'll get a ZIP file to upload to your Facebook app

4. On Facebook, add the **Instant Games** module and go to **Instant Games ‚Üí Web Hosting**
   ![Hosting Facebook Instant Games](/deployment/deploytofacebookinstantgames-hosting.jpg)

5. Upload your zip using **Upload version** (1). After processing, click **Stage for testing** (2) or **Push to production** (star icon)
   ![Upload to Facebook Instant Games](/deployment/deploytofacebookinstantgames-upload.jpg)

6. Click the **Play** button next to each version to test your game on Facebook

:::

:::details How to create a Facebook app with Instant Games

1. [Create a new app](https://developers.facebook.com/apps/creation/) and select **Other**, then click **Next**
   ![Create Facebook App](/deployment/facebookinstantgames-1.jpg)

2. Select type **Instant Games**
   ![Select Instant Games](/deployment/facebookinstantgames-2.jpg)

3. After creating the app, add the **Instant Games** product
   ![Add Instant Games Product](/deployment/facebookinstantgames-3.jpg)

See the [official Instant Games documentation](https://developers.facebook.com/docs/games/build/instant-games) for more details.

**Note:** You only need to create the app ‚Äì Needle Engine handles all technical requirements automatically.
:::

### Deploy to Glitch üéè

:::warning Deprecated - Service Discontinued
Glitch has discontinued their hosting service. This deployment option is no longer available.

**Alternatives:**
- **[Needle Cloud](./cloud/#deploy-from-unity)** ‚Äì Official Needle hosting with built-in networking support
- **[Netlify](#deploy-to-netlify)** ‚Äì Professional hosting with custom domains
- **[Vercel](#deploy-to-vercel)** ‚Äì Excellent performance for frontend projects
- **[Build to Folder](#build-to-folder)** ‚Äì Deploy to any web server manually
:::

### <logo-header logo="/imgs/ftp-icon.webp" alt="FTP">Deploy to FTP</logo-header>

Deploy directly to any server with FTP or SFTP support.

:::details Unity: Deploy to FTP server

1. Add the `DeployToFTP` component to a GameObject in your scene
   *(Best practice: add it to the same GameObject as Needle Engine)*

2. Assign an FTP server asset and fill in server, username, and password
   *Get these credentials from your hosting provider when you create an FTP account*

3. Click **Build & Deploy** to build and upload to your FTP account

![Deploy to FTP Component](/deployment/deploytoftp.jpg)

*Deploy to FTP component*

![FTP Server Asset](/deployment/deploytoftp2.jpg)

*FTP Server asset containing access information*

![Deploy to FTP with Server Assigned](/deployment/deploytoftp3.jpg)

*Deploy To FTP component with server asset assigned. You can deploy to a subfolder using the path field*

:::

:::details Manual FTP deployment

1. Open **File ‚Üí Build Settings**, select **Needle Engine**, and click **Build**
2. Wait for the build to complete ‚Äì the `dist` folder will open automatically
3. Copy the files from the `dist` folder to your FTP storage

**That's it!** üòâ

![Dist Folder](https://user-images.githubusercontent.com/2693840/187311461-e6afb2d7-5761-48cf-bacb-1c1733bb768b.png)

**Troubleshooting:**

**Website doesn't work after upload:**
Your web server may not support serving gzipped files.

**Option 1:** Enable gzip compression on your server using a `.htaccess` file (see below)
**Option 2:** Turn off gzip compression in build settings at **File ‚Üí Needle Engine ‚Üí Build Window**

![Build Options Gzip](/deployment/buildoptions_gzip.jpg)

**Build errors during compression:**
Please report the bug! To get unstuck immediately, toggle **Development Build** on in Build Settings.

:::

#### Enabling gzip using a htaccess file

Create a file named `.htaccess` in your upload folder (or parent folder) with this content:

```apache
<IfModule mod_mime.c>
RemoveType .gz
AddEncoding gzip .gz
AddType application/javascript .js.gz
```

Upload the `.htaccess` file to your server.

---

## <logo-header logo="/imgs/folder-icon.webp" alt="Folder">Build To Folder</logo-header>

Build your project locally for manual upload to any web server or hosting service.

When using our default Vite template, the build output folder is `<webproject>/dist`.

**<logo-header logo="/imgs/unity-logo.webp" alt="Unity">Unity: Access Build Options</logo-header>**

Open **File ‚Üí Needle Engine ‚Üí Build Window**:

![Unity Build Window](/imgs/unity-build-window-2.jpg)

**Available Options:**

- **Build to Disk** ‚Äì Create production build in the `dist` folder
- **Preview Build** ‚Äì Build and start a local server to preview the final result
- **Development Build** ‚Äì Disable compression for debugging (not recommended for production)

**Learn more:** [Optimization & Compression](/docs/how-to-guides/optimization/) - Build types, compression options, and best practices

:::tip Node.js is only required during development
The distributed website (using our default Vite template) is a static page that doesn't rely on Node.js and can be hosted on any regular web server.

Node.js is only required if you want to run our minimalistic networking server for multiplayer experiences.
:::

## Advanced Topics

### Cross-Platform Deployment Workflows

You can create Unity projects that build to both Needle Engine and regular Unity platforms (Desktop, WebGL, etc.). Our component mapping approach means no runtime logic is modified in Unity.

**Using Unity Play Mode:**

In **Project Settings ‚Üí Needle Engine**, toggle **Override Play Mode** and **Override Build Settings** to switch between Needle's build process and Unity's build process:

![Unity Play Mode Settings](https://user-images.githubusercontent.com/2693840/187308490-5acb9016-ffff-4113-be62-4de450a42b08.png)

:::tip Dual Platform Development
This approach may require duplicate code (C# for Unity, TypeScript for Needle Engine). The amount of extra work depends on your project complexity.
:::

### Needle Engine Command Line Arguments for Unity

Needle Engine for Unity supports command-line arguments for batch exports and builds using -batchmode (headless/CLI options).  

**Note**: A Needle Engine PRO license is required for command-line builds.   

**Available Options:**

| Argument | Description |
| -- | -- |
| `-executeMethod Needle.Engine.ActionsBatch.Execute` | **required** ‚Äî Tells Needle Engine to run batch processing |
| `-teamId <teamId>` | **required** ‚Äî Your Needle Cloud team id. Get via [Needle Cloud](https://cloud.needle.tools/team#edit) |
| `-scene` | **required** ‚Äî Path to a scene or asset to export<br/>Example: `Assets/path/to/myObject.prefab` or `Assets/path/to/myScene.unity` |
| `-outputPath <path>` |  **required** ‚Äî Set the output path for the build<br/>Example: `-outputPath path/to/output.glb` |
| `-buildProduction` | **optional** ‚Äî Run a production build. Only used for Unity scenes. Either `-buildProduction` or `-buildDevelopment` must be specified. |
| `-buildDevelopment` | **optional** ‚Äî Run a development build. Only used for Unity scenes. Either `-buildProduction` or `-buildDevelopment` must be specified. |
| `-debug` | Open a console window for debugging |  

Please refer to the [Unity Commandline Arguments documentation](https://docs.unity3d.com/Documentation/Manual/CommandLineArguments.html) for Unity specific options.

:::tip Needle License Server
For automated builds on CI/CD systems make sure the Needle License server is running. See [Needle Cloud Documentation - Starting the License Server](/docs/cloud/#starting-the-needle-license-server) for setup instructions.
:::

**Example Usage:**

```bash
Unity.exe -batchmode -executeMethod Needle.Engine.ActionsBatch.Execute -teamId <teamId> -projectPath "C:/MyProject" -scene "Assets/Scenes/MyScene.unity" -buildProduction -quit   
```

---

## Next Steps

**Optimize Your Build:**
- [Optimization & Compression](/docs/how-to-guides/optimization/) ‚Äì Make your project load faster and run smoother
- [Export Guide](/docs/how-to-guides/export/) ‚Äì Best practices for 3D assets

**Learn More:**
- [Getting Started Guide](/docs/getting-started/) ‚Äì Set up your first project
- [Needle Cloud Documentation](/docs/cloud/) ‚Äì Official hosting platform
- [Features Overview](/docs/explanation/core-concepts/features-overview) ‚Äì See what's possible

**Get Help:**
- [Forum](https://forum.needle.tools/?utm_source=needle_docs&utm_content=deployment) ‚Äì Ask questions and share projects
- [Discord](https://discord.needle.tools) ‚Äì Join the community
- [Help & Community](/docs/help/) ‚Äì Additional resources
Source: https://engine.needle.tools/docs/how-to-guides/deployment/index.html

---
title: Add Contact Shadows (ContactShadows)
description: Add realistic ground shadows to your 3D scenes with the ContactShadows component. Soft, performant shadows that enhance visual quality. Works in Unity and Blender.
---

# Add Contact Shadows

Add realistic, soft shadows where objects meet the ground for enhanced depth and realism.

<video-embed src="/docs/videos/contactshadows.mp4" autoplay muted />

:::tip Works with Unity and Blender
The ContactShadows component is available for both Unity and Blender integrations.
:::

## What You Can Do

- **Realistic Ground Shadows** - Soft shadows where objects touch surfaces
- **Auto-Fit to Scene** - Automatically size shadows to cover your entire scene
- **Customizable Appearance** - Control darkness, opacity, and blur
- **Performant** - Efficient rendering without heavy shadow mapping
- **Easy Setup** - Add via component or HTML attribute

Perfect for:
- Product showcases and configurators
- Architectural visualizations
- Character and vehicle displays
- Any scene needing enhanced depth perception
- Lightweight shadow alternative

## Quick Start

### Via HTML Attribute (Easiest)

Add contact shadows to your entire scene with one line:

```html
<needle-engine contactshadows="0.7"></needle-engine>
```

The value (`0.7`) controls both opacity and darkness. Higher values = stronger shadows.

### Via Component in Unity/Blender

**In Unity or Blender:**
1. Create an empty object in your scene
2. Add the `ContactShadows` component
3. Enable **Auto Fit** to cover the whole scene
4. Export and view - shadows appear automatically!

### Programmatically

Create contact shadows from code:

```ts
import { ContactShadows } from "@needle-tools/engine";

// Automatically create and fit shadows to the scene
const shadows = ContactShadows.auto();

// Customize the shadows
shadows.opacity = 0.7;
shadows.darkness = 0.6;
shadows.blur = 3.0;
```

## Settings

| Setting | What it does | Default |
| --- | --- | --- |
| **Auto Fit** | Automatically size shadows to fit the entire scene | `false` |
| **Darkness** | How dark the shadows appear (0 = invisible, 1 = black) | `0.5` |
| **Opacity** | Transparency of the shadow plane (0 = transparent, 1 = opaque) | `0.5` |
| **Blur** | Softness of shadow edges (higher = softer) | `4.0` |
| **Occlude Below Ground** | Hide objects below the shadow plane | `false` |
| **Backface Shadows** | Cast shadows from backfaces of objects | `true` |
| **Manual Update** | Only update shadows when manually triggered | `false` |

## How It Works

ContactShadows renders your scene from below using an orthographic camera:

1. Objects are rendered as black silhouettes
2. The silhouettes are blurred for soft edges
3. The result is projected onto a ground plane
4. Only the area near objects shows shadows (contact area)

This creates realistic "contact shadows" without expensive real-time shadow mapping.

## Examples

### Product Display

Enhance product visualization with ground shadows:

**Via HTML:**
```html
<needle-engine src="product.glb" contactshadows="0.6"></needle-engine>
```

**Via Component:**
1. Add `ContactShadows` component to your scene
2. Enable **Auto Fit**
3. Set **Darkness** to `0.6` and **Opacity** to `0.5`
4. Set **Blur** to `5.0` for very soft shadows

### Architectural Visualization

Add depth to building models:

```ts
import { ContactShadows } from "@needle-tools/engine";

const shadows = ContactShadows.auto();
shadows.darkness = 0.7;
shadows.opacity = 0.8;
shadows.blur = 2.0; // Sharper shadows for architecture
```

### Custom Shadow Area

Control exactly where shadows appear:

**In Unity/Blender:**
1. Create a plane where you want shadows
2. Scale the plane to define the shadow area
3. Add `ContactShadows` component
4. Disable **Auto Fit**
5. The shadow area matches the object's scale

### Dynamic Scenes

Update shadows when objects move:

```ts
import { Behaviour, ContactShadows } from "@needle-tools/engine";

export class DynamicShadows extends Behaviour {

    private shadows?: ContactShadows;

    start() {
        this.shadows = ContactShadows.auto();
        // Enable manual updates for better performance
        this.shadows.manualUpdate = true;
    }

    // Call this when objects move or change
    updateShadows() {
        if (this.shadows) {
            this.shadows.needsUpdate = true;
        }
    }
}
```

## Advanced Features

### Auto-Fit with Custom Parameters

Control how shadows fit to your scene:

```ts
import { ContactShadows } from "@needle-tools/engine";

const shadows = ContactShadows.auto(context, {
    object: mySpecificObject, // Fit to specific object instead of whole scene
    positionOffset: { y: 0.01 }, // Raise shadows slightly off ground
    scaleFactor: { x: 1.2, z: 1.2 } // Expand shadow area by 20%
});
```

### Manual Shadow Updates

For static scenes, update shadows only when needed:

```ts
const shadows = ContactShadows.auto();
shadows.manualUpdate = true; // Don't update every frame

// Later, when something changes:
shadows.needsUpdate = true; // Update on next frame
```

This improves performance in scenes where objects don't move frequently.

### Fitting Shadows

Manually fit shadows to specific objects or the whole scene:

```ts
const shadows = ContactShadows.auto();

// Fit to the entire scene
shadows.fitShadows();

// Fit to specific objects
shadows.fitShadows({
    object: [object1, object2, object3],
    positionOffset: { y: 0.02 },
    scaleFactor: { x: 1.5, z: 1.5 }
});
```

### Occlude Below Ground

Hide parts of objects below the shadow plane:

```ts
const shadows = ContactShadows.auto();
shadows.occludeBelowGround = true;
```

Useful for:
- Cutting off reflected objects below mirrors
- Hiding underground parts in architectural models
- Creating water surface effects

### Backface Shadows

Control whether object backsides cast shadows:

```ts
const shadows = ContactShadows.auto();
shadows.backfaceShadows = false; // Only front faces cast shadows
```

Disabling this can reduce shadow artifacts but may make shadows look less complete.

## Common Questions

**How do contact shadows differ from regular shadows?** 
Contact shadows are soft, ground-plane-only shadows that enhance depth perception. They don't cast onto other objects like traditional shadow mapping does.

**Do contact shadows work in VR/AR?** 
Yes! Contact shadows render correctly in WebXR environments.

**Can I have multiple ContactShadows in one scene?** 
Generally you should only have one ContactShadows instance per scene. Use `ContactShadows.auto()` which creates only one instance.

**Why are my shadows not appearing?** 
Check that objects have visible geometry and aren't marked as transparent or wireframe. Use `?debugcontactshadows` URL parameter for diagnostics.

**How do I adjust shadow size?**  
If using **Auto Fit**, shadows automatically cover the scene. Otherwise, scale the GameObject to define the shadow area.

**Are contact shadows expensive?**  
They're more efficient than full shadow mapping but do require rendering the scene from below each frame. Use **Manual Update** for static scenes to improve performance.

**Can contact shadows follow moving objects?**  
Yes, shadows update automatically by default. For moving objects in otherwise static scenes, use manual updates and trigger `needsUpdate` when objects move.

## Performance Tips

**Static Scenes:**  
Enable manual updates and only update when needed:
```ts
shadows.manualUpdate = true;
shadows.needsUpdate = true; // Only when scene changes
```

**Reduce Texture Size:**  
Shadows use a 512√ó512 render target by default. This is hardcoded but provides good quality/performance balance.

**Adjust Blur:**  
Lower blur values render faster. Start with `blur: 2.0` and increase only if needed.

**Selective Rendering:**  
Objects marked with certain properties (wireframe, colorWrite:false) are automatically excluded from shadow rendering.

## Debugging

Enable debug mode by adding `?debugcontactshadows` to your URL:

```
http://localhost:3000?debugcontactshadows
```

This logs:
- Shadow creation and initialization
- Fitting operations and bounding boxes
- Render pipeline details

## More Information

**Live Example:**  
- [Contact Shadows Sample](https://samples.needle.tools/contact-shadows) - Interactive demo with controls

**API Documentation:**  
- [ContactShadows API](https://engine.needle.tools/docs/api/ContactShadows) - Complete technical reference

**Related Components:**  
- [Light](/docs/reference/components#light) - Traditional lighting and shadows
- [GroundProjectedEnv](/docs/reference/components#groundprojectedenv) - Ground-projected environment reflections
Source: https://engine.needle.tools/docs/how-to-guides/components/contact-shadows.html

---
title: Make Objects Follow the Cursor
description: Create interactive effects where 3D objects follow the user's mouse or touch position with the CursorFollow component. Works in Unity and Blender.
---

# Make Objects Follow the Cursor

Create interactive effects where 3D objects smoothly follow the user's cursor or touch position.

<video-embed src="/docs/videos/lookatcursor.mp4" autoplay muted />

:::tip Works with Unity and Blender
The CursorFollow component is available for both Unity and Blender integrations.
:::

## What You Can Do

- **Follow Mouse/Touch** - Objects track cursor position across the screen
- **Smooth Movement** - Add damping for natural, smooth motion
- **Maintain Distance** - Keep objects at a fixed distance from camera
- **Full Page Tracking** - Track cursor even outside the 3D canvas
- **Surface Snapping** - Stick objects to surfaces in your scene

Perfect for:
- Interactive headers and hero sections
- Eye-following characters
- Floating UI elements
- Product spotlight effects
- Cursor-based interactions

## Quick Start

### Basic Setup

**In Unity or Blender:**
1. Add a `CursorFollow` component to any object
2. Export and open in browser
3. Move your cursor - the object follows!

### Smooth Motion

Add natural, smooth movement:

1. On the CursorFollow component, set **Damping** to `0.1` (or higher for slower motion)
2. The object now smoothly eases toward the cursor position

Try different values:
- `0` = Instant movement (no smoothing)
- `0.05` = Very responsive
- `0.2` = Smooth and natural
- `0.5` = Slow, floaty movement

## Settings

| Setting | What it does |
| --- | --- |
| **Damping** | Smoothness of movement (0 = instant, higher = smoother) |
| **Use Full Page** | Track cursor across entire page, not just the 3D canvas |
| **Keep Distance** | Maintain the object's initial distance from camera |
| **Snap To Surface** | Stick the object to surfaces in the scene via raycasting |

## Examples

### Interactive 3D Header

Create an engaging header where a 3D object follows the cursor:

1. Add your 3D object (logo, character, product)
2. Add `CursorFollow` component
3. Set **Damping** to `0.2` for smooth movement
4. Enable **Use Full Page** so it tracks across your entire website

Combine with a `LookAt` component to make objects look at the cursor!

### Eye-Following Character

Make a character's eyes follow the cursor:

1. Add `CursorFollow` to empty objects positioned where the eyes should look
2. Use `LookAt` components on the eye objects, targeting the CursorFollow objects
3. Adjust **Damping** for natural eye movement
4. The eyes now follow the cursor!

### Floating Cursor Indicator

Create a custom 3D cursor that floats in your scene:

1. Add a small 3D object (sphere, custom model)
2. Add `CursorFollow` component
3. Enable **Snap To Surface** to stick it to objects in your scene
4. Set **Keep Distance** to `false` if you want it to move freely in 3D space

### Product Spotlight

Highlight products as users move their cursor:

1. Add a spotlight or highlight object
2. Add `CursorFollow` with smooth **Damping**
3. The light follows the cursor, creating an interactive spotlight effect

## Scripting

### Control Distance Programmatically

Change how far the object floats from the camera:

```ts
import { Behaviour, CursorFollow } from "@needle-tools/engine";

export class MyComponent extends Behaviour {

    start() {
        const cursorFollow = this.gameObject.getComponent(CursorFollow);

        if (cursorFollow) {
            // Force update the distance (useful if you move the object)
            cursorFollow.updateDistance(true);
        }
    }
}
```

### Combine with Other Components

CursorFollow works great with other components:

```ts
import { Behaviour, CursorFollow, LookAt } from "@needle-tools/engine";

export class InteractiveSetup extends Behaviour {

    start() {
        // Add CursorFollow to a target object
        const target = this.gameObject;
        const cursorFollow = target.addNewComponent(CursorFollow);
        cursorFollow.damping = 0.15;
        cursorFollow.useFullPage = true;

        // Make another object look at this target
        const lookAt = this.gameObject.addNewComponent(LookAt);
        lookAt.target = target;
    }
}
```

## How It Works

The CursorFollow component:

1. Tracks cursor position in normalized device coordinates (NDC)
2. Creates a ray from the camera through the cursor position
3. Places the object along that ray at a specified distance
4. Optionally smooths the movement with damping
5. Can raycast to snap to surfaces if enabled

## Settings Explained

### Use Full Page

When **enabled** (default):
- Tracks cursor across your entire webpage
- Perfect for hero sections and headers
- Object keeps responding even when cursor leaves the canvas

When **disabled**:
- Only tracks cursor inside the 3D canvas
- Useful for contained experiences
- Object stops moving when cursor leaves canvas

### Keep Distance

When **enabled** (default):
- Object stays at its initial distance from camera
- Creates a "floating in space" effect
- Distance calculated when component starts

When **disabled**:
- Object moves freely in 3D space
- Useful with **Snap To Surface** for surface-following effects

### Snap To Surface

When **enabled**:
- Object sticks to surfaces in your scene
- Uses raycasting to detect surfaces
- Great for "painting" effects or surface indicators

When **disabled** (default):
- Object floats freely at the cursor position
- No collision detection needed

## Common Questions

**Can I use this for mobile/touch devices?**
Yes! The component automatically works with touch events on mobile devices.

**Does it work outside the canvas?**
Yes, when **Use Full Page** is enabled. This is great for hero sections where the 3D element is small but should react to the full page.

**How do I make multiple objects follow the cursor differently?**
Add CursorFollow to multiple objects with different **Damping** values. Lower damping = faster response, higher damping = slower, more delayed movement.

**Can I make an object look at the cursor instead?**
Yes! Use the `LookAt` component and combine it with CursorFollow on a target object. The LookAt object will rotate to face the cursor-following target.

**What's the performance impact?**
Very minimal! The component runs once per frame and uses simple math. You can have many CursorFollow objects without performance issues.

## Debugging

Enable debug mode by adding `?debugcursor` to your URL:

```
http://localhost:3000?debugcursor
```

This shows visual gizmos when **Snap To Surface** is enabled, displaying the raycast hit points and normals.

## More Information

**Live Example:**
- [Look At Cursor Sample](https://engine.needle.tools/samples/look-at-cursor-interactive-3d-header/) - Interactive 3D header demo

**API Documentation:**
- [CursorFollow API](https://engine.needle.tools/docs/api/CursorFollow) - Complete technical reference

**Related Components:**
- [LookAt](/docs/reference/components#lookat) - Make objects look at targets
- [Orbit Controls](/docs/reference/components#orbitcontrols) - Camera orbit controls
Source: https://engine.needle.tools/docs/how-to-guides/components/cursor-follow.html

---
title: Drag Objects in Your Scene (DragControls)
description: Let users drag and move 3D objects with mouse, touch, or VR controllers using the DragControls component. Works in Unity and Blender.
---

# Drag Objects in Your Scene

Make objects draggable in 2D screen space or 3D world space with mouse, touch, and VR support.

<video-embed src="/docs/videos/dragcontrols.mp4" autoplay muted />

:::tip Works with Unity and Blender
The DragControls component is available for both Unity and Blender integrations.
:::

## What You Can Do

- **Drag with Mouse/Touch** - Click and drag objects on desktop and mobile
- **VR/AR Support** - Grab and move objects with controllers or hands
- **Multiple Drag Modes** - Floor plane, screen space, surface snapping, and more
- **Grid Snapping** - Snap objects to a grid while dragging
- **Multiplayer** - Works with networking for collaborative experiences
- **Physics Integration** - Automatically handles rigidbodies during drag

Perfect for:
- Interactive product configurators
- Furniture placement tools
- Collaborative design spaces
- VR/AR object manipulation
- Puzzle and building games

## Quick Start

### Basic Setup

**In Unity or Blender:**
1. Add the `DragControls` component to any object with a mesh
2. Export and open in browser
3. Click and drag the object - it moves!

That's it! The object is now draggable.

### With Networking

Share dragged objects with other users:

1. Add `SyncedRoom` component to your scene
2. Add `SyncedTransform` to draggable objects
3. Users automatically see each other moving objects

## Settings

| Setting | What it does |
| --- | --- |
| **Drag Mode** | How the object moves: Floor plane, attached to cursor, or surface snapping |
| **Snap Grid Resolution** | Grid size for snapping (0 = no snapping) |
| **Keep Rotation** | Maintain object's original rotation while dragging |
| **XR Drag Mode** | Separate drag mode for VR/AR controllers |
| **XR Keep Rotation** | Maintain rotation while dragging in VR/AR |
| **XR Distance Drag Factor** | How quickly objects move closer/farther in VR |
| **Show Gizmo** | Display visual line from object to surface below |

## Drag Modes

### XZ Plane (Floor)
Objects stay on the same horizontal plane as they started. Perfect for objects on floors or tables.

### Attached
Objects follow the pointer/controller directly. In 2D, they move along the screen plane. In VR, they follow your hand.

### Hit Normal
Objects drag along the surface normal where you grabbed them. Good for objects on walls or slopes.

### Dynamic View Angle
Automatically switches between floor plane (looking down) and screen plane (looking straight) based on camera angle.

### Snap To Surfaces
Objects stick to surfaces as you drag them. Great for placing objects on walls, ceilings, or furniture.

### None
Disables dragging completely.

## Examples

### Furniture Placement

Let users arrange furniture in a room:

1. Add `DragControls` to furniture objects
2. Set **Drag Mode** to `XZ Plane` (keeps furniture on floor)
3. Set **Snap Grid Resolution** to `0.1` for clean placement
4. Users can drag furniture around the room

### Collaborative Workspace

Multiple users placing and moving objects together:

1. Add `SyncedRoom` component
2. Add `DragControls` and `SyncedTransform` to all draggable objects
3. Set **Drag Mode** to `Dynamic View Angle` for natural movement
4. Users see each other moving objects in real-time

### VR Object Manipulation

Natural VR grabbing and placement:

1. Add `DragControls` to objects
2. Set **XR Drag Mode** to `Attached` for natural hand movement
3. Disable **XR Keep Rotation** to allow rotating objects while dragging
4. Use **Snap To Surfaces** for placing objects on walls/tables

### Product Configurator

Let users position and rotate products:

1. Add `DragControls` to the product
2. Set **Drag Mode** to `Attached` for screen-following movement
3. Enable **Keep Rotation** to prevent accidental rotation
4. Add UI controls to call rotation methods from code

## Scripting

### Check if Objects Are Being Dragged

Detect when any object is being dragged:

```ts
import { Behaviour, DragControls } from "@needle-tools/engine";

export class DragDetector extends Behaviour {

    update() {
        if (DragControls.HasAnySelected) {
            console.log("Something is being dragged!");
        }
    }
}
```

### Get Currently Dragged Objects

Access all objects currently being dragged:

```ts
import { Behaviour, DragControls } from "@needle-tools/engine";

export class DragMonitor extends Behaviour {

    update() {
        const dragging = DragControls.CurrentlySelected;

        for (const dragControl of dragging) {
            const obj = dragControl.draggedObject;
            console.log("Dragging:", obj?.name);
        }
    }
}
```

### Keep Objects Within Bounds

Constrain dragged objects to stay within a defined area:

```ts
import { Behaviour, DragControls, Gizmos } from "@needle-tools/engine";

export class DragMonitor extends Behaviour {

    onBeforeRender() {
        const dragging = DragControls.CurrentlySelected;

        const boundsCenter = this.gameObject.worldPosition;
        const boundsSize = this.gameObject.worldScale;

        Gizmos.DrawWireBox(boundsCenter, boundsSize, 0xff3377);

        const halfSize = boundsSize.multiplyScalar(0.5);

        for (const dragControl of dragging) {
            const obj = dragControl.draggedObject;
            if (obj) {
                // Clamp position within bounds
                const pos = obj.worldPosition;
                const minX = boundsCenter.x - halfSize.x;
                const maxX = boundsCenter.x + halfSize.x;
                const minY = boundsCenter.y - halfSize.y;
                const maxY = boundsCenter.y + halfSize.y;
                const minZ = boundsCenter.z - halfSize.z;
                const maxZ = boundsCenter.z + halfSize.z;
                pos.x = Math.max(minX, Math.min(maxX, pos.x));
                pos.y = Math.max(minY, Math.min(maxY, pos.y));
                pos.z = Math.max(minZ, Math.min(maxZ, pos.z));
                obj.worldPosition = pos;
            }
        }
    }
}
```

**How to use:**
1. Create an empty GameObject to define the bounds area
2. Add this component to it
3. Scale the GameObject to set the bounds size
4. The component will keep all dragged objects within this box
5. A pink wireframe box visualizes the bounds

### Change Drag Target Dynamically

Useful for duplicating or switching objects mid-drag:

```ts
import { Behaviour, DragControls } from "@needle-tools/engine";

export class DragSwitcher extends Behaviour {

    switchTarget(newObject: Object3D) {
        const dragControl = this.gameObject.getComponent(DragControls);

        if (dragControl) {
            // Change what object is being dragged
            dragControl.setTargetObject(newObject);
        }
    }
}
```

### Respond to Drag Events

Detect when an object with DragControls starts or stops being dragged:

```ts
import { Behaviour, DragControls, serializable } from "@needle-tools/engine";

export class DragListener extends Behaviour {

    @serializable(DragControls)
    dragControls?: DragControls;

    private wasDragging = false;

    update() {
        if (!this.dragControls) return;

        const isDragging = this.dragControls.draggedObject !== null;

        // Just started dragging
        if (isDragging && !this.wasDragging) {
            console.log("Started dragging!");
            this.onDragStart();
        }

        // Just stopped dragging
        if (!isDragging && this.wasDragging) {
            console.log("Stopped dragging!");
            this.onDragEnd();
        }

        this.wasDragging = isDragging;
    }

    onDragStart() {
        // Play sound, change material, etc.
    }

    onDragEnd() {
        // Snap to final position, save state, etc.
    }
}
```

## Advanced Features

### Grid Snapping

Snap dragged objects to a 3D grid:
- Set **Snap Grid Resolution** to desired grid size (e.g., `0.25` for quarter-meter grid)
- Objects snap to grid points while dragging
- Perfect for building tools and placement systems

### Multiplayer Ownership

DragControls automatically integrates with `SyncedTransform`:
- Requests ownership when dragging starts
- Enables "fast mode" for responsive dragging
- Releases ownership when dragging ends
- Other users see smooth synchronized movement

### Physics Integration

When dragging objects with Rigidbody components:
- Automatically becomes kinematic during drag (no physics simulation)
- Wakes up rigidbodies and resets velocities
- Returns to physics simulation when released
- Applies velocity on release for throwing mechanics

### VR Distance Control

In VR/AR, pulling controllers toward/away from your body changes object distance:
- **XR Distance Drag Factor** controls sensitivity
- Higher values = more responsive distance changes
- Set to `0` to disable distance adjustment
- Works naturally with hand/controller movement

## Common Questions

**How do I make only specific objects draggable?**  
Add DragControls only to objects you want to be draggable. Objects without the component can't be dragged.

**Can I drag objects in VR without seeing controllers?**  
Yes! DragControls works with XR hand tracking and controller-free input. Just enable XR support.

**Why does my object jump when I start dragging?**  
This can happen if the drag plane is incorrectly positioned. Try changing the **Drag Mode** or ensure the object has proper colliders.

**How do I prevent objects from dragging through walls?**  
Use **Snap To Surfaces** drag mode and ensure your walls have colliders. The object will stick to surfaces.

**Can I drag multiple objects at once?**  
Each DragControls handles one object, but you can have multiple dragging simultaneously (useful for multi-touch or VR with both hands).

**How do I disable dragging temporarily?**  
Set **Drag Mode** to `None` or disable the DragControls component.

**Does it work with networking in production?**  
Yes! DragControls is designed for multiplayer. Combine with `SyncedRoom` and `SyncedTransform` for collaborative experiences.

## Debugging

Enable debug mode by adding `?debugdrag` to your URL:

```
http://localhost:3000?debugdrag
```

This shows:
- Visual helpers for drag planes and normals
- Attachment points and hit positions
- Movement distances and device info
- Bounding box snap points

## More Information

**Live Example:**
- [Collaborative Sandbox](https://engine.needle.tools/samples/collaborative-sandbox/) - Multi-user dragging and placement

**API Documentation:**
- [DragControls API](https://engine.needle.tools/docs/api/DragControls) - Complete technical reference

**Related Components:**
- [SyncedTransform](/docs/reference/components#syncedtransform) - Network synchronization for dragged objects
- [Duplicatable](/docs/reference/components#duplicatable) - Duplicate objects while dragging
- [Deletable](/docs/reference/components#deletable) - Delete dragged objects
Source: https://engine.needle.tools/docs/how-to-guides/components/drag-controls.html

---
title: Drag and Drop Files into Your Scene
description: Allow users to drag and drop 3D models (glTF, GLB, FBX, OBJ, USDZ, VRM) directly into your web experience with the DropListener component. Works in Unity and Blender.
---

# Drag and Drop Files into Your Scene

Let users drag and drop 3D models directly into your web experience.

<video-embed src="/docs/videos/droplistener.mp4" autoplay muted />

:::tip Works with Unity and Blender
The DropListener component is available for both Unity and Blender integrations.
:::

## What You Can Do

- **Drag Files** - Users drag glTF, GLB, FBX, OBJ, USDZ, or VRM files into the browser
- **Paste URLs** - Users paste links to 3D models
- **Auto-Place** - Dropped objects appear where users drop them
- **Auto-Scale** - Make all dropped objects fit a consistent size
- **Multiplayer** - Share dropped files with other connected users
- **Drop Zones** - Only allow drops in specific areas

## Quick Start

### Basic Setup

**In Unity or Blender:**
1. Add a `DropListener` component to an object in your scene
2. Export and open in browser
3. Drag a 3D model file into the browser window

The model appears in your scene!

### With Multiplayer

To share dropped files with other users:

1. Add a `SyncedRoom` component to your scene
2. Enable **Use Networking** on the DropListener
3. When someone drops a file, everyone sees it

## Settings

| Setting | What it does |
| --- | --- |
| **Drop Area** | Only accept drops on this specific mesh (leave empty for anywhere) |
| **Fit Into Volume** | Automatically resize dropped objects to fit a size |
| **Fit Volume Size** | The size to fit objects into (like `2√ó2√ó2`) |
| **Place At Hit Position** | Drop objects where the cursor hits, or at a fixed spot |
| **Use Networking** | Share dropped files with other users |

## Examples

### Product Viewer

Replace the current product when users drop a new model:

1. Add your initial product as a child of the DropListener object
2. When users drop a file, it replaces the current product
3. Enable **Fit Into Volume** so all products appear at the same size

Perfect for furniture configurators, product showcases, or avatar try-ons.

### Designated Drop Zone

Only allow drops on a specific surface (like a table or platform):

1. Create a mesh object (cube, plane, etc.)
2. Add the DropListener to a different object
3. Assign the mesh to **Drop Area**
4. Files only work when dropped on that mesh

:::tip Needs a Mesh
The Drop Area must have visible geometry for drag and drop detection to work.
:::

### Multiple Drop Zones

<video-embed src="/docs/videos/droplistener-multiple.mp4" autoplay muted />

Create multiple independent drop zones, each with its own drop area:

**How it works:**
1. Create two cylinders (or any meshes) as separate drop areas
2. Create two DropListener components (can be on separate empty objects)
3. Assign the left cylinder to DropListener 1's **Drop Area** field
4. Assign the right cylinder to DropListener 2's **Drop Area** field
5. Each DropListener only responds to drops on its assigned cylinder

**In the video above:**
- Left cylinder: Drop area for DropListener 1 (displays the helmet)
- Right cylinder: Drop area for DropListener 2 (displays the camera)
- Each has its own independent drop zone

**Why this is useful:**
- Compare different models side-by-side
- Collaborative review tool - team members drop their designs to compare
- Create before/after comparisons
- Build product comparison tools
- Each drop zone can have different settings (fit size, placement, etc.)
- Multiple independent display areas

**Example Setup:**
- DropListener 1: Assigned to left cylinder, fits to volume 1√ó2√ó1
- DropListener 2: Assigned to right cylinder, fits to volume 2√ó2√ó2
- Drop different files on each cylinder to compare them side-by-side

Each cylinder acts as a completely independent drop zone with its own content.

### Collaborative Scene Builder

Let multiple users add objects to a shared scene:

1. Add `SyncedRoom` to your scene
2. Enable **Use Networking** on DropListener
3. Disable **Fit Into Volume** if you want original sizes
4. Users can drag files and everyone sees them appear

## Scripting

### React to Drops

Run code when someone drops a file:

```ts
import { Behaviour, DropListener, DropListenerEvents } from "@needle-tools/engine";

export class MyComponent extends Behaviour {

    awake() {
        const dropListener = this.gameObject.getComponent(DropListener);

        // When a file is dropped
        dropListener.addEventListener(DropListenerEvents.FileDropped, (evt) => {
            const file = evt.detail as File;
            console.log("User dropped:", file.name);
        });

        // When an object is added to the scene
        dropListener.addEventListener(DropListenerEvents.ObjectAdded, (evt) => {
            const object = evt.detail.object;
            console.log("New object in scene:", object.name);

            // You can modify the object here
            // For example, add a glow effect or play a sound
        });
    }
}
```

### Load from Code

Load a model without user interaction:

```ts
import { Behaviour, DropListener } from "@needle-tools/engine";

export class ModelLoader extends Behaviour {

    async start() {
        const dropListener = this.gameObject.getComponent(DropListener);

        // Load from URL
        const url = "https://example.com/model.glb";
        const object = await dropListener.loadFromURL(url);

        if (object) {
            console.log("Loaded:", object.name);
        }
    }
}
```

## Special Features

### Smart URL Handling

DropListener automatically handles special URLs:

- **GitHub files** - Paste GitHub URLs and they're converted to raw content
- **Polyhaven models** - Paste Polyhaven asset pages and get the 3D model

### Placeholder Behavior

Child objects under the DropListener are treated as placeholders:
- They stay visible until the first drop
- They're automatically removed when a file is dropped
- Perfect for "Drop model here" preview objects

## Common Questions

**Can users drop multiple files?**
Currently one file at a time. If multiple files are dropped, only the first 3D model is loaded.

**What about images?**
Images are automatically ignored. The DropListener only accepts 3D model formats.

**How does multiplayer work?**
When enabled, dropped files are uploaded to Needle's server and the URL is shared with other users. They download and see the same object.

**Does it work offline?**
Yes for local file drops. URL pasting and multiplayer require internet connection.

## More Information

**Live Example:**
- [DropListener Sample](https://engine.needle.tools/samples/droplistener) - Try it yourself with multiplayer

**API Documentation:**
- [DropListener API](https://engine.needle.tools/docs/api/DropListener) - Complete technical reference

**Related Guides:**
- [Networking & Multiplayer](/docs/how-to-guides/networking/) - Set up multiplayer features
- [Loading Scenes](/docs/how-to-guides/scripting/index#loading-scenes) - Load content dynamically
Source: https://engine.needle.tools/docs/how-to-guides/components/droplistener.html

---
title: Duplicate Objects by Dragging (Duplicatable)
description: Let users create copies of objects by dragging them with the Duplicatable component. Works in Unity and Blender with multiplayer support.
---

# Duplicate Objects by Dragging

Create interactive experiences where users can spawn copies of objects by clicking and dragging.

<video-embed src="/docs/videos/duplicatable.mp4" autoplay muted />

:::tip Works with Unity and Blender
The Duplicatable component is available for both Unity and Blender integrations.
:::

## What You Can Do

- **Drag to Duplicate** - Users click and drag to create a copy that follows their cursor
- **Automatic Networking** - Duplicated objects sync across all connected users
- **Rate Limiting** - Prevent spam by limiting how many objects can be created
- **Custom Templates** - Define what object gets duplicated
- **Works with DragControls** - Automatically integrates with object dragging

Perfect for:
- Object placement tools
- Building and construction games
- Collaborative design spaces
- Inventory systems where items spawn
- Furniture configurators

## Quick Start

### Basic Setup

**In Unity or Blender:**
1. Create an object you want to duplicate (e.g., a cube)
2. Add a `Duplicatable` component to it
3. The component automatically sets up the object as a template
4. Export and open in browser
5. Click and drag the object - a copy spawns and follows your cursor!

### With Multiplayer

Share duplicated objects with other users:

1. Add `SyncedRoom` component to your scene
2. The Duplicatable component automatically adds networking
3. When users click and create objects, everyone sees them

## Settings

| Setting | What it does |
| --- | --- |
| **Object** | The object to duplicate (leave empty to duplicate this object) |
| **Parent** | Where duplicates are parented (leave empty to use this object's parent) |
| **Limit Count** | Max objects that can be created per 60 seconds (prevents spam) |

## How It Works

When you add Duplicatable to an object:

1. The component creates a hidden template copy
2. When you click and drag, a new instance spawns from the template
3. The new object follows your cursor as you drag
4. If networking is enabled, the object syncs to other users
5. The template stays hidden and ready for the next duplication

## Examples

### Furniture Spawner

Create a palette of furniture users can place:

1. Create furniture objects (chair, table, lamp)
2. Add `Duplicatable` to each one
3. Arrange them in a palette/toolbar area
4. Set **Limit Count** to `10` to prevent spam
5. Users click and drag to create and place furniture

### Building Blocks

Let users build with blocks:

1. Create a block object
2. Add `Duplicatable` component
3. Add `DragControls` (automatically configured)
4. Set drag mode to snap to grid
5. Users click and drag to create blocks and build structures

### Inventory System

Spawn items from an inventory:

1. Create item templates (tools, equipment, etc.)
2. Add `Duplicatable` to each
3. Set **Parent** to a "world items" container
4. Display items in UI or palette
5. Click items to spawn them into the scene

### Collaborative Object Spawning

Multiple users adding objects together:

1. Add `SyncedRoom` component
2. Create object templates with `Duplicatable`
3. Each template automatically gets `SyncedTransform`
4. Users spawn and place objects collaboratively
5. Everyone sees the same scene in real-time

## Scripting

### Duplicate Programmatically

Trigger duplication from code without user click:

```ts
import { Behaviour, Duplicatable, GameObject } from "@needle-tools/engine";

export class ObjectSpawner extends Behaviour {

    start() {
        const duplicatable = this.gameObject.getComponent(Duplicatable);

        if (duplicatable && duplicatable["handleDuplication"]) {
            // Spawn a copy
            const newObject = duplicatable["handleDuplication"]();

            if (newObject) {
                console.log("Spawned:", newObject.name);

                // Customize the spawned object
                newObject.position.set(0, 1, 0);
            }
        }
    }
}
```

:::warning Private Method
The `handleDuplication` method is private. The recommended way is to let users click the object naturally. Use this approach only for advanced cases.
:::

### Custom Duplication Logic

Create your own duplication system:

```ts
import { Behaviour, GameObject, serializable } from "@needle-tools/engine";
import { Object3D } from "three";

export class CustomDuplicator extends Behaviour {

    @serializable(Object3D)
    template?: Object3D;

    onPointerClick() {
        if (!this.template) return;

        // Clone the template
        const clone = GameObject.instantiateSynced(this.template, {
            parent: this.gameObject,
            position: this.worldPosition,
        });

        if (clone) {
            console.log("Created custom duplicate:", clone.name);
        }
    }
}
```

### Check Duplicate Count

Monitor how many objects have been created:

```ts
import { Behaviour, Duplicatable } from "@needle-tools/engine";

export class DuplicateMonitor extends Behaviour {

    update() {
        const duplicatable = this.gameObject.getComponent(Duplicatable);

        if (duplicatable) {
            // Access internal counter (private, for debugging)
            const count = duplicatable["_currentCount"];
            const limit = duplicatable.limitCount;

            console.log(`Created: ${count}/${limit}`);
        }
    }
}
```

### Customize Spawned Objects

Modify objects right after they're created:

```ts
import { Behaviour, Duplicatable } from "@needle-tools/engine";

export class CustomizeSpawned extends Behaviour {

    private duplicatable?: Duplicatable;

    awake() {
        this.duplicatable = this.gameObject.getComponent(Duplicatable);
    }

    update() {
        // Watch for DragControls being created on new objects
        // This happens right after duplication
        // You can then customize the newly spawned object
    }
}
```

## Advanced Features

### Automatic DragControls

When Duplicatable creates an object:
- Automatically adds `DragControls` if not present
- Sets drag mode to `SnapToSurfaces` by default
- User can immediately drag the new object
- No additional setup needed

### Automatic Networking

When `SyncedRoom` is present:
- Uses `GameObject.instantiateSynced()` automatically
- Adds `SyncedTransform` to spawned objects
- All users see duplicated objects
- Position and rotation sync in real-time

### Rate Limiting

Prevents users from creating too many objects:
- **Limit Count** controls max objects per minute
- Counter decrements by 1 every second
- When limit is reached, clicks are ignored
- Warning logged to console
- Automatically resets over time

### Template System

The object to duplicate becomes a hidden template:
- Original object is hidden (`visible = false`)
- Template preserves initial position and rotation
- Each click spawns from the template
- Template never appears in the scene

## Common Questions

**What happens to the original object?**
The original becomes a hidden template. The first duplicate you see is actually a copy, not the original.

**Can I duplicate objects without DragControls?**
The component expects DragControls and adds it automatically. If you don't want dragging, disable DragControls on the spawned object via script.

**How do I change what object gets duplicated?**
Set the **Object** field to a different object. If left empty, the object with the Duplicatable component is used.

**Can I duplicate objects with animations or scripts?**
Yes! The entire hierarchy and all components are copied. Scripts, animations, materials - everything is duplicated.

**What's the difference between Duplicatable and instantiate?**
Duplicatable is for user interaction (clicking to spawn). `GameObject.instantiate()` is for programmatic spawning in code.

**How do I increase the spawn limit?**
Change **Limit Count** to a higher number. Default is 60 objects per minute. Set to 0 for unlimited (not recommended).

**Does it work with physics?**
Yes! Duplicated objects keep their Rigidbody components and physics properties.

## Common Issues

**Objects spawn at wrong position:**
Make sure the template object starts at the correct position. The Duplicatable stores the initial position when the scene loads.

**Can't create any objects:**
Check if you've hit the **Limit Count**. Wait a few seconds and try again, or increase the limit.

**Objects don't appear for other users:**
Ensure you have `SyncedRoom` in your scene for networking to work.

**Duplicated object is missing components:**
Check if components are being destroyed in `start()` or `awake()`. Some components remove themselves on instantiation.

## More Information

**Live Example:**
- [Collaborative Sandbox](https://engine.needle.tools/samples/collaborative-sandbox/) - Multi-user building with duplication and dragging

**API Documentation:**
- [Duplicatable API](https://engine.needle.tools/docs/api/Duplicatable) - Complete technical reference

**Related Components:**
- [DragControls](/docs/how-to-guides/components/drag-controls) - Drag and move objects
- [Deletable](/docs/reference/components#deletable) - Delete spawned objects
- [SyncedTransform](/docs/reference/components#syncedtransform) - Network synchronization
Source: https://engine.needle.tools/docs/how-to-guides/components/duplicatable.html

---
title: Camera Controls (OrbitControls)
description: The core camera controller for interactive 3D experiences. Rotate, pan, and zoom around your scene with mouse, touch, and keyboard. Works in Unity and Blender.
---

# Camera Controls (OrbitControls)

The primary camera controller for navigating and exploring 3D scenes with intuitive mouse, touch, and keyboard controls.

<video-embed src="/docs/videos/orbitcontrols-1.mp4" autoplay muted />

:::tip Works with Unity and Blender
The OrbitControls component is available for both Unity and Blender integrations.
:::

## What You Can Do

- **Rotate** - Orbit around objects by dragging
- **Pan** - Move the camera side-to-side (right-click drag or two-finger touch)
- **Zoom** - Scroll to zoom in/out
- **Auto-Rotate** - Automatically rotate the camera around the scene
- **Auto-Fit** - Automatically frame the entire scene
- **Focus on Click** - Double-click objects to focus on them
- **Smooth Animations** - Animate camera movements programmatically

Perfect for:
- Product showcases and configurators
- Architectural visualizations
- Interactive 3D models
- Any scene requiring camera control
- All Needle Engine projects (it's the default!)

## Quick Start

### Default Behavior

OrbitControls is typically added automatically to your camera in Unity or Blender. Just export and you're ready to go!

**Controls:**
- **Left-click drag** - Rotate around the scene
- **Right-click drag** or **Two-finger touch** - Pan the camera
- **Mouse wheel** or **Pinch** - Zoom in/out
- **Double-click** - Focus on the clicked object

### Adding Manually

**In Unity or Blender:**
1. Select your camera object
2. Add the `OrbitControls` component
3. Export - camera controls are now active!

## Core Features

### Auto-Rotate

<video-embed src="/docs/videos/orbitcontrols-autorotate.mp4" autoplay muted />

Automatically rotate the camera for presentations:

**In Editor:**
1. Enable **Auto Rotate** on the OrbitControls component
2. Set **Auto Rotate Speed** (default is `1.0`)
3. The camera rotates automatically - any user interaction stops it

**From Code:**
```ts
import { Behaviour, OrbitControls } from "@needle-tools/engine";

export class AutoRotateExample extends Behaviour {
    start() {
        const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);
        if (orbit) {
            orbit.autoRotate = true;
            orbit.autoRotateSpeed = 2.0; // Rotate twice as fast
        }
    }
}
```

### Auto-Fit to Scene

<video-embed src="/docs/videos/orbitcontrols-autofit.mp4" autoplay muted />

Automatically frame the entire scene when it loads or when users click the background:

**In Editor:**
- Enable **Auto Fit** - Camera frames all objects on start
- Set **Click Background To Fit Scene** - Number of clicks on background to re-fit (default: `2`)

Users can double-click the background at any time to re-fit the camera to the entire scene.

**From Code:**
```ts
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);
orbit?.fitCamera(); // Fit entire scene
```

### Focus on Objects

Users can double-click objects to focus the camera on them. Configure this behavior:

| Setting | What it does | Default |
| --- | --- | --- |
| **Double Click To Focus** | Focus on object when double-clicked | `true` |
| **Middle Click To Focus** | Focus on object when middle-clicked | `true` |
| **Click Background To Fit Scene** | Number of clicks on background to fit entire scene | `2` |

## Settings

### Rotation Controls

| Setting | What it does | Default |
| --- | --- | --- |
| **Enable Rotate** | Allow camera rotation | `true` |
| **Auto Rotate** | Automatically rotate camera | `false` |
| **Auto Rotate Speed** | Rotation speed when auto-rotating | `1.0` |
| **Min Azimuth Angle** | Minimum horizontal rotation (radians) | `Infinity` (no limit) |
| **Max Azimuth Angle** | Maximum horizontal rotation (radians) | `Infinity` (no limit) |
| **Min Polar Angle** | Minimum vertical rotation (radians) | `0` |
| **Max Polar Angle** | Maximum vertical rotation (radians) | `Math.PI` |

### Zoom Controls

| Setting | What it does | Default |
| --- | --- | --- |
| **Enable Zoom** | Allow zooming | `true` |
| **Zoom Speed** | How fast zooming happens | `1` |
| **Zoom To Cursor** | Zoom toward cursor position instead of center | `false` |
| **Min Zoom** | Minimum zoom distance | `0` |
| **Max Zoom** | Maximum zoom distance | `Infinity` |

### Pan Controls

| Setting | What it does | Default |
| --- | --- | --- |
| **Enable Pan** | Allow panning | `true` |

### Movement Feel

| Setting | What it does | Default |
| --- | --- | --- |
| **Enable Damping** | Smooth, inertial movement | `true` |
| **Damping Factor** | How much damping (lower = more smooth) | `0.1` |
| **Enable Keys** | Allow keyboard controls | `false` |

### Behavior

| Setting | What it does | Default |
| --- | --- | --- |
| **Auto Target** | Automatically find focus point | `true` |
| **Auto Fit** | Fit scene to view on start | `false` |
| **Allow Interrupt** | User input stops animations | `true` |
| **Target Lerp Duration** | Animation duration in seconds | `1` |

## Examples

### Product Viewer

Create a product showcase that auto-rotates until touched:

```ts
import { Behaviour, OrbitControls } from "@needle-tools/engine";

export class ProductViewer extends Behaviour {

    start() {
        const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

        if (orbit) {
            // Auto-rotate the product
            orbit.autoRotate = true;
            orbit.autoRotateSpeed = 0.5;

            // Fit the product in view
            orbit.fitCamera();

            // Stop rotation when user interacts
            orbit.onStartInteraction(() => {
                orbit.autoRotate = false;
            });
        }
    }
}
```

### Restrict Camera Movement

Limit rotation to prevent users from seeing under/behind objects:

```ts
import { Mathf, OrbitControls } from "@needle-tools/engine";

// In your component
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

if (orbit) {
    // Prevent looking directly up or down
    orbit.minPolarAngle = Mathf.toRadians(30);  // 30 degrees from top
    orbit.maxPolarAngle = Mathf.toRadians(80);  // 80 degrees from top

    // Limit horizontal rotation
    orbit.minAzimuthAngle = Mathf.toRadians(-45);  // -45 degrees
    orbit.maxAzimuthAngle = Mathf.toRadians(45);   // +45 degrees
}
```

### Animate Camera to Position

<video-embed src="/docs/videos/orbitcontrols-setcamera-and-looktarget.mp4" autoplay muted />

Smoothly move camera to look at a specific object:

```ts
import { Behaviour, OrbitControls, serializable } from "@needle-tools/engine";
import { Object3D } from "three";

export class FocusObject extends Behaviour {

    @serializable(Object3D)
    targetObject?: Object3D;

    focusOnTarget() {
        const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

        if (orbit && this.targetObject) {
            // Animate camera to look at the target
            orbit.setCameraAndLookTarget(this.targetObject);

            // Or set positions separately:
            // orbit.setLookTargetPosition(this.targetObject.worldPosition);
            // orbit.setCameraTargetPosition(cameraPosition);
        }
    }
}
```

### Fit Specific Objects

Frame specific objects instead of the whole scene:

```ts
import { Behaviour, OrbitControls } from "@needle-tools/engine";
import { Object3D } from "three";

export class FitObjects extends Behaviour {

    fitToObjects(objects: Object3D[]) {
        const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

        if (orbit) {
            orbit.fitCamera({
                objects: objects,
                immediate: false, // Animate to the new view
            });
        }
    }
}
```

### Keyboard Controls

Enable keyboard navigation:

```ts
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

if (orbit) {
    orbit.enableKeys = true;

    // Users can now use:
    // Arrow keys - Pan camera
    // Default three.js orbit controls keys are used
}
```

## Scripting API

### Camera Movement

```ts
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

// Rotate the camera
orbit.rotateLeft(0.1);  // Rotate left in radians
orbit.rotateUp(-0.1);   // Rotate down in radians

// Pan the camera
orbit.pan(10, 0);  // Pan 10 pixels right

// Zoom
orbit.zoomIn(0.1);   // Zoom in 10%
orbit.zoomIn(-0.1);  // Zoom out 10%
```

### Camera Animations

```ts
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

// Animate camera position
orbit.setCameraTargetPosition(newPosition, 2.0); // 2 second duration

// Animate look target
orbit.setLookTargetPosition(targetPosition, 1.5); // 1.5 second duration

// Set immediately (no animation)
orbit.setCameraTargetPosition(newPosition, true);

// Stop ongoing animations
orbit.stopCameraLerp();
orbit.stopLookTargetLerp();

// Check if animating
if (orbit.cameraLerpActive) {
    console.log("Camera is moving...");
}
```

### Field of View

```ts
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

// Animate FOV change
orbit.setFieldOfView(60, 1.0); // Change to 60¬∞ over 1 second

// Set immediately
orbit.setFieldOfView(45, true);
```

### Fitting Camera

```ts
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

// Fit entire scene
orbit.fitCamera();

// Fit specific objects
orbit.fitCamera({
    objects: [object1, object2],
    immediate: false,  // Animate to view
});

// Advanced options
orbit.fitCamera({
    objects: myObjects,
    immediate: false,
    centerCamera: "y",  // Only center on Y axis
    fov: 50,            // Set field of view
});
```

### Access Three.js Controls

```ts
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

// Access underlying three.js OrbitControls
const threeControls = orbit.controls;

if (threeControls) {
    // Direct access to three.js properties
    console.log("Distance:", threeControls.getDistance());
    console.log("Azimuth:", threeControls.getAzimuthalAngle());
    console.log("Polar:", threeControls.getPolarAngle());

    // Access the camera being controlled
    console.log("Camera:", orbit.controllerObject);
}
```

### Events

```ts
import { OrbitControls, OrbitControlsEventsType } from "@needle-tools/engine";

const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

// Listen for user interaction
orbit.onStartInteraction(() => {
    console.log("User started interacting with camera");
});

// Listen for camera target reached
orbit.addEventListener(OrbitControlsEventsType.CameraTargetReached, (evt) => {
    console.log("Camera reached target:", evt.detail.type);
    // evt.detail.type is either "camera" or "lookat"
});
```

## Advanced Features

### Look At Constraints

Make the camera always look at a specific object:

**In Editor:**
1. Create a `LookAtConstraint` component
2. Assign the target object to the constraint
3. Assign the constraint to **Look At Constraint** on OrbitControls

The camera will always look at the constrained object while users control it.

### Target Bounds

Restrict where users can pan the camera:

**In Editor:**
1. Create an empty object to define the bounds
2. Scale it to the desired size
3. Assign it to **Target Bounds** on OrbitControls

Users can only pan within this defined volume.

### Custom Dom Element

Make OrbitControls listen to a different HTML element:

```ts
const orbit = this.context.mainCameraComponent?.getComponent(OrbitControls);

if (orbit) {
    orbit.targetElement = document.getElementById("my-custom-element");
}
```

## Common Questions

**How do I disable camera controls temporarily?**  
Disable the OrbitControls component: `orbit.enabled = false;`

**Can users control the camera in VR/AR?**  
OrbitControls automatically disables in XR mode. Camera control happens through the headset instead.

**Why does auto-rotate stop when I interact?**  
This is default behavior. Auto-rotation resumes only if you re-enable it via script.

**How do I prevent users from seeing under the floor?**  
Set **Min Polar Angle** and **Max Polar Angle** to limit vertical rotation.

**Can I change controls sensitivity?**  
Yes! Adjust **Damping Factor** (lower = smoother), **Zoom Speed**, and **Auto Rotate Speed**.

**How do I focus camera on an object immediately?**  
Use `orbit.setCameraAndLookTarget(targetObject, true);` - the `true` makes it instant.

**Can I use keyboard controls?**  
Enable **Enable Keys** to allow arrow key navigation.

## Performance Tips

**Damping:**
Damping creates smooth motion but requires updates every frame. For static presentations, you can disable it once camera settles.

**Auto-Rotate:**
Auto-rotation updates every frame. Disable when not needed to save performance.

**Manual Updates:**
For very static scenes, consider handling camera control yourself and disabling OrbitControls entirely.

## Debugging

Enable debug mode by adding `?debugorbit` to your URL:

```
http://localhost:3000?debugorbit
```

This shows:
- Camera look target as a green sphere
- Raycast hit points
- Detailed logging of camera operations

**Other debug parameters:**
- `?freecam` - Unlock all camera restrictions
- `?smoothcam` or `?smoothcam=0.95` - Override damping factor
- `?debugcamerafit` - Log camera fitting operations

## More Information

**API Documentation:**
- [OrbitControls API](https://engine.needle.tools/docs/api/OrbitControls) - Complete technical reference
- [three.js OrbitControls](https://threejs.org/docs/#examples/en/controls/OrbitControls) - Underlying three.js implementation

**Related Components:**
- [Camera](/docs/reference/components#camera) - Camera component settings
- [LookAtConstraint](/docs/reference/components#lookatconstraint) - Constrain camera look target
Source: https://engine.needle.tools/docs/how-to-guides/components/orbit-controls.html

---
title: Switch Between Scenes (SceneSwitcher)
description: Dynamically load and switch between multiple 3D scenes with the SceneSwitcher component. Perfect for galleries, portfolios, and multi-scene experiences. Works in Unity and Blender.
---

# Switch Between Scenes

Dynamically load and switch between fully interactive glTF content - complete scenes or individual assets - with smooth transitions and preloading.

<video-embed src="/docs/videos/sceneswitcher.mp4" autoplay muted />

:::tip Works with Unity and Blender
The SceneSwitcher component is available for both Unity and Blender integrations.
:::

:::tip Needle Engine's Superpower: Interactive glTF/glb Files
A key feature of Needle Engine is that **glTF/glb files are fully interactive**. When you export from Unity or Blender, your scenes include not just 3D models, but all components, scripts, physics, animations, and custom logic. SceneSwitcher loads these complete, self-contained interactive experiences - not just static geometry!
:::

## What You Can Do

- **Load Fully Interactive Scenes** - Each scene is a complete Unity/Blender export with all its components, scripts, physics, animations, and interactivity
- **Self-Contained Experiences** - Loaded scenes bring their own logic (DragControls, particle systems, custom scripts, etc.)
- **Multiple Scenes** - Switch between different 3D environments
- **Multiple SceneSwitchers** - Have several independent SceneSwitchers in one scene, each managing different content
- **Keyboard Navigation** - Use arrow keys, A/D, or number keys to switch scenes
- **Swipe on Mobile** - Swipe left/right to navigate between scenes
- **Preloading** - Automatically preload nearby scenes for instant switching
- **Loading Scenes** - Optional loading screen while switching
- **Browser History** - Back/forward buttons work with scene changes
- **Custom Transitions** - Control scene open/close behavior with code

Perfect for:
- Portfolio and gallery websites
- Product showcases with multiple variations
- Multi-level experiences
- Interactive storytelling
- Virtual museums and exhibitions

## Quick Start

### Basic Setup

**In Unity or Blender:**
1. Create an empty GameObject
2. Add the `SceneSwitcher` component
3. Add your scene files to the **Scenes** array
4. Export and view - first scene loads automatically!

**Controls:**
- **Arrow Keys** or **A/D** - Switch scenes
- **Number Keys (1, 2, 3...)** - Jump to specific scene
- **Swipe** (mobile) - Swipe left/right to navigate

### Three Different Scenes

The video above shows three distinct scenes:
1. **Cylinder Garden** (Scene 1) - Decorative plants on cylinders
2. **Gold & Fog** (Scene 2) - Golden spheres in misty atmosphere
3. **Lightmapping** (Scene 3) - Statue with colored lighting

Users can navigate between them seamlessly using Previous/Next buttons or keyboard controls.

## Scene Organization Patterns

SceneSwitcher is incredibly flexible - you can organize your scenes in different ways depending on your needs:

### Pattern 1: Replace Entire Scene Content

For completely different environments (like the video above), use a minimal root scene:

**Root Scene (main.glb):**
- Camera
- Lights (optional - scenes can provide their own)
- SceneSwitcher component
- UI elements (optional - Previous/Next buttons)

**Individual Scenes:**
- scene1.glb - Complete environment with all objects
- scene2.glb - Complete environment with all objects
- scene3.glb - Complete environment with all objects

This pattern is perfect for:
- Portfolio galleries where each scene is completely different
- Virtual museums with distinct exhibition rooms
- Product showcases with entirely different setups

**See it in action:**
- [Multi-Scene Sample](https://engine.needle.tools/samples/multi-scene-example) - Live example with source code

### Pattern 2: Replace Parts of the Scene

<video-embed src="/docs/videos/sceneswitcher-loading-interactive-scenes.mp4" autoplay muted />

For partial content switching, keep persistent elements in the root scene and load interactive files:

**Root Scene:**
- Camera with OrbitControls
- Lighting setup (stays consistent)
- Ground plane or environment
- UI and navigation
- SceneSwitcher component

**Individual Scenes (exported from Unity or Blender):**
- Each scene is a full glTF export with all its components
- Loaded scenes bring their own scripts (DragControls, particle systems, etc.)
- Scenes can have animations, physics, UI, and custom logic
- Completely self-contained interactive experiences

This pattern is perfect for:
- Product configurators where environment stays the same
- Loading interactive demos or mini-games
- Character customization with persistent background
- Swapping focal content while keeping context
- Portfolio of interactive 3D experiences

**See it in action:**
- [Interactive Content Demo](https://sceneswitcher-interactive-content-zubcksz2mtep1.needle.run/) - Live example loading interactive scenes

### Pattern 3: Multiple SceneSwitchers (Very Powerful!)

<video-embed src="/docs/videos/sceneswitcher-multiple.mp4" autoplay muted />

You can have **multiple SceneSwitcher components** in the same scene, each managing different parts:

**Example: Showroom with Multiple Products**

```
Root Scene:
‚îú‚îÄ‚îÄ Camera
‚îú‚îÄ‚îÄ Showroom Environment (persistent)
‚îú‚îÄ‚îÄ ProductDisplay1 (with SceneSwitcher)
‚îÇ   ‚îú‚îÄ‚îÄ Switches between: chair1.glb, chair2.glb, chair3.glb
‚îú‚îÄ‚îÄ ProductDisplay2 (with SceneSwitcher)
‚îÇ   ‚îú‚îÄ‚îÄ Switches between: lamp1.glb, lamp2.glb, lamp3.glb
‚îî‚îÄ‚îÄ ProductDisplay3 (with SceneSwitcher)
    ‚îú‚îÄ‚îÄ Switches between: table1.glb, table2.glb, table3.glb
```

Each SceneSwitcher:
- Operates independently
- Has its own scene array
- Can use different navigation (one via UI, another via keyboard)
- Loads/unloads only its own content

This pattern is perfect for:
- Showrooms with multiple independent product displays
- Comparison tools (left side vs right side)
- Multi-panel presentations
- Complex configurators with multiple customization areas

**Example Code for Multiple Switchers:**

```ts
import { Behaviour, SceneSwitcher } from "@needle-tools/engine";

export class MultiSwitcherController extends Behaviour {

    start() {
        // Get all SceneSwitchers in the scene
        const switchers = this.gameObject.getComponentsInChildren(SceneSwitcher);

        console.log(`Found ${switchers.length} scene switchers`);

        // Control them independently
        if (switchers[0]) switchers[0].select(0); // First display: scene 0
        if (switchers[1]) switchers[1].select(1); // Second display: scene 1
        if (switchers[2]) switchers[2].select(2); // Third display: scene 2
    }
}
```

:::tip Multiple SceneSwitchers Power
Having multiple SceneSwitchers is what makes Needle Engine's scene management incredibly powerful and flexible. You're not limited to switching entire environments - you can switch specific parts independently!
:::

## Settings

### Basic Settings

| Setting | What it does | Default |
| --- | --- | --- |
| **Scenes** | Array of scene files to switch between | `[]` |
| **Auto Load First Scene** | Load first scene automatically on start | `true` |
| **Loading Scene** | Optional scene to display while loading | `undefined` |

### Navigation Settings

| Setting | What it does | Default |
| --- | --- | --- |
| **Use Keyboard** | Enable keyboard shortcuts (arrows, A/D, numbers) | `true` |
| **Use Swipe** | Enable swipe navigation on mobile | `true` |
| **Clamp** | Stop at first/last scene (or loop around) | `true` |

### URL & History

| Setting | What it does | Default |
| --- | --- | --- |
| **Query Parameter Name** | URL parameter for current scene (e.g., `?scene=1`) | `"scene"` |
| **Use Scene Name** | Use scene name in URL instead of index | `true` |
| **Use History** | Add scene changes to browser history | `true` |

### Scene Settings

| Setting | What it does | Default |
| --- | --- | --- |
| **Use Scene Lighting** | Apply lighting from loaded scene | `true` |
| **Use Scene Background** | Apply skybox from loaded scene | `true` |

### Preloading

| Setting | What it does | Default |
| --- | --- | --- |
| **Preload Next** | How many scenes ahead to preload | `1` |
| **Preload Previous** | How many scenes behind to preload | `1` |
| **Preload Concurrent** | Max concurrent downloads | `2` |

### UI

| Setting | What it does | Default |
| --- | --- | --- |
| **Create Menu Buttons** | Add Previous/Next to Needle menu | `false` |

## Examples

### Simple Gallery

Create a 3-scene portfolio:

**In Editor:**
1. Add `SceneSwitcher` component
2. Add 3 scenes to the **Scenes** array:
   - Scene1.glb
   - Scene2.glb
   - Scene3.glb
3. Enable **Clamp** to stop at first/last scene
4. Users navigate with arrows or swipe

### Infinite Loop Gallery

Let users loop through scenes endlessly:

**In Editor:**
1. Add scenes to SceneSwitcher
2. Disable **Clamp**
3. After the last scene, pressing "next" returns to first scene
4. Great for continuous presentations

### Product Configurator

Show different product variations:

```ts
import { Behaviour, SceneSwitcher, serializable } from "@needle-tools/engine";

export class ProductConfigurator extends Behaviour {

    @serializable(SceneSwitcher)
    sceneSwitcher?: SceneSwitcher;

    start() {
        // Add product variations dynamically
        this.sceneSwitcher?.addScene("products/red-variant.glb");
        this.sceneSwitcher?.addScene("products/blue-variant.glb");
        this.sceneSwitcher?.addScene("products/green-variant.glb");

        // Load the first one
        this.sceneSwitcher?.select(0);
    }

    selectColor(colorName: string) {
        // Switch to specific product by name
        this.sceneSwitcher?.select(colorName);
    }
}
```

### Custom Loading Screen

Show a loading scene while switching:

**In Editor:**
1. Create a simple loading scene (e.g., spinner, progress bar)
2. Export it as `loading.glb`
3. Assign it to **Loading Scene** on SceneSwitcher
4. The loading scene appears during transitions

## Scripting

### Switch Scenes Programmatically

```ts
import { Behaviour, SceneSwitcher } from "@needle-tools/engine";

export class SceneController extends Behaviour {

    start() {
        const switcher = this.gameObject.getComponent(SceneSwitcher);

        if (switcher) {
            // Navigate between scenes
            switcher.selectNext();  // Go to next scene
            switcher.selectPrev();  // Go to previous scene

            // Jump to specific scene by index
            switcher.select(2);  // Load scene at index 2

            // Jump to scene by name
            switcher.select("my-scene-name");

            // Get current scene info
            console.log("Current index:", switcher.currentIndex);
            console.log("Current scene:", switcher.currentlyLoadedScene?.url);
        }
    }
}
```

### Add Scenes Dynamically

```ts
const switcher = this.gameObject.getComponent(SceneSwitcher);

// Add a new scene
const newScene = switcher.addScene("path/to/scene.glb");

// Switch to it
switcher.switchScene(newScene);
```

### Listen to Scene Events

```ts
import { Behaviour, SceneSwitcher } from "@needle-tools/engine";

export class SceneMonitor extends Behaviour {

    start() {
        const switcher = this.gameObject.getComponent(SceneSwitcher);

        // When scene starts loading
        switcher.addEventListener("loadscene-start", (e) => {
            console.log("Loading scene:", e.detail.scene.url);
            console.log("Scene index:", e.detail.index);
        });

        // Loading progress
        switcher.addEventListener("progress", (e) => {
            const percent = (e.loaded / e.total) * 100;
            console.log(`Loading: ${percent.toFixed(1)}%`);
        });

        // When scene finished loading
        switcher.addEventListener("loadscene-finished", (e) => {
            console.log("Finished loading:", e.detail.scene.url);
        });

        // When scene is added and opened
        switcher.addEventListener("scene-opened", (e) => {
            console.log("Scene opened:", e.detail.scene.url);
        });
    }
}
```

### Check Loading State

```ts
const switcher = this.gameObject.getComponent(SceneSwitcher);

// Check if a scene is currently loading
if (switcher.currentlyLoadingScene) {
    console.log("Loading:", switcher.currentlyLoadingScene.url);

    // Get loading progress
    const progress = switcher.currentLoadingProgress;
    if (progress) {
        const percent = (progress.loaded / progress.total) * 100;
        console.log(`Progress: ${percent}%`);
    }
}
```

### Preload Scenes

```ts
const switcher = this.gameObject.getComponent(SceneSwitcher);

// Preload a specific scene by index
switcher.preload(2);

// Preloading happens automatically based on settings:
// - preloadNext: scenes ahead of current
// - preloadPrevious: scenes behind current
```

### Reload Current Scene

```ts
const switcher = this.gameObject.getComponent(SceneSwitcher);

// Reload the currently loaded scene
await switcher.reload();
```

### Unload Scene

```ts
const switcher = this.gameObject.getComponent(SceneSwitcher);

// Unload the current scene completely
await switcher.unload();
```

## Advanced Features

### ISceneEventListener Interface

Add custom logic when scenes open or close:

```ts
import { Behaviour, ISceneEventListener, SceneSwitcher } from "@needle-tools/engine";

// Add this to the root of your scene (the scene being loaded)
// or on the same object as the SceneSwitcher
export class MySceneTransition extends Behaviour implements ISceneEventListener {

    async sceneOpened(sceneSwitcher: SceneSwitcher) {
        console.log("My scene opened:", sceneSwitcher.currentlyLoadedScene?.url);

        // Fade in effect, play audio, etc.
        await this.fadeIn();
    }

    async sceneClosing() {
        console.log("My scene is closing");

        // Fade out, save state, etc.
        await this.fadeOut();
    }

    private async fadeIn() {
        // Your fade-in animation logic
    }

    private async fadeOut() {
        // Your fade-out animation logic
    }
}
```

### URL Parameters

SceneSwitcher syncs with URL parameters automatically:

```
https://example.com/?scene=2        // Load scene at index 2
https://example.com/?scene=gallery  // Load scene named "gallery"
```

Users can:
- **Bookmark** specific scenes
- **Share** direct links to scenes
- **Use browser back/forward** to navigate scenes

### Keyboard Shortcuts

Default keyboard controls:
- **Arrow Right / D** - Next scene
- **Arrow Left / A** - Previous scene
- **Number keys (1-9)** - Jump to scene by index (1 = first scene)

Disable with `useKeyboard = false`.

### Mobile Swipe

Swipe left/right to navigate on touch devices.

Configure threshold or disable with `useSwipe = false`.

## Common Questions

**How many scenes can I add?**  
No hard limit, but be mindful of total file size. Use preloading settings to control memory usage.

**Can scenes have different lighting?**  
Yes! Enable **Use Scene Lighting** and **Use Scene Background** to apply each scene's lighting/skybox.

**How do I prevent users from jumping scenes?**  
Set `useKeyboard = false` and `useSwipe = false`, then only provide your own UI for navigation.

**Can I load scenes from external URLs?**  
Yes! Use `addScene("https://example.com/scene.glb")` to add external scenes.

**What's the difference between Loading Scene and regular scenes?**  
The loading scene appears while other scenes load. It's optional but improves UX for large scenes.

**How does preloading work?**  
SceneSwitcher automatically downloads nearby scenes based on **Preload Next** and **Preload Previous** settings. This makes transitions instant.

**Can I use this with multiplayer?**  
Yes! Scene changes can be synced across users with custom networking code using the scene events.

## Performance Tips

**Preload Settings:**
- Set `preloadNext = 1` and `preloadPrevious = 0` for linear galleries
- Set both to `0` to disable preloading (saves memory, slower transitions)
- Increase `preloadConcurrent` for faster preloading on good connections

**Scene Size:**
- Keep scenes under 10MB for fast loading
- Use compressed textures
- Optimize geometry

**Loading Scene:**
- Keep loading scenes very small (< 1MB)
- Use simple geometry and minimal textures

**URL Parameters:**
- Set `queryParameterName = ""` to disable URL syncing if not needed

## Debugging

Enable debug mode by adding `?debugsceneswitcher` to your URL:

```
http://localhost:3000?debugsceneswitcher
```

This shows:
- Scene loading start/finish
- Progress bars in console
- Preloading schedule
- Scene add/remove operations

## More Information

**Live Example:**
- [Multi-Scene Sample](https://engine.needle.tools/samples/multi-scene-example) - Interactive demo with source code

**Real-World Examples:**
- [Needle Website](https://needle.tools) - Company website
- [Songs Of Cultures](https://app.songsofcultures.com) - Interactive cultural experience

**API Documentation:**
- [SceneSwitcher API](https://engine.needle.tools/docs/api/SceneSwitcher) - Complete technical reference
- [ISceneEventListener API](https://engine.needle.tools/docs/api/ISceneEventListener) - Scene transition interface

**Related Guides:**
- [Loading Scenes](/docs/how-to-guides/scripting/index#loading-scenes) - Load scenes programmatically
- [Asset References](/docs/how-to-guides/scripting/reference-assets) - Reference external assets
Source: https://engine.needle.tools/docs/how-to-guides/components/scene-switcher.html

---
title: Create Scroll-Based Animations (ScrollFollow)
description: Link scroll position to timelines, animations, and 3D objects to create immersive scrollytelling experiences. Works in Unity and Blender.
---

# Create Scroll-Based Animations

Drive timelines, animations, and object properties with page scroll position to create engaging narrative experiences.

<video-embed src="/docs/videos/scrolltimeline-viewbox-demo.mp4" autoplay muted />

**[View Live Demo ‚Üí](https://scrollytelling-bike-z23hmxb2gnu5a.needle.run/)**

:::tip Works with Unity and Blender
The ScrollFollow component is available for both Unity and Blender integrations.
:::

## What You Can Do

- **Timeline Scrubbing** - Control Unity Timeline playback with scroll position
- **Animator Control** - Drive animation state machines based on scroll
- **Audio Playback** - Sync audio to scroll position for narrated experiences
- **Object Movement** - Move 3D objects vertically as users scroll
- **Spline Following** - Control camera paths along splines
- **Light Intensity** - Fade lights in/out based on scroll
- **Custom Properties** - Drive any property with scroll values

Perfect for:
- Product storytelling and reveals
- Interactive tutorials and guides
- Narrative-driven experiences
- Portfolio showcases
- Educational content
- Marketing campaigns

## Quick Start

### Basic Timeline Setup

**In Unity or Blender:**
1. Create a Timeline with your animations and camera movements
2. Add a `PlayableDirector` component to control the timeline
3. Add a `ScrollFollow` component to the same GameObject
4. Assign the **PlayableDirector** to ScrollFollow's **Target** property
5. Export and scroll - your timeline now scrubs with the page!

### With HTML Markers

For precise control over timeline sections, add markers in your HTML:

```html
<div data-timeline-marker="0.0">Introduction</div>
<div data-timeline-marker="0.5">Product Features</div>
<div data-timeline-marker="1.0">Call to Action</div>
```

The timeline will smoothly transition between these markers as they scroll into view.

## Settings

| Setting | What it does |
| --- | --- |
| **Target** | Object(s) to control with scroll (see supported types below) |
| **Damping** | Smoothness of scroll response (0 = instant, higher = smoother) |
| **Invert** | Reverse scroll direction (scrolling down = value decreases) |
| **HTML Selector** | CSS selector for custom scroll container (experimental) |
| **Changed** | Event fired when scroll position changes |

## Supported Target Types

The ScrollFollow component can drive many different component types:

### PlayableDirector (Timeline)
Scrubs timeline playback based on scroll position. Use with HTML markers for section-based control.

**How it works:**
- Scroll position maps to timeline time (0 = start, 1 = end)
- Timeline markers can be linked to HTML elements
- Automatically pauses and evaluates timeline

### Animator
Sets a float parameter named `"scroll"` on the Animator component.

**How to use:**
1. Create a float parameter named `"scroll"` in your Animator
2. Create transitions based on this parameter
3. Assign the Animator to ScrollFollow's target

### Animation
Controls animation playback time directly.

**How it works:**
- Scroll position maps to animation time
- 0 = animation start, 1 = animation end

### AudioSource
Scrubs audio playback position based on scroll.

**Use cases:**
- Narrated scrolling experiences
- Sound effects tied to visual reveals
- Music synchronized with scroll

### SplineWalker
Moves objects along a spline path as users scroll.

**How it works:**
- Scroll position sets the `position01` property
- Perfect for camera paths and object reveals

### Light
Controls light intensity with scroll position.

**How it works:**
- 0 = light off, 1 = full intensity
- Create fade-in/fade-out effects

### Object3D
Moves objects vertically based on scroll position.

**How it works:**
- Objects move within their bounding box height
- Natural parallax-like movement

### Custom Objects
Any object with a `scroll` property (number or function) can be controlled.

**Example:**
```ts
export class CustomScrollTarget extends Behaviour {
    scroll: number = 0; // Will be set by ScrollFollow

    update() {
        // Use this.scroll (0-1 value) for custom behavior
        this.gameObject.scale.setScalar(this.scroll);
    }
}
```

## Examples

### Product Reveal Timeline

Create a scrolling product showcase:

<video-embed src="/docs/videos/product-scrollytelling.mp4" autoplay muted />

**[View Live Example ‚Üí](https://engine.needle.tools/samples/product-scrollytelling)**

1. Set up a Timeline with:
   - Camera animations revealing product details
   - Product rotation and zoom
   - UI elements appearing at key moments
2. Add `PlayableDirector` and `ScrollFollow` components
3. Add HTML markers for each section:
```html
<div data-timeline-marker="0.0">
  <h2>Introducing the Product</h2>
</div>
<div data-timeline-marker="0.33">
  <h2>Premium Materials</h2>
</div>
<div data-timeline-marker="0.66">
  <h2>Advanced Features</h2>
</div>
<div data-timeline-marker="1.0">
  <h2>Order Now</h2>
</div>
```

### Animator-Based Scroll

Control animation states with scroll:

1. Create an Animator with a float parameter `"scroll"`
2. Set up animation states and transitions:
   - State 1: "Idle" (scroll < 0.3)
   - State 2: "Opening" (scroll 0.3 - 0.7)
   - State 3: "Opened" (scroll > 0.7)
3. Add `ScrollFollow` component
4. Assign the Animator to the target

### Camera Path with Spline

Create a camera that follows a path as users scroll:

1. Create a spline path for your camera
2. Add `SplineWalker` component to the camera
3. Add `ScrollFollow` component
4. Assign the SplineWalker to the target
5. Camera smoothly follows the path based on scroll

### Parallax Object Movement

Create depth with scrolling objects:

1. Add `ScrollFollow` to multiple objects at different depths
2. Assign each object as its own target
3. Adjust **Damping** differently for each layer
4. Objects move at different speeds creating parallax

## Scripting

### Listen to Scroll Changes

React to scroll position changes in your code:

```ts
import { Behaviour, ScrollFollow, serializable } from "@needle-tools/engine";

export class ScrollListener extends Behaviour {

    @serializable(ScrollFollow)
    scrollFollow?: ScrollFollow;

    start() {
        this.scrollFollow?.changed.addEventListener((evt) => {
            console.log("Scroll value:", evt.value);

            // Prevent default scroll handling if needed
            if (evt.value > 0.5) {
                evt.preventDefault();
            }
        });
    }
}
```

### Get Current Scroll Value

Access the current scroll position:

```ts
import { Behaviour, ScrollFollow, serializable } from "@needle-tools/engine";

export class ScrollReader extends Behaviour {

    @serializable(ScrollFollow)
    scrollFollow?: ScrollFollow;

    update() {
        if (this.scrollFollow) {
            const value = this.scrollFollow.currentValue;
            // value is 0-1, where 0 = top, 1 = bottom

            if (value > 0.8) {
                console.log("Near bottom of page!");
            }
        }
    }
}
```

### Custom Scroll Target

Create components that respond to scroll:

```ts
import { Behaviour } from "@needle-tools/engine";

export class FadeOnScroll extends Behaviour {

    // ScrollFollow will set this property
    scroll(value: number) {
        // Fade object based on scroll position
        const material = this.gameObject.getComponent(Renderer)?.sharedMaterial;
        if (material) {
            material.opacity = value;
            material.transparent = true;
        }
    }
}
```

### Multiple Targets

Drive multiple components with one ScrollFollow:

```ts
import { Behaviour, ScrollFollow, PlayableDirector, Light } from "@needle-tools/engine";

export class ScrollSetup extends Behaviour {

    start() {
        const scrollFollow = this.gameObject.addComponent(ScrollFollow);

        // Control multiple targets at once
        scrollFollow.target = [
            this.gameObject.getComponent(PlayableDirector)!,
            this.gameObject.findByName("MainLight")!.getComponent(Light)!,
        ];

        scrollFollow.damping = 0.3; // Smooth scrolling
    }
}
```

## Timeline Markers

Timeline markers provide precise control over scroll-based storytelling:

### Unity Timeline Markers

In Unity, add custom markers to your Timeline:

1. Create a Timeline asset
2. Add markers at key moments
3. Name them descriptively
4. ScrollFollow automatically links them to HTML elements by index

### HTML Markers

Define scroll points in your HTML with `data-timeline-marker`:

```html
<!-- Normalized time values (0.0 to 1.0) -->
<section data-timeline-marker="0.0">
  <h1>Start</h1>
  <p>Beginning of the experience</p>
</section>

<section data-timeline-marker="0.25">
  <h2>First Feature</h2>
  <p>Description appears here</p>
</section>

<section data-timeline-marker="0.5">
  <h2>Second Feature</h2>
  <p>More content</p>
</section>

<section data-timeline-marker="1.0">
  <h2>Conclusion</h2>
  <p>End of timeline</p>
</section>
```

### How Markers Work

- Each marker corresponds to a time in your timeline
- When a marker's HTML element is in view, the timeline scrubs to that time
- Smooth blending occurs between visible markers
- Timeline stays at a marker until the next one comes into view

## Advanced Features

### Scroll Damping

Control how smoothly the scroll responds:

- **Damping = 0**: Instant response (timeline/animation jumps to scroll position)
- **Damping = 0.1-0.3**: Responsive with slight smoothing
- **Damping = 0.5-1.0**: Very smooth, floaty response
- **Higher values**: Increasingly laggy, cinematic feel

Perfect for:
- Low damping: Precise control, interactive experiences
- High damping: Cinematic reveals, smooth storytelling

### Inverted Scroll

Set **Invert** to `true` to reverse scroll behavior:
- Scrolling down decreases the value (1 ‚Üí 0)
- Scrolling up increases the value (0 ‚Üí 1)

Use cases:
- Objects that should descend as you scroll down
- Reverse-narrative experiences
- Custom scroll behaviors

### Custom Scroll Container

Use **HTML Selector** to scroll within a specific element instead of the whole page:

```ts
scrollFollow.htmlSelector = "#my-scroll-container";
```

```html
<div id="my-scroll-container" style="height: 100vh; overflow-y: auto;">
  <!-- Your scrollable content -->
</div>
```

:::warning Experimental Feature
Custom scroll containers are experimental and may change in future updates.
:::

## Responsive Design Tips

### Page Structure

For best results, structure your HTML for clear sections:

```html
<div class="scroll-container">
  <section data-timeline-marker="0.0" class="full-height">
    <h1>Section 1</h1>
  </section>

  <section data-timeline-marker="0.5" class="full-height">
    <h1>Section 2</h1>
  </section>

  <section data-timeline-marker="1.0" class="full-height">
    <h1>Section 3</h1>
  </section>
</div>
```

```css
.full-height {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}
```

### Mobile Considerations

- Test scroll behavior on mobile devices
- Adjust damping for touch scrolling (often needs lower values)
- Ensure timeline markers are clearly visible
- Consider longer sections on mobile for easier viewing

### Performance

- Use timeline scrubbing instead of real-time animation for better performance
- Limit the number of active ScrollFollow components
- Consider disabling ScrollFollow on low-performance devices
- Use `?debugscroll` URL parameter to monitor performance

## Common Questions

**How do I make the timeline stay at a specific point longer?**  
Add multiple HTML markers with the same timeline time value, or make the HTML section taller.

**Can I control multiple timelines with one ScrollFollow?**  
Yes! Add multiple PlayableDirector components to the target array.

**Why isn't my timeline moving smoothly?**  
Check that your Timeline has enough keyframes, and consider increasing the damping value.

**How do I sync HTML content with timeline events?**  
Use timeline markers that correspond to `data-timeline-marker` elements. When those elements are in view, the timeline will be at that point.

**Can I use this with page scrolling libraries?**  
Yes, ScrollFollow works with most scrolling libraries. For custom scroll containers, use the **htmlSelector** property.

**Does it work on mobile?**  
Yes! ScrollFollow supports touch scrolling on mobile devices.

**How do I debug scroll issues?**  
Add `?debugscroll` to your URL to see detailed logging:
```
http://localhost:3000?debugscroll
```

## Debugging

Enable debug mode by adding `?debugscroll` to your URL:

```
http://localhost:3000?debugscroll
```

This shows:
- Current scroll value and percentage
- Number of active targets
- Timeline marker information and weights
- Scroll position calculations

## More Information

**Live Examples:**
- [Product Scrollytelling](https://engine.needle.tools/samples/product-scrollytelling) - Interactive product reveal
- [Bike Scrollytelling Demo](https://scrollytelling-bike-z23hmxb2gnu5a.needle.run/) - Product showcase
- [Scrollytelling Template](https://github.com/needle-engine/scrollytelling-template) - Starter template
- [Bike Demo Repository](https://github.com/needle-engine/needle-engine-bike-scrollytelling) - Complete source code

**API Documentation:**
- [ScrollFollow API](https://engine.needle.tools/docs/api/ScrollFollow) - Complete technical reference

**Related Components:**
- [PlayableDirector](/docs/reference/components#playabledirector) - Timeline control
- [Animator](/docs/reference/components#animator) - Animation state machines
- [SplineWalker](/docs/reference/components#splinewalker) - Spline path following
Source: https://engine.needle.tools/docs/how-to-guides/components/scroll-follow.html

---
title: Play Videos in Your Scene
description: Play video files, streams, and live broadcasts in your 3D scenes with the VideoPlayer component. Works in Unity and Blender.
---

# Play Videos in Your Scene

Display videos on 3D surfaces, play livestreams, and create video-based experiences.

<video-embed src="/docs/videos/video-component.mp4" autoplay muted />

:::tip Works with Unity and Blender
The VideoPlayer component is available for both Unity and Blender integrations.
:::

## What You Can Do

- **Play Videos** - MP4, WebM, and other browser-supported formats
- **Livestreams** - Support for HLS (m3u8) streaming
- **Video Surfaces** - Project videos onto any 3D object
- **Playback Control** - Play, pause, loop, and control speed
- **Picture-in-Picture** - Native browser PiP support
- **Fullscreen Mode** - Display videos in screenspace overlay

Perfect for:
- Video walls and displays
- Product demonstrations
- Interactive presentations
- Live event streaming
- Video textures on objects

## Quick Start

### Basic Setup

**In Unity or Blender:**
1. Add a 3D object with a material (like a Plane or Cube)
2. Add the `VideoPlayer` component to the object
3. Set the **URL** to your video file
4. Enable **Play On Awake** if you want it to start automatically
5. Export and view in browser - the video plays on the surface!

### Video Formats

The VideoPlayer supports any format your browser can play:
- **MP4** (H.264) - Best compatibility
- **WebM** - Good for web, smaller file sizes
- **OGG** - Open format
- **HLS Streams** (m3u8) - For livestreaming

## Settings

| Setting | What it does |
| --- | --- |
| **Play On Awake** | Start playing automatically when the scene loads |
| **URL** | The video file URL or stream address |
| **Is Looping** | Repeat the video when it finishes |
| **Playback Speed** | Speed multiplier (1 = normal, 2 = double speed, 0.5 = half speed) |
| **Muted** | Start with audio muted |
| **Aspect Mode** | How to adjust object dimensions to match video aspect ratio |

## Examples

### Video Display Screen

Create a video screen in your scene:

1. Add a Plane object
2. Add `VideoPlayer` component
3. Set **URL** to your video file
4. Enable **Play On Awake** and **Is Looping**
5. The plane now shows your video

### Interactive Video Control

Let users start/stop videos with clicks:

```ts
import { Behaviour, VideoPlayer, serializable } from "@needle-tools/engine";

export class VideoControl extends Behaviour {

    @serializable(VideoPlayer)
    videoPlayer?: VideoPlayer;

    onPointerClick() {
        if (!this.videoPlayer) return;

        if (this.videoPlayer.isPlaying) {
            this.videoPlayer.pause();
        } else {
            this.videoPlayer.play();
        }
    }
}
```

### Livestream Display

Show a live video stream:

1. Add `VideoPlayer` component
2. Set **URL** to an m3u8 stream (e.g., `https://example.com/live/stream.m3u8`)
3. Enable **Play On Awake**
4. The stream plays automatically with HLS support

### Video Gallery

Create multiple video displays:

1. Create multiple objects with VideoPlayer components
2. Set different **URL** values for each
3. Disable **Play On Awake** on all of them
4. Use scripting to play videos when users approach or click

## Scripting

### Basic Controls

Control video playback from code:

```ts
import { Behaviour, VideoPlayer } from "@needle-tools/engine";

export class MyVideoController extends Behaviour {

    start() {
        const video = this.gameObject.getComponent(VideoPlayer);

        if (video) {
            // Play the video
            video.play();

            // Pause the video
            video.pause();

            // Stop the video (resets to beginning)
            video.stop();

            // Check if playing
            if (video.isPlaying) {
                console.log("Video is playing");
            }

            // Jump to specific time (in seconds)
            video.currentTime = 10;

            // Loop the video
            video.isLooping = true;

            // Change playback speed
            video.playbackSpeed = 1.5; // 1.5x speed

            // Mute/unmute
            video.muted = true;
        }
    }
}
```

### Change Video Source

Switch between different videos:

```ts
import { Behaviour, VideoPlayer } from "@needle-tools/engine";

export class VideoSwitcher extends Behaviour {

    @serializable(VideoPlayer)
    videoPlayer?: VideoPlayer;

    switchToVideo(url: string) {
        if (this.videoPlayer) {
            this.videoPlayer.setClipURL(url);
            this.videoPlayer.play();
        }
    }
}
```

### Picture-in-Picture

Request the browser's picture-in-picture mode:

```ts
import { Behaviour, VideoPlayer } from "@needle-tools/engine";

export class PiPController extends Behaviour {

    onPointerClick() {
        const video = this.gameObject.getComponent(VideoPlayer);
        video?.requestPictureInPicture();
    }
}
```

### Screenspace Fullscreen

Display video as a fullscreen overlay:

```ts
import { Behaviour, VideoPlayer } from "@needle-tools/engine";

export class FullscreenVideo extends Behaviour {

    onPointerClick() {
        const video = this.gameObject.getComponent(VideoPlayer);
        if (video) {
            video.screenspace = true; // Show fullscreen
            // video.screenspace = false; // Exit fullscreen
        }
    }
}
```

When in screenspace mode:
- Press **Escape** to exit
- Mouse wheel to zoom
- Click and drag to pan
- On mobile: pinch to zoom, drag to pan, double-tap to exit

### Access Video Element

For advanced control, access the underlying HTML video element:

```ts
const video = this.gameObject.getComponent(VideoPlayer);
if (video) {
    const element = video.videoElement;
    const texture = video.videoTexture;
    const material = video.videoMaterial;

    // Direct access to HTML video element
    console.log("Duration:", element.duration);
    console.log("Current time:", element.currentTime);
}
```

## Aspect Ratio Modes

Control how the video dimensions affect your object:

**None (default)**
Object keeps its original size, video may appear stretched

**Adjust Height**
Object height changes to match video aspect ratio

**Adjust Width**
Object width changes to match video aspect ratio

This is especially useful for video streams where the aspect ratio may not be known in advance.

## Common Questions

**What video formats are supported?**
Any format your browser supports. MP4 with H.264 encoding has the best compatibility across all browsers.

**Can I play videos without user interaction?**
Videos may start muted until the user interacts with the page (browser autoplay policy). The VideoPlayer handles this automatically.

**How do I play YouTube videos?**
Direct YouTube URLs don't work. You need to use the YouTube embed API or download/convert the video to a supported format.

**Can I play videos from my local computer?**
For development, serve videos from your local web server or use a URL to a hosted video. For production, host videos on a CDN or web server.

**What about livestreams?**
Yes! The VideoPlayer supports HLS streams (m3u8 files). The component automatically loads the HLS.js library when needed.

**Does it work on mobile?**
Yes! The component uses `playsInline` to prevent fullscreen takeover on iOS and handles touch input for screenspace mode.

**How do I hide the video but keep the audio?**
Set the object's scale to very small or move it off-screen. The audio will still play.

## Performance Tips

**Video Resolution**
Use appropriate resolution for your target display size. A 1920√ó1080 video on a small UI element wastes bandwidth and processing power.

**Compression**
Compress videos before deployment. Tools like HandBrake or FFmpeg can significantly reduce file size while maintaining quality.

**Preloading**
Call `videoPlayer.preloadVideo()` to start loading the video before playback is needed.

**Multiple Videos**
If showing many videos simultaneously, consider starting them paused and only playing those currently visible to users.

## Debugging

Enable debug mode by adding `?debugvideo` to your URL:

```
http://localhost:3000?debugvideo
```

This logs detailed information about video loading, playback state, and errors.

## More Information

**Live Example:**
- [Video Playback Sample](https://engine.needle.tools/samples/video-playback/) - Interactive demo with playback controls

**API Documentation:**
- [VideoPlayer API](https://engine.needle.tools/docs/api/VideoPlayer) - Complete technical reference

**Related Components:**
- [Audio Source](/docs/reference/components#audiosource) - Play audio files
- [UI Components](/docs/reference/components#ui) - Create video UI controls
Source: https://engine.needle.tools/docs/how-to-guides/components/video-player.html

---
title: Everywhere Actions ‚Äî Interactive experiences on Desktop, Android & iOS (even AR)
description: Needle's Everywhere Actions are a set of carefully chosen components that allow you to create interactive experiences in Unity without writing a single line of code. They are designed to serve as building blocks for experiences across the web, mobile and XR, **including Augmented Reality on iOS**. From low-level triggers and actions, higher-level complex interactive behaviours can be built.
---

# Everywhere Actions

<logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="./unity/">Unity</a></logo-header> ‚Ä¢ <logo-header logo="/blender/logo.png" alt="Blender"><a href="./blender/">Blender</a></logo-header>

## What are Everywhere Actions?

Needle's Everywhere Actions are a set of carefully chosen components that allow you to create **interactive experiences without writing code**.

Build experiences that work across **all platforms**:

### Supported Platforms

| Platform | Support | Notes |
| --- | --- | --- |
| **Desktop** | ‚úÖ Full support | Windows, macOS, Linux |
| **Mobile** | ‚úÖ Full support | Android & iOS browsers |
| **VR Headsets** | ‚úÖ Full support | Quest, Vive, Index, etc. |
| **AR Devices** | ‚úÖ Full support | ARCore, ARKit devices |
| **<logo-header logo="/imgs/apple-logo.webp" alt="Apple">iOS WebXR</logo-header>** | ‚úÖ **Full native AR** | Via [Needle Go App Clip](../xr/ios-webxr-app-clip) |
| **<logo-header logo="/imgs/quicklook-logo.webp" alt="QuickLook">iOS QuickLook</logo-header>** | ‚úÖ Supported | Apple Vision Pro, iPhone, iPad |

:::tip Native WebXR on iOS Now Available! üéâ
Full WebXR support is now available on iOS through [Needle Go App Clip](../xr/ios-webxr-app-clip). Experience complete AR and VR on iPhone and iPad without app installation‚Äîjust open your WebXR scene in Safari or Chrome!
:::

## How do I use Everywhere Actions?

For iOS support add the `USDZExporter` component to your scene. It is good practice to add it to the same object as the `WebXR` component (but not mandatory)

To add an action to any object in your scene  
select it and then click `Add Component > Needle > Everywhere Actions > [Action]`.

![](/imgs/everywhere-actions-component-menu.gif)

## List of Everywhere Actions

| Action | Description | Example Use Cases |
| --- | --- | --- |
| Play Animation on Click | Plays a selected animation state from an Animator. After playing, it can optionally transition to another animation. | Product presentations, interactive tutorials, character movement |
| Change Material on Click | Switch out one material for others. All objects with that material will be switched together. | Product configurators, characters |
| Look At | Make an object look at the camera. | UI elements, sprites, info graphics, billboard effects, clickable hotspots |
| Play Audio on Click | Plays a selected audio clip. | Sound effects, Narration, Museum exhibits |
| Hide on Start | Hides an object at scene start for later reveal. |
| Set Active on Click | Show or hide objects. |  |
| Change Transform on Click | Move, rotate or scale an object. Allows for absolute or relative movement. | Characters, products, UI animation (use animation for more complex movements) |
| Audio Source | Plays audio on start and keeps looping. Spatial or non-spatial | Background music, ambient sounds |
| WebXR Image Tracking | Tracks an image target and shows or hides objects. | AR experiences, product presentations |

## Samples

### Musical Instrument

Demonstrates spatial audio, animation, and interactions.

<sample src="https://engine.needle.tools/samples-uploads/musical-instrument" />

### Simple Character Controllers

Demonstrates combining animations, look at, and movement.  

<sample src="https://engine.needle.tools/samples-uploads/usdz-characters" />

### Image Tracking

Demonstrates how to attach 3D content onto a custom image marker.
Start the scene below in AR and point your phone's camera at the image marker on a screen, or print it out.

:::tip iOS: Full Native Support ‚úÖ
Image tracking works natively on iOS through [Needle Go App Clip](../xr/ios-webxr-app-clip) with ARKit support‚Äîno setup required!
:::

:::info Android: Browser Flag Required
**On Android** please turn on "WebXR Incubations" in the Chrome Flags. You can find those by pasting [chrome://flags/#webxr-incubations](chrome://flags/#webxr-incubations) into the Chrome browser address bar of your Android phone.
:::

[Read more about Image Tracking with Needle Engine](../xr/image-tracking)

<img src="https://image-tracking-zubckszr0qj2.needle.run/assets/needle-marker.png" alt="Image Marker" width=300 />    

<sample src="https://image-tracking-zubckszr0qj2.needle.run/" />

### Interactive Building Blocks Overview

<sample src="https://engine.needle.tools/samples-uploads/usdz-interactivity" />

## Create your own Everywhere Actions

Creating new Everywhere Actions involves writing code for your action in TypeScript, which will be used in the browser and for WebXR, and using our TriggerBuilder and ActionBuilder API to create a matching setup for Augmented Reality on iOS via QuickLook. When creating custom actions, keep in mind that QuickLook has a limited set of features available. You can still use any code you want for the browser and WebXR, but the behaviour for QuickLook may need to be an approximation built from the available triggers and actions. 

:::tip
Often constructing specific behaviours requires thinking outside the box and creatively applying the available low-level actions. An example would be a "Tap to Place" action ‚Äì there is no raycasting or hit testing available in QuickLook, but you could cover the expected placement area with a number of invisible objects and use a "Tap" trigger to move the object to be placed to the position of the tapped invisible object.  
:::

Triggers and Actions for QuickLook are based on [Apple's Preliminary Interactive USD Schemas](https://developer.apple.com/documentation/arkit/usdz_schemas_for_ar/actions_and_triggers)

### Code Example

Here's the implementation for `HideOnStart` as an example for how to create an Everywhere Action with implementations for both the browser and QuickLook:  
@[code ts twoslash](@code/component-everywhere-action-hideonstart.ts)

::: tip
Often, getting the right behaviour will involve composing _higher-level actions_ from the available _lower-level actions_. For example, our "Change Material on Click" action is composed of a number of `fadeActions` and internally duplicates objects with different sets of materials each. By carefully constructing these actions, complex behaviours can be achieved.  
:::

### Low level methods for building your own actions

| Triggers | |
| --- | --- |
| `TriggerBuilder.sceneStartTrigger` | |
| `TriggerBuilder.tapTrigger` | |

| Actions | |
| --- | --- |
| `ActionBuilder.fadeAction` | |
| `ActionBuilder.startAnimationAction` | |
| `ActionBuilder.waitAction` | |
| `ActionBuilder.lookAtCameraAction` | |
| `ActionBuilder.emphasize` | |
| `ActionBuilder.transformAction` | |
| `ActionBuilder.playAudioAction` | |

|  Group Actions | |
| --- | --- |
| `ActionBuilder.sequence` | |
| `ActionBuilder.parallel` | |
| `GroupAction.addAction` | |
| `GroupAction.makeParallel` | |
| `GroupAction.makeSequence` | |
| `GroupAction.makeLooping` | |
| `GroupAction.makeRepeat` | |

To see the implementation of our built-in Everywhere Actions, please take look at `src/engine-components/export/usdz/extensions/behavior/BehaviourComponents.ts`.

## References
- [Apple's Preliminary USD Behaviours](https://developer.apple.com/augmented-reality/quick-look/)

## Further reading

:::tip <logo-header logo="/imgs/apple-logo.webp" alt="Apple">iOS WebXR Support</logo-header>
Want to use full WebXR features on iPhone and iPad? Check out our [iOS WebXR with App Clip](../xr/ios-webxr-app-clip) guide for complete AR and VR support without app installation.
:::

- [Visit our AR Showcase Website](https://engine.needle.tools/projects/ar-showcase/) that has many interactive AR examples with a focus on iOS AR & Quicklook
- [Needle Engine Everywhere Action Samples](https://engine.needle.tools/samples/?overlay=samples&tag=everywhere+actions)
- [Image Tracking with Needle Engine](../xr/image-tracking)
Source: https://engine.needle.tools/docs/how-to-guides/everywhere-actions/index.html

---
title: Exporting Assets to glTF
---

# Exporting Assets to glTF

<logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="./unity/">Unity</a></logo-header> ‚Ä¢ <logo-header logo="/blender/logo.png" alt="Blender"><a href="./blender/">Blender</a></logo-header>

Learn how to export your Unity and Blender scenes, assets, animations, materials, and lightmaps to the web using glTF format. Needle Engine provides powerful tools to convert your 3D content into optimized web-ready assets.

**What You Can Export:**
- üé® Materials (PBR, custom shaders, MaterialX)
- üé¨ Animations (Timeline, Animator, clips)
- üì¶ Prefabs and scenes (for lazy loading)
- üí° Lightmaps and skyboxes
- üé≠ Meshes, textures, and more

:::tip Quick Start
Add a `Needle Engine` component to your Unity scene to get started. By default, your scene exports automatically on save‚Äîyou can disable this in the `Needle Engine` component settings.
:::  

## <logo-header logo="/imgs/gltf-logo.webp" alt="glTF">Exporting glTF Files</logo-header>

Create a new GameObject and add a `GltfObject` component‚Äîthis becomes the root of a glTF file that exports meshes, materials, animations, textures, and more.

**How it works:**
1. Add `GltfObject` component to a GameObject
2. Add child objects (meshes, lights, etc.) under it
3. Save your scene‚Äîthe glTF exports automatically
4. Find the `.glb` file in your `assets/` folder

:::tip Only Exports What's Inside
Only scripts and data on and inside `GltfObject` roots are exported. Content outside these roots is ignored.
:::

**Performance Tip:** Enable `Smart Export` in `Edit > Project Settings > Needle` to only export when changes are detected in the object hierarchy.

:::details Excluding Objects from Export
Objects tagged as `EditorOnly` are ignored during export (including their children). This is better than disabling objects, which still export in case they're enabled at runtime.
:::

### Lazy Loading & Multiple Scenes

Split your app into multiple scenes for faster loading. Use the [`SceneSwitcher`](https://engine.needle.tools/docs/api/SceneSwitcher) component to load and unload scenes at runtime.

**Benefits:**
- Smaller initial load times
- Load content only when needed
- Better performance across devices

**Example:** On [needle.tools](https://needle.tools?utm_source=needle_docs&utm_content=export_scenes), each section is a separate scene that loads on demand.

[Learn more about loading scenes ‚Üí](scripting.html#loading-scenes)

### Recommended Complexity per glTF

Keep your glTF files within these limits for optimal performance across devices:

| Metric | Recommended Max | Notes |
| --- | --- | --- |
| **File Size** | 50 MB uncompressed | Usually compresses to 10-20 MB |
| **Vertices** | 500k | Lower for mobile VR |
| **Lightmaps** | 4√ó 2k textures | Larger files = slower loading |

:::tip Split Large Scenes
If you exceed these limits, split your content into multiple glTF files and load them on demand. This keeps performance fast across all devices.
:::

*These recommendations ensure good performance across a range of web-capable devices and bandwidths. There's no hard technical limitation beyond device capabilities.*

### Prefabs
Prefabs can be exported as invidual glTF files and instantiated at runtime. To export a prefab as glTF just reference a prefab asset (from the project browser and not in the scene) [from one of your scripts](https://fwd.needle.tools/needle-engine/docs/addressables).  

Exporting Prefabs works with nesting too: a component in a Prefab can reference another Prefab which will then also be exported.  
This mechanism allows for composing scenes to be as lightweight as possible and loading the most important content first and defer loading of additional content.  

### Scene Assets
Similar to Prefab assets, you can reference other Scene assets.  
To get started, create a component in Unity with a ``UnityEditor.SceneAsset`` field and add it to one of your GameObjects inside a GltfObject. The referenced scene will now be exported as a separate glTF file and can be loaded/deserialized as a ``AssetReference`` from TypeScript.  

You can keep working inside a referenced scene and still update your main exporter scene/website. On scene save or play mode change we will detect if the current scene is being used by your currently running server and then trigger a re-export for only that glb. (This check is done by name - if a glb inside your ``<web_project>/assets/`` folder exists, it is exported again and the main scene reloads it.)

As an example on [our website](https://needle.tools?utm_source=needle_docs&utm_content=export_sceneassets) each section is setup as a separate scene and on export packed into multiple glb files that we load on demand:

![2022-08-22-172605_Needle_Website_-_Website_-_Windows,_Mac,_Linux_-_U](https://user-images.githubusercontent.com/5083203/185958983-71913c97-5eec-4cfd-99f5-76798582373e.png)

#### Loading a Prefab or Scene from a custom script
If you want to reference and load a prefab from one of your scripts you can declare a `AssetReference` type.  
Here is a minimal example: 

@[code ts twoslash](@code/component-prefab.ts)

## üèá Exporting Animations 
Needle Engine supports a considerable and powerful subset of Unity's animation features:

- **Timeline** incl. activation tracks, animation tracks, track offsets
- **Animator** incl. top-level state transitions
  - Blend trees are currently not supported.
  - Sub state machines are currently not supported.
- **AnimationClips** incl. Loop modes
- **Procedural Animations** can be created via scripting

Needle Engine is one of the first to support the new [glTF extension KHR_ANIMATION_POINTER](https://github.com/ux3d/glTF/tree/extensions/KHR_animation_pointer/extensions/2.0/Khronos/KHR_animation_pointer).  
This means that almost all properties, including script variables, are animatable.  

One current limitation is that materials won't be duplicated on export ‚Äî if you want to animate the same material with different colors, for example, you currently need to split the material in two. 

## üåç Exporting the Skybox 
The Unity skybox and custom reflection (if any) are baked into a texture on export and automatically exported inside the ``NEEDLE_lightmaps`` extension.  

To change the skybox resolution you can add a ``SkyboxExportSettings`` component to your scene.  

![image](https://user-images.githubusercontent.com/5083203/196030839-170a9496-9ed9-4ebc-bc1d-2df6c746f8c8.png)

If you don't want to skybox to be exported at all in a glb file you can untick the ``Embed Skybox`` option on your ``GltfObject`` component  

![image](https://user-images.githubusercontent.com/5083203/196030825-8a05037f-5acc-4795-9128-2bdacedd0d49.png)

## ‚ú® Exporting Materials

### Physically Based Materials (PBR)
By default, materials are converted into glTF materials on export. glTF supports a physically based material model and has a number of extensions that help to represent complex materials.  

For full control over what gets exported, it's **highly recommended** to use the glTF materials provided by UnityGltf:
- UnityGLTF/PBRGraph
- UnityGLTF/UnlitGraph

::: tip When in doubt, use the PBRGraph shader.
The PBRGraph material has a lot of features, way more than the "Standard" or "Lit" shaders provided by Unity. These features include surface effects like clearcoat, sheen, iridescence, and volumetric effects like transmission, refraction and dispersion.
:::

Other shaders that can be exported directly (with conversion):
- Universal Render Pipeline/Lit
- Universal Render Pipeline/Unlit
- Standard (Built-in Render Pipeline)
- Autodesk Interactive (Built-in Render Pipeline)
- Unlit (Built-in Render Pipeline)

Other materials are converted using a propery name heuristic. That means that depending on what property names your materials and shaders use, you might want to either refactor your custom shader's properties to use the property names of either Universal Render Pipeline/Lit or PBRGraph, or export the material as [Custom Shader](#custom-shaders).

### Custom Shaders
To export custom unlit shaders (for example made with ShaderGraph) use the dropdown in the Material header to select the shader export type. Needle Engine offers support for Unity Shader export in WebGL2 format (Unlit Shaders only) or as MaterialX graphs.

![image](/imgs/custom-shaders.jpg)

#### MaterialX Format

MaterialX is a powerful standard for describing materials and shaders in a graph based way, independent of the rendering engine. It allows you to define complex materials, with multiple surface layers and realistic lighting.

- [MaterialX in Needle Engine](./materialx.md) documentation

#### WebGL2 Format (Unlit Shaders)
 
**Limitations**
- We currently only support custom **Unlit** shaders ‚Äî Lit shader conversion is not officially supported.
- Custom Lit Shaders are currently experimental. Not all rendering modes are supported. 
- Shadow receiving on custom shaders is not supported
- Skinned meshes with custom shaders are not supported
- As there's multiple coordinate system changes when going from Unity to three.js and glTF, there might be some changes necessary to get advanced effects to work. We try to convert data on export but may not catch all cases where conversions are necessary.  
  - UV coordinates in Unity start at the bottom left; in glTF they start at the top left.
  - X axis values are flipped in glTF compared to Unity. This is a variant of a left-handed to right-handed coordinate system change. Data used in shaders may need to be flipped on X to display correctly.  

<!-- ::: note Not part of the glTF specification
Note that **Custom Shaders** aren't officially part of the glTF specification. Our implementation of custom shaders uses an extension called KHR_techniques_webgl, that stores the WebGL shader code directly in the glTF file. The resulting assets will work in viewers based on Needle Engine.
::: -->

## üí° Exporting Lightmaps
![2022-08-22-171650_Needle_-_Google_Chrome](https://user-images.githubusercontent.com/5083203/185957005-d04c9530-07eb-40f5-b305-9822d13b79ab.png)

Lightmaps baked in your 3D editor are automatically exported to the web with Needle Engine. The lighting you see in your editor is what you get on the web!

**Lightmap export works with:**
- Unity's built-in lightmapper and third-party solutions
- Blender's Cycles renderer with baked lighting

### Integration-Specific Guides

**<logo-header logo="/imgs/unity-logo.webp" alt="Unity"><a href="/docs/tutorials/fundamentals/unity-integration#lightmaps">Unity Lightmapping Guide</a></logo-header>**
Learn about Unity-specific lightmap settings, recommendations, and best practices for mixing baked and non-baked objects.

**<logo-header logo="/blender/logo.png" alt="Blender"><a href="/docs/blender/lightmapping">Blender Lightmapping Guide</a></logo-header>**
Learn how to bake lighting in Blender and export it with Needle Engine.
Source: https://engine.needle.tools/docs/how-to-guides/export/index.html

---
title: MaterialX
image: https://cloud.needle.tools/-/media/Xc99R6zbaD-kpoTw1cMRKA.gif
---

## MaterialX in Needle Engine

MaterialX is a powerful standard for describing materials and shaders in a graph based way, independent of the rendering engine. It allows you to define complex materials, with multiple surface layers and realistic lighting.  

It's widely used across film, VFX and e-commerce, and is supported by many professional authoring tools such as Autodesk Maya and 3ds Max, Houdini, V-Ray, and Omniverse. 

[![MaterialX Demo](https://cloud.needle.tools/-/media/Xc99R6zbaD-kpoTw1cMRKA.gif)](https://engine.needle.tools/samples/material-x)

::: tip Learn more
You can learn more about MaterialX on the [MaterialX website](https://www.materialx.org/).
:::

Materials made with Unity's [**Shader Graph**](https://docs.unity3d.com/Packages/com.unity.shadergraph@17.3/manual/index.html) can be exported to MaterialX files automatically through the **Needle MaterialX Exporter**, which is part of our Unity integration package.

This allows you to create complex, lit materials in Unity, and they're automatically exported along with your scene. MaterialX export extends our existing Unlit shader export, which is less portable due to the use of WebGL2 shaders. With MaterialX, you're ready for WebGPU and future rendering technologies, and can achieve high fidelity materials in your web projects.

The MaterialX support in Needle Engine uses the official [MaterialX JavaScript library](https://github.com/materialx/MaterialX), which means that materials are represented at the highest fidelity possible. This allows you to use any MaterialX file.

::: info Shader Graph to MaterialX requires a **Pro**, **Edu** or **Enterprise** plan.
The MaterialX Exporter is available for users on the Pro, Edu and Enterprise plans.
[See plans and pricing.](https://needle.tools/pricing)
:::

## Usecases

MaterialX is a great choice if you 
- are using **Graph-based materials** for your projects for artistic control and flexibility.
- need **rich and complex surface features** such as procedural textures, detail maps, or layered materials.
- have **existing MaterialX materials** that you want to keep throughout your studio pipeline.
- want to ensure **consistency and compatibility** for your renderings across different rendering engines.

## Enable MaterialX support in your project

To enable MaterialX support in your Needle Engine project, you need to add the `@needle-tools/materialx` package to your project.

::: tabs

@tab Unity

1. Select the Needle Engine component in your scene.

2. Find the "NpmDef Dependencies" section in the Inspector, and add a new dependency by increasing the "Size" number (e.g. from 0 to 1).

3. Click the Object Picker symbol, enable Package Visibility with the eye symbol, and select the `Needle MaterialX` package from the list.

   ![Find and add the MaterialX package dependency in Unity.](/materialx/add-materialx-package-dependency.jpeg)
   _Find and add the MaterialX package dependency in Unity._

You are now ready to use MaterialX in your web project.

@tab Other Needle integrations

1. Find and open your web project in a code editor (e.g. VS Code).  
   [Learn how to open your web project.](./project-structure.html#opening-the-web-project-in-a-code-editor)
2. Install the Needle MaterialX package from the NPM registry in your web project.

   ```bash
   npm install @needle-tools/materialx
   ```

   This will add the MaterialX package to your project.

3. If you're using any of our Vite-based templates, you don't need to do anything else. The MaterialX package will be automatically included in your project.

    ::: tip If you're unsure, you're probably using one of our Vite-based templates!
    :::

4. If you're not using the Needle Vite plugins, import and register MaterialX in your main entry file, for example in `main.ts`:

   ```ts
   import { useNeedleMaterialX } from "@needle-tools/materialx";
   useNeedleMaterialX();
   ```

You are now ready to use MaterialX in your web project.

@tab three.js

You can use our MaterialX package in any three.js project, even if you're not using Needle Engine.

1. Register our `MaterialX` plugin with your `GLTFLoader`:

    ```ts
    import { useNeedleMaterialX } from "@needle-tools/materialx";
    import { GLTFLoader } from "three/examples/jsm/loaders/GLTFLoader.js";

    const gltfLoader = new GLTFLoader();
    
    // ... register other plugins such as DRACOLoader, KTX2Loader, etc.
    useNeedleMaterialX(gltfLoader);

    // ... load a file that contains MaterialX materials
    gltfLoader.load("https://cloud.needle.tools/-/assets/Z23hmXB2qfHiF-2qfHiF/file", (gltf) => {
        scene.add(gltf.scene);
    });
    ```

2. Load GLB files that contain the `NEEDLE_materials_mtlx` extension. The plugin will automatically load and apply the MaterialX materials to the objects that are using them.

3. You can enable preloading of the MaterialX WebAssembly module by calling `useNeedleMaterialX(gltfLoader, { preload: true })`. This will load the MaterialX WebAssembly module in advance, so that it is ready when you load a GLB file with MaterialX materials.

You can find a full example of how to use MaterialX in a three.js project on StackBlitz: [MaterialX in three.js](https://stackblitz.com/edit/needle-materialx-example?file=main.js).

::: 
## Exporting materials with MaterialX support

1. Create materials with Unity's Shader Graph.

   ![Example of a complex Shader Graph in Unity.](/materialx/shadergraph-example.webp)
   _Example of a complex Shader Graph in Unity._

2. Select an object that has a Shader Graph-based material in your scene, or select the shader asset in the Project View.

3. In the Material properties, find the section "Needle Engine ‚Äì Custom Shader Settings", and select "MaterialX" as the Shader Export Type.

    ![Enabling the MaterialX export type in the Shader Graph material properties.](/materialx/enable-asset-label-from-material.jpeg)
    _Enabling the MaterialX export type in the Shader Graph material properties._

3. When you export your scene, all materials using shaders with the "MaterialX" export type will be embedded alongside your 3D content, and loaded at runtime.

## Using MaterialX files created externally

The Needle MaterialX package contains experimental support for loading MaterialX files directly. Textures can be resolved via a callback function, and materials are returned as three.js `ShaderMaterial`.

You can find examples for working with the Needle MaterialX package [in our MaterialX collection on StackBlitz](
https://stackblitz.com/@marwie/collections/materialx).

:::: tabs
@tab From code

```ts
import { TextureLoader } from 'three';
import { Experimental_API } from '@needle-tools/materialx';

// Load a MaterialX file and its referenced textures from a URL
function load(mtlx_url) {
    const parts = mtlx_url.split('/');
    parts.pop();
    const dir = parts.join('/');

    return fetch(mtlx_url)
    .then((res) => res.text())
    .then((mtlx) => {
        const loader = new TextureLoader();
        const materialNameOrIndex = 0;
        Experimental_API.createMaterialXMaterial(mtlx, materialNameOrIndex, {
            getTexture: async (url) => {
                return await loader.loadAsync(dir + url);
            },
        }).then((mat) => {
            console.log("MaterialX material has been loaded:", mat);
        });
    });
}
```

::: info
The `Experimental_API.createMaterialXMaterial()` method currently doesn't support loading multiple materials, or MaterialX files with additional .mtlx references.
:::

::::

## Supported Nodes and Features

Needle Engine supports the full MaterialX specification, including OpenPBR, Standard Surface, UsdPreviewSurface and Unlit Surface nodes, and including NPR (non-photorealistic rendering) nodes like fresnel effects. Nested nodegraph definitions and custom nodes are also supported.

MaterialX materials in Needle Engine support the following features:
- **Image-Based Lighting** (IBL) automatically coming from the scene's environment map
- **Reflection Probes** affect objects using MaterialX materials
- **Light sources**: Directional, point, and spot lights, with a current limit of 8 lights per scene
- **Texture compression and progressive textures**. MaterialX materials fully support the powerful texture compression and progressive loading features of Needle Engine, allowing you to use large textures. They will be only loaded when needed, and only in the resolution needed for the current view. 
- **Animated material properties** for colors, floats, vectors. Same as other materials in Needle Engine, any numeric material property can be animated.
- All MaterialX surface models, including **OpenPBR**, **Standard Surface**, **UsdPreviewSurface**, and **Unlit Surface**.

The Needle MaterialX Exporter leverages the graph-based structure of Unity's Shader Graph for export, and converts Shader Graph nodes to MaterialX nodedefs and nodegraphs. It has support for the following features:
- **Material properties** like colors, floats, vectors, textures
- **Operations** on numbers, vectors, and matrices
- **Blend nodes** like Mix, Add, Multiply, and Blend with various blend modes
- **Textures** and color spaces
- **Subgraphs** with one or more levels of nesting
- **Vertex colors** are supported
- **Multiple UV channels** are supported (up to 4)
- **Shader Keywords** are supported and will be exported as switch nodes in MaterialX.

## Supported MaterialX Version

Needle Engine currently supports MaterialX version 1.39.4. MaterialX documents with earlier versions are also supported and will be automatically upgraded to the latest version.

## Limitations of the MaterialX Exporter

Not all features that Shader Graph supports are also supported by MaterialX. If you attempt to export an unsupported node, the exporter will log an error and stop the export process. You can then fix the issue by replacing the unsupported node with a supported one, if possible.

- **Vertex displacement is not yet supported**: MaterialX supports displacement mapping, but Needle Engine does not currently support it. This means that any displacement nodes in your MaterialX files will be ignored.
- **Realtime shadows**: Light sources in your scene will affect MaterialX materials, but realtime shadows are currently not supported.
- **Baked Lightmaps**: Baked lightmaps are currently not supported in MaterialX materials.
- **Tangent space** is not supported at the moment, which means that Shader Graph nodes specifying "Tangent" as space will look different.
- **Code Nodes** are not supported at the moment.

::: tip The special "MATERIALX" shader keyword
If you have complex shaders with unsupported nodes, you can use the "MATERIALX" keyword to prevent exporting them. The "On" path of keyword switches will be exported, and the "Off" path will be ignored for export. You can use this to keep shaders with custom nodes or unsupported features functional, but still export them to MaterialX.
:::

::: info Built-in MaterialX support in three.js
While three.js has some initial support for MaterialX, it's using a custom implementation that doesn't support many features of the standard, leading to lower accuracy in material representation. Needle Engine uses the official MaterialX JavaScript library, which means that materials are represented at the highest fidelity possible.

Needle is contributing to the built-in three.js MaterialX support, so that at some point we can offer both options or switch to the three.js implementation once it's more comprehensive.
:::
Source: https://engine.needle.tools/docs/how-to-guides/export/materialx.html

---
title: Integrating with Adobe Experience Manager (AEM)
---

# <logo-header logo="/imgs/adobe-experience-manager-logo.webp" alt="Adobe Experience Manager">Integrating with Adobe Experience Manager</logo-header>

Adobe Experience Manager (AEM) is an enterprise-grade content management system. This guide covers multiple approaches for integrating Needle Engine 3D content into AEM, from simple iframe embeds to advanced component-based integrations that content authors can manage.

## Overview: Integration Approaches

Choose the approach that fits your AEM setup and authoring requirements:

| Approach | Best For | Author-Friendly | Technical Complexity |
|----------|----------|-----------------|---------------------|
| [iframe Embed](#approach-1-iframe-embedding) | Quick integration, isolated content | ‚≠ê‚≠ê | Low |
| [AEM Component](#approach-2-custom-aem-component) | Authorable content, reusability | ‚≠ê‚≠ê‚≠ê‚≠ê | Medium |
| [Direct Integration](#approach-3-direct-web-component-integration) | Maximum control, custom layouts | ‚≠ê‚≠ê‚≠ê | Medium-High |
| [Experience Fragment](#approach-4-experience-fragments) | Multi-channel content, reusability | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Medium |

---

## Approach 1: iframe Embedding

**Best for:** Quick integration when you have limited access to AEM development resources.

This is the simplest approach and works with any AEM setup, including AEM as a Cloud Service.

### Steps

1. **Deploy your Needle project** to Needle Cloud or your preferred hosting platform
   - [Deploy to Needle Cloud](/docs/cloud/)
   - [Other deployment options](/docs/how-to-guides/deployment/)

2. **Get your project URL**
   ```
   https://your-project.needle.run/
   ```

3. **Add iframe to AEM page** using one of these methods:

   **Option A: Using the Embed Component (AEM Core Components)**

   If your AEM site uses Core Components:
   - Drag the "Embed" component onto your page
   - Select "Embeddable" type
   - Paste your Needle project URL
   - Configure size and other options

   **Option B: Using HTML in Text Component**

   ```html
   <iframe
       src="https://your-project.needle.run/"
       allow="xr; xr-spatial-tracking; fullscreen; accelerometer; gyroscope"
       style="width: 100%; height: 600px; border: none;"
       allowfullscreen>
   </iframe>
   ```

:::tip Get Embed Code from Needle Cloud
Needle Cloud provides ready-to-use embed code. Open your project, click "Share", and copy the iframe snippet.
:::

### iframe Considerations

**Pros:**
- ‚úÖ No AEM development required
- ‚úÖ Works with any AEM version
- ‚úÖ Easy updates (just redeploy Needle project)
- ‚úÖ Content isolation

**Cons:**
- ‚ùå Limited integration with page content
- ‚ùå Less flexible sizing options
- ‚ùå Authors can't edit 3D content properties in AEM

---

## Approach 2: Custom AEM Component

**Best for:** Content authors who need to configure and manage 3D experiences directly in AEM.

Create a custom AEM component that allows authors to add and configure Needle Engine content through AEM's authoring interface.

### Architecture Overview

```
Unity/Blender ‚Üí Needle Engine ‚Üí Deploy ‚Üí AEM Component ‚Üí Author configures
```

### Implementation Steps

#### 1. Create the AEM Component

Create a new component in your AEM project:

**Component Structure:**
```
/apps/myproject/components/content/needle-engine/
‚îú‚îÄ‚îÄ .content.xml
‚îú‚îÄ‚îÄ _cq_dialog.xml
‚îú‚îÄ‚îÄ needle-engine.html
‚îî‚îÄ‚îÄ clientlibs/
    ‚îú‚îÄ‚îÄ .content.xml
    ‚îú‚îÄ‚îÄ css.txt
    ‚îú‚îÄ‚îÄ js.txt
    ‚îî‚îÄ‚îÄ js/
        ‚îî‚îÄ‚îÄ needle-loader.js
```

**`.content.xml`** (Component Definition):
```xml
<?xml version="1.0" encoding="UTF-8"?>
<jcr:root xmlns:cq="http://www.day.com/jcr/cq/1.0"
          xmlns:jcr="http://www.jcp.org/jcr/1.0"
    jcr:primaryType="cq:Component"
    jcr:title="Needle Engine 3D"
    jcr:description="Embeds a Needle Engine 3D experience"
    componentGroup="My Project - Content"/>
```

#### 2. Create the Author Dialog

**`_cq_dialog.xml`** (Author Interface):
```xml
<?xml version="1.0" encoding="UTF-8"?>
<jcr:root xmlns:sling="http://sling.apache.org/jcr/sling/1.0"
          xmlns:cq="http://www.day.com/jcr/cq/1.0"
          xmlns:jcr="http://www.jcp.org/jcr/1.0"
          xmlns:nt="http://www.jcp.org/jcr/nt/1.0"
    jcr:primaryType="nt:unstructured"
    jcr:title="Needle Engine Configuration"
    sling:resourceType="cq/gui/components/authoring/dialog">
    <content
        jcr:primaryType="nt:unstructured"
        sling:resourceType="granite/ui/components/coral/foundation/container">
        <items jcr:primaryType="nt:unstructured">
            <tabs
                jcr:primaryType="nt:unstructured"
                sling:resourceType="granite/ui/components/coral/foundation/tabs">
                <items jcr:primaryType="nt:unstructured">
                    <basic
                        jcr:primaryType="nt:unstructured"
                        jcr:title="Basic Settings"
                        sling:resourceType="granite/ui/components/coral/foundation/container">
                        <items jcr:primaryType="nt:unstructured">
                            <projectUrl
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/form/textfield"
                                fieldLabel="Project URL"
                                fieldDescription="URL to your deployed Needle Engine project"
                                name="./projectUrl"
                                required="{Boolean}true"/>
                            <integrationMode
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/form/select"
                                fieldLabel="Integration Mode"
                                name="./integrationMode">
                                <items jcr:primaryType="nt:unstructured">
                                    <iframe
                                        jcr:primaryType="nt:unstructured"
                                        text="iframe (Isolated)"
                                        value="iframe"
                                        selected="{Boolean}true"/>
                                    <webcomponent
                                        jcr:primaryType="nt:unstructured"
                                        text="Direct (Integrated)"
                                        value="webcomponent"/>
                                </items>
                            </integrationMode>
                            <height
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/form/textfield"
                                fieldLabel="Height"
                                fieldDescription="Height in pixels (e.g., 600)"
                                name="./height"
                                value="600"/>
                            <enableAR
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/form/checkbox"
                                fieldDescription="Enable AR/VR features"
                                name="./enableAR"
                                text="Enable AR/VR"
                                value="true"/>
                            <autoplay
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/form/checkbox"
                                fieldDescription="Start animations automatically"
                                name="./autoplay"
                                text="Autoplay"
                                value="true"
                                checked="{Boolean}true"/>
                        </items>
                    </basic>
                    <advanced
                        jcr:primaryType="nt:unstructured"
                        jcr:title="Advanced"
                        sling:resourceType="granite/ui/components/coral/foundation/container">
                        <items jcr:primaryType="nt:unstructured">
                            <backgroundColor
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/form/textfield"
                                fieldLabel="Background Color"
                                fieldDescription="Hex color or 'transparent' (e.g., #ffffff)"
                                name="./backgroundColor"
                                value="transparent"/>
                            <loadingStyle
                                jcr:primaryType="nt:unstructured"
                                sling:resourceType="granite/ui/components/coral/foundation/form/select"
                                fieldLabel="Loading Style"
                                name="./loadingStyle">
                                <items jcr:primaryType="nt:unstructured">
                                    <default
                                        jcr:primaryType="nt:unstructured"
                                        text="Default"
                                        value="default"
                                        selected="{Boolean}true"/>
                                    <light
                                        jcr:primaryType="nt:unstructured"
                                        text="Light"
                                        value="light"/>
                                    <dark
                                        jcr:primaryType="nt:unstructured"
                                        text="Dark"
                                        value="dark"/>
                                </items>
                            </integrationMode>
                        </items>
                    </advanced>
                </items>
            </tabs>
        </items>
    </content>
</jcr:root>
```

#### 3. Create the HTL Template

**`needle-engine.html`** (Component Rendering):
```html
<sly data-sly-use.clientlib="/libs/granite/sightly/templates/clientlib.html">
    <sly data-sly-call="${clientlib.js @ categories='myproject.needle-engine'}"/>
</sly>

<div class="needle-engine-wrapper"
     data-project-url="${properties.projectUrl}"
     data-integration-mode="${properties.integrationMode || 'iframe'}"
     data-height="${properties.height || '600'}"
     data-enable-ar="${properties.enableAR}"
     data-autoplay="${properties.autoplay}"
     data-background-color="${properties.backgroundColor}"
     data-loading-style="${properties.loadingStyle}">

    <sly data-sly-test="${properties.integrationMode == 'webcomponent'}">
        <!-- Direct Web Component Integration -->
        <script type="module" src="https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js"></script>
        <needle-engine
            src="${properties.projectUrl}"
            background-color="${properties.backgroundColor || 'transparent'}"
            loading-style="${properties.loadingStyle || 'default'}"
            style="width: 100%; height: ${properties.height}px;">
        </needle-engine>
    </sly>

    <sly data-sly-test="${properties.integrationMode != 'webcomponent'}">
        <!-- iframe Integration -->
        <iframe
            src="${properties.projectUrl}"
            allow="xr; xr-spatial-tracking; fullscreen; accelerometer; gyroscope; camera; microphone"
            style="width: 100%; height: ${properties.height}px; border: none;"
            allowfullscreen>
        </iframe>
    </sly>
</div>

<sly data-sly-test="${wcmmode.edit}">
    <div class="needle-engine-placeholder" style="background: #f5f5f5; padding: 20px; text-align: center; border: 2px dashed #ccc;">
        <p><strong>Needle Engine 3D Experience</strong></p>
        <p style="font-size: 0.9em; color: #666;">
            <sly data-sly-test="${properties.projectUrl}">
                URL: ${properties.projectUrl}
            </sly>
            <sly data-sly-test="${!properties.projectUrl}">
                Configure this component to add a 3D experience
            </sly>
        </p>
    </div>
</sly>
```

#### 4. Add Client Library (Optional for Enhanced Features)

**`clientlibs/.content.xml`**:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<jcr:root xmlns:cq="http://www.day.com/jcr/cq/1.0"
          xmlns:jcr="http://www.jcp.org/jcr/1.0"
    jcr:primaryType="cq:ClientLibraryFolder"
    categories="[myproject.needle-engine]"
    embed="[core.wcm.components.commons.site.link]"/>
```

**`clientlibs/js/needle-loader.js`** (Optional enhancements):
```javascript
(function() {
    'use strict';

    // Add responsive behavior or custom initialization
    document.addEventListener('DOMContentLoaded', function() {
        const wrappers = document.querySelectorAll('.needle-engine-wrapper');

        wrappers.forEach(function(wrapper) {
            // Add responsive height adjustments
            const iframe = wrapper.querySelector('iframe');
            const webComponent = wrapper.querySelector('needle-engine');

            if (iframe || webComponent) {
                // Custom initialization logic here
                console.log('Needle Engine component initialized');
            }
        });
    });
})();
```

#### 5. Deploy and Use

1. **Deploy the component** to your AEM instance
2. **Add component to page template** policy (if using editable templates)
3. **Authors can now:**
   - Drag the "Needle Engine 3D" component onto pages
   - Configure project URL and options through the dialog
   - Preview in edit mode
   - Publish with the page

:::tip Content Workflow
Recommended workflow: 3D artists update content in Unity/Blender ‚Üí Export via Needle ‚Üí Deploy to Needle Cloud ‚Üí AEM authors update URL in component ‚Üí Publish
:::

---

## Approach 3: Direct Web Component Integration

**Best for:** Custom AEM templates where you want full control over layout and integration with existing page JavaScript.

This approach embeds Needle Engine directly into AEM templates without using iframes.

### Steps

1. **Add Needle Engine to your AEM clientlib**

   **`/apps/myproject/clientlibs/clientlib-site/js.txt`**:
   ```
   #base=js
   needle-engine.js
   ```

   **`/apps/myproject/clientlibs/clientlib-site/js/needle-engine.js`**:
   ```javascript
   // Load Needle Engine from CDN
   const script = document.createElement('script');
   script.type = 'module';
   script.src = 'https://cdn.jsdelivr.net/npm/@needle-tools/engine/dist/needle-engine.min.js';
   document.head.appendChild(script);
   ```

2. **Add to your page template** (HTL):

   ```html
   <div class="container">
       <div class="row">
           <div class="col-md-6">
               <!-- Your AEM content -->
               <h1>${properties.title}</h1>
               <p>${properties.description}</p>
           </div>
           <div class="col-md-6">
               <!-- Needle Engine content -->
               <needle-engine
                   src="https://your-project.needle.run/assets/scene.glb"
                   background-color="transparent"
                   style="width: 100%; height: 500px;">
               </needle-engine>
           </div>
       </div>
   </div>
   ```

3. **For dynamic content**, use Sling Models:

   **Java Sling Model**:
   ```java
   @Model(adaptables = Resource.class)
   public class NeedleEngineModel {

       @ValueMapValue
       private String projectUrl;

       @ValueMapValue
       private String backgroundColor;

       @ValueMapValue
       private Integer height;

       public String getProjectUrl() {
           return projectUrl;
       }

       public String getBackgroundColor() {
           return backgroundColor != null ? backgroundColor : "transparent";
       }

       public Integer getHeight() {
           return height != null ? height : 600;
       }
   }
   ```

   **HTL Template**:
   ```html
   <sly data-sly-use.model="com.myproject.models.NeedleEngineModel">
       <needle-engine
           src="${model.projectUrl}"
           background-color="${model.backgroundColor}"
           style="width: 100%; height: ${model.height}px;">
       </needle-engine>
   </sly>
   ```

---

## Approach 4: Experience Fragments

**Best for:** Reusable 3D content across multiple pages or channels (email, mobile app, etc.).

Experience Fragments let you create reusable Needle Engine content that can be shared across pages and exported to other channels.

### Steps

1. **Create an Experience Fragment template** with Needle Engine component

2. **Content authors can:**
   - Create an Experience Fragment with 3D content
   - Configure the Needle Engine component once
   - Reuse across multiple pages
   - Export to Adobe Target for personalization
   - Use in email campaigns or mobile apps

3. **Reference the fragment** on pages:
   ```html
   <sly data-sly-resource="${'/content/experience-fragments/myproject/needle-3d-hero' @ resourceType='cq/experience-fragments/components/experiencefragment'}"></sly>
   ```

:::tip Multi-Channel Content
Experience Fragments are especially powerful when you need the same 3D content across web, mobile apps, and email campaigns. Configure once, use everywhere.
:::

---

## Advanced Integration: Communication Between AEM and Needle

For advanced use cases where AEM content needs to interact with Needle Engine (e.g., clicking an AEM button triggers an animation in the 3D scene).

### Example: Triggering 3D Animations from AEM

**AEM Component JavaScript**:
```javascript
// In your AEM component's clientlib
document.querySelector('.my-aem-button').addEventListener('click', function() {
    // Get reference to Needle Engine
    const needleEngine = document.querySelector('needle-engine');

    if (needleEngine && needleEngine.context) {
        // Dispatch custom event that Needle scripts can listen to
        const event = new CustomEvent('aem-trigger', {
            detail: { action: 'playAnimation', animationName: 'Rotate' }
        });
        needleEngine.dispatchEvent(event);
    }
});
```

**Needle Engine Component (TypeScript)**:
```typescript
import { Behaviour } from "@needle-tools/engine";

export class AEMIntegration extends Behaviour {

    start() {
        // Listen for events from AEM
        this.context.domElement.addEventListener('aem-trigger', (evt: CustomEvent) => {
            const { action, animationName } = evt.detail;

            if (action === 'playAnimation') {
                this.playAnimation(animationName);
            }
        });
    }

    private playAnimation(name: string) {
        // Your animation logic here
        console.log('Playing animation:', name);
    }
}
```

---

## Asset Management Considerations

### Where to Host Needle Engine Projects

| Option | Best For | Pros | Cons |
|--------|----------|------|------|
| **Needle Cloud** | Quick iteration, dev/staging | Fast deployment, preview sharing | May want custom domain for production |
| **AEM DAM** | Enterprise compliance, single platform | Integrated with AEM, compliance | Larger asset sizes, may need CDN |
| **Separate CDN** | Performance-critical apps | Fast global delivery, cache control | Additional infrastructure |
| **AEM Publish** | Simple setups | No extra infrastructure | Not optimized for 3D assets |

### Recommended Setup

1. **Development**: Host on Needle Cloud for rapid iteration
2. **Staging**: Host on AEM staging environment or dedicated CDN
3. **Production**: Host on CDN (CloudFront, Akamai, etc.) with AEM URLs stored in component properties

---

## Content Author Workflow

A typical workflow for content authors:

1. **Receive 3D content** from design/development team
   - Deployed to Needle Cloud or CDN
   - Provided with URL

2. **Add to AEM page**
   - Drag Needle Engine component onto page
   - Configure URL and options in dialog
   - Preview in edit mode

3. **Adjust properties** as needed
   - Height, background color, AR features
   - Integration mode (iframe vs direct)

4. **Publish** the page

:::tip For Content Authors
The Needle Engine component works like any other AEM component. Just paste the URL of your 3D experience and configure the display options. No coding required!
:::

---

## Performance Best Practices

1. **Use CDN for assets**
   - Host `.glb` files and textures on a CDN
   - Leverage AEM Dispatcher caching for static resources

2. **Lazy loading**
   - Load Needle Engine only when the component is visible
   - Use Intersection Observer API

3. **Optimize 3D content**
   - Keep `.glb` files under 10MB when possible
   - Use texture compression
   - [See optimization guide](/docs/how-to-guides/optimization/)

4. **AEM Dispatcher configuration**
   ```apache
   # Allow caching of Needle Engine assets
   /cache {
       /rules {
           /0001 {
               /glob "*.glb"
               /type "allow"
           }
           /0002 {
               /glob "*.bin"
               /type "allow"
           }
       }
   }
   ```

---

## Security Considerations

1. **Content Security Policy (CSP)**

   Add Needle Engine domains to your AEM CSP:
   ```
   Content-Security-Policy:
       script-src 'self' https://cdn.jsdelivr.net;
       connect-src 'self' https://needle.run https://*.needle.run;
       worker-src 'self' blob:;
   ```

2. **Permissions for XR Features**

   Ensure your AEM pages allow necessary permissions:
   ```html
   <meta http-equiv="Permissions-Policy" content="
       xr-spatial-tracking=*,
       accelerometer=*,
       gyroscope=*,
       camera=*
   ">
   ```

3. **Asset Access Control**
   - Use AEM's built-in authentication if hosting on AEM
   - Consider signed URLs for sensitive 3D content

---

## Troubleshooting

### Component not appearing in edit mode

**Check:**
- Component is added to page template policy
- Component group is correct
- Author has necessary permissions

### 3D content not loading

**Check:**
- Project URL is accessible (open in browser)
- CORS headers are set correctly on hosting server
- CSP allows loading from external domains
- Browser console for errors

### Performance issues

**Check:**
- File sizes of `.glb` files
- Number of polygons in 3D models
- Texture resolutions
- [Run optimization guide](/docs/how-to-guides/optimization/)

---

## Example: Complete Integration

Here's a complete example combining multiple approaches:

```
Your AEM Site
‚îú‚îÄ‚îÄ Page Template
‚îÇ   ‚îú‚îÄ‚îÄ Header (standard AEM)
‚îÇ   ‚îú‚îÄ‚îÄ Hero with Needle 3D (Custom Component)
‚îÇ   ‚îú‚îÄ‚îÄ Feature Grid (standard AEM)
‚îÇ   ‚îî‚îÄ‚îÄ Product Showcase (Experience Fragment with Needle)
‚îÇ
‚îî‚îÄ‚îÄ Content Structure
    ‚îú‚îÄ‚îÄ /content/mysite/en/products
    ‚îÇ   ‚îú‚îÄ‚îÄ product-a (uses inline Needle component)
    ‚îÇ   ‚îî‚îÄ‚îÄ product-b (uses shared Experience Fragment)
    ‚îÇ
    ‚îî‚îÄ‚îÄ /content/experience-fragments/mysite
        ‚îî‚îÄ‚îÄ product-3d-viewer (reusable across site)
```

---

## Next Steps

**Learn More:**
- [Embedding Guide](/docs/how-to-guides/deployment/embedding) ‚Äì Additional embedding techniques
- [Web Component Attributes](/docs/reference/needle-engine-attributes) ‚Äì Configure Needle Engine
- [Needle Cloud](/docs/cloud/) ‚Äì Quick deployment platform

**Get Help:**
- [Forum](https://forum.needle.tools) ‚Äì Ask questions about AEM integration
- [Discord](https://discord.needle.tools) ‚Äì Get real-time help
- [Examples](https://needle.tools/samples) ‚Äì See Needle Engine in action

:::tip Need Help?
Integrating with enterprise CMS platforms can be complex. Reach out on our [forum](https://forum.needle.tools) or [Discord](https://discord.needle.tools) for specific AEM integration questions.
:::
Source: https://engine.needle.tools/docs/how-to-guides/integrations/adobe-experience-manager.html

---
title: Integrating with Framer
---

# <logo-header logo="/imgs/framer-logo.webp" alt="Framer">Integrating with Framer</logo-header>

The easiest way to integrate with [Framer](https://framer.com) is to use the [Needle Engine Framer Plugin](https://www.framer.com/marketplace/plugins/needle-engine/).   

## Add a 3D embed to your Framer project

1. Deploy your project to Needle Cloud (or use a different hosting provider)

2. In Framer click on the menu item `Insert/Plugins/Browse All` to find the Needle Engine Framer plugin

    ![](/imgs/framer-plugin-01.jpg)

3. Search for `Needle Engine` and add the plugin to your project

    ![](/imgs/framer-plugin-02.jpg)

4. In the Needle Engine panel click on `Add Needle Engine` and add the URL of your deployed project.

    ![](/imgs/framer-plugin-03.jpg)

5. Select the added element and in the `3D Model URL` field add the URL of your deployed project.

    ![](/imgs/framer-plugin-04.jpg)

6. You can now adjust the size and position of your Needle Engine project in Framer.

    ![](/imgs/framer-plugin-05.jpg)

## Add a 3D website to your Framer project

**Example: [Framer Example Website](https://enchanted-chart-098958.framer.app/)** embedding the LookAtCursor sample

With Needle Engine 4.11 we add support for directly embedding a Needle Engine project into a framer website. This allows you to use the full power of Needle Engine to create interactive 3D websites and integrate them into your Framer project. 

1. To use simply paste your `needle.run` URL (this is the URL of your Needle Cloud hosted projects) into the `src` field of the Needle Engine Framer plugin.  

2. Set `Use iFrame` to OFF to use the direct embedding option.

3. That's it! Your Needle Engine project is now running on your Framer website.

<br/>

## There are more integration options

See [Embedding a Needle project into an existing website](/docs/how-to-guides/deployment/embedding#platform-specific-integrations) for more options and details.
Source: https://engine.needle.tools/docs/how-to-guides/integrations/framer.html

---
title: Integrating with Wordpress
---

# <logo-header logo="/imgs/wordpress-logo.webp" alt="WordPress">Integrating with WordPress</logo-header>

The easiest way to integrate with WordPress is to use an iframe. This way, you can host your Needle Engine project anywhere, and just embed it into your WordPress page.

## Embedding a Needle project as iframe

1. Deploy your project to Needle Cloud

2. Add the following code snippet to your Wordpress page, replacing the `src` URL with the URL of your deployed project.

    ```html
    <!-- Embedding a Needle Engine project as iframe -->
    <iframe src="https://focus-rect-demo-z23hmxbztexgt-z19e07i.needle.run/"
        style="width: 100%; height: 500px; border: none;">
    </iframe>
    ```

:::tip Get Embed code from Needle Cloud

Needle Cloud offers an easy way to get the embed code for your project. Just open your project in Needle Cloud, and click on the "Share" button. There, you can find the embed code snippet ready to copy.

:::

## There are more integration options

See [Embedding a Needle project into an existing website](/docs/how-to-guides/deployment/embedding#platform-specific-integrations) for more options and details.
Source: https://engine.needle.tools/docs/how-to-guides/integrations/wordpress.html

---
title: Optimization & Compression
---

# Optimization & Compression

**Make your Needle Engine projects load faster and run smoother.** Learn about compression formats, build types, and optimization techniques to deliver the best experience to your users.

:::tip Also See
- **[Deployment Platforms](/docs/how-to-guides/deployment/)** - Deploy to Netlify, Vercel, GitHub Pages, and more
- **[Export Guide](/docs/how-to-guides/export/)** - Best practices for assets
:::

---

## Understanding Build Types

### Development Builds

Development builds are optimized for fast iteration during development:
- **No texture compression** (KTX2) ‚Äì faster build times
- **No mesh compression** (Draco) ‚Äì faster build times
- **No progressive loading** ‚Äì simpler debugging
- **Larger file sizes** ‚Äì not suitable for production

**When to use:** During active development and testing.

### Production Builds

Production builds are optimized for performance and file size:
- **Texture compression** using KTX2 (ETC1S or UASTC)
- **Mesh compression** using Draco or Meshopt
- **Progressive texture loading** for faster initial load
- **Automatic mesh LODs** for better performance
- **Minimal file sizes** for fast loading

**When to use:** For deployment to production websites.

See guides in your Editor (Unity or Blender) for accessing build options.

---

## Production Build Setup

### Required: Install toktx

To make production builds, you need [toktx](https://github.com/KhronosGroup/KTX-Software/releases) installed for texture compression using the KTX2 supercompression format.

**Installation:**
1. Go to the [toktx Releases Page](https://github.com/KhronosGroup/KTX-Software/releases)
2. Download and install the latest version (v4.1.0 or newer)
3. Restart Unity after installation

:::tip Troubleshooting
If you've installed toktx and it's in your PATH but can't be found, restart your machine and try building again.
:::

:::details Troubleshooting: Toktx cannot be found (Windows)
Make sure you have added toktx to your system environment variables. You may need to restart your computer after adding it to refresh the environment variables.

**Default install location:** `C:\Program Files\KTX-Software\bin`
![Environment Variables](/imgs/ktx-env-variable.webp)
:::

:::details Advanced: Custom glTF extensions
If you plan on adding custom glTF extensions, building for production requires handling those in `gltf-transform`. See [@needle-tools/gltf-build-pipeline](https://www.npmjs.com/package/@needle-tools/gltf-build-pipeline) for reference.
:::

---

## Texture Compression

Production builds compress textures using **KTX2** (ETC1S or UASTC) or **WebP** depending on your settings and quality requirements.

### Choosing Between ETC1S, UASTC and WebP

| Format | ETC1S | UASTC | WebP |
| --- | --- | --- | --- |
| **GPU Memory Usage** | Low | Low | High (uncompressed) |
| **File Size** | Low | High | Very low |
| **Quality** | Medium | Very high | Depends on quality setting |
| **Typical usage** | Works for everything, best for color textures | High-detail data textures: normal maps, roughness, metallic | Files where ETC1S quality is insufficient but UASTC is too large |

**Quick Guide:**
- **Color textures, UI**: Use ETC1S for small file size
- **Normal maps, detail textures**: Use UASTC for maximum quality
- **Photography, detailed textures**: Use WebP if ETC1S quality isn't sufficient

### Setting Compression Per Texture

You can override compression settings for individual textures using the Needle Texture Importer (Unity) or Material tab (Blender).

:::details Unity: Global compression settings
Configure default compression for all textures:

![Unity Compression Settings](/imgs/unity-compression-settings.png)
:::

:::details Unity: Per-texture compression overrides
Use the Compression & LOD Settings component to override settings for specific textures. Assign all textures you want to override in the component.

![Unity Individual Texture Settings](/imgs/unity-compression-settings-individual.png)
:::

:::details Blender: Per-texture compression settings
Select the Material tab to see compression options for all textures used by that material.

![Texture Compression in Blender](/blender/texture-compression.webp)
:::

---

## Mesh Compression

Production builds compress meshes to reduce file size and improve loading times.

### Choosing Between Draco and Meshopt

| Format | Draco | Meshopt |
| --- | --- | --- |
| **GPU Memory Usage** | Medium | Low |
| **File Size** | Lowest | Low |
| **Animation compression** | No | Yes |

**Quick Guide:**
- **Static meshes**: Use Draco for smallest file size
- **Animated meshes**: Use Meshopt (supports animation compression)

By default, production builds use Draco compression. Use the `MeshCompression` component to choose between Draco and Meshopt per exported glTF.

:::details Unity: Mesh compression settings
Use the Compression & LOD Settings component to select compression type:

![Unity Mesh Compression Options](/imgs/unity-mesh-compression-options.jpg)

- **Current scene**: Add component anywhere in your root scene
- **Prefab or NestedGltf**: Add to a `GltfObject` or the prefab referenced by your components
- **Referenced scene**: Add to the referenced scene that is exported
:::

:::details Unity: Mesh simplification to reduce vertex count
Use the Compression & LOD Settings component to configure mesh simplification for production builds. Append `?wireframe` to your URL to preview meshes in the browser.

![Unity Mesh Compression Options](/imgs/unity-mesh-compression-options.jpg)
:::

---

## Progressive Texture Loading (Texture LODs)

**Significantly reduce initial loading time** by loading low-resolution textures first, then upgrading to full quality when visible.

Add the `Progressive Texture Settings` component anywhere in your scene to enable progressive loading for all textures. Progressive loading is not applied to lightmaps or skybox textures.

**Benefits:**
- Much faster initial load times
- Full quality loaded on-demand
- Seamless quality transitions

:::details Unity: Enable progressive texture loading
Use the Compression & LOD Settings component to enable progressive loading globally. Can be disabled or enabled for individual textures as needed.

![Unity Compression Settings](/imgs/unity-compression-settings.png)
:::

---

## Automatic Mesh LODs (Level of Detail)

**Since Needle Engine 3.36**, mesh LODs are automatically generated during builds and chosen at runtime based on mesh density and screen size.

**Key Benefits:**
- Faster initial loading time
- Better rendering performance (fewer vertices on screen)
- Faster raycasting with LOD meshes
- Automatic on-demand loading

:::details Unity: Control LOD generation
Use the Compression & LOD Settings component to control LOD generation for all meshes or individual meshes.

![Unity Mesh Compression Options](/imgs/unity-mesh-compression-options.jpg)
:::

---

## Build Options

### <logo-header logo="/imgs/unity-logo.webp" alt="Unity">Unity Build Window</logo-header>

Open **File ‚Üí Needle Engine ‚Üí Build Window**:

![Unity Build Window](/imgs/unity-build-window-2.jpg)

**Available Options:**

- **Build to Disk** ‚Äì Create production build in the `dist` folder
- **Preview Build** ‚Äì Build and start a local server to preview the final result
- **Development Build** ‚Äì Disable compression for debugging (not recommended for production)

:::tip Node.js is only required during development
The distributed website (using our default Vite template) is a static page that doesn't rely on Node.js and can be hosted on any regular web server.

Node.js is only required if you want to run our minimalistic networking server for multiplayer experiences.
:::

---

## Optimization Best Practices

### Texture Optimization

**File size matters:**
- Use the smallest texture resolution that looks good
- Enable progressive loading for large textures
- Use appropriate compression format (ETC1S vs UASTC vs WebP)
- Avoid unnecessarily large texture atlases

**GPU memory matters:**
- Use KTX2 formats (ETC1S or UASTC) instead of WebP when possible
- WebP textures are uncompressed in GPU memory

### Mesh Optimization

**Reduce vertex count:**
- Use mesh simplification in production builds
- Enable automatic LOD generation
- Remove unnecessary geometry before export

**Reduce draw calls:**
- Combine meshes when possible
- Use instancing for repeated objects
- Minimize unique materials

### Scene Optimization

**Reduce initial load time:**
- Enable progressive texture loading
- Use automatic mesh LODs
- Load large scenes progressively with `SceneSwitcher`
- Use `AssetReference` for on-demand loading

**Improve runtime performance:**
- Optimize physics colliders (simpler shapes when possible)
- Disable unnecessary components
- Use object pooling for frequently spawned objects
- Profile with browser DevTools and Needle Inspector

---

## Troubleshooting

### Build errors during compression

**Problem:** Production build fails during compression

**Solution:**
1. Toggle **Development Build** on in Build Settings to get unstuck immediately
2. Report the bug to [Needle support](/docs/help/)
3. Check that toktx is installed and in your PATH

### Website doesn't work after upload

**Problem:** Deployed website shows errors or doesn't load

**Solution:**
- **Option 1:** Enable gzip compression on your server (see [.htaccess example](/docs/how-to-guides/deployment/#enabling-gzip-using-a-htaccess-file))
- **Option 2:** Turn off gzip compression in **File ‚Üí Needle Engine ‚Üí Build Window**

![Build Options Gzip](/deployment/buildoptions_gzip.jpg)

---

## Related Documentation

- **[Deployment Platforms](/docs/how-to-guides/deployment/)** - Deploy to Netlify, Vercel, GitHub Pages, and more
- **[Export Guide](/docs/how-to-guides/export/)** - Best practices for exporting 3D assets
- **[Debugging Parameters](/docs/how-to-guides/debugging/)** - Performance profiling and debugging
- **[Needle Inspector](/docs/three/needle-devtools-for-threejs-chrome-extension)** - Chrome DevTools for three.js
- **[Help & Community](/docs/help/)** - Get support and ask questions
Source: https://engine.needle.tools/docs/how-to-guides/optimization/index.html

# Networking Concepts

Understanding the core concepts of multiplayer networking in Needle Engine.

---

## Rooms and State

At the heart of networking in Needle Engine is the concept of synchronized rooms. Each room has an ID, and users connect to a room by providing this ID. Rooms are stored on a server, and users can join and leave rooms at any time.

When a user joins a room, they receive the current state of the room, apply that current state to their scene, and then listen for changes to the room state.
When a user leaves a room, they stop listening for changes to the room state.

Room state is stored as JSON data on the server, so all changes are persistent. This means that room state is not only useful for networking, but also for persisting actions of a single user.

Needle can provide _view-only IDs_ for rooms. When accessing a room with a view-only ID, the user will not be able to interact with the room, but will be able to see the current state and get live updates. This is useful for presentations or demonstrations.

---

## Ownership

Objects in a room can be _owned_ by a user. This means that only the owner of an object can change its state.

By default, objects have no owner.

Components like `DragControls` will request ownership of an object before actually moving it.

In custom components, you can control how ownership is handled.
There may be no ownership required, ownership may be allowed to be transferred to another user automatically, or ownership may be transferred only by a specific action.

When a user leaves a room, objects owned by that user will either be deleted or have ownership reset, depending on how the object was created.

---

## Related

- [Networking Overview](./index) - Getting started with networking
- [Sync Component State](./sync-state) - Use @syncField for automatic syncing
- [Manual Networking](./manual-networking) - Low-level networking API
Source: https://engine.needle.tools/docs/how-to-guides/networking/concepts.html

# Host Your Own Networking Server

**Deploy custom networking infrastructure for production and large-scale deployments.**

By default, networked Needle scenes connect to cloud infrastructure managed by Needle. For production deployments, larger audiences, or custom requirements, you can host your own networking server.

## Needle's Default Networking Server

::: tip Free Default Server - Sufficient for Most Projects
Needle provides a **free, production-ready networking server** that's suitable for most projects:

**Server URL:** `https://networking.needle.tools`
**WebSocket Endpoint:** `wss://networking.needle.tools`

This default server:
- Works out of the box with no configuration needed
- Supports up to 15-20 concurrent users per room
- Handles state synchronization and persistence
- Has global availability and low latency
- Is free to use for all Needle Engine projects

**You only need a custom server if:**
- You need more than 15-20 concurrent users per room
- You require custom server-side logic or validation
- You need data sovereignty or on-premises hosting
- You want full control over infrastructure and costs
:::

## When to Use Custom Servers

Consider hosting your own networking server when you need:
- **Scale** - More than 15-20 concurrent users per room
- **Control** - Full control over infrastructure and implementation
- **Custom Logic** - Server-side validation, custom message handling
- **Data Sovereignty** - Keep data in specific regions or on-premises
- **Cost Optimization** - Predictable costs for high-traffic scenarios

## Using Needle Networking Servers

Needle provides a ready-to-use networking server as an NPM package that you can deploy anywhere.

## Self-Hosted Server Setup

### Installation

The networking server is available as a Node.js package:

```bash
npm install @needle-tools/needle-networking
```

### Integration

Choose your web framework:

::: code-tabs

@tab Fastify
```js
import networking from "@needle-tools/needle-networking";
networking.startServerFastify(fastifyApp, { endpoint: "/socket" });
```

@tab Express
```js
import networking from "@needle-tools/needle-networking";
networking.startServerExpress(expressApp, { endpoint: "/socket" });
```

@tab Custom Framework
```js
import { init, onConnection } from "@needle-tools/networking";

// Add your framework-specific websocket implementation
class WebsocketConnector {
    constructor(frameworkWebsocket) {
        // Your implementation
    }
    on(event, callback) {
        // Handle 'message' and 'close' events
        // Call the callback when receiving messages
    }
    send(key, value) {
        // Send messages to the websocket connection
    }
}

const options = { endpoint: "/socket" };
init(options);

yourFramework.createWebsocketRoute(options.endpoint, frameworkWebsocket => {
    onConnection(new WebsocketConnector(frameworkWebsocket));
});
```

:::

## Configuration Options

The following options are available when starting the server:

| Option | Type | Description | Default |
| --- | --- | --- | --- |
| `options.endpoint` | string | Relative server endpoint (e.g., `/socket` ‚Üí `yourserver/socket`) | `/` |
| `options.maxUsers` | number | Maximum concurrent users on the server | `50` |
| `options.defaultUserTimeout` | number | Time in seconds before a user is considered disconnected | `30` |

### Environment Variables

| Variable | Description | Default |
| --- | --- | --- |
| `VIEW_ONLY_SALT` | Salt for generating view-only room IDs from regular room IDs | Predefined value |
| `NEEDLE_NETWORKING_S3_*` | S3 storage configuration (see below) | Not set (uses disk storage) |

## State Storage

### Default Storage (Disk)

By default, network state is stored as JSON files in the `/.data` directory:
- Each room has its own file
- State is sent to clients when they join a room
- Simple and works out of the box
- Suitable for development and small deployments

### S3-Compatible Storage

For production deployments, you can use S3-compatible storage providers (AWS S3, MinIO, DigitalOcean Spaces, etc.):

```bash
NEEDLE_NETWORKING_S3_ENDPOINT=https://your-s3-endpoint.com
NEEDLE_NETWORKING_S3_REGION=us-east-1
NEEDLE_NETWORKING_S3_BUCKET=your-bucket-name
NEEDLE_NETWORKING_S3_ACCESS_KEY_ID=your-access-key
NEEDLE_NETWORKING_S3_ACCESS_KEY=your-secret-key
NEEDLE_NETWORKING_S3_PREFIX=my_state/ # Optional prefix for all state files
```

## Local Development Server

For testing and development, run a local networking server:

### Setup

1. Download the local server from [github.com/needle-tools/networking-local](https://fwd.needle.tools/needle-engine/local-networking-repository)
2. Follow the README instructions to set up the server
3. The server will run on `wss://localhost:9001/socket` by default

### Configure Your Scene

1. Add a `Networking` component to your scene
2. Paste the local server address into the "Localhost" field:
   ```
   wss://localhost:9001/socket
   ```

![Needle Engine Networking component with custom server](/imgs/networking_absolute.webp)

## Different Servers for Development and Production

You can use different server URLs for local development and hosted deployment:

**In the Networking component:**
- **Localhost** - Used during local development
- **Production** - Used when your app is deployed

This allows you to:
- Test with a local server during development
- Automatically use production servers when deployed
- Avoid hardcoding server URLs

## Deployment

The networking server can be deployed to any Node.js hosting provider:

### Recommended Platforms

- **Google Cloud Run** - Serverless, auto-scaling
- **AWS EC2 / ECS** - Full control, scalable
- **Azure App Service** - Managed Node.js hosting
- **DigitalOcean App Platform** - Simple deployment
- **Railway** - Easy deployment with git integration
- **Render** - Modern deployment platform

### Deployment Checklist

- [ ] Set appropriate `maxUsers` limit
- [ ] Configure S3 storage for persistence (recommended)
- [ ] Set up SSL/TLS certificates (wss:// required)
- [ ] Configure CORS if needed
- [ ] Set up monitoring and logging
- [ ] Test with expected user load
- [ ] Configure auto-scaling if supported

## Advanced: WebRTC Customization

For voice chat (`VoIP`) and screen sharing (`ScreenCapture`), Needle Engine uses [peer.js](https://peerjs.com/) with WebRTC.

To use custom ICE/STUN/TURN servers:

```ts
import { setPeerOptions } from "@needle-tools/engine";

setPeerOptions({
    config: {
        iceServers: [
            { urls: 'stun:your-stun-server.com:19302' },
            {
                urls: 'turn:your-turn-server.com:3478',
                username: 'username',
                credential: 'password'
            }
        ]
    }
});
```

## Troubleshooting

### Connection Issues

**Problem:** Can't connect to custom server

**Solutions:**
- Verify server is running and accessible
- Check WebSocket endpoint URL (should start with `ws://` or `wss://`)
- Ensure CORS is configured if hosting on different domain
- Check firewall rules allow WebSocket connections

### Performance Issues

**Problem:** Slow or laggy synchronization

**Solutions:**
- Increase server resources (CPU, memory)
- Use S3 storage instead of disk storage
- Deploy server closer to your users (CDN, edge functions)
- Consider using binary messages (Flatbuffers) for high-frequency updates
- Increase `maxUsers` if hitting limits

## Next Steps

**Learn more:**
- [Understanding Networking](/docs/explanation/networking/architecture) - How the networking system works
- [Manual Networking](/docs/how-to-guides/networking/manual-networking) - Custom message handling

**Reference:**
- [Networking Package Repository](https://fwd.needle.tools/needle-engine/packages/needle-engine-networking) - Full server code
- [Local Server Repository](https://fwd.needle.tools/needle-engine/local-networking-repository) - Development server setup
- [Networking Events API](/docs/reference/api/networking-events) - Complete event reference
Source: https://engine.needle.tools/docs/how-to-guides/networking/custom-servers.html

---
title: Networking & Multiplayer
description: Build real-time multiplayer 3D web experiences with Needle Engine. Add shared state synchronization, voice chat (VoIP), screen sharing, and collaborative features with simple components. Supports 15-20 concurrent users on default servers, scalable to thousands with custom infrastructure.
---

# Networking & Multiplayer

**Build multiplayer 3D web experiences with shared state, voice chat, and real-time synchronization.**

Needle Engine includes a full networking solution for multiplayer experiences. Shared world state, voice chat, session persistence, and more can be achieved with our networking components and APIs.

<video-embed src="/docs/videos/networking-example.mp4" autoplay muted />

## Quick Start

Get your first multiplayer scene running in 5 minutes:

1. Add a `SyncedRoom` component to your scene
2. Add `SyncedTransform` to an object
3. Add `DragControls` to make it interactive
4. Open in two browser windows and drag the object!

**[Follow the complete setup guide ‚Üí](./setup)**

## What Can You Build?

- **Collaborative Spaces** - Multiple users exploring and interacting together
- **Multiplayer Games** - Real-time games with synchronized state
- **Virtual Meetings** - Persistent meeting spaces with voice chat
- **Interactive Experiences** - Shared AR/VR experiences across devices
- **Collaborative Design** - Real-time 3D design collaboration

## Choose Your Path

### üéØ First Time with Networking?

Start with the basics:
- **[Enable Networking](./setup)** - Add multiplayer to your project (5 min)
- **[Sync Component State](./sync-state)** - Use `@syncField` for automatic networking
- **[Understanding Networking](/docs/explanation/networking/architecture)** - Learn how it works

### üîß Building Something Specific?

Jump to practical guides:
- **[Sync Component State](./sync-state)** - Automatic networking with `@syncField`
- **[Manual Networking](./manual-networking)** - Send and receive custom messages
- **[Host Your Own Server](./custom-servers)** - Deploy custom networking infrastructure

### üìö Want to Understand How It Works?

Learn the concepts:
- **[Networking Architecture](/docs/explanation/networking/architecture)** - Rooms, ownership, and state
- **[Message Types](/docs/explanation/networking/architecture#message-types)** - JSON vs Binary (Flatbuffers)
- **[WebRTC for Voice](/docs/explanation/networking/architecture#webrtc-for-voice-and-video)** - How voice chat works

### üìñ Looking for Reference?

Find specific information:
- **[Networking Events](/docs/reference/api/networking-events)** - Complete event reference
- **[Built-in Components](/docs/reference/components#networking)** - Networking component catalog
- **[API Documentation](https://engine.needle.tools/docs/api/latest)** - TypeScript API docs

## Built-in Networking Components

| Component | Description |
| --- | --- |
| `SyncedRoom` | Handles networking connection and room management |
| `SyncedTransform` | Synchronizes object transforms (position, rotation, scale) |
| `SyncedCamera` | Spawns a prefab for each user showing their viewpoint |
| `VoIP` | Voice-over-IP audio connections between users |
| `ScreenCapture` | Screen sharing via web APIs - [Example](https://engine.needle.tools/samples/screensharing) |
| `Networking` | Customize server backend URL or use local server |
| `DragControls` | Drag objects with automatic ownership transfer |
| `Duplicatable` | Duplicate objects across the network |
| `Deletable` | Delete objects across the network |
| `DeleteBox` | Delete objects when dragged into a volume |
| `PlayerSync` | Instantiate an object for each connected player |
| `PlayerState` | Component for objects instantiated by `PlayerSync` |
| `PlayerColor` | Assign each user a random color |
| `WebXR` | Synchronize VR/AR avatars (hands and heads) |

## Default Networking Infrastructure

By default, Needle scenes connect to cloud infrastructure managed by Needle:
- ‚úÖ No additional setup needed
- ‚úÖ Currently no additional cost
- ‚úÖ Works fine for 15-20 concurrent users per room
- ‚úÖ Perfect for prototyping and small deployments

For production or larger deployments, you can [host your own server](./custom-servers).

## Common Questions

### How many users can connect?

**Default servers:** Around 15-20 concurrent users per room works well.

**Custom servers:** Scalable to hundreds or thousands of users depending on your infrastructure.

### Is voice chat included?

Yes! Use the `VoIP` component for voice chat and the `ScreenCapture` component for screen sharing. Both use WebRTC (peer.js) for direct peer-to-peer connections.

### Can I use my own server?

Absolutely! The networking server is available as an [NPM package](https://fwd.needle.tools/needle-engine/packages/needle-engine-networking) and can be deployed anywhere. See [Custom Servers](./custom-servers) for details.

### How is state persisted?

Room state is automatically saved on the server as JSON. When new users join, they receive the current state. You can configure storage to use disk (default) or S3-compatible services.

### Can I send custom messages?

Yes! Use [manual networking](./manual-networking) for complete control over messages. You can send JSON or binary (Flatbuffer) messages with custom data.

## How-To Guides

**Setup & Basics:**
- [Enable Networking](./setup) - Add multiplayer to your project
- [Sync Component State](./sync-state) - Use `@syncField` decorator

**Advanced:**
- [Manual Networking](./manual-networking) - Send custom messages
- [Host Your Own Server](./custom-servers) - Deploy custom infrastructure

## Learn More

**Understanding:**
- [Networking Architecture](/docs/explanation/networking/architecture) - How networking works
- [Built-in Components](/docs/reference/components#networking) - Component catalog

**Reference:**
- [Networking Events](/docs/reference/api/networking-events) - Complete event reference
- [API Documentation](https://engine.needle.tools/docs/api/latest) - TypeScript API

**Resources:**
- [Networking Package](https://fwd.needle.tools/needle-engine/packages/needle-engine-networking) - NPM package
- [Local Server Setup](https://fwd.needle.tools/needle-engine/local-networking-repository) - Development server

## Next Steps

1. **[Enable Networking](./setup)** - Get started with your first multiplayer scene
2. **[Sync Component State](./sync-state)** - Learn automatic networking
3. **[Understanding Networking](/docs/explanation/networking/architecture)** - Learn the concepts
Source: https://engine.needle.tools/docs/how-to-guides/networking/index.html

# Manual Networking

**Send and receive custom network messages with full control.**

Needle Engine provides a low-level API for sending and receiving messages. We call this "manual networking". The principles are the same as automatic networking, but you're in full control of when to send messages, what data to send, and how to handle incoming messages.

## When to Use Manual Networking

Use manual networking when you need:
- Custom message formats
- Complex data structures
- Fine-grained control over when messages are sent
- High-performance binary messages
- Custom server-side logic

For simple field synchronization, use [`@syncField`](/docs/how-to-guides/networking/sync-state) instead.

## Sending Messages

### Send JSON Messages

Send a message to all users in the same room:

```ts
this.context.connection.send(key: string, data: IModel | object | boolean | string | number | null);
```

**Example:**

```ts
// Send a custom event
this.context.connection.send("player-jumped", {
    playerId: this.playerId,
    height: 2.5,
    timestamp: Date.now()
});
```

### Send Binary Messages (Advanced)

::: warning Advanced - Not Needed for Most Use Cases
Binary messages with FlatBuffers are an **advanced optimization** for very high-frequency updates (100+ messages per second). **Most applications should use JSON messages** which are simpler and easier to work with.
:::

For extreme performance scenarios, send binary (Flatbuffer) messages:

```ts
this.context.connection.sendBinary(byteArray: Uint8Array);
```

See [Using Flatbuffers](#using-flatbuffers) for details.

## Receiving Messages

### Subscribe to Messages

You can subscribe to events in the room using a specific key. Typically, you want to match subscribing with unsubscribing:

**Option 1: Enable/Disable Lifecycle**
Subscribe in `onEnable` and unsubscribe in `onDisable`. With this approach, no messages will be received while the object is disabled.

```ts
onEnable() {
    this.context.connection.beginListen("player-jumped", this.onPlayerJumped);
}

onDisable() {
    this.context.connection.stopListen("player-jumped", this.onPlayerJumped);
}

private onPlayerJumped = (data: any) => {
    console.log("Player jumped:", data.playerId, data.height);
}
```

**Option 2: Start/Destroy Lifecycle**
Subscribe in `start` and unsubscribe in `onDestroy`. With this approach, messages will still be received while the object is disabled.

```ts
start() {
    this.context.connection.beginListen("player-jumped", this.onPlayerJumped);
}

onDestroy() {
    this.context.connection.stopListen("player-jumped", this.onPlayerJumped);
}

private onPlayerJumped = (data: any) => {
    console.log("Player jumped:", data.playerId, data.height);
}
```

### Unsubscribe from Messages

Always unsubscribe when you're done listening:

```ts
this.context.connection.stopListen(key: string);
```

## Message Persistence

When sending network messages, you can control whether messages should be saved in the room state (persistent) or only sent to users currently in the room (non-persistent).

### Persistent Messages

To persist a message, include a `guid` field. This field typically identifies which object the message applies to:

```ts
// This message will be saved in room state
// and sent to users who join later
this.context.connection.send("my-message", {
    guid: this.guid,
    myData: "myValue"
});
```

### Non-Persistent Messages

Messages without a `guid` field are only sent to users currently in the room:

```ts
// This message will NOT be saved in room state
// Only current users receive it
this.context.connection.send("my-message", {
    myData: "myValue"
});
```

### Prevent Persistence (with guid)

To target a specific object (include a `guid`) but still prevent persistence, set `dontSave` to `true`:

```ts
// Send to a specific object but don't persist
this.context.connection.send("my-message", {
    guid: this.guid,
    myData: "myValue",
    dontSave: true
});
```

### Delete on Disconnect

To persist a message but delete it when the user disconnects, use `deleteOnDisconnect`:

```ts
// Persist until the user disconnects
this.context.connection.send("my-message", {
    guid: this.guid,
    myData: "myValue",
    deleteOnDisconnect: true
});
```

### Delete Specific State

To delete state for a specific guid from the backend storage:

```ts
this.context.connection.send("delete-state", {
    guid: "guid_to_delete"
});
```

## Debug Flags

Use these URL parameters to understand network messages:

| Flag | Description |
|------|-------------|
| `?debugnet` | Log all incoming and outgoing network messages |
| `?debugowner` | Log all ownership requests and changes |
| `?debugnetbin` | Log binary message details |

**Example:**
```
http://localhost:3000/?debugnet
```

## Using Flatbuffers (Advanced)

::: warning Advanced Feature - Not Necessary for Most Projects
**You probably don't need this.** FlatBuffers are an advanced optimization for extreme performance scenarios (e.g., 100+ network messages per second).

**For most multiplayer applications**, JSON messages are:
- Much easier to implement and debug
- Fully sufficient for typical gameplay (movement, interactions, chat, etc.)
- Already optimized by Needle Engine

Only consider FlatBuffers if you have profiled your application and confirmed that JSON message serialization is a bottleneck.
:::

Binary messages using [Flatbuffers](https://google.github.io/flatbuffers/) can be faster and more efficient than JSON messages for very high-frequency updates or extremely large data structures.

**Requirements:**
- Define custom FlatBuffer schemas (`.fbs` files)
- Compile schemas to TypeScript using the FlatBuffers compiler
- Register schemas with the networking system
- Write custom serialization/deserialization code

### Register a Schema

```ts
import { registerBinaryType } from '@needle-tools/engine';
import { MyDataModel } from 'my-data-model.js';

const MySchemaIdentifier = "MYSC";

registerBinaryType(MySchemaIdentifier, MyDataModel.getRootAsSyncedTransformModel);
```

### Send Binary Messages

```ts
import { MyDataModel } from 'my-data-model.js';

const MySchemaIdentifier = "MYSC";
const builder = new flatbuffers.Builder();

// Construct a Flatbuffer message
function createMyCustomModel(somePayload: string): Uint8Array {
    builder.clear();
    MyDataModel.startMyDataModel(builder);
    const guidObj = builder.createString(guid);
    MyDataModel.addSomePayload(builder, guidObj);
    const res = MyDataModel.endMyDataModel(builder);
    builder.finish(res, MySchemaIdentifier);
    return builder.asUint8Array();
}

// Send the data
function sendData() {
    const data = createMyCustomModel("your-payload");
    this.context.connection.sendBinary(data);
}
```

### Receive Binary Messages

```ts
import { MyDataModel } from 'my-data-model.js';

const MySchemaIdentifier = "MYSC";

this.context.connection.beginListenBinary(MySchemaIdentifier, (data) => {
    const model = MyDataModel.getRootAsMyDataModel(data);
    console.log("Received binary message", model, model.somePayload());
});
```

### Unsubscribe from Binary Messages

```ts
this.context.connection.stopListenBinary(identifier: string);
```

### Built-in Flatbuffer Schemas

Needle Engine uses these binary schemas internally:

- **SyncedTransform** ('STRS') - High-frequency transform updates
- **SyncedCamera** ('SCAM') - Camera position/rotation sync
- **Vec2/3/4** - Optimized vector types

::: tip Custom Binary Messages
Currently, custom binary messages can't be automatically persisted on the networking server. To enable persistence, you need to modify the networking server to process your custom flatbuffer schemas.
:::

### Flatbuffer Resources

- [Built-in schemas in Needle Engine](https://github.com/needle-tools/needle-engine-support/tree/main/documentation/node_modules/@needle-tools/engine/src/engine-schemes)
- [Generating a schema](https://google.github.io/flatbuffers/flatbuffers_guide_writing_schema.html)
- [Using the schema compiler](https://google.github.io/flatbuffers/flatbuffers_guide_using_schema_compiler.html)
- [Flatbuffers in TypeScript](https://google.github.io/flatbuffers/flatbuffers_guide_use_typescript.html)

## Next Steps

**Learn more:**
- [Host Your Own Server](/docs/how-to-guides/networking/custom-servers) - Deploy custom networking infrastructure
- [Understanding Networking](/docs/explanation/networking/architecture) - Learn how messages work

**Reference:**
- [Networking Events API](/docs/reference/api/networking-events) - Complete event reference
- [Built-in Components](/docs/reference/components#networking) - Networking component catalog
Source: https://engine.needle.tools/docs/how-to-guides/networking/manual-networking.html

# Enable Networking

**Add multiplayer to your Needle Engine project in 5 minutes.**

This guide shows you how to enable networking in your project and test it with synchronized objects across multiple browser windows.

## Quick Start

### Step 1: Add the SyncedRoom Component

Add a `SyncedRoom` component to your scene. By default, this will use networking infrastructure provided by Needle.

**In Unity:**
1. Select a GameObject in your scene (or create a new empty GameObject)
2. Add Component ‚Üí Needle Engine ‚Üí Networking ‚Üí Synced Room

**In Blender:**
1. Select an object in your scene
2. Add Component ‚Üí Networking ‚Üí Synced Room

**In Code (three.js/web):**
```ts
import { SyncedRoom } from "@needle-tools/engine";

const syncedRoom = gameObject.addComponent(SyncedRoom);
```

### Step 2: Add Synchronized Transform

Add a `SyncedTransform` component to an object whose movement you want to synchronize across the network.

**In Unity:**
1. Select the GameObject you want to sync
2. Add Component ‚Üí Needle Engine ‚Üí Networking ‚Üí Synced Transform

**In Blender:**
1. Select the object you want to sync
2. Add Component ‚Üí Networking ‚Üí Synced Transform

### Step 3: Make it Interactive

Add a `DragControls` component to the same object to make it draggable.

**In Unity:**
1. Add Component ‚Üí Needle Engine ‚Üí Interaction ‚Üí Drag Controls

**In Blender:**
1. Add Component ‚Üí Interaction ‚Üí Drag Controls

### Step 4: Test It!

1. **Run your project** - Start the development server
2. **Open in browser** - Navigate to your local development URL (usually `http://localhost:3000`)
3. **Join a room** - Click the "Join Room" button that appears
4. **Copy the URL** - The URL will update with a room ID
5. **Open another window** - Paste the URL in a new browser window (or on another device)
6. **Drag the object** - Try dragging the object in one window and watch it move in the other!

The `DragControls` component has built-in networking support. Ownership will be transferred to whoever starts dragging the object.

## Built-In Components with Networking Support

| Component | Description |
| --- | --- |
| `SyncedRoom` | Handles networking connection and connection to a room |
| `SyncedTransform` | Synchronizes object transforms (position, rotation, scale) |
| `SyncedCamera` | Spawns a prefab for each user showing their viewpoint |
| `VoIP` | Voice-over-IP audio connections between users |
| `ScreenCapture` | Screen sharing via web APIs |
| `Networking` | Customize the server backend URL or use a local server |
| `DragControls` | Drag objects with automatic ownership transfer |
| `Duplicatable` | Duplicate objects across the network |
| `Deletable` | Delete objects across the network |
| `DeleteBox` | Delete objects when dragged into a volume |
| `PlayerSync` | Instantiate an object for each connected player |
| `PlayerState` | Component for objects instantiated by `PlayerSync` |
| `PlayerColor` | Assign each user a random color |
| `WebXR` | Synchronize VR/AR avatars (hands and heads) |

## Configuration Options

### Using a Custom Server

Add a `Networking` component to customize the server backend URL:

**Production Server:**
Set the "Production" URL to your custom server endpoint.

**Development Server:**
Set the "Localhost" URL to test with a local networking server.

![Needle Engine Networking component](/imgs/networking_absolute.webp)

### Room Settings

The `SyncedRoom` component allows you to configure:
- **Room Name** - Custom room identifier (leave empty for auto-generated)
- **Auto Join** - Automatically join the room on load
- **Require Interaction** - User must click to join (required for audio/voice)

## Debug Tools

Add these URL parameters to your page for debugging:

| Parameter | Description |
| --- | --- |
| `?debugnet` | Log all network messages to console |
| `?debugowner` | Log ownership requests and changes |
| `?debugnetbin` | Log binary message details |

**Example:**
```
http://localhost:3000/?debugnet
```

## Next Steps

**Learn more about networking:**
- [Sync Component State](/docs/how-to-guides/networking/sync-state) - Use `@syncField` for automatic networking
- [Manual Networking](/docs/how-to-guides/networking/manual-networking) - Send and receive custom messages
- [Understanding Networking](/docs/explanation/networking/architecture) - Learn how it works

**Advanced:**
- [Host Your Own Server](/docs/how-to-guides/networking/custom-servers) - Deploy custom networking infrastructure
- [Networking Events API](/docs/reference/api/networking-events) - Complete event reference
Source: https://engine.needle.tools/docs/how-to-guides/networking/setup.html

# Sync Component State

**Automatically network your component fields with a single decorator.**

Fields in your custom components can be networked very easily. Changes to the field will automatically be detected and sent to all users in the room. The changes are also persisted as part of the Room State, so users that join later will receive the current state as well.

## Using @syncField

To automatically network a field in a component, decorate it with the `@syncField()` decorator:

:::: code-group
::: code-group-item Sync a number
```ts twoslash
import { Behaviour, syncField } from "@needle-tools/engine"

export class SyncedNumber extends Behaviour {

    // Use `@syncField` to automatically network a field.
    // You can optionally assign a method or method name to be called when the value changes.
    @syncField("myValueChanged")
    mySyncedValue?: number = 1;

    private myValueChanged() {
       console.log("My value changed", this.mySyncedValue);
    }

    onPointerClick() {
       this.mySyncedValue = Math.random();
    }
}
```
:::
::: code-group-item Sync an object's color
<!-- SAMPLE network color change -->
:::
::::

## Change Callbacks

The `@syncField` decorator has an optional parameter to specify a method that should be called when the value changes:

```ts
@syncField("onColorChanged")
color?: Color;

private onColorChanged() {
    // This runs when the color changes
    // Update your object's material, etc.
}
```

The callback method:
- Should be defined in the same class
- Can be a method name (string) or a method reference
- Runs on all clients when the value changes
- Useful for triggering visual updates or side effects

## Project Setup

::: tip Custom Project Setup
If you're using a custom project setup, you need to have `experimentalDecorators: true` in your `tsconfig.json` file for syncField decorators to work. Projects created with Needle Starters have this enabled by default.
:::

## Creating and Destroying Objects

Often, you want to create and destroy objects at runtime, and these changes should be synchronized across the network.

### PlayerSync Component

The `PlayerSync` component simplifies this by automatically instantiating a specific object for each connected player. When a player leaves the room, the object is destroyed for all users.

**In Unity/Blender:**
1. Add a `PlayerSync` component to your scene
2. Assign a prefab to the "Player" field
3. The prefab will be instantiated for each connected player

### Manual Instantiation

Needle Engine provides two high-level methods:

#### syncInstantiate()

Duplicate objects across the network:

```ts
import { syncInstantiate } from "@needle-tools/engine";

// Create a new instance for all users
const newObject = syncInstantiate(originalObject, {
    parent: parentObject,
    position: new Vector3(0, 1, 0),
    visible: true
});
```

[API Documentation](https://engine.needle.tools/docs/api/latest/syncInstantiate)

#### syncDestroy()

Destroy objects across the network:

```ts
import { syncDestroy } from "@needle-tools/engine";

// Destroy the object for all users
syncDestroy(objectToDestroy);
```

[API Documentation](https://engine.needle.tools/docs/api/latest/syncDestroy)

## Best Practices

### Keep Synced Fields Simple

`@syncField` works best with simple data types:
- Numbers
- Strings
- Booleans
- Simple objects with JSON-serializable properties

For complex objects or high-frequency updates, consider [Manual Networking](/docs/how-to-guides/networking/manual-networking).

### Use Callbacks for Side Effects

Always use the callback parameter when you need to react to changes:

```ts
@syncField("onHealthChanged")
health: number = 100;

private onHealthChanged() {
    // Update UI, trigger effects, etc.
    this.updateHealthBar();
}
```

### Consider Performance

Each synced field creates network traffic when it changes. For objects that update frequently (like transforms), use built-in components like `SyncedTransform` which are optimized for high-frequency updates.

## Supported Field Types

The following types can be automatically synced:

- **Primitives:** `number`, `string`, `boolean`
- **three.js types:** `Vector2`, `Vector3`, `Vector4`, `Quaternion`, `Color`
- **Arrays:** Arrays of supported types
- **Objects:** Plain objects with JSON-serializable properties

## Next Steps

**Learn more:**
- [Manual Networking](/docs/how-to-guides/networking/manual-networking) - Send custom messages for more control
- [Understanding Networking](/docs/explanation/networking/architecture) - Learn how state sync works

**Reference:**
- [Networking Events API](/docs/reference/api/networking-events) - Complete event reference
- [Built-in Components](/docs/reference/components#networking) - Networking component catalog
Source: https://engine.needle.tools/docs/how-to-guides/networking/sync-state.html

---
title: Create Components
description: Learn how to write custom TypeScript and JavaScript components for Needle Engine. Create interactive behaviors, use the @serializable decorator for editor integration, and leverage lifecycle methods like start() and update() for game logic.
---

# Create Components

Learn how to create interactive components for Needle Engine using TypeScript or JavaScript.

:::tip Prerequisites
New to TypeScript? Start here:
- [TypeScript Essentials](../../tutorials/fundamentals/typescript-essentials) - Language fundamentals
- [Needle Engine for Unity Developers](../../tutorials/fundamentals/for-unity-developers) - Unity to web workflow
:::

:::details Video: Creating Custom Components in Unity
This video gives a short introduction to the easiest and fastest way to create custom Needle Engine components in Unity.

<video-embed src="https://www.youtube.com/watch?v=uf5UK0bLHlY" limit_height />
:::

---

## Quick Start

### Direct File Approach

Add a `.ts` or `.js` file to `src/scripts/` in your web project:

```
your-project/
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ scripts/
        ‚îî‚îÄ‚îÄ MyFirstScript.ts  ‚Üê Add your component here
```

**Benefits:**
- Simple and direct
- Perfect for small projects
- Automatic hot reload

### Unity - NPM Definition Approach

Organize code into reusable npm packages using NPM Definition files:

1. In Unity: `Create > NPM Definition`
2. Right-click the NpmDef: `Create > TypeScript`
3. Write your component

**Benefits:**
- Modular code organization
- Share code between projects
- Standard npm package format

[Learn more about NPM Definitions](../../explanation/core-concepts/npm-modules)

---

## Your First Component

Create `src/scripts/Rotate.ts`:

```ts twoslash
import { Behaviour, serializable } from "@needle-tools/engine";

export class Rotate extends Behaviour
{
    @serializable()
    speed : number = 1;

    start(){
        // Logging is useful for debugging in the browser
        // Open the developer console (F12) to see your component's data
        console.log(this);
    }

    // update will be called every frame
    update(){
        this.gameObject.rotateY(this.context.time.deltaTime * this.speed);
    }
}
```

**What happens next:**
- üîÑ **C# stub** (Unity) or **Blender panel** auto-generates on save
- ‚ö° **Hot reload** in browser‚Äîno Unity recompilation needed
- üöÄ **Instant iteration**‚Äîsee changes in ~1 second

---

## Component with Custom Function

```ts twoslash
import { Behaviour } from "@needle-tools/engine";

export class PrintNumberComponent extends Behaviour
{
    start(){
      this.printNumber(42);
    }

    private printNumber(myNumber : number){
        console.log("My Number is: " + myNumber);
    }
}
```

---

## Multiple Components Per File

You can export multiple components from one file:

```ts
export class MyComponent1 extends Behaviour { }
export class MyComponent2 extends Behaviour { }
```

---

## Component Architecture

Components attach to **three.js Object3D** instances:

- Access the Object3D: `this.gameObject`
- Access the scene: `this.context.scene`
- Access components: `this.gameObject.getComponent(Type)`

:::warning Visibility & Active State
Setting `visible = false` on an Object3D acts like Unity's `SetActive(false)`:
- Disables **all** components on this object and its children
- **No** update events called until `visible = true` again
- To hide visually without affecting components, disable the `Renderer` component instead
:::

---

## Serialization

Use `@serializable()` to expose properties in the editor (Unity/Blender) and ensure they get saved/loaded correctly.

### Basic Types

Primitives (number, string, boolean) only need `@serializable()`:

```ts twoslash
import { Behaviour, serializable } from "@needle-tools/engine";

export class MyComponent extends Behaviour
{
    @serializable()
    speed: number = 5;

    @serializable()
    playerName: string = "Player";

    @serializable()
    isActive: boolean = true;
}
```

### Object References

For object references and complex types, **you must specify the type**:

```ts twoslash
import { Behaviour, serializable } from "@needle-tools/engine";
import { Object3D, Light, Camera } from "three";

export class MyComponent extends Behaviour
{
    @serializable(Object3D)
    myTarget?: Object3D;

    @serializable(Light)
    targetLight?: Light;

    @serializable(Camera)
    mainCamera?: Camera;
}
```

### Arrays

**Primitive arrays** don't need a type:

```ts twoslash
import { Behaviour, serializable } from "@needle-tools/engine";

export class MyComponent extends Behaviour
{
    @serializable()
    speeds: number[] = [1, 2, 3];

    @serializable()
    names: string[] = ["Player1", "Player2"];
}
```

**Arrays with object references need the type specified**:

```ts twoslash
import { Behaviour, serializable } from "@needle-tools/engine";
import { Object3D, Light } from "three";

export class MyComponent extends Behaviour
{
    // Correct: type specified for object references
    @serializable(Object3D)
    waypoints: Object3D[] = [];

    @serializable(Light)
    lights: Light[] = [];

    // Wrong: will not serialize correctly
    // waypoints: Object3D[] = [];
}
```

:::tip Reference
See the complete [@serializable decorator reference](../../reference/typescript-decorators#serializable) for more details and advanced usage.
:::

---

## Version Control

While generated C# components use the type name to produce stable GUIDs, we recommend checking in generated components in version control as a good practice.

---

## Next Steps

- [Use Lifecycle Hooks](./use-lifecycle-hooks) - awake, start, update methods
- [Handle User Input](./handle-input) - Mouse, touch, keyboard
- [Find Components](./find-components) - Query the scene graph
- [Use Coroutines](./use-coroutines) - Sequenced operations
- [Component Lifecycle Reference](../../reference/api/lifecycle-methods) - Complete API

---

## Need Help?

- [TypeScript Essentials](../../tutorials/fundamentals/typescript-essentials)
- [Scripting Examples](../../reference/scripting-examples)
- [API Documentation](https://engine.needle.tools/docs/api/latest)
- [Discord Community](https://discord.needle.tools)
Source: https://engine.needle.tools/docs/how-to-guides/scripting/create-components.html

---
title: Detect Mobile Devices and Platforms
description: Learn how to detect mobile devices, tablets, browsers, and operating systems to create platform-specific experiences
---

# Detect Mobile Devices and Platforms

Learn how to detect what device, platform, or browser your users are on to create optimized experiences.

Needle Engine provides the `DeviceUtilities` namespace with functions to detect:
- **Device types**: Mobile phones, tablets, desktops, XR headsets
- **Operating systems**: iOS, Android, macOS, VisionOS
- **Browsers**: Safari, Chrome, specialized XR browsers
- **Capabilities**: AR support, microphone permissions, version info

Use these utilities to adapt your app's behavior, optimize performance, or enable platform-specific features.

:::tip Cross-Platform by Default
Needle Engine works seamlessly across all platforms! Use these utilities only when you need platform-specific features or optimizations. Your app should work everywhere by default, with progressive enhancement for capable devices.
:::

---

## Built-In Components (No Code Required!)

For many use cases, you don't need to write any code! Use these built-in components directly in Unity or Blender.

### DeviceFlag Component

Automatically show or hide GameObjects based on device type (mobile vs desktop).

**In Unity/Blender:**
1. Add the `DeviceFlag` component to any GameObject
2. Set `Visible On` to:
   - **Desktop** - Only visible on desktop/laptop computers
   - **Mobile** - Only visible on phones and tablets
   - **Desktop + Mobile** - Visible on all devices

**Use Cases:**
- Show high-quality models only on desktop
- Display simplified UI for mobile devices
- Hide complex effects on lower-powered devices

### XRFlag Component

Show or hide objects based on XR state (VR/AR mode, first/third person view).

**In Unity/Blender:**
1. Add the `XRFlag` component to any GameObject
2. Set `Visible In` to combinations of:
   - **Browser** - Normal web browser mode
   - **AR** - When in AR session
   - **VR** - When in VR session
   - **FirstPerson** - First-person camera view
   - **ThirdPerson** - Third-person camera view

**Use Cases:**
- Show UI only in browser mode, hide in VR/AR
- Display different models for VR vs AR
- Switch between first-person and third-person controls

:::tip Perfect for Non-Programmers
These components work automatically when added in your editor - no scripting needed! They're perfect for artists and designers who want device-specific content without writing code.
:::

---

## Quick Start (Code)

:::tip Recommended Approach
Use the `DeviceUtilities` namespace for all device detection - it keeps imports clean and organized.
:::

```ts
import { Behaviour, DeviceUtilities } from "@needle-tools/engine";

export class PlatformDetection extends Behaviour {
    start() {
        if (DeviceUtilities.isMobileDevice()) {
            console.log("Running on mobile device!");

            if (DeviceUtilities.isiOS()) {
                console.log("Specifically on iOS");
            } else if (DeviceUtilities.isAndroidDevice()) {
                console.log("Specifically on Android");
            }
        }
    }
}
```

---

## Device Type Detection

### Mobile vs Desktop

```ts
import { DeviceUtilities } from "@needle-tools/engine";

// Check if on phone or tablet
if (DeviceUtilities.isMobileDevice()) {
    // Reduce particle effects for mobile
    particleCount = 100;
} else if (DeviceUtilities.isDesktop()) {
    // Use higher quality settings on desktop
    particleCount = 1000;
}
```

### Specific Device Types

```ts
import { DeviceUtilities } from "@needle-tools/engine";

if (DeviceUtilities.isiPad()) {
    console.log("Running on iPad");
}

if (DeviceUtilities.isQuest()) {
    console.log("Running on Meta Quest");
}

if (DeviceUtilities.isVisionOS()) {
    console.log("Running on Apple Vision Pro");
}
```

---

## Operating System Detection

### iOS Detection

```ts
import { DeviceUtilities } from "@needle-tools/engine";

// Check for any iOS device (iPhone, iPad, iPod, Vision Pro)
if (DeviceUtilities.isiOS()) {
    console.log("iOS device detected");

    // Get specific iOS version
    const version = DeviceUtilities.getiOSVersion();
    if (version) {
        console.log("iOS version:", version);
    }
}

// Specific iPad detection
if (DeviceUtilities.isiPad()) {
    // iPad-specific UI layout
}
```

### Android Detection

```ts
import { DeviceUtilities } from "@needle-tools/engine";

if (DeviceUtilities.isAndroidDevice()) {
    console.log("Android device detected");
    // Use Android-specific features
}
```

### macOS Detection

```ts
import { DeviceUtilities } from "@needle-tools/engine";

if (DeviceUtilities.isMacOS()) {
    console.log("Running on macOS");
    // Show Command key shortcuts instead of Ctrl
}
```

---

## Browser Detection

### Safari

```ts
import { DeviceUtilities } from "@needle-tools/engine";

if (DeviceUtilities.isSafari()) {
    console.log("Safari browser detected");

    // Get Safari version
    const version = DeviceUtilities.getSafariVersion();
    if (version) {
        console.log("Safari version:", version);
    }

    // Apply Safari-specific workarounds if needed
}
```

### Chrome

```ts
import { DeviceUtilities } from "@needle-tools/engine";

const chromeVersion = DeviceUtilities.getChromeVersion();
if (chromeVersion) {
    console.log("Chrome version:", chromeVersion);
}
```

### Specialized Browsers

```ts
import { DeviceUtilities } from "@needle-tools/engine";

// Mozilla XR Viewer (iOS AR browser)
if (DeviceUtilities.isMozillaXR()) {
    console.log("Running in Mozilla XR Viewer");
}

// Needle App Clip
if (DeviceUtilities.isNeedleAppClip()) {
    console.log("Running in Needle App Clip");
}
```

---

## XR and AR Capabilities

### AR Support

```ts
import { DeviceUtilities } from "@needle-tools/engine";

// Check if device supports AR QuickLook (iOS AR)
if (DeviceUtilities.isiOS() && DeviceUtilities.supportsQuickLookAR()) {
    console.log("Device supports AR QuickLook");
    // Show AR button
}
```

### VR Devices

```ts
import { DeviceUtilities } from "@needle-tools/engine";

if (DeviceUtilities.isQuest()) {
    // Optimize for Quest rendering capabilities
    enableFoveatedRendering();
}

if (DeviceUtilities.isVisionOS()) {
    // Enable immersive space features
    enableVisionProMode();
}
```

---

## Practical Examples

### Platform-Specific Quality Settings

```ts
import { Behaviour, DeviceUtilities } from "@needle-tools/engine";

export class QualitySettings extends Behaviour {
    start() {
        const renderer = this.context.renderer;

        if (DeviceUtilities.isMobileDevice()) {
            // Lower quality on mobile
            renderer.setPixelRatio(1);
            renderer.shadowMap.enabled = false;

            if (DeviceUtilities.isiOS()) {
                // iOS-specific optimizations
                renderer.powerPreference = "low-power";
            }
        } else {
            // High quality on desktop
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
        }
    }
}
```

### Adaptive UI

```ts
import { Behaviour, DeviceUtilities } from "@needle-tools/engine";

export class ResponsiveUI extends Behaviour {
    start() {
        if (DeviceUtilities.isiPad()) {
            // Larger touch targets for iPad
            this.buttonSize = 60;
        } else if (DeviceUtilities.isMobileDevice()) {
            // Medium size for phones
            this.buttonSize = 50;
        } else {
            // Smaller size for desktop with mouse
            this.buttonSize = 40;
        }

        this.updateButtonSizes();
    }

    private buttonSize: number = 40;

    private updateButtonSizes() {
        // Update UI button sizes based on device
        console.log("Setting button size to", this.buttonSize);
    }
}
```

### Control Scheme Selection

```ts
import { Behaviour, DeviceUtilities } from "@needle-tools/engine";

export class ControlManager extends Behaviour {
    start() {
        if (DeviceUtilities.isVisionOS() || DeviceUtilities.isQuest()) {
            // Enable XR hand tracking controls
            this.enableXRControls();
        } else if (DeviceUtilities.isMobileDevice()) {
            // Enable touch controls
            this.enableTouchControls();
        } else {
            // Enable keyboard + mouse controls
            this.enableDesktopControls();
        }
    }

    private enableXRControls() {
        console.log("XR controls enabled");
    }

    private enableTouchControls() {
        console.log("Touch controls enabled");
    }

    private enableDesktopControls() {
        console.log("Desktop controls enabled");
    }
}
```

### Feature Detection with Permissions

```ts
import { Behaviour, DeviceUtilities } from "@needle-tools/engine";

export class MicrophoneSetup extends Behaviour {
    async start() {
        // Check if microphone permission is granted
        const hasPermission = await DeviceUtilities.microphonePermissionsGranted();

        if (hasPermission) {
            console.log("Microphone access granted");
            // Enable voice features
        } else {
            console.log("Microphone access denied or not requested");
            // Show fallback UI
        }
    }
}
```

---

## Available Detection Functions

All functions are available under the `DeviceUtilities` namespace. See the [complete API documentation](https://engine.needle.tools/docs/api/DeviceUtilities) for more details.

### Device Types
- `DeviceUtilities.isMobileDevice()` - Any phone or tablet
- `DeviceUtilities.isDesktop()` - Desktop/laptop computer (excludes Hololens)
- `DeviceUtilities.isiPad()` - iPad specifically
- `DeviceUtilities.isQuest()` - Meta Quest devices
- `DeviceUtilities.isVisionOS()` - Apple Vision Pro

### Operating Systems
- `DeviceUtilities.isiOS()` - Any iOS device (iPhone, iPad, iPod, Vision Pro)
- `DeviceUtilities.isAndroidDevice()` - Android devices
- `DeviceUtilities.isMacOS()` - macOS computers

### Browsers
- `DeviceUtilities.isSafari()` - Safari browser
- `DeviceUtilities.isMozillaXR()` - Mozilla XR Viewer

### Capabilities
- `DeviceUtilities.supportsQuickLookAR()` - AR QuickLook support (iOS AR)
- `DeviceUtilities.microphonePermissionsGranted()` - Async check for microphone access

### Version Information
- `DeviceUtilities.getiOSVersion()` - Returns iOS version string
- `DeviceUtilities.getChromeVersion()` - Returns Chrome version string
- `DeviceUtilities.getSafariVersion()` - Returns Safari version string

---

## Best Practices

### Progressive Enhancement

Always build your core experience to work on all platforms, then enhance:

```ts
import { DeviceUtilities } from "@needle-tools/engine";

// ‚úÖ Good: Works everywhere, enhanced on capable devices
if (DeviceUtilities.isMobileDevice()) {
    // Simplified mobile experience
} else {
    // Enhanced desktop experience with extra features
}

// ‚ùå Bad: Blocks users on certain platforms
if (!DeviceUtilities.isMobileDevice()) {
    throw new Error("Desktop only!");
}
```

### Test on Real Devices

Device detection isn't perfect. Always test on actual hardware:

- Use URL parameters for testing: `?forcemobile=true`
- Test on multiple iOS and Android versions
- Verify behavior in different browsers

### Combine with Feature Detection

Prefer feature detection over device detection when possible:

```ts
// Check for actual WebXR support
if ('xr' in navigator) {
    // Enable VR/AR features
}

// Check for touch support
if ('ontouchstart' in window) {
    // Enable touch-specific UI
}
```

---

## Next Steps

**Learn more:**
- [Handle User Input](./handle-input) - Cross-platform input handling
- [XR Development](/docs/how-to-guides/xr/) - VR and AR experiences
- [Optimization Guide](/docs/how-to-guides/optimization/) - Platform-specific optimizations

**Reference:**
- [DeviceUtilities API Documentation](https://engine.needle.tools/docs/api/DeviceUtilities) - Complete API reference
- [Utility Functions Reference](/docs/reference/api/utilities) - Complete utilities API
- [Component Reference](/docs/reference/components) - All built-in components
Source: https://engine.needle.tools/docs/how-to-guides/scripting/detect-mobile-devices.html

---
title: Handle User Input
description: Respond to mouse, touch, keyboard, and controller input
---

# Handle User Input

Learn how to respond to user input in Needle Engine‚Äîfrom mouse clicks to touch gestures to VR controllers.

:::tip Cross-Platform by Default
Needle Engine's input system works across **desktop, mobile, and VR** automatically. You don't need to handle different input types separately!
:::

---

## Pointer Events (Mouse, Touch, VR)

The easiest way to handle input is using **pointer event methods** on your components. These work for mouse, touch, and VR controllers automatically.

### Basic Click Handler

```ts
import { Behaviour, PointerEventData } from "@needle-tools/engine";

export class Clickable extends Behaviour {
    onPointerClick(args: PointerEventData) {
        console.log("Clicked on", this.gameObject.name);
        console.log("World position:", args.point);
    }
}
```

**Add this component to any object** and it will respond to clicks!

### Available Pointer Events

| Method | When Called |
| --- | --- |
| `onPointerEnter` | Mouse/touch starts hovering |
| `onPointerMove` | Mouse/touch moves over object |
| `onPointerExit` | Mouse/touch stops hovering |
| `onPointerDown` | Mouse/touch pressed |
| `onPointerUp` | Mouse/touch released |
| `onPointerClick` | Mouse/touch clicked (down + up) |

---

## Hover Effects

Change object appearance on hover:

```ts
import { Behaviour, PointerEventData, Renderer } from "@needle-tools/engine";
import { Color } from "three";

export class HoverEffect extends Behaviour {
    private originalColor?: Color;

    awake() {
        const renderer = this.gameObject.getComponent(Renderer);
        if (renderer?.sharedMaterial) {
            this.originalColor = renderer.sharedMaterial.color.clone();
        }
    }

    onPointerEnter(args: PointerEventData) {
        const renderer = this.gameObject.getComponent(Renderer);
        if (renderer?.sharedMaterial) {
            renderer.sharedMaterial.color.set(0xff0000); // Red
        }
    }

    onPointerExit(args: PointerEventData) {
        const renderer = this.gameObject.getComponent(Renderer);
        if (renderer?.sharedMaterial && this.originalColor) {
            renderer.sharedMaterial.color.copy(this.originalColor);
        }
    }
}
```

---

## Drag and Drop

Track pointer movement while dragging:

```ts
import { Behaviour, PointerEventData } from "@needle-tools/engine";

export class SimpleDrag extends Behaviour {
    private isDragging = false;

    onPointerDown(args: PointerEventData) {
        this.isDragging = true;
    }

    onPointerUp(args: PointerEventData) {
        this.isDragging = false;
    }

    onPointerMove(args: PointerEventData) {
        if (this.isDragging) {
            // Move object to the hit point
            this.gameObject.position.copy(args.point);
        }
    }
}
```

:::tip Built-in DragControls
For production use, consider the built-in `DragControls` component which includes:
- Smooth dragging on surfaces
- Networking support
- Throw physics
- Touch and VR support
:::

---

## Keyboard Input

Check keyboard state in `update()`:

```ts
import { Behaviour } from "@needle-tools/engine";

export class KeyboardMovement extends Behaviour {
    speed: number = 5;

    update() {
        const input = this.context.input;

        // Check if keys are held down
        if (input.getKey("w")) {
            this.gameObject.position.z -= this.speed * this.context.time.deltaTime;
        }
        if (input.getKey("s")) {
            this.gameObject.position.z += this.speed * this.context.time.deltaTime;
        }
        if (input.getKey("a")) {
            this.gameObject.position.x -= this.speed * this.context.time.deltaTime;
        }
        if (input.getKey("d")) {
            this.gameObject.position.x += this.speed * this.context.time.deltaTime;
        }

        // Check for key press (once per press)
        if (input.getKeyDown("Space")) {
            console.log("Space was just pressed!");
        }
    }
}
```

### Keyboard Methods

| Method | Description |
| --- | --- |
| `getKey(key)` | Is key currently held down? |
| `getKeyDown(key)` | Was key pressed this frame? |
| `getKeyUp(key)` | Was key released this frame? |

**Key names:** Use keyboard event key values like `"w"`, `"Space"`, `"ArrowUp"`, `"Escape"`, etc.

---

## Polling Input State

Check input state continuously in `update()`:

```ts
import { Behaviour } from "@needle-tools/engine";

export class InputPolling extends Behaviour {
    update() {
        // Mouse/touch pointer state (button 0 = left mouse button / first touch)
        if (this.context.input.getPointerDown(0)) {
            console.log("Pointer is currently down");
        }

        if (this.context.input.getPointerPressed(0)) {
            console.log("Pointer was just pressed this frame");
        }

        if (this.context.input.getPointerUp(0)) {
            console.log("Pointer was just released this frame");
        }

        // Get pointer position (normalized 0-1)
        const pointerPos = this.context.input.getPointerPosition(0);
        if (pointerPos) {
            console.log("Pointer X:", pointerPos.x, "Y:", pointerPos.y);
        }
    }
}
```

---

## Global Input Events

Subscribe to input events that fire anywhere in the scene (not just on specific objects):

```ts
import { Behaviour, InputEvents, NEPointerEvent } from "@needle-tools/engine";

export class GlobalInputHandler extends Behaviour {
    onEnable() {
        // Listen to all pointer events globally
        this.context.input.addEventListener(InputEvents.PointerDown, this.onGlobalPointerDown);
        this.context.input.addEventListener(InputEvents.PointerUp, this.onGlobalPointerUp);
    }

    onDisable() {
        // Clean up event listeners
        this.context.input.removeEventListener(InputEvents.PointerDown, this.onGlobalPointerDown);
        this.context.input.removeEventListener(InputEvents.PointerUp, this.onGlobalPointerUp);
    }

    private onGlobalPointerDown = (evt: NEPointerEvent) => {
        console.log("Pointer down at:", evt.clientX, evt.clientY);
    }

    private onGlobalPointerUp = (evt: NEPointerEvent) => {
        console.log("Pointer up at:", evt.clientX, evt.clientY);
    }
}
```

### Global Input Events

| Event | When Fired |
| --- | --- |
| `InputEvents.PointerDown` | Any pointer down |
| `InputEvents.PointerUp` | Any pointer up |
| `InputEvents.PointerMove` | Any pointer movement |
| `InputEvents.KeyDown` | Any key pressed |
| `InputEvents.KeyUp` | Any key released |

---

## Browser Events

You can also subscribe to native browser events:

```ts
import { Behaviour } from "@needle-tools/engine";

export class BrowserEvents extends Behaviour {
    onEnable() {
        window.addEventListener("click", this.onWindowClick);
        window.addEventListener("keydown", this.onKeyDown);
    }

    onDisable() {
        window.removeEventListener("click", this.onWindowClick);
        window.removeEventListener("keydown", this.onKeyDown);
    }

    private onWindowClick = (evt: MouseEvent) => {
        console.log("Click anywhere:", evt.clientX, evt.clientY);
    }

    private onKeyDown = (evt: KeyboardEvent) => {
        console.log("Key pressed:", evt.key);
    }
}
```

:::warning Platform Differences
When using browser events directly, you need to handle platform differences yourself (mouse vs touch vs VR). Needle Engine's input system handles this automatically.
:::

---

## Requirements for Pointer Events

For pointer events (`onPointerClick`, etc.) to work:

1. **Object must be visible** - `visible = true`
2. **GameObject needs geometry** - A mesh 
3. **Layer not set to "Ignore Raycast"**

:::tip For input on invisible objects use Layer Masks
By default only visible objects receive input events. You can set the object's layer mask to a different layer, then disable rendering for that layer in the main camera. This way the object can still receive pointer events while being invisible.
:::

---

## Touch Gestures

Handle multi-touch gestures:

```ts
import { Behaviour } from "@needle-tools/engine";

export class TouchGestures extends Behaviour {
    update() {
        const input = this.context.input;

        // Check number of active touches
        const touchCount = input.getPointerCount();

        if (touchCount === 2) {
            // Two-finger pinch/zoom
            const touch0 = input.getPointerPosition(0);
            const touch1 = input.getPointerPosition(1);

            if (touch0 && touch1) {
                const distance = touch0.distanceTo(touch1);
                console.log("Pinch distance:", distance);
            }
        }
    }
}
```

---

## VR Controller Input

Pointer events work automatically with VR controllers! No extra code needed.

For advanced VR input (button presses, thumbstick), see:
- [XR Development Guide](/docs/how-to-guides/xr/)
- [XR Event Methods](/docs/reference/api/xr-events)

---

## Next Steps

**Learn more:**
- [Perform Raycasting](./perform-raycasting) - Manual raycasting for advanced use cases
- [Use Coroutines](./use-coroutines) - Sequence actions over time
- [Component Lifecycle](./use-lifecycle-hooks) - awake, start, update methods

**Reference:**
- [Input Event Methods Reference](/docs/reference/api/input-events) - Complete API
- [XR Event Methods](/docs/reference/api/xr-events) - VR/AR events
- [Scripting Examples](/docs/reference/scripting-examples) - More code patterns
Source: https://engine.needle.tools/docs/how-to-guides/scripting/handle-input.html

---
title: Perform Raycasting
description: Cast rays to detect objects and hit points in your scene
---

# Perform Raycasting

Learn how to cast rays through your scene to detect objects, find hit points, and implement custom interaction logic.

:::tip When to Use Raycasting
- Custom interaction detection beyond pointer events
- Line-of-sight checks (can A see B?)
- Projectile trajectories
- Ground detection for character placement
- Custom selection tools
:::

---

## Basic Raycasting

Cast a ray from a point in a direction:

```ts
import { Behaviour } from "@needle-tools/engine";
import { Vector3 } from "three";

export class BasicRaycast extends Behaviour {
    start() {
        // Set ray origin and direction
        const origin = new Vector3(0, 1, 0);
        const direction = new Vector3(0, 0, -1); // Forward

        // Cast ray using Needle's physics raycast
        const hits = this.context.physics.raycast(origin, direction);

        if (hits.length > 0) {
            const hit = hits[0];
            console.log("Hit object:", hit.object.name);
            console.log("Hit point:", hit.point);
            console.log("Distance:", hit.distance);
        }
    }
}
```

:::tip Use Needle's Raycast Method
**Always use `this.context.physics.raycast()`** instead of three.js `Raycaster` directly. Needle's method:
- Uses **Mesh BVH** acceleration for much faster raycasts against mesh geometry
- Provides consistent results across the engine
- For physics colliders specifically, use `this.context.physics.engine.raycast()`
:::

---

## Raycast from Camera

Cast a ray from the camera based on screen position:

```ts
import { Behaviour } from "@needle-tools/engine";
import { Vector3 } from "three";

export class CameraRaycast extends Behaviour {
    update() {
        const input = this.context.input;

        // Check if pointer was clicked
        if (input.getPointerPressed(0)) {
            // Get pointer position (normalized -1 to 1)
            const pointerPos = input.getPointerPositionRC(0);
            if (!pointerPos) return;

            const camera = this.context.mainCamera!;

            // Calculate ray from camera
            const origin = new Vector3();
            const direction = new Vector3();

            origin.setFromMatrixPosition(camera.matrixWorld);
            direction.set(pointerPos.x, pointerPos.y, 0.5)
                .unproject(camera)
                .sub(origin)
                .normalize();

            // Cast ray using Needle's physics raycast
            const hits = this.context.physics.raycast(origin, direction);

            if (hits.length > 0) {
                const hit = hits[0];
                console.log("Clicked on:", hit.object.name);
                console.log("World position:", hit.point);
            }
        }
    }
}
```

---

## Raycast Options

Configure raycasts with additional options:

```ts
import { Behaviour, RaycastOptions } from "@needle-tools/engine";
import { Vector3 } from "three";

export class RaycastWithOptions extends Behaviour {
    start() {
        const origin = new Vector3(0, 5, 0);
        const direction = new Vector3(0, -1, 0); // Down

        // Raycast options
        const options: RaycastOptions = {
            maxDistance: 100,        // Maximum ray distance
            precise: true,           // Use collider shapes (more accurate)
            testTriggers: false,     // Exclude trigger colliders
        };

        // Perform raycast with options
        const hits = this.context.physics.raycast(origin, direction, options);

        if (hits.length > 0) {
            const hit = hits[0];
            console.log("Hit object:", hit.object.name);
            console.log("Hit point:", hit.point);
            console.log("Hit normal:", hit.normal);
            console.log("Distance:", hit.distance);
        }
    }
}
```

### RaycastOptions

| Option | Type | Description |
| --- | --- | --- |
| `maxDistance` | number | Maximum ray distance (default: Infinity) |
| `precise` | boolean | Use physics colliders for more accurate results |
| `testTriggers` | boolean | Include trigger colliders in results |
| `layerMask` | number | Filter objects by layer mask |

---

## Line of Sight Check

Check if one object can "see" another:

```ts
import { Behaviour, serializable } from "@needle-tools/engine";
import { Object3D, Vector3 } from "three";

export class LineOfSight extends Behaviour {
    @serializable(Object3D)
    target?: Object3D;

    update() {
        if (!this.target) return;

        // Calculate direction to target
        const direction = new Vector3();
        direction.subVectors(this.target.position, this.gameObject.position);
        const distance = direction.length();
        direction.normalize();

        // Raycast to target
        const hits = this.context.physics.raycast(
            this.gameObject.position,
            direction,
            { maxDistance: distance }
        );

        // Check if we hit the target (or nothing blocking)
        if (hits.length === 0 || hits[0].object === this.target) {
            console.log("Target is visible!");
        } else {
            console.log("Target is blocked by:", hits[0].object.name);
        }
    }
}
```

---

## Ground Detection

Find the ground below an object:

```ts
import { Behaviour } from "@needle-tools/engine";
import { Vector3 } from "three";

export class GroundDetection extends Behaviour {
    update() {
        const origin = this.gameObject.position.clone();
        origin.y += 0.1; // Start slightly above

        const direction = new Vector3(0, -1, 0); // Downward

        const hits = this.context.physics.raycast(origin, direction, {
            maxDistance: 10
        });

        if (hits.length > 0) {
            const groundHeight = hits[0].point.y;
            console.log("Ground is at height:", groundHeight);

            // Snap object to ground
            this.gameObject.position.y = groundHeight;
        }
    }
}
```

---

## Raycast Against Specific Objects

Only test ray against specific objects by filtering the results:

```ts
import { Behaviour, serializable } from "@needle-tools/engine";
import { Object3D, Vector3 } from "three";

export class SelectiveRaycast extends Behaviour {
    @serializable(Object3D)
    targetObjects?: Object3D[];

    update() {
        if (!this.targetObjects || this.targetObjects.length === 0) return;

        const input = this.context.input;
        if (input.getPointerPressed(0)) {
            const pointerPos = input.getPointerPositionRC(0);
            if (!pointerPos) return;

            const camera = this.context.mainCamera!;
            const origin = new Vector3();
            const direction = new Vector3();

            origin.setFromMatrixPosition(camera.matrixWorld);
            direction.set(pointerPos.x, pointerPos.y, 0.5)
                .unproject(camera)
                .sub(origin)
                .normalize();

            // Cast ray
            const hits = this.context.physics.raycast(origin, direction);

            // Filter to only target objects
            for (const hit of hits) {
                if (this.targetObjects.includes(hit.object)) {
                    console.log("Hit target:", hit.object.name);
                    break;
                }
            }
        }
    }
}
```

---

## Filter by Layer

Use the `layerMask` option to control which layers are tested:

```ts
import { Behaviour, RaycastOptions } from "@needle-tools/engine";
import { Vector3 } from "three";

export class LayerRaycast extends Behaviour {
    start() {
        const origin = new Vector3(0, 1, 0);
        const direction = new Vector3(0, 0, -1);

        // Only test specific layers
        const options: RaycastOptions = {
            layerMask: 1 << 0 // Only layer 0
        };

        // Cast ray
        const hits = this.context.physics.raycast(origin, direction, options);

        console.log("Found", hits.length, "objects on layer 0");
    }
}
```

---

## Visualize Rays (Debug)

Draw debug lines to see your rays:

```ts
import { Behaviour, Gizmos } from "@needle-tools/engine";
import { Vector3, Color } from "three";

export class VisualizeRay extends Behaviour {
    update() {
        const origin = this.gameObject.position;
        const direction = this.gameObject.forward; // Forward direction
        const distance = 10;

        // Cast ray
        const hits = this.context.physics.raycast(origin, direction, {
            maxDistance: distance
        });

        // Draw ray
        const end = origin.clone().add(direction.clone().multiplyScalar(distance));

        if (hits.length > 0) {
            // Draw in red if hit
            Gizmos.DrawLine(origin, hits[0].point, new Color(1, 0, 0), 0.1);
        } else {
            // Draw in green if no hit
            Gizmos.DrawLine(origin, end, new Color(0, 1, 0), 0.1);
        }
    }
}
```

---

## Intersection Data

Raycasts return intersection data with useful information:

```ts
interface Intersection {
    // The hit point in world space
    point: Vector3;

    // Distance from ray origin
    distance: number;

    // The object that was hit
    object: Object3D;

    // Surface normal at hit point
    normal?: Vector3;

    // UV coordinates at hit point (if available)
    uv?: Vector2;

    // Face index that was hit (for meshes)
    faceIndex?: number;
}
```

---

## Performance Tips

### Use Needle's Built-in Raycast

**Always prefer `this.context.physics.raycast()`** over three.js `Raycaster`:

```ts
// ‚úÖ FAST - Uses Mesh BVH acceleration
const hits = this.context.physics.raycast(origin, direction);

// ‚ùå SLOW - No BVH acceleration
const raycaster = new Raycaster();
raycaster.set(origin, direction);
const hits = raycaster.intersectObjects(scene.children, true);
```

Needle's built-in raycast is **significantly faster** because it:
- Uses **Mesh BVH** (Bounding Volume Hierarchy) for spatial acceleration
- Automatically optimizes for static vs dynamic objects
- Tests against mesh geometry efficiently

:::tip Physics Colliders
To raycast against physics colliders specifically, use `this.context.physics.engine.raycast()` instead.
:::

### Use Layers

Filter by layers to reduce tested objects:

```ts
const options: RaycastOptions = {
    layerMask: 1 << 1 // Only test layer 1
};
const hits = this.context.physics.raycast(origin, direction, options);
```

### Limit Ray Distance

Specify `maxDistance` to stop testing early:

```ts
const options: RaycastOptions = {
    maxDistance: 10 // Only check first 10 units
};
const hits = this.context.physics.raycast(origin, direction, options);
```

---

## Common Use Cases

### Custom Grabbing/Picking

```ts
import { Behaviour } from "@needle-tools/engine";
import { Object3D } from "three";

export class CustomPicker extends Behaviour {
    private pickedObject?: Object3D;

    update() {
        const input = this.context.input;

        if (input.getPointerPressed(0)) {
            const pointerPos = input.getPointerPositionRC(0);
            if (!pointerPos) return;

            const raycaster = this.context.physics.getRaycaster();
            raycaster.setFromCamera(pointerPos, this.context.mainCamera!);

            const hits = raycaster.intersectObjects(this.context.scene.children, true);
            if (hits.length > 0) {
                this.pickedObject = hits[0].object;
                console.log("Picked:", this.pickedObject.name);
            }
        }

        if (input.getPointerUp(0)) {
            this.pickedObject = undefined;
        }
    }
}
```

### Projectile Path

```ts
import { Behaviour } from "@needle-tools/engine";
import { Vector3 } from "three";

export class Projectile extends Behaviour {
    speed: number = 10;
    private velocity = new Vector3();

    start() {
        // Set initial velocity
        this.velocity.copy(this.gameObject.forward).multiplyScalar(this.speed);
    }

    update() {
        const dt = this.context.time.deltaTime;

        // Calculate movement this frame
        const movement = this.velocity.clone().multiplyScalar(dt);
        const distance = movement.length();
        const direction = movement.normalize();

        // Raycast along path
        const hits = this.context.physics.raycast(
            this.gameObject.position,
            direction,
            { maxDistance: distance }
        );

        if (hits.length > 0) {
            // Hit something!
            console.log("Projectile hit:", hits[0].object.name);
            this.destroy();
        } else {
            // Move forward
            this.gameObject.position.add(movement);
        }
    }
}
```

---

## Next Steps

**Learn more:**
- [Handle User Input](./handle-input) - Pointer and keyboard events
- [Use Physics](./use-physics) - Rigidbodies and colliders
- [Component Lifecycle](./use-lifecycle-hooks) - awake, start, update

**Reference:**
- [Input Event Methods](/docs/reference/api/input-events) - Pointer events API
- [Physics Events](/docs/reference/api/physics-events) - Collision events
- [three.js Raycaster](https://threejs.org/docs/#api/en/core/Raycaster) - Raycaster API
Source: https://engine.needle.tools/docs/how-to-guides/scripting/perform-raycasting.html

---
title: Use Coroutines
description: Run sequenced operations over time without blocking
---

# Use Coroutines

Learn how to use coroutines to run code over multiple frames, create delays, and sequence operations. Coroutines in Needle Engine are built on JavaScript generators and run on the main thread, pausing and resuming execution across frames without blocking.

:::tip Related Guide
If you're new to Needle Engine components, start with [Use Lifecycle Hooks](./use-lifecycle-hooks) to learn about `awake()`, `start()`, and `update()` methods. Coroutines are a complementary tool for time-based and sequenced operations.
:::

:::tip When to Use Coroutines
- Sequence operations with delays between them
- Animate values over time
- Wait for conditions to be met
- Run periodic tasks without update()
- Load resources with delays or retries
- Create smooth transitions and effects
:::

:::warning When NOT to Use Coroutines
For code that needs to run every frame (like continuous movement, rotation, or input handling), use the `update()` lifecycle method instead. See [Lifecycle Hooks](./use-lifecycle-hooks) for more details.
:::

---

## Quick Start

Basic component using a coroutine:

```ts
import { Behaviour, WaitForSeconds } from "@needle-tools/engine";

export class Spawner extends Behaviour {
    start() {
        // Start a coroutine
        this.startCoroutine(this.spawnRoutine());
    }

    *spawnRoutine() {
        while (true) {
            this.spawnEnemy();
            yield WaitForSeconds(2); // Wait 2 seconds
        }
    }

    private spawnEnemy() {
        console.log("Enemy spawned!");
    }
}
```

:::tip JavaScript Generators
Coroutines use JavaScript generator functions (`function*`). The `yield` keyword pauses execution and resumes on the next frame or after a wait. Unlike web workers or threads, coroutines run on the main thread‚Äîthey don't create true parallelism but allow you to write sequential code that executes over time.
:::

---

## Wait Methods

Needle Engine provides several wait methods for coroutines:

### WaitForSeconds

Wait for a specific amount of time in seconds:

```ts
import { Behaviour, WaitForSeconds } from "@needle-tools/engine";

export class DelayedAction extends Behaviour {
    start() {
        this.startCoroutine(this.delayedMessage());
    }

    *delayedMessage() {
        console.log("Starting...");
        yield WaitForSeconds(3); // Wait 3 seconds
        console.log("3 seconds later!");
    }
}
```

### WaitForFrames

Wait for a specific number of frames:

```ts
import { Behaviour, WaitForFrames } from "@needle-tools/engine";

export class FrameDelay extends Behaviour {
    start() {
        this.startCoroutine(this.waitFrames());
    }

    *waitFrames() {
        console.log("Frame:", this.context.time.frameCount);
        yield WaitForFrames(60); // Wait 60 frames
        console.log("60 frames later:", this.context.time.frameCount);
    }
}
```

### yield null

Wait for the next frame:

```ts
*myRoutine() {
    console.log("Frame 1");
    yield null; // Wait one frame
    console.log("Frame 2");
    yield null; // Wait another frame
    console.log("Frame 3");
}
```

---

## Common Patterns

### Timed Display Updates

Update UI or text at regular intervals:

```ts
import { Behaviour, Text, serializable, WaitForSeconds } from "@needle-tools/engine";

export class DisplayTime extends Behaviour {
    @serializable(Text)
    text?: Text;

    onEnable() {
        this.startCoroutine(this.updateTime());
    }

    private *updateTime() {
        while (true) {
            if (this.text) {
                this.text.text = new Date().toLocaleTimeString();
            }
            yield WaitForSeconds(1); // Update every second
        }
    }
}
```

### Fade Effect

Smoothly animate values over time:

```ts
import { Behaviour, WaitForSeconds } from "@needle-tools/engine";

export class Fader extends Behaviour {
    fadeIn(duration: number = 1) {
        this.startCoroutine(this.fadeRoutine(0, 1, duration));
    }

    fadeOut(duration: number = 1) {
        this.startCoroutine(this.fadeRoutine(1, 0, duration));
    }

    *fadeRoutine(from: number, to: number, duration: number) {
        const startTime = this.context.time.time;

        while (true) {
            const elapsed = this.context.time.time - startTime;
            const t = Math.min(elapsed / duration, 1);

            const alpha = from + (to - from) * t;
            this.setOpacity(alpha);

            if (t >= 1) break;
            yield null; // Wait for next frame
        }
    }

    private setOpacity(alpha: number) {
        // Set material opacity
        console.log("Opacity:", alpha);
    }
}
```

### Delayed Sequence

Execute multiple actions with delays:

```ts
import { Behaviour, WaitForSeconds } from "@needle-tools/engine";

export class Sequencer extends Behaviour {
    start() {
        this.startCoroutine(this.playSequence());
    }

    *playSequence() {
        console.log("Action 1");
        yield WaitForSeconds(1);

        console.log("Action 2");
        yield WaitForSeconds(2);

        console.log("Action 3");
        yield WaitForSeconds(1);

        console.log("Sequence complete!");
    }
}
```

### Wait for Condition

Wait until a condition is met:

```ts
import { Behaviour, GameObject } from "@needle-tools/engine";

export class Waiter extends Behaviour {
    target?: GameObject;

    start() {
        this.startCoroutine(this.waitForTarget());
    }

    *waitForTarget() {
        console.log("Waiting for target...");

        // Wait until target exists
        while (!this.target) {
            yield null;
        }

        console.log("Target found!", this.target);
    }
}
```

### Periodic Task

Run a task repeatedly with delays:

```ts
import { Behaviour, WaitForSeconds } from "@needle-tools/engine";

export class PeriodicTask extends Behaviour {
    private _running = false;

    onEnable() {
        this._running = true;
        this.startCoroutine(this.periodicUpdate());
    }

    onDisable() {
        this._running = false;
    }

    *periodicUpdate() {
        while (this._running) {
            this.doTask();
            yield WaitForSeconds(5); // Every 5 seconds
        }
    }

    private doTask() {
        console.log("Task executed at:", new Date().toLocaleTimeString());
    }
}
```

---

## Stopping Coroutines

You can stop coroutines by storing the generator reference:

```ts
import { Behaviour, WaitForSeconds } from "@needle-tools/engine";

export class StoppableRoutine extends Behaviour {
    private _routine?: Generator;

    start() {
        this._routine = this.startCoroutine(this.myRoutine());
    }

    stopRoutine() {
        if (this._routine) {
            this.stopCoroutine(this._routine);
            this._routine = undefined;
        }
    }

    *myRoutine() {
        while (true) {
            console.log("Running...");
            yield WaitForSeconds(1);
        }
    }
}
```

:::tip Automatic Cleanup
Coroutines are automatically stopped when a component is disabled or destroyed, so you don't need to manually stop them in most cases.
:::

---

## Coroutines vs update()

When should you use coroutines instead of `update()`?

**Use Coroutines when:**
- You need delays between operations
- You're sequencing multiple steps
- You want code to run periodically (not every frame)
- You're waiting for conditions or events
- You need clearer, more readable sequential logic

**Use update() when:**
- You need to run code every frame
- You're doing continuous animation or movement
- You need maximum performance (less overhead)
- You're implementing physics or game logic that updates constantly

```ts
// ‚ùå Don't use update() for periodic tasks
update() {
    this._timer += this.context.time.deltaTime;
    if (this._timer >= 2) {
        this._timer = 0;
        this.doSomething();
    }
}

// ‚úÖ Use coroutines instead
start() {
    this.startCoroutine(this.periodicTask());
}

*periodicTask() {
    while (true) {
        this.doSomething();
        yield WaitForSeconds(2);
    }
}
```

---

## Advanced: Nested Coroutines

You can yield other coroutines:

```ts
import { Behaviour, WaitForSeconds } from "@needle-tools/engine";

export class NestedRoutines extends Behaviour {
    start() {
        this.startCoroutine(this.mainRoutine());
    }

    *mainRoutine() {
        console.log("Starting main routine");

        // Wait for sub-routine to complete
        yield* this.subRoutine();

        console.log("Main routine complete");
    }

    *subRoutine() {
        console.log("Sub-routine started");
        yield WaitForSeconds(2);
        console.log("Sub-routine finished");
    }
}
```

---

## Best Practices

:::tip Do's
- Use coroutines for time-based sequences
- Stop coroutines when they're no longer needed
- Use meaningful variable names for wait times
- Check conditions before long operations
- Use `WaitForSeconds` for time-based delays
:::

:::warning Don'ts
- Avoid infinite loops without yields (will freeze)
- Don't use coroutines for every-frame updates
- Don't forget to yield in loops
- Avoid too many simultaneous coroutines (performance)
:::

---

## Next Steps

- [Use Lifecycle Hooks](./use-lifecycle-hooks) - awake, start, update methods
- [Handle User Input](./handle-input) - Mouse, touch, keyboard
- [Scripting Examples](/docs/reference/scripting-examples) - More code examples
- [Component API Reference](/docs/reference/api/lifecycle-methods) - Complete API

---
Source: https://engine.needle.tools/docs/how-to-guides/scripting/use-coroutines.html

---
title: Use Lifecycle Hooks
description: Control when and how your component code runs
---

# Use Lifecycle Hooks

Learn how to use Needle Engine's lifecycle hooks to run code at the right time in your component's lifetime.

:::tip When to Use Lifecycle Hooks
- Initialize components when they're created
- Run code every frame for animation or gameplay
- React to component being enabled/disabled
- Clean up resources when components are destroyed
- Synchronize logic with rendering
:::

---

## Quick Start

Basic component with common lifecycle hooks:

```ts
import { Behaviour } from "@needle-tools/engine";

export class MyComponent extends Behaviour {
    // Called when component is created
    awake() {
        console.log("Component created!");
    }

    // Called first frame after creation
    start() {
        console.log("Component started!");
    }

    // Called every frame
    update() {
        console.log("Frame update");
    }

    // Called when destroyed
    onDestroy() {
        console.log("Component destroyed");
    }
}
```

:::warning Performance
Only implement lifecycle methods you actually need! Empty `update()` methods on many components hurt performance.
:::

---

## Lifecycle Methods Overview

| Method | When Called | Common Uses |
| --- | --- | --- |
| `awake()` | Component created | Cache references, initialize variables |
| `onEnable()` | Component enabled | Subscribe to events, start processes |
| `start()` | First frame | Setup that needs other components |
| `earlyUpdate()` | Before update | Input processing, pre-calculations |
| `update()` | Every frame | Main game logic, movement, animation |
| `lateUpdate()` | After update | Camera following, final adjustments |
| `onBeforeRender()` | Before render | Last-minute visual updates |
| `onAfterRender()` | After render | Post-processing, statistics |
| `onDisable()` | Component disabled | Unsubscribe events, pause processes |
| `onDestroy()` | Component destroyed | Clean up resources, remove references |

**Full API:** [Lifecycle Methods Reference](/docs/reference/api/lifecycle-methods)

---

## Initialization: awake()

Called when the component is first created, before `start()`.

### Cache Component References

```ts
import { Behaviour } from "@needle-tools/engine";
import { MeshRenderer } from "three";

export class Example extends Behaviour {
    private renderer?: MeshRenderer;
    private otherComponent?: OtherComponent;

    awake() {
        // Cache references - do this once in awake, not every frame!
        this.renderer = this.gameObject.getComponent(MeshRenderer);
        this.otherComponent = this.gameObject.getComponent(OtherComponent);

        console.log("References cached");
    }
}
```

### Initialize Variables

```ts
import { Behaviour, serializable } from "@needle-tools/engine";

export class Counter extends Behaviour {
    @serializable()
    startValue: number = 0;

    private currentCount = 0;

    awake() {
        // Initialize from serialized values
        this.currentCount = this.startValue;
    }
}
```

---

## Start Logic: start()

Called on the first frame after `awake()`, after all components' `awake()` has been called.

### Use Other Components

```ts
import { Behaviour } from "@needle-tools/engine";

export class Dependent extends Behaviour {
    private manager?: GameManager;

    awake() {
        // Find the manager
        this.manager = GameObject.findObjectOfType(GameManager);
    }

    start() {
        // Safe to use manager here - its awake() has been called
        if (this.manager) {
            this.manager.registerPlayer(this);
        }
    }
}
```

### Start Coroutines

```ts
import { Behaviour } from "@needle-tools/engine";

export class Spawner extends Behaviour {
    start() {
        // Start a coroutine
        this.startCoroutine(this.spawnRoutine());
    }

    *spawnRoutine() {
        while (true) {
            this.spawnEnemy();
            yield WaitForSeconds(2); // Wait 2 seconds
        }
    }

    private spawnEnemy() {
        console.log("Enemy spawned!");
    }
}
```

---

## Every Frame: update()

Called every frame. Use for main game logic.

### Movement

```ts
import { Behaviour, serializable } from "@needle-tools/engine";

export class Mover extends Behaviour {
    @serializable()
    speed: number = 5;

    update() {
        // Use deltaTime for frame-rate independent movement
        const dt = this.context.time.deltaTime;
        this.gameObject.position.x += this.speed * dt;
    }
}
```

### Input Handling

```ts
import { Behaviour } from "@needle-tools/engine";

export class InputHandler extends Behaviour {
    update() {
        const input = this.context.input;

        // Check keyboard
        if (input.getKeyDown("space")) {
            this.jump();
        }

        // Check mouse
        if (input.getPointerPressed(0)) {
            this.shoot();
        }
    }

    private jump() {
        console.log("Jump!");
    }

    private shoot() {
        console.log("Shoot!");
    }
}
```

### Rotation

```ts
import { Behaviour, serializable } from "@needle-tools/engine";

export class Rotator extends Behaviour {
    @serializable()
    rotationSpeed: number = 90; // Degrees per second

    update() {
        const dt = this.context.time.deltaTime;
        const radians = (this.rotationSpeed * dt) * (Math.PI / 180);
        this.gameObject.rotateY(radians);
    }
}
```

---

## Late Update: lateUpdate()

Called after all `update()` calls, before rendering. Perfect for cameras and final adjustments.

### Camera Following

```ts
import { Behaviour, serializable } from "@needle-tools/engine";
import { Object3D, Vector3 } from "three";

export class CameraFollow extends Behaviour {
    @serializable(Object3D)
    target?: Object3D;

    @serializable()
    followSpeed: number = 5;

    private offset = new Vector3(0, 2, -5);

    lateUpdate() {
        if (!this.target) return;

        // Follow target after it has moved in update()
        const targetPos = this.target.position.clone().add(this.offset);

        const dt = this.context.time.deltaTime;
        this.gameObject.position.lerp(targetPos, this.followSpeed * dt);

        // Look at target
        this.gameObject.lookAt(this.target.position);
    }
}
```

### Billboard Effect

```ts
import { Behaviour } from "@needle-tools/engine";

export class Billboard extends Behaviour {
    lateUpdate() {
        // Face camera after camera has moved
        const camera = this.context.mainCamera;
        if (camera) {
            this.gameObject.lookAt(camera.position);
        }
    }
}
```

---

## Enable/Disable: onEnable() & onDisable()

Called when component is enabled or disabled.

### Event Subscriptions

```ts
import { Behaviour } from "@needle-tools/engine";
import { InputEvents } from "@needle-tools/engine";

export class Clickable extends Behaviour {
    onEnable() {
        // Subscribe when enabled
        this.context.input.addEventListener(
            InputEvents.PointerDown,
            this.onPointerDown
        );
    }

    onDisable() {
        // Unsubscribe when disabled
        this.context.input.removeEventListener(
            InputEvents.PointerDown,
            this.onPointerDown
        );
    }

    private onPointerDown = () => {
        console.log("Pointer down!");
    }
}
```

### Pause/Resume

```ts
import { Behaviour } from "@needle-tools/engine";

export class Enemy extends Behaviour {
    private active = false;

    onEnable() {
        this.active = true;
        console.log("Enemy activated");
    }

    onDisable() {
        this.active = false;
        console.log("Enemy deactivated");
    }

    update() {
        if (!this.active) return;
        // Enemy logic...
    }
}
```

---

## Cleanup: onDestroy()

Called when component or GameObject is destroyed.

### Resource Cleanup

```ts
import { Behaviour } from "@needle-tools/engine";
import { Texture, Material } from "three";

export class TextureUser extends Behaviour {
    private customTexture?: Texture;
    private customMaterial?: Material;

    start() {
        // Create resources
        this.customTexture = new Texture();
        this.customMaterial = new Material();
    }

    onDestroy() {
        // Clean up to prevent memory leaks
        this.customTexture?.dispose();
        this.customMaterial?.dispose();

        console.log("Resources cleaned up");
    }
}
```

### Remove Global References

```ts
import { Behaviour } from "@needle-tools/engine";

export class Player extends Behaviour {
    start() {
        // Register globally
        GameManager.instance.registerPlayer(this);
    }

    onDestroy() {
        // Remove global reference
        GameManager.instance.unregisterPlayer(this);
    }
}
```

---

## Execution Order

Understanding the order lifecycle methods are called:

```
[Component Created]
  ‚Üì
awake()           // All components
  ‚Üì
onEnable()        // All components
  ‚Üì
start()           // All components (first frame only)
  ‚Üì
[Every Frame:]
  ‚Üì
earlyUpdate()     // All components
  ‚Üì
update()          // All components
  ‚Üì
lateUpdate()      // All components
  ‚Üì
onBeforeRender()  // All components
  ‚Üì
[RENDER]
  ‚Üì
onAfterRender()   // All components

[When Disabled:]
onDisable()

[When Destroyed:]
onDisable()
  ‚Üì
onDestroy()
```

---

## Advanced: earlyUpdate()

Called before `update()`, useful for input processing:

```ts
import { Behaviour } from "@needle-tools/engine";
import { Vector2 } from "three";

export class InputProcessor extends Behaviour {
    private moveInput = new Vector2();

    earlyUpdate() {
        // Process input before other components need it
        const input = this.context.input;
        this.moveInput.x = (input.getKey("d") ? 1 : 0) - (input.getKey("a") ? 1 : 0);
        this.moveInput.y = (input.getKey("w") ? 1 : 0) - (input.getKey("s") ? 1 : 0);
        this.moveInput.normalize();
    }

    update() {
        // Use processed input
        const dt = this.context.time.deltaTime;
        this.gameObject.position.x += this.moveInput.x * dt;
        this.gameObject.position.z += this.moveInput.y * dt;
    }
}
```

---

## Advanced: onBeforeRender() & onAfterRender()

Called just before/after rendering:

### Update Shader Uniforms

```ts
import { Behaviour } from "@needle-tools/engine";
import { ShaderMaterial } from "three";

export class ShaderUpdater extends Behaviour {
    private material?: ShaderMaterial;

    awake() {
        const mesh = this.gameObject.getComponent(MeshRenderer);
        this.material = mesh?.material as ShaderMaterial;
    }

    onBeforeRender() {
        // Update shader just before render
        if (this.material?.uniforms) {
            this.material.uniforms.time.value = this.context.time.time;
        }
    }
}
```

### Gather Statistics

```ts
import { Behaviour } from "@needle-tools/engine";

export class FrameStats extends Behaviour {
    private frameCount = 0;
    private lastReportTime = 0;

    onAfterRender() {
        this.frameCount++;

        const time = this.context.time.time;
        if (time - this.lastReportTime > 1.0) {
            console.log("FPS:", this.frameCount);
            this.frameCount = 0;
            this.lastReportTime = time;
        }
    }
}
```

---

## Performance Best Practices

### ‚úÖ DO

Cache component references in `awake()`:
```ts
awake() {
    this.rigidbody = this.gameObject.getComponent(Rigidbody);
}
```

Use `deltaTime` for frame-rate independence:
```ts
update() {
    const dt = this.context.time.deltaTime;
    this.gameObject.position.x += this.speed * dt;
}
```

Unsubscribe from events:
```ts
onDisable() {
    this.context.input.removeEventListener(InputEvents.PointerDown, this.callback);
}
```

### ‚ùå DON'T

Don't search every frame:
```ts
// BAD - very slow!
update() {
    const player = GameObject.findObjectOfType(Player);
}
```

Don't add empty methods:
```ts
// BAD - wastes performance
update() {
    // Empty!
}
```

Don't forget cleanup:
```ts
// BAD - memory leak!
start() {
    this.texture = new Texture();
}
// Missing onDestroy() to dispose texture
```

---

## Complete Example: Health System

Putting it all together:

```ts
import { Behaviour, serializable } from "@needle-tools/engine";

export class Health extends Behaviour {
    @serializable()
    maxHealth: number = 100;

    @serializable()
    regenerateRate: number = 5;

    private currentHealth = 0;
    private isDead = false;

    // Initialize
    awake() {
        this.currentHealth = this.maxHealth;
    }

    // Register with manager
    start() {
        const manager = GameObject.findObjectOfType(GameManager);
        manager?.registerHealthComponent(this);
    }

    // Regenerate health
    update() {
        if (this.isDead) return;

        const dt = this.context.time.deltaTime;
        this.currentHealth = Math.min(
            this.currentHealth + this.regenerateRate * dt,
            this.maxHealth
        );
    }

    // Cleanup
    onDestroy() {
        const manager = GameObject.findObjectOfType(GameManager);
        manager?.unregisterHealthComponent(this);
    }

    // Public API
    takeDamage(amount: number) {
        if (this.isDead) return;

        this.currentHealth -= amount;

        if (this.currentHealth <= 0) {
            this.currentHealth = 0;
            this.isDead = true;
            this.onDeath();
        }
    }

    private onDeath() {
        console.log("Health depleted!");
        // Trigger death effects
    }

    getHealthPercent(): number {
        return this.currentHealth / this.maxHealth;
    }
}
```

---

## Next Steps

**Learn more:**
- [Handle User Input](./handle-input) - Process keyboard and pointer events
- [Use Physics](./use-physics) - Rigidbodies and collision events
- [Create Components](./create-components) - Component basics
- [Browse all How-To Guides](/docs/how-to-guides/) - See all task-oriented guides

**Reference:**
- [Lifecycle Methods](/docs/reference/api/lifecycle-methods) - Complete API reference
- [Time API](/docs/reference/api/time) - Access time and deltaTime
- [Input Events](/docs/reference/api/input-events) - Input event reference
Source: https://engine.needle.tools/docs/how-to-guides/scripting/use-lifecycle-hooks.html

---
title: Use Physics
description: Add realistic physics simulation with rigidbodies, colliders, and forces
---

# Use Physics

Learn how to add realistic physics simulation to your Needle Engine projects using the built-in Rapier physics engine.

:::tip When to Use Physics
- Realistic object movement and interactions
- Gravity and falling objects
- Collision detection and response
- Force-based movement (explosions, wind, throwing)
- Trigger zones for gameplay mechanics
:::

---

## Quick Start

Add physics to an object:

```ts
import { Behaviour, Rigidbody } from "@needle-tools/engine";

export class PhysicsExample extends Behaviour {
    start() {
        // Add a rigidbody component at runtime
        const rb = this.gameObject.addNewComponent(Rigidbody);

        // Configure physics properties
        rb.mass = 10;
        rb.drag = 0.5;
        rb.angularDrag = 0.5;

        console.log("Physics enabled!");
    }
}
```

:::tip Unity/Blender Setup
In most cases, you'll add Rigidbody and Collider components directly in Unity or Blender, not in code. The exported glTF will include these physics components automatically.
:::

---

## Rigidbodies

Rigidbodies add physics simulation to objects. They respond to forces, gravity, and collisions.

### Basic Rigidbody

```ts
import { Behaviour, Rigidbody } from "@needle-tools/engine";

export class Ball extends Behaviour {
    private rigidbody?: Rigidbody;

    awake() {
        // Get the rigidbody component
        this.rigidbody = this.gameObject.getComponent(Rigidbody);
    }

    start() {
        if (this.rigidbody) {
            // Configure mass and drag
            this.rigidbody.mass = 5;
            this.rigidbody.drag = 0.1;
            this.rigidbody.angularDrag = 0.05;

            // Enable/disable gravity
            this.rigidbody.useGravity = true;
        }
    }
}
```

### Rigidbody Properties

| Property | Type | Description |
| --- | --- | --- |
| `mass` | number | Mass in kilograms (default: 1) |
| `drag` | number | Linear drag (air resistance) |
| `angularDrag` | number | Rotational drag |
| `useGravity` | boolean | Apply gravity force |
| `isKinematic` | boolean | Controlled by code, not physics |
| `lockRotation` | boolean | Prevent rotation from physics |

---

## Apply Forces

Move rigidbodies using physics forces:

### Impulse Force (Instant)

```ts
import { Behaviour, Rigidbody, serializable } from "@needle-tools/engine";
import { Vector3 } from "three";

export class Launcher extends Behaviour {
    @serializable()
    launchForce: number = 10;

    private rigidbody?: Rigidbody;

    awake() {
        this.rigidbody = this.gameObject.getComponent(Rigidbody);
    }

    launch() {
        if (this.rigidbody) {
            // Apply instant force upward
            const force = new Vector3(0, this.launchForce, 0);
            this.rigidbody.applyImpulse(force);

            console.log("Object launched!");
        }
    }
}
```

### Continuous Force

```ts
import { Behaviour, Rigidbody } from "@needle-tools/engine";
import { Vector3 } from "three";

export class Thruster extends Behaviour {
    private rigidbody?: Rigidbody;
    private thrust = 5;

    awake() {
        this.rigidbody = this.gameObject.getComponent(Rigidbody);
    }

    update() {
        if (this.rigidbody) {
            // Apply continuous upward force
            const force = new Vector3(0, this.thrust, 0);
            this.rigidbody.applyForce(force);
        }
    }
}
```

### Torque (Rotation)

```ts
import { Behaviour, Rigidbody } from "@needle-tools/engine";
import { Vector3 } from "three";

export class Spinner extends Behaviour {
    private rigidbody?: Rigidbody;

    awake() {
        this.rigidbody = this.gameObject.getComponent(Rigidbody);
    }

    start() {
        if (this.rigidbody) {
            // Apply rotational impulse around Y axis
            const torque = new Vector3(0, 10, 0);
            this.rigidbody.applyTorque(torque);
        }
    }
}
```

---

## Set Velocity Directly

Control rigidbody velocity:

```ts
import { Behaviour, Rigidbody } from "@needle-tools/engine";
import { Vector3 } from "three";

export class DirectMovement extends Behaviour {
    private rigidbody?: Rigidbody;

    awake() {
        this.rigidbody = this.gameObject.getComponent(Rigidbody);
    }

    update() {
        if (this.rigidbody) {
            // Set velocity directly
            const velocity = new Vector3(0, 0, 5); // Move forward at 5 m/s
            this.rigidbody.setVelocity(velocity);

            // Set angular velocity (rotation)
            const angularVel = new Vector3(0, 1, 0); // Spin around Y axis
            this.rigidbody.setAngularVelocity(angularVel);
        }
    }

    getSpeed(): number {
        // Get current speed
        return this.rigidbody?.getVelocity().length() ?? 0;
    }
}
```

---

## Kinematic Rigidbodies

Kinematic rigidbodies are controlled by code, not physics:

```ts
import { Behaviour, Rigidbody } from "@needle-tools/engine";
import { Vector3 } from "three";

export class Platform extends Behaviour {
    private rigidbody?: Rigidbody;
    private startPos = new Vector3();

    awake() {
        this.rigidbody = this.gameObject.getComponent(Rigidbody);
        this.startPos.copy(this.gameObject.position);
    }

    start() {
        if (this.rigidbody) {
            // Make kinematic - controlled by code
            this.rigidbody.isKinematic = true;
        }
    }

    update() {
        // Move platform with code
        const time = this.context.time.time;
        this.gameObject.position.y = this.startPos.y + Math.sin(time) * 2;

        // Kinematic rigidbodies still affect dynamic objects!
        // Objects will ride on this platform
    }
}
```

:::tip Kinematic Use Cases
- Moving platforms
- Elevators
- Doors
- Character controllers
- Anything that moves predictably but should affect other physics objects
:::

---

## Collision Detection

Detect when rigidbodies collide:

```ts
import { Behaviour, Collision, serializable } from "@needle-tools/engine";

export class Breakable extends Behaviour {
    @serializable()
    breakForce: number = 10;

    onCollisionEnter(col: Collision) {
        console.log("Hit by:", col.collider.gameObject.name);

        // Calculate impact force (approximate)
        const impact = this.estimateImpact(col);

        if (impact > this.breakForce) {
            console.log("Object broke from impact!");
            this.destroy();
        }
    }

    private estimateImpact(col: Collision): number {
        // Get relative velocity (simplified)
        return 5; // In real code, calculate from velocities
    }
}
```

### Collision Events

| Event | When Called |
| --- | --- |
| `onCollisionEnter` | Collision starts |
| `onCollisionStay` | Collision continues (every frame) |
| `onCollisionExit` | Collision ends |

**See:** [Physics Events Reference](/docs/reference/api/physics-events) for complete API

---

## Trigger Zones

Triggers detect objects without physical collision:

```ts
import { Behaviour, Collision, serializable } from "@needle-tools/engine";
import { Object3D } from "three";

export class Checkpoint extends Behaviour {
    @serializable()
    nextCheckpoint?: Object3D;

    private activated = false;

    onTriggerEnter(col: Collision) {
        if (this.activated) return;

        // Check if player entered
        const player = col.collider.gameObject.getComponent(PlayerController);
        if (player) {
            this.activated = true;
            console.log("Checkpoint reached!");
            this.onCheckpointReached(player);
        }
    }

    private onCheckpointReached(player: PlayerController) {
        // Handle checkpoint logic
        player.setSpawnPoint(this.gameObject.position);
    }
}
```

:::tip Trigger vs Collision
- **Triggers:** Objects pass through (detection zones, pickups, checkpoints)
- **Collisions:** Physical response (solid walls, bouncing balls)

Mark colliders as "Is Trigger" in Unity/Blender to make them triggers.
:::

---

## Raycasting

Check for physics objects along a ray:

```ts
import { Behaviour, RaycastOptions } from "@needle-tools/engine";
import { Vector3 } from "three";

export class Scanner extends Behaviour {
    update() {
        const origin = this.gameObject.position;
        const direction = this.gameObject.forward;

        // Raycast using physics engine (tests against colliders)
        const options: RaycastOptions = {
            maxDistance: 10,
            precise: true,  // Use collider shapes
        };

        const hits = this.context.physics.engine.raycast(origin, direction, options);

        if (hits.length > 0) {
            console.log("Found object:", hits[0].object.name);
            console.log("Distance:", hits[0].distance);
        }
    }
}
```

**See:** [Perform Raycasting](./perform-raycasting) for complete guide

---

## Layers and Filtering

Use layers to control what collides with what:

```ts
import { Behaviour, Rigidbody } from "@needle-tools/engine";

export class LayeredObject extends Behaviour {
    awake() {
        // Set object layer
        this.gameObject.layers.set(1); // Layer 1
    }

    start() {
        const rb = this.gameObject.getComponent(Rigidbody);
        if (rb) {
            // Configure which layers this rigidbody collides with
            // (This is typically done in Unity/Blender physics settings)
        }
    }
}
```

:::tip Layer Configuration
Layer collision matrices are usually configured in Unity's Physics Settings or Blender's physics properties, not in code.
:::

---

## Physics Materials

Control friction and bounciness:

```ts
import { Behaviour, PhysicsMaterial } from "@needle-tools/engine";

export class BouncyBall extends Behaviour {
    start() {
        // Physics materials are typically set in Unity/Blender
        // But you can modify them at runtime:

        const collider = this.gameObject.getComponent(BoxCollider);
        if (collider?.physicsMaterial) {
            collider.physicsMaterial.bounciness = 0.9;  // Very bouncy
            collider.physicsMaterial.friction = 0.1;    // Low friction
        }
    }
}
```

---

## Character Controller Example

Complete physics-based character:

```ts
import { Behaviour, Rigidbody, serializable } from "@needle-tools/engine";
import { Vector3 } from "three";

export class PhysicsCharacter extends Behaviour {
    @serializable()
    moveSpeed: number = 5;

    @serializable()
    jumpForce: number = 8;

    private rigidbody?: Rigidbody;
    private isGrounded = false;

    awake() {
        this.rigidbody = this.gameObject.getComponent(Rigidbody);
    }

    start() {
        if (this.rigidbody) {
            // Configure for character
            this.rigidbody.lockRotation = true;  // Don't fall over
            this.rigidbody.drag = 2;             // Stop quickly
        }
    }

    update() {
        if (!this.rigidbody) return;

        const input = this.context.input;
        const velocity = this.rigidbody.getVelocity();

        // Horizontal movement
        const moveX = (input.getKey("d") ? 1 : 0) - (input.getKey("a") ? 1 : 0);
        const moveZ = (input.getKey("s") ? 1 : 0) - (input.getKey("w") ? 1 : 0);

        velocity.x = moveX * this.moveSpeed;
        velocity.z = moveZ * this.moveSpeed;

        // Jump
        if (input.getKeyDown("space") && this.isGrounded) {
            velocity.y = this.jumpForce;
        }

        this.rigidbody.setVelocity(velocity);

        // Check if grounded (simplified)
        this.checkGrounded();
    }

    private checkGrounded() {
        // Use raycast to check ground
        const origin = this.gameObject.position.clone();
        origin.y += 0.1;
        const direction = new Vector3(0, -1, 0);

        const hits = this.context.physics.raycast(origin, direction, {
            maxDistance: 0.2
        });

        this.isGrounded = hits.length > 0;
    }
}
```

---

## Performance Tips

### Reduce Physics Updates

```ts
// Don't do this every frame:
‚ùå this.gameObject.getComponent(Rigidbody);

// Cache it once:
‚úÖ awake() {
    this.rigidbody = this.gameObject.getComponent(Rigidbody);
}
```

### Use Sleep

Physics objects automatically sleep when stationary. Don't wake them unnecessarily:

```ts
// This wakes the rigidbody:
rigidbody.setVelocity(new Vector3(0, 0, 0));

// This keeps it asleep:
if (rigidbody.getVelocity().length() > 0.1) {
    rigidbody.setVelocity(new Vector3(0, 0, 0));
}
```

### Simplify Colliders

- Use primitive colliders (box, sphere, capsule) instead of mesh colliders
- Mesh colliders are much slower, use sparingly
- For complex shapes, combine multiple primitive colliders

---

## Common Issues

### Object Falls Through Floor

**Problem:** Fast-moving objects pass through thin colliders

**Solution:** Enable Continuous Collision Detection (CCD) in Unity/Blender, or use thicker colliders

### Physics Feels Floaty

**Problem:** Movement doesn't feel responsive

**Solution:**
- Increase `drag` on rigidbody
- Use higher gravity (configure in Unity/Blender)
- Reduce `mass` for lighter feel

### Jittery Movement

**Problem:** Objects vibrate or jitter

**Solution:**
- Reduce `angularDrag` if spinning too much
- Check for multiple overlapping colliders
- Ensure colliders don't start intersecting

---

## Next Steps

**Learn more:**
- [Perform Raycasting](./perform-raycasting) - Cast rays for detection
- [Use Lifecycle Hooks](./use-lifecycle-hooks) - When to run physics code
- [Handle User Input](./handle-input) - Keyboard and pointer events
- [Browse all How-To Guides](/docs/how-to-guides/) - See all task-oriented guides

**Reference:**
- [Physics Events](/docs/reference/api/physics-events) - Collision/trigger events API
- [Component Reference](/docs/reference/components) - Built-in physics components
- [Rapier Physics](https://rapier.rs/) - Underlying physics engine
Source: https://engine.needle.tools/docs/how-to-guides/scripting/use-physics.html

---
title: WebXR Image Tracking with Needle Engine
---

# <logo-header logo="/imgs/webxr-logo.webp" alt="WebXR">WebXR Image Tracking</logo-header>

## What is WebXR Image Tracking

**WebXR image tracking enables browsers to detect and track specific images in the real world** through a device's camera, providing real-time position and orientation data to anchor virtual content precisely to physical markers like posters, packaging, or artwork.

By pointing the camera at a recognized image, the image tracking API continuously updates the spatial relationship between the virtual and physical elements, ensuring proper alignment even as the device or image moves.

Image tracking transforms static images into interactive AR triggers‚Äîallowing museum paintings to display overlaid information, product packages to reveal 3D animations, or business cards to show floating contact details‚Äîall through web standards without requiring users to download dedicated apps, making AR experiences instantly accessible through any compatible web browser.

## Platform Support

Needle Engine supports image tracking across multiple platforms:

| Platform | Technology | Status |
| --- | --- | --- |
| **iOS (Safari, Chrome)** | Native WebXR via [App Clip](/docs/how-to-guides/xr/ios-webxr-app-clip) | ‚úÖ Full support |
| **Android** | WebXR Image Tracking | ‚úÖ Supported (requires Chrome flag) |
| **iOS (Alternative)** | QuickLook Image Tracking | ‚úÖ Supported via [Everywhere Actions](/docs/how-to-guides/everywhere-actions/) |

### iOS: Native WebXR Image Tracking üéâ

**NEW:** iOS now supports native WebXR image tracking through [Needle Go - iOS WebXR App Clip](/docs/how-to-guides/xr/ios-webxr-app-clip)!

Users can experience your image tracking AR content instantly on iPhone and iPad via:
- QR codes
- Smart app banners
- Direct links

**No app installation required** ‚Äì powered by ARKit for high-quality tracking.

[Try it now](https://appclip.needle.tools) ‚Ä¢ [Learn more about iOS WebXR](/docs/how-to-guides/xr/ios-webxr-app-clip)

### Android: WebXR Image Tracking

Android devices support WebXR Image Tracking through Chrome with a browser flag enabled.

:::info Enable WebXR Image Tracking on Android
**On Android**, turn on "WebXR Incubations" in Chrome Flags:
1. Open Chrome on your Android device
2. Paste `chrome://flags/#webxr-incubations` in the address bar
3. Enable the "WebXR Incubations" flag
4. Restart Chrome
:::

## Live Demo

[**Try the live demo ‚Üí**](https://engine.needle.tools/samples/image-tracking?utm_source=docs&utm_content=xr)

Start the scene below in AR and point your phone's camera at the image marker on a screen, or print it out.

<div style="display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0;">
<div style="flex: 1; max-width: 300px;"> 
    <img src="https://image-tracking-zubckszr0qj2.needle.run/assets/imagetracking-01-marker.jpg" alt="Image Marker" style="height: auto; display: block;" />
</div>
<div style="flex: 1; max-width: 300px;">
    <img src="https://image-tracking-zubckszr0qj2.needle.run/assets/imagetracking-02-marker.png" alt="Image Marker" style="height: auto; display: block; " />
</div>
</div>

<a href="/docs/imgs/imagetracking-handout.pdf" target="_blank">Download printable marker 1 (PDF)</a> ‚Äì <a href="/docs/imgs/imagetracking-handout-2.pdf" target="_blank">Download printable marker 2 (PDF)</a>

<sample src="https://image-tracking-zubckszr0qj2.needle.run/" />

**How to test:**
1. Open the demo on your device (iOS or Android)
2. Tap the AR button to enter AR mode
3. Point your camera at the marker image above
4. Watch 3D content appear tracked to the marker!

---

## Setup in Unity or Blender

Image tracking can be set up in both Unity and Blender by adding a `WebXRImageTracking` component to an object. Then add your images to the `Tracked Images` array.

### <logo-header logo="/imgs/unity-logo.webp" alt="Unity">Unity Setup</logo-header>

![Unity WebXR Image Tracking Component](/imgs/webxr-image-tracking-unity-component.jpg)
*Image tracking component in Unity*

**Steps:**
1. Add a `WebXRImageTracking` component to a GameObject
2. In the `Tracked Images` array, add your marker images
3. Assign content to display when each image is detected
4. Export and test on device

### <logo-header logo="/blender/logo.png" alt="Blender">Blender Setup</logo-header>

![Blender WebXR Image Tracking Component](/imgs/webxr-image-tracking-blender-component.jpg)
*Image tracking component in Blender*

**Steps:**
1. Add a `WebXRImageTracking` component in the Needle Engine panel
2. Add your marker images to the tracked images list
3. Set up content to appear when images are detected
4. Export and test on device

---

## Technical Details

### <logo-header logo="/imgs/ios-logo.webp" alt="iOS">iOS: Full Native Support ‚úÖ</logo-header>

iOS image tracking works through [Needle Go App Clip](/docs/how-to-guides/xr/ios-webxr-app-clip) with full ARKit support:
- ‚úÖ **No browser flags required**
- ‚úÖ **No setup needed**
- ‚úÖ **High-quality ARKit tracking**
- ‚úÖ **Works in Safari and Chrome**
- ‚úÖ **Instant access via QR codes or links**

Your Needle Engine project works automatically on iOS with image tracking enabled. [Learn more ‚Üí](/docs/how-to-guides/xr/ios-webxr-app-clip)

### <logo-header logo="/imgs/android-logo.webp" alt="Android">Android: Browser Flag Required</logo-header>

Android uses the WebXR Image Tracking API, which is currently in draft specification status ([Marker Tracking Explainer](https://github.com/immersive-web/image-tracking/blob/main/explainer.md)).

**Requirements:**
- Enable `WebXR Incubations` flag in Chrome (`chrome://flags/#webxr-incubations`)
- Restart Chrome after enabling the flag

:::tip
This is a temporary requirement while browser vendors finalize the specification. Once finalized, the flag won't be needed.
:::

### Alternative Approaches

If you need image tracking without WebXR support, consider these alternatives:

**1. Everywhere Actions (iOS QuickLook)**
- Works on iOS without App Clip
- Uses Apple's QuickLook with USDZ
- Limited to QuickLook capabilities
- [Learn more about Everywhere Actions](/docs/how-to-guides/everywhere-actions/)

**2. Camera-Based Libraries**
These require camera access permissions and use local computer vision:
- [Experimental AR.js integration](https://github.com/FireDragonGameStudio/NeedleAndARjs) by FireDragonGameStudio
- [AR.js](https://github.com/AR-js-org/AR.js) (open source)
- [Mind AR](https://github.com/hiukim/mind-ar-js) (open source)

:::tip
For the best user experience on iOS, we recommend using the [iOS WebXR App Clip](/docs/how-to-guides/xr/ios-webxr-app-clip) approach, which provides native ARKit tracking without requiring camera permissions or additional setup.
:::

---

## Use Cases

Image tracking opens up many creative possibilities:

**Marketing & Advertising:**
- Product packaging reveals 3D animations
- Posters come to life with video content
- Business cards show contact information in AR

**Education & Museums:**
- Paintings display historical context
- Textbooks show 3D models
- Exhibits provide interactive information

**Retail & E-commerce:**
- Product catalogs show 3D previews
- Magazine ads become interactive
- Store displays trigger AR experiences

**Events & Entertainment:**
- Concert posters show ticket info
- Movie posters play trailers
- Event badges trigger AR content

---

## Best Practices

**Image Marker Design:**
- Use high-contrast images
- Include distinctive features
- Avoid repeating patterns
- Test at different sizes
- Ensure good lighting conditions

**Performance:**
- Keep tracked content lightweight
- Use texture compression
- Optimize 3D models
- Test on target devices

**User Experience:**
- Provide clear instructions
- Show the marker image prominently
- Handle detection/loss gracefully
- Test in various lighting conditions

---

## Next Steps

**Get Started:**
- [Unity Integration](/docs/unity/) - Set up image tracking in Unity
- [Blender Integration](/docs/blender/) - Set up image tracking in Blender
- [iOS WebXR Guide](/docs/how-to-guides/xr/ios-webxr-app-clip) - Enable native iOS support

**Learn More:**
- [XR Documentation](/docs/how-to-guides/xr/) - Full XR capabilities
- [Everywhere Actions](/docs/how-to-guides/everywhere-actions/) - Alternative AR approaches
- [Deployment Guide](/docs/how-to-guides/deployment/) - Publish your AR experience

**Resources:**
- [Live Demo](https://engine.needle.tools/samples/image-tracking) - Try it now
- [WebXR Marker Tracking Explainer](https://github.com/immersive-web/image-tracking/blob/main/explainer.md)
- [WebXR Device API](https://www.w3.org/TR/webxr/)
- [caniuse: WebXR](https://caniuse.com/webxr)

---

:::tip Need Help?
Join our [Discord community](https://discord.needle.tools) or visit our [Forum](https://forum.needle.tools) for support with image tracking and other AR features.
:::
Source: https://engine.needle.tools/docs/how-to-guides/xr/image-tracking.html

---
title: VR & AR (WebXR)
description: Build immersive VR and AR experiences that work on Meta Quest, Apple Vision Pro, Android AR, and iOS - no app stores, no installation required.
---

# <logo-header logo="/imgs/webxr-logo.webp" alt="WebXR">WebXR with Needle Engine</logo-header>

**WebXR made easy.** Build immersive AR and VR experiences that work everywhere ‚Äì from Meta Quest to Apple Vision Pro, Android to iOS, and everything in between. No app stores, no installation, no SDKs. Just pure web technology.

:::tip Try it now
Experience WebXR in action: [View XR Samples](https://engine.needle.tools/samples/?overlay=samples&tag=xr)
:::

## Why Choose Needle Engine for XR

**True Cross-Platform Support**
Needle Engine supports the full [WebXR specification](https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API), including both AR and VR. Your experiences work on:
- **<logo-header logo="/imgs/meta-logo.webp" alt="Meta">VR Headsets</logo-header>**: Meta Quest, Apple Vision Pro, Pico, HTC Vive, Valve Index, and more
- **<logo-header logo="/imgs/android-logo.webp" alt="Android">Mobile AR</logo-header>**: Android devices with Chrome/Firefox
- **<logo-header logo="/imgs/apple-logo.webp" alt="Apple">iOS AR</logo-header>**: Native WebXR via [App Clips](ios-webxr-app-clip.md) - a unique Needle Engine advantage
- **Emerging Tech**: Looking Glass displays, Hololens, Magic Leap, and future devices

**Instant Deployment**
No app stores, no installation, no waiting for approval. Share your XR experiences with a simple URL or QR code. Users can jump into AR/VR in seconds.

**Future-Proof**
When a new XR device comes out that supports WebXR, your apps work automatically. This is the power of building with web standards ‚Äì compatibility is not limited to a specific set of devices or SDKs.

**Component-Based Simplicity**
Add immersive XR capabilities to any scene with a single component. No complex setup, no boilerplate code. It just works.

## Quickstart: Enable XR in 2 Minutes

Adding AR or VR support to your Needle Engine scene is incredibly simple:

**1. Add the WebXR Component**

You can add it visually using the [Unity Integration](/docs/unity/) or [Blender addon](/docs/blender/), or with just a few lines of code:

```ts
import { onStart, WebXR } from "@needle-tools/engine";

onStart(context => {
  context.scene.addComponent(WebXR);
});
```

**2. Deploy and Test**

Deploy your scene to any HTTPS URL and open it on an XR device. That's it!

:::tip Learn More
- [XR Event Methods](/reference/api/xr-events) - Event methods and lifecycle
- [NeedleXRSession API](https://engine.needle.tools/docs/api/NeedleXRSession) - Advanced session control
- [WebXR Component API](https://engine.needle.tools/docs/api/WebXR) - Full component reference
:::

## Platform Support

### <logo-header logo="/imgs/apple-logo.webp" alt="Apple">iOS: Full WebXR Support Now Available</logo-header>

**Native iOS WebXR via App Clips** üéâ

Needle Engine provides full WebXR support on iPhone and iPad through [App Clip technology](ios-webxr-app-clip.md) ‚Äì a unique advantage that sets Needle Engine apart. Users can experience your WebXR AR content instantly via QR codes, links, or smart app banners without installing an app.

**Features:**
- Full WebXR session management powered by ARKit
- Hit testing and plane detection
- DOM overlays for UI elements
- Image tracking
- Anchor creation and tracking (work in progress)
- Lighting estimation (work in progress)

**No code changes required** ‚Äì your existing Needle Engine WebXR scenes work automatically on iOS. Simply enable the WebXR component with the `createARButton` option and deploy to an HTTPS URL.

[Try it now](https://appclip.needle.tools) ‚Ä¢ [Read full iOS WebXR docs](./ios-webxr-app-clip)

**Alternative: Everywhere Actions**

For USDZ/QuickLook-based iOS AR experiences, see [Everywhere Actions](/docs/how-to-guides/everywhere-actions/). This approach uses Apple's native 3D format and supports a subset of functionality including spatial audio, animations, and interactions.

### Supported Devices & Browsers

The following devices and browsers have been verified to work with Needle Engine. When new devices with WebXR support are released, they will work with your apps out of the box.

#### Mobile Devices

| Device | Browser | Features |
| --- | --- | --- |
| <logo-header logo="/imgs/android-logo.webp" alt="Android">Android 10+</logo-header> | ‚úîÔ∏è Chrome | Full WebXR AR support |
| <logo-header logo="/imgs/android-logo.webp" alt="Android">Android 10+</logo-header> | ‚úîÔ∏è Firefox | Full WebXR AR support |
| <logo-header logo="/imgs/apple-logo.webp" alt="Apple">iOS 14+</logo-header> | ‚úîÔ∏è Safari<br/>‚úîÔ∏è Chrome | Full WebXR via [App Clip technology](/docs/explanation/core-concepts/ios-webxr-app-clip) (ARKit-powered). Alternative: [Everywhere Actions](/docs/how-to-guides/everywhere-actions/) for USDZ/QuickLook |
| <logo-header logo="/imgs/apple-logo.webp" alt="Apple">iOS 15+</logo-header> | ‚úîÔ∏è WebXR Viewer | Older browser option (somewhat dated) |
| <logo-header logo="/imgs/microsoft-logo.webp" alt="Microsoft">Hololens 2</logo-header> | ‚úîÔ∏è Edge | hand tracking |
| <logo-header logo="/imgs/microsoft-logo.webp" alt="Microsoft">Hololens 1</logo-header> | ‚ùå | no WebXR support |
| <logo-header logo="/imgs/magic-leap-logo.webp" alt="Magic Leap">Magic Leap 2</logo-header> | ‚úîÔ∏è | |

#### VR Headsets

| Device | Browser | Features |
| --- | --- | --- |
| <logo-header logo="/imgs/apple-logo.webp" alt="Apple">Apple Vision Pro</logo-header> | ‚úîÔ∏è Safari | hand tracking, transient pointer support |
| <logo-header logo="/imgs/meta-logo.webp" alt="Meta">Meta Quest 3</logo-header> | ‚úîÔ∏è Meta Browser | hand tracking, sessiongranted<sup>1</sup>, passthrough, depth sensing, mesh tracking |
| <logo-header logo="/imgs/meta-logo.webp" alt="Meta">Meta Quest 3S</logo-header> | ‚úîÔ∏è Meta Browser | hand tracking, sessiongranted<sup>1</sup>, passthrough, depth sensing, mesh tracking |
| <logo-header logo="/imgs/meta-logo.webp" alt="Meta">Meta Quest 2</logo-header> | ‚úîÔ∏è Meta Browser | hand tracking, sessiongranted<sup>1</sup>, passthrough (black and white) |
| <logo-header logo="/imgs/meta-logo.webp" alt="Meta">Meta Quest Pro</logo-header> | ‚úîÔ∏è Meta Browser | hand tracking, sessiongranted<sup>1</sup>, passthrough |
| <logo-header logo="/imgs/meta-logo.webp" alt="Meta">Meta Quest 1</logo-header> | ‚úîÔ∏è Meta Browser | hand tracking, sessiongranted<sup>1</sup> |
| <logo-header logo="/imgs/pico-logo.webp" alt="Pico">Pico Neo 4</logo-header> | ‚úîÔ∏è Pico Browser | passthrough, hand tracking<sup>2</sup> |
| <logo-header logo="/imgs/pico-logo.webp" alt="Pico">Pico Neo 3</logo-header> | ‚úîÔ∏è Pico Browser | basic support (no hand tracking, inverted controller thumbsticks) |
| <logo-header logo="/imgs/meta-logo.webp" alt="Meta">Oculus Rift 1/2</logo-header> | ‚úîÔ∏è Chrome |  |
| Valve Index | ‚úîÔ∏è Chrome |  |
| HTC Vive | ‚úîÔ∏è Chrome |  |
| <logo-header logo="/imgs/microsoft-logo.webp" alt="Microsoft">Hololens 2</logo-header> | ‚úîÔ∏è Edge | hand tracking, AR and VR modes |

#### Other Devices

| Device | Browser | Notes |
| --- | --- | --- |
| Looking Glass Holographic Display | ‚úîÔ∏è Chrome | requires Looking Glass bridge and custom code, [see our sample](https://engine.needle.tools/samples/looking-glass/) |
| <logo-header logo="/imgs/logitech-logo.webp" alt="Logitech">Logitech MX Ink</logo-header> | ‚úîÔ∏è Meta Browser | officially supported, see [docs](https://logitech.github.io/mxink/WebXR/WebXrIntegration.html#using-needle-tools) |

<sup>1</sup>: Requires enabling browser flag: `chrome://flags/#webxr-navigation-permission`
<sup>2</sup>: Requires enabling toggle in Developer settings

## Live Examples

Experience what's possible with Needle Engine XR. Try these interactive examples on your device:

<sample src="https://engine.needle.tools/samples/collaborative-sandbox/"/>

**More Examples:**
- [Image Tracking Demo](https://engine.needle.tools/samples/image-tracking?utm_source=docs&utm_content=xr) - WebXR on Android, QuickLook on iOS
- [Musical Instrument](https://engine.needle.tools/samples-uploads/musical-instrument) - Spatial audio, animation, interactions
- [AR Overlay UI](https://engine.needle.tools/samples-uploads/ar-overlay/) - HTML content in AR
- [Browse all XR samples](https://engine.needle.tools/samples/?overlay=samples&tag=xr)

**Real-World Projects:**
> **[In Arm's Reach](https://engine.needle.tools/samples/in-arms-reach/)** - Immersive mixed reality experience connecting users spatially and emotionally from their city to remote places of nature. This climate awareness project was realized in only 2.5 days and won 5 prizes including the Grand Prize at MIT Reality Hack 2024 - the most prizes for a project in the event's history!
> ‚Äî #madewithneedle üíö

> **[Castle Builder](https://castle.needle.tools/)** - Cross-platform multiplayer sandbox with VR support, voice chat, and synchronized experiences across desktop and VR headsets.
> ‚Äî #madebyneedle üíö

> **[Encryption in Space](https://accurate-tree-observation.glitch.me/)** - Collaborative text placement with AR viewing on iOS via USDZ export.
> ‚Äî #madewithneedle by Katja Rempel üíö

## Core XR Features

### AR Settings

When building AR experiences, you'll often need to adjust scale and positioning:

**1. Define AR Session Root and Scale**
Add a `WebXR` component to your root object and modify the scale property. For AR experiences, you typically want to scale the scene to fit the real world (e.g., a product might be scaled to actual size).

**2. Define User Scale**
Adjust the user scale to shrink (< 1) or enlarge (> 1) the user in relation to the scene when entering AR. This affects how large the virtual environment appears relative to the user.

### Controlling Object Visibility

Use the `XR Flag` component to control whether objects are visible in different contexts:

- Browser (desktop/mobile 2D view)
- AR mode
- VR mode
- First Person view
- Third Person view

**Common Use Cases:**
- Hide floors when entering AR (real-world floor is visible)
- Hide avatar head in first-person VR view
- Show different UI elements in different modes

### Image Tracking

Needle Engine supports **WebXR Image Tracking** on Android and **QuickLook Image Tracking** on iOS.

Track images in the real world and attach 3D content to them. Perfect for:
- Product packaging experiences
- Posters and marketing materials
- Interactive business cards
- Museum exhibits

[Try the live demo](https://engine.needle.tools/samples/image-tracking?utm_source=docs&utm_content=xr) ‚Ä¢ [Read full Image Tracking docs](./image-tracking)

## Advanced Features

### Multiplayer & Networking in XR

Add real-time multiplayer support to your XR experiences with Needle Engine's built-in networking:

**1. Enable Networking**
Add a `SyncedRoom` component to enable multiplayer sessions.

**2. Sync Desktop Viewers**
Add a `SyncedCamera` component to allow desktop users to watch VR/AR users.

**3. Enable Voice Chat**
Add a `VoIP` component for spatial voice communication.

:::tip Scene Structure
These components can be placed anywhere in your hierarchy. They can all be on the same GameObject, which is a common pattern.
:::

### HTML Content Overlays in AR

Display custom HTML UI elements during AR sessions using the `dom-overlay` feature:

```html
<needle-engine>
    <div class="desktop ar" style="pointer-events:none;">
        <div class="positioning-container">
          <p>Your content for AR and desktop</p>
          <p class="only-in-ar">This only appears in AR</p>
        </div>
    </div>
</needle-engine>
```

Control visibility with CSS:

```css
.only-in-ar {
  display: none;
}

.ar-session-active .only-in-ar {
  display: initial;
}
```

:::tip Styling Note
The overlay element will always be displayed fullscreen while in XR. To align content differently, create a container _inside_ the AR element.
:::

[See live example](https://engine.needle.tools/samples-uploads/ar-overlay/)

### Customize AR Exit Button

By default, Needle Engine creates an "X" button in the top-right corner to exit AR. You can customize or hide it:

**Custom Button:**
```html
<needle-engine>
  <div slot="quit-ar">
    Exit AR
  </div>
</needle-engine>
```

**Hide Button:**
```html
<needle-engine>
  <div slot="quit-ar"></div>
</needle-engine>
```

:::tip
Always provide users with a way to exit AR. Use [NeedleXRSession.stop()](https://engine.needle.tools/docs/api/NeedleXRSession) to exit programmatically.
:::

### Travelling Between VR Worlds

Needle Engine supports the [`sessiongranted`](https://github.com/immersive-web/navigation) state, allowing users to seamlessly navigate between WebXR applications without leaving their immersive session.

**How to Use:**
Add the `OpenURL` component to clickable objects to create links to other XR experiences.

**Availability:**
Currently supported on Meta Quest 1, 2, and 3 in the Meta Browser (requires browser flag: `chrome://flags/#webxr-navigation-permission`). On other platforms, users will need to re-enter VR on the new page.

### Custom Avatars

While Needle Engine doesn't provide out-of-the-box integration with external avatar systems, you can create custom application-specific avatars:

**Basic Avatar Setup:**
1. Create an empty GameObject as avatar root
2. Add an object named `Head` with an `XRFlag` set to Third Person
3. Add objects named `HandLeft` and `HandRight`
4. Add your graphics below these objects

**Experimental Components:**

There are several experimental components for more expressive avatars. These are subject to change, so we recommend duplicating them for your own use:

- **`PlayerColor`** - Randomized synchronized player colors
- **`AvatarEyeLook_Rotation`** - Eyes follow other avatars (synchronized)
- **`AvatarBlink_Simple`** - Periodic eye blinking animation
- **`OffsetConstraint`** - Position constraints for body parts
- **`BasicIKConstraint`** - Simple IK for arms and legs

![Avatar Example](https://user-images.githubusercontent.com/2693840/185243523-57c4b2a9-0ec7-4f88-b53b-585e879d504d.gif)
*Example Avatar Rig with basic neck model and limb constraints*

## Next Steps

**Learn More:**
- [XR Event Methods](/docs/reference/api/xr-events) - Event methods and lifecycle hooks
- [WebXR Component API](https://engine.needle.tools/docs/api/WebXR) - Complete component documentation
- [NeedleXRSession API](https://engine.needle.tools/docs/api/NeedleXRSession) - Advanced session control
- [Image Tracking Guide](/docs/how-to-guides/xr/image-tracking) - Detailed image tracking documentation

**iOS AR Options:**
- [iOS WebXR App Clip](/docs/how-to-guides/xr/ios-webxr-app-clip) - Native WebXR support for iPhone and iPad
- [Everywhere Actions](/docs/how-to-guides/everywhere-actions/) - USDZ/QuickLook-based interactive AR

**Get Inspired:**
- [Browse XR Samples](https://engine.needle.tools/samples/?overlay=samples&tag=xr) - Interactive examples
- [Community Projects](https://forum.needle.tools/?utm_source=needle_docs&utm_content=xr) - Projects from the Needle community
Source: https://engine.needle.tools/docs/how-to-guides/xr/index.html

---
title: iOS WebXR Support for Needle Engine
description: Needle Engine now supports native iOS WebXR on iPhone and iPad using ARKit-powered App Clips. Run WebXR AR experiences instantly without app installation on Safari iOS.
---

# <logo-header logo="/imgs/webxr-logo.webp" alt="WebXR">iOS WebXR Support for Needle Engine</logo-header>

:::tip Now Available in Beta
iOS WebXR support is now available natively in **Needle Engine Beta**.
:::

Needle Engine now includes native iOS WebXR support through Needle Go. While Safari on iOS doesn't support WebXR by default, Needle Engine automatically bridges this gap using native ARKit to provide full WebXR functionality in a lightweight, instant-launch format.

[![iOS WebXR on iPhone](https://cloud.needle.tools/-/media/WI0Q0s961BjdXgUEQHxifQ.gif)](https://appclip.needle.tools)

## How iOS WebXR Works in Needle Engine

Needle Engine automatically enables WebXR AR experiences on iPhone and iPad using App Clip technology, in the form of our Needle Go App Clip. App Clips launch instantly without requiring full app installation, making it perfect for sharing AR experiences via QR codes, links, or smart app banners.

**Key Benefits:**
- **No Installation Required**: Users access AR experiences instantly without downloading an app
- **Native iOS WebXR**: Run WebXR scenes on iPhone and iPad with full ARKit integration
- **Easy Sharing**: Share AR experiences through QR codes, links, or website banners
- **Full AR Features**: Supports hit testing, anchors (wip), lighting estimation (wip), and more
- **Works with three.js**: Also compatible with any three.js-based web application via Needle Go

## Why Native iOS WebXR Support?

WebXR is not natively supported on Safari for iOS. Previously, the only option was Mozilla's WebXR Viewer app, which requires installation and hasn't been updated in years.

Needle Engine solves this by providing instant access to WebXR experiences through Apple's App Clip technology, automatically handling the integration for you.

## Getting Started

### Try it now

Visit [appclip.needle.tools](https://appclip.needle.tools) on your iPhone or iPad with Safari to experience iOS WebXR in action.

### How does iOS WebXR work in Needle Engine?

Needle Engine uses App Clips to instantly launch WebXR experiences in Augmented Reality without requiring app installation. The integration is automatic‚Äîyour existing Needle Engine projects work on iOS without modifications.

### Which devices are supported?

iOS WebXR in Needle Engine works on iPhone and iPad devices running iOS 14 or later, from the Safari or Chrome browser.

## Experience WebXR AR on iOS

Users can experience your Needle Engine WebXR content through their iPhone or iPad screen, viewing and interacting with 3D content overlaid on the real world using native ARKit capabilities.

[![iOS WebXR Physics Example](https://cloud.needle.tools/-/media/I0gsLjFwcM2pyydPfkxaiw.gif)](https://engine.needle.tools/samples/physics-playground) [![iOS WebXR Image Tracking](https://cloud.needle.tools/-/media/vRUf9BmqW_bgNARATjmfCQ.gif)](https://engine.needle.tools/samples/image-tracking) [![More iOS WebXR Examples](https://cloud.needle.tools/-/media/gcj_YoSns8FivafQRiCiOQ.gif)](https://appclip.needle.tools)

Try out more iOS WebXR examples at [appclip.needle.tools](https://appclip.needle.tools).

## Using iOS WebXR with Needle Engine

Your existing Needle Engine WebXR scenes work automatically on iOS. Simply ensure your scene:

1. Has a `WebXR` component with the `createARButton` option enabled (see [WebXR documentation](/docs/how-to-guides/xr/))
2. Is deployed to a publicly accessible HTTPS URL
3. Is optimized for mobile devices

### Enabling iOS WebXR

There are two ways to enable iOS WebXR support in your Needle Engine project:

**Option 1: Enable AR Button (Recommended)**  
Enable the `createARButton` option in your [WebXR component](http://engine.needle.tools/docs/api/WebXR). This automatically creates a button that users can tap to enter AR mode.

**Option 2: Start Programmatically**
Manually start an XR session in your code:
```typescript
NeedleXRSession.start("ar");
```

:::tip No Additional Changes Required
The WebXR-to-ARKit integration is handled automatically when users access your experience on iOS Safari and Chrome. On Android the standard WebXR API is used.
:::

### For Vanilla three.js Applications

Even if you're using vanilla three.js without Needle Engine, you can enable iOS WebXR support by linking to:

```
https://appclip.needle.tools/ar?url=<your-webxr-url>
```

**Example:**
```
https://appclip.needle.tools/ar?url=https://example.com/my-ar-experience
```

Use this URL in QR codes, links, or share it directly. When opened on iPhone or iPad, it launches the Needle Go App Clip with your WebXR experience.

## Supported WebXR Features

Needle Engine's iOS WebXR support includes comprehensive functionality:

- WebXR session management
- Hit testing and plane detection
- DOM overlays for UI elements
- Image tracking
- Anchor creation and tracking (wip)
- Lighting estimation (wip)

## Custom Branding for iOS AR

On iOS, the Needle Go App Clip experience includes a splash screen and wording. This branding can be customized for your project with a PRO subscription.  

At the moment, setting up custom branding isn't automated, so please reach out to us at [hi@needle.tools](mailto:hi@needle.tools) if you're interested in customizing the iOS AR experience for your project.

::: tip Required Branding Assets

Please provide the following assets for iOS AR branding customization:
- The URL to your experience (e.g. `https://yourdomain.com/your-ar-experience`)
- A header image: Minimum width 1800px, Height must be 1200px, PNG or JPG, No transparency, Maximum 10MB
- A display title (max. 30 chars) and subtitle (max. 56 chars)
- If needed, translations for display title and subtitle
- Your choice of "View", "Open", or "Play" for the call-to-action button text

Here's an example of how the iOS AR experience looks with custom branding:

![Example of iOS AR branding assets](/imgs/needlego-advancedexperience-template.webp "2x")

:::

## Troubleshooting

### AR experiences aren't working

Ensure that camera permissions are granted. Check in your device settings if the App Clip has access to the camera.

## Contact Us

If you need further assistance, you can reach us at:

- Email: [hi@needle.tools](mailto:hi@needle.tools)
- Website: [needle.tools](https://needle.tools)
- Discord: [Discord community](https://discord.needle.tools)

## Alternative: Everywhere Actions

Looking for a different iOS AR approach? Check out [Everywhere Actions](/docs/how-to-guides/everywhere-actions/), which enables interactive AR experiences on iOS using USDZ and QuickLook (Apple's native 3D format).

## Related Documentation

- [WebXR Documentation](/docs/how-to-guides/xr/) - Setting up WebXR in Needle Engine
- [Image Tracking](/docs/how-to-guides/xr/image-tracking) - WebXR image tracking guide
- [Everywhere Actions](/docs/how-to-guides/everywhere-actions/) - iOS AR solution using USDZ
- [Deployment](/docs/how-to-guides/deployment/) - Publishing your Needle Engine projects
Source: https://engine.needle.tools/docs/how-to-guides/xr/ios-webxr-app-clip.html

---
title: Frameworks, Bundlers, HTML
---

# Web Integration & Frameworks

Needle Engine is a web component that works with any modern web framework or vanilla JavaScript. Install it via npm and use it anywhere.

[Learn more about Needle Engine ‚Üí](https://needle.tools)

## Quick Start

**Install:**
```bash
npm i @needle-tools/engine
```

**Use in HTML:**
```html
<script type="module">
  import '@needle-tools/engine';
</script>
<needle-engine src="path/to/your.glb"></needle-engine>
```

That's it! Needle Engine automatically bundles with your project for optimized production builds.

[üìñ See web component reference ‚Üí](/docs/reference/needle-engine-attributes)

::: tip Bundling and tree shaking

**Bundling** means that all the css, js and other files making up your project are combined into less, and smaller, files at build time. This ensures that instead of downloading numerous small scripts and components, only one or a few are downloaded that contain the minimal code needed. The Vite docs contain a great explanation for why web apps should be bundled: [Why Bundle for Production](https://vitejs.dev/guide/why.html)

**Tree shaking** is a common practice in web development where unused code is removed from the final bundle to reduce file size. This is similar to "code stripping" in Unity. [The MSDN docs](https://developer.mozilla.org/en-US/docs/Glossary/Tree_shaking) have a good explanation of tree shaking.
:::

## <logo-header logo="/imgs/vite-logo.webp" alt="Vite">Supported Frameworks & Bundlers</logo-header>

Needle Engine is framework-agnostic‚Äîuse it with any modern web stack. Our default template uses [Vite](https://vitejs.dev), but you can integrate with any framework or bundler.

### Production-Ready Stacks

| Framework | Status | Notes |
| --- | --- | --- |
| **Vite + HTML** | ‚úÖ Default template | Minimal setup, great for getting started |
| **Vite + Vue** | ‚úÖ Production use | Powers [needle.tools](https://needle.tools) ‚Ä¢ [Sample](https://github.com/needle-tools/needle-engine-samples) |
| **Vite + React** | ‚ö° Experimental template | Available in Unity integration |
| **Vite + Svelte** | ‚úÖ Supported | |
| **Vite + SvelteKit** | ‚úÖ Supported | |
| **Next.js** | ‚úÖ Supported | [Example project](https://github.com/needle-engine/nextjs-sample) |
| **react-three-fiber** | ‚ö° Experimental template | Available in Unity integration |
| **Vanilla JS (CDN)** | ‚úÖ Supported | No bundler needed ‚Ä¢ [Guide](./three/) |

:::tip Have a Different Stack?
Let us know what you're building with! We're always looking to improve the experience and provide more examples.
:::

:::tip
Some frameworks require custom settings in `needle.config.json`. Learn more [here](/docs/reference/needle-config-json). Typically, the `baseUrl` needs to be set. 
:::

:::details How do I create a custom project template in Unity?

You can create and share your own web project templates to use other bundlers, build systems, or none at all.  

**Create a new Template**  
1. Select `Create/Needle Engine/Project Template` to add a ProjectTemplate into the folder you want to use as a template 
2. Done! It's that simple.

The dependencies come from unity when there is a NpmDef in the project (so when your project uses local references).  
You could also publish your packages to npm and reference them via version number.  
:::

## <logo-header logo="/imgs/pwa-logo.webp" alt="PWA">Progressive Web Apps (PWA)</logo-header>

Turn your Needle Engine project into a Progressive Web App with offline support, automatic updates, and installability.

**PWA Benefits:**
- üì± Install on home screen (mobile & desktop)
- ‚ö° Works offline
- üîÑ Auto-update when you publish new versions
- üöÄ Faster loading with smart caching

### Setup

**1. Install the Vite PWA plugin:**

```bash
npm install vite-plugin-pwa --save-dev
```

**2. Configure `vite.config.js`:**

Pass the same `pwaOptions` object to both `needlePlugins` and `VitePWA`.

```js
import { VitePWA } from 'vite-plugin-pwa';

export default defineConfig(async ({ command }) => {

    // Create the pwaOptions object. 
    // You can edit or enter PWA settings here (e.g. change the PWA name or add icons).
    /** @type {import("vite-plugin-pwa").VitePWAOptions} */
    const pwaOptions = {};
  
    const { needlePlugins } = await import("@needle-tools/engine/plugins/vite/index.js");

    return {
        plugins: [
            // pass the pwaOptions object to the needlePlugins and the VitePWA function
            needlePlugins(command, needleConfig, { pwa: pwaOptions }),
            VitePWA(pwaOptions),
        ],
        // the rest of your Vite config...
```

:::tip All assets are cached by default
Note that by default, all assets in your build folder are added the PWA precache ‚Äì for large applications with many dynamic assets, this may not be what you want (imagine the YouTube PWA caching all videos once a user opens the app!). See [More PWA Options](#more-pwa-options) for how to customize this behavior.  
:::

### Testing PWAs

To test your PWA, deploy the page, for example using the `DeployToFTP` component.  
Then, open the deployed page in a browser and check if the PWA features work as expected:
- the app shows up as installable
- the app works offline
- the app is detected as offline-capable PWA by [pwabuilder.com](https://pwabuilder.com/)

PWAs use Service Workers to cache resources and provide offline support. Service Workers are somewhat harder to use during development, and typically are only enabled for builds (e.g. when you use a `DeployTo...` component). 

You can enable PWA support for development by adding the following to the options object in your `vite.config.js`. 

```js
const pwaOptions = {
  // Note: PWAs behave different in dev mode. 
  // Make sure to verify the behaviour in production builds!
  devOptions: {
    enabled: true,
  }
};
```

Please note that PWAs in development mode do not support offline usage ‚Äì trying it may result in unexpected behavior.  

### Automatically update running apps

Websites typically show new or updated content on page refresh. 

In some situations, you may want the page to refresh and reload automatically when a new version has been published ‚Äì 
such as in a museum, trade show, public display, or other long-running scenarios.  

To enable automatic updates, set the `updateInterval` property in the pwaOptions object to a duration (in milliseconds) in which the app should check for updates. If an update is detected, the page will reload automatically.

```js
const pwaOptions = {
  updateInterval: 15 * 60 * 1000, // 15 minutes, in milliseconds
};
```

:::tip Periodic Reloads and User Data
It's not recommended to use automatic reloads in applications where users are interacting with forms or other data that could be lost on a reload. For these applications, showing a reload prompt is recommended.  
See the [Vite PWA plugin documentation](https://vite-pwa-org.netlify.app/guide/prompt-for-update.html) for more information on how to implement a reload prompt instead of automatic reloading.   
:::

### More PWA options

Since Needle uses the [Vite PWA plugin](https://vite-pwa-org.netlify.app/) under the hood, you can use all options and hooks provided by that.  
For example, you can provide a partial manifest with a custom app title or theme color:

```js
const pwaOptions = {
  // manifest options provided here will override the defaults 
  manifest: {
    name: "My App",
    short_name: "My App",
    theme_color: "#B2D464",
  }
};
```

For complex requirements like partial caching, custom service workers or different update strategies, you can remove the `{ pwa: pwaOptions }` option from `needlePlugins` and add PWA functionality directly through the Vite PWA plugin.

## Accessing Needle Engine and Components from external javascript
    
Code that you expose can be accessed from JavaScript after bundling. This allows to build viewers and other applications where there's a split between data known at edit time and data only known at runtime (e.g. dynamically loaded files, user generated content).  
For accessing components from regular javascript outside of the engine please refer to the [interop with regular javascript section](/docs/how-to-guides/scripting/create-components#accessing-needle-engine-and-components-from-anywhere)

## Customizing how loading looks

See the *Loading Display* section in [needle engine component reference](/docs/reference/needle-engine-attributes)

### Builtin styles

The needle-engine loading appearance can use a light or dark skin.  
To change the appearance use the `loading-style` attribute on the `<needle-engine>` web component.  
Options are `light` and `dark` (default):

``<needle-engine loading-style="light"></needle-engine>``

### Custom Loading Style ‚Äî *PRO feature*  #

Please see the *Loading Display* section in [needle engine component reference](/docs/reference/needle-engine-attributes)

![custom loading](/imgs/custom-loading-style.webp)
Source: https://engine.needle.tools/docs/how-to-guides/web-integration/index.html

---
description: "Learn how to create responsive 3D websites that adapt to any screen size using Focus Rect and ViewBox features"
---

# Create Responsive 3D Layouts

This guide shows you how to build responsive 3D websites that adapt seamlessly to different screen sizes and aspect ratios. Whether you're building a portfolio, product showcase, or interactive experience, Needle Engine provides powerful tools to ensure your 3D content looks great on every device.

## Overview

Needle Engine offers two complementary approaches for responsive 3D design:

- **Focus Rect** - Adjusts the camera center based on your HTML layout
- **ViewBox** - Automatically frames specific 3D content in the view

Both can be used independently or combined for maximum flexibility.

---

## Method 1: Focus Rect

Focus Rect allows you to control the camera's focal point by linking it to HTML elements in your page layout. As your page layout responds to different screen sizes, the 3D camera automatically adjusts to keep the right content in view.

### When to Use Focus Rect

**Perfect for:**
- Portfolio websites with side-by-side text and 3D content
- Product showcases where UI elements frame the 3D view
- Landing pages with asymmetric layouts
- Any design where the 3D scene should respond to page structure

**Best for:** Layouts where you want the camera to follow your page design rather than the 3D content itself.

### How Focus Rect Works

Focus Rect uses CSS positioning to determine where the camera should point. You specify an HTML element (like a `<div>`), and Needle Engine:
1. Calculates the element's screen position
2. Adjusts the camera to center on that position
3. Updates automatically when the window resizes

### Setup with Code

Add this to your Needle Engine code (e.g., in `main.ts`):

```ts twoslash
import "@needle-tools/engine";
import { onStart } from "@needle-tools/engine";

onStart((ctx) => {
    const focusElement = document.querySelector(".focus-area");
    if (focusElement) {
        ctx.setCameraFocusRect(focusElement);
    }
})
```

Then create the HTML element to focus on:

```html
<div class="focus-area" style="
    position: absolute;
    left: 20%;
    top: 30%;
    width: 40%;
    height: 40%;
"></div>
```

::: tip No-Code Alternative
You can also use [HTML attributes](/docs/reference/needle-engine-attributes) to set focus rect without writing code. Add `focus-rect=".focus-area"` to your `<needle-engine>` element.
:::

### Dynamic Focus Changes

You can change the focus rect at runtime to create smooth camera transitions:

```ts
import { Context } from "@needle-tools/engine";

// Switch to a different focus area
function changeFocus(newElementSelector: string) {
    const newElement = document.querySelector(newElementSelector);
    if (newElement) {
        Context.Current.setCameraFocusRect(newElement);
    }
}

// Clear the focus rect to return to default view
function clearFocus() {
    Context.Current.setCameraFocusRect(null);
}
```

### Real-World Examples

**Portfolio Header:**

<sample src="https://portfolio-header-demo-z23hmxb19zenk-19zenk.needle.run/" />

[Open in new tab](https://portfolio-header-demo-z23hmxb19zenk-19zenk.needle.run/)

**Product Showcase:**

<sample src="https://focus-rect-demo-z23hmxbztexgt-z19e07i.needle.run/" />

[Open in new tab](https://focus-rect-demo-z23hmxbztexgt-z19e07i.needle.run/)

### Video Tutorial

<video-embed src="https://www.youtube.com/watch?v=YAPInggEIg8" limit_height />

---

## Method 2: ViewBox

The [ViewBox component](https://engine.needle.tools/docs/api/classes/Built-in_Components.ViewBox.html) defines a 3D bounding box that should always be visible in the camera view. Needle Engine automatically adjusts the camera framing to fit this box, regardless of screen size or aspect ratio.

### When to Use ViewBox

**Perfect for:**
- Character viewers that must show the full character
- Product configurators where the product should always be visible
- Scenes that need guaranteed content framing
- Apps that need to support both mobile (portrait) and desktop (landscape)

**Best for:** Ensuring specific 3D content is always properly framed, regardless of device.

### How ViewBox Works

ViewBox creates an invisible bounding box in your 3D scene. The camera automatically:
1. Adjusts its field of view or distance
2. Ensures the entire box is visible
3. Adapts to different screen aspect ratios
4. Maintains proper framing as you resize the window

### Setup in Unity

1. **Add the Component**
   - Create an empty GameObject in your scene
   - Add the `ViewBox` component from Needle Engine

2. **Position and Scale**
   - Position the GameObject to center on your content
   - Scale it to encompass everything you want visible
   - The box is only visible in the editor, not at runtime

3. **Test Different Aspect Ratios**
   - Preview your scene in Unity
   - Try different Game view aspect ratios
   - The ViewBox ensures your content stays framed

### Setup in Blender

1. **Add the Component**
   - Select an Empty object or create one
   - Add the `ViewBox` component in the Needle Engine panel

2. **Adjust the Bounds**
   - Scale the empty to frame your content
   - Use the viewport to visualize the bounds
   - Test with different viewport sizes

### Animated ViewBox

You can animate or scale the ViewBox to create dynamic effects:

```ts
import { Behaviour, serializable } from "@needle-tools/engine";
import { ViewBox } from "@needle-tools/engine";

export class AnimatedFraming extends Behaviour {

    @serializable(ViewBox)
    viewBox?: ViewBox;

    zoomIn() {
        if (!this.viewBox) return;
        // Smoothly scale the viewbox
        this.startCoroutine(this.animateScale(0.5, 1.0)); // zoom in
    }

    *animateScale(targetScale: number, duration: number) {
        const startScale = this.viewBox!.gameObject.scale.clone();
        let time = 0;

        while (time < duration) {
            time += this.context.time.deltaTime;
            const t = Math.min(time / duration, 1);
            const scale = startScale.lerp(targetScale, t);
            this.viewBox!.gameObject.scale.copy(scale);
            yield;
        }
    }
}
```

### Real-World Examples

#### 3D Bike Example

Note: The yellow box is the Viewbox Gizmo and only enabled for visualization purposes.

<sample src="https://viewbox-demo-z23hmxbz2gkayo-z1nyzm6.needle.run/" />

[Open in new tab](https://viewbox-demo-z23hmxbz2gkayo-z1nyzm6.needle.run/)

**Scrollytelling Experience:**

<sample src="https://scrollytelling-bike-z23hmxb2gnu5a.needle.run/" />

[Open in new tab](https://scrollytelling-bike-z23hmxb2gnu5a.needle.run/)

#### Interactive Example

[Editable Demo on Stackblitz](https://stackblitz.com/edit/needle-engine-view-box-example?file=README.md)

### Video Tutorials

**ViewBox Basics:**

<video-embed src="https://www.youtube.com/watch?v=Dn9lmWy3Vak" limit_height />

**Advanced ViewBox Techniques:**

<video-embed src="https://www.youtube.com/watch?v=-YKKoYRIrtg" limit_height />

---

## Combining Focus Rect and ViewBox

For maximum control over responsive design, use both techniques together:

**ViewBox** handles the 3D content framing:
- Ensures your character/product is always visible
- Adapts to different aspect ratios automatically
- Maintains proper scale across devices

**Focus Rect** handles the page layout:
- Centers the camera based on your UI design
- Responds to asymmetric page layouts
- Creates visual harmony between 2D and 3D

### Example: Portfolio Hero Section

```ts
import { onStart } from "@needle-tools/engine";

onStart((ctx) => {
    // Set focus rect for layout responsiveness
    const heroSection = document.querySelector(".hero-content");
    if (heroSection) {
        ctx.setCameraFocusRect(heroSection);
    }

    // ViewBox (added in Unity/Blender) ensures the character stays framed
    // Both work together for perfect responsiveness
});
```

This combination ensures:
- ‚úÖ Your 3D content is always properly framed (ViewBox)
- ‚úÖ The camera centers on the right part of the screen (Focus Rect)
- ‚úÖ Everything adapts to any device or window size

---

## Best Practices

### Performance

- **Focus Rect** is lightweight and updates only on window resize
- **ViewBox** recalculates camera position every frame
- For static scenes, consider disabling ViewBox after initial framing

### Testing

Always test your responsive design on:
- üì± Mobile portrait (9:16 or similar)
- üì± Mobile landscape (16:9)
- üíª Desktop (16:9, 16:10, 21:9)
- üñ•Ô∏è Ultra-wide monitors

### Common Pitfalls

**Focus Rect:**
- ‚ùå Don't use on elements that change size frequently
- ‚ùå Avoid tiny focus areas (camera may shake)
- ‚úÖ Use stable, well-defined layout elements

**ViewBox:**
- ‚ùå Don't make it too tight (content may clip)
- ‚ùå Avoid very different aspect ratios in one box
- ‚úÖ Leave some padding around your content

---

## Troubleshooting

**Camera doesn't follow focus rect:**
- Check that the element exists in the DOM
- Verify the element has actual dimensions (not `display: none`)
- Ensure you're calling `setCameraFocusRect` after the page loads

**ViewBox doesn't work:**
- Make sure the ViewBox component is active in your scene
- Check that the ViewBox isn't too small or collapsed
- Verify the camera has the ViewBox component reference

**Content is cut off:**
- Increase the ViewBox size to add padding
- Check if other camera constraints are interfering
- Test with different aspect ratios to find the issue

---

## Next Steps

- **Learn the APIs:** [Context API Reference](https://engine.needle.tools/docs/api/classes/Engine_Core.Context.html)
- **Master Components:** [ViewBox Component Reference](https://engine.needle.tools/docs/api/classes/Built-in_Components.ViewBox.html)
- **Web Attributes:** [HTML attributes for configuration](/docs/reference/needle-engine-attributes)
- **Dynamic Behavior:** [Lifecycle hooks for runtime changes](/docs/how-to-guides/scripting/use-lifecycle-hooks)
- **Web Integration:** [Frameworks, Bundlers & More](/docs/how-to-guides/web-integration/)
- **Deployment:** [Deploy your responsive site](/docs/how-to-guides/deployment/)
Source: https://engine.needle.tools/docs/how-to-guides/web-integration/responsive-design.html

---
title: Input Event Methods
description: Reference for pointer, touch, and controller input events
---

# Input Event Methods

Handle pointer/touch/controller interactions on your components.

:::tip Cross-Platform Input
These events work across **desktop, mobile, and VR**‚Äîno need to handle different input types separately!
:::

---

## Event Methods

| Method | Parameters | When Called |
| --- | --- | --- |
| `onPointerEnter` | `args: PointerEventData` | Cursor **starts** hovering (object or children) |
| `onPointerMove` | `args: PointerEventData` | Cursor **moves** over object (or children) |
| `onPointerExit` | `args: PointerEventData` | Cursor **stops** hovering |
| `onPointerDown` | `args: PointerEventData` | Cursor **pressed** (mouse/touch down) |
| `onPointerUp` | `args: PointerEventData` | Cursor **released** |
| `onPointerClick` | `args: PointerEventData` | Cursor **clicked** (down + up on same object) |

---

## PointerEventData

The event parameter provides detailed information:

```ts
interface PointerEventData {
    // The point where the raycast hit the object
    point: Vector3;

    // The object that was hit
    object: Object3D;

    // Screen-space pointer position (0-1 range)
    pointerId: number;

    // Mouse button or touch index
    button: number;

    // Original browser event
    event: PointerEvent;
}
```

---

## Example: Simple Click Handler

```ts
import { Behaviour, PointerEventData } from "@needle-tools/engine";

export class Clickable extends Behaviour {
    onPointerClick(args: PointerEventData) {
        console.log("Clicked on", this.gameObject.name);
        console.log("Click position:", args.point);
    }
}
```

---

## Example: Hover Effects

```ts
import { Behaviour, PointerEventData } from "@needle-tools/engine";

export class HoverEffect extends Behaviour {
    private originalColor: Color;

    awake() {
        const renderer = this.gameObject.getComponent(Renderer);
        this.originalColor = renderer.material.color.clone();
    }

    onPointerEnter(args: PointerEventData) {
        const renderer = this.gameObject.getComponent(Renderer);
        renderer.material.color.set(0xff0000); // Red on hover
    }

    onPointerExit(args: PointerEventData) {
        const renderer = this.gameObject.getComponent(Renderer);
        renderer.material.color.copy(this.originalColor);
    }
}
```

---

## Example: Drag and Drop

```ts
import { Behaviour, PointerEventData } from "@needle-tools/engine";

export class Draggable extends Behaviour {
    private isDragging = false;

    onPointerDown(args: PointerEventData) {
        this.isDragging = true;
    }

    onPointerUp(args: PointerEventData) {
        this.isDragging = false;
    }

    onPointerMove(args: PointerEventData) {
        if (this.isDragging) {
            this.gameObject.position.copy(args.point);
        }
    }
}
```

---

## Global Input Events

Subscribe to input events globally (not just on specific objects):

```ts
import { Behaviour, InputEvents, NEPointerEvent } from "@needle-tools/engine";

export class GlobalInputHandler extends Behaviour {
    onEnable() {
        this.context.input.addEventListener(InputEvents.PointerDown, this.onGlobalPointerDown);
    }

    onDisable() {
        this.context.input.removeEventListener(InputEvents.PointerDown, this.onGlobalPointerDown);
    }

    private onGlobalPointerDown = (evt: NEPointerEvent) => {
        console.log("Pointer down anywhere in the scene", evt);
    }
}
```

---

## Polling Input State

Check input state every frame:

```ts
import { Behaviour } from "@needle-tools/engine";

export class PollingExample extends Behaviour {
    update() {
        // Check if pointer is down (mouse button 0 or first touch)
        if (this.context.input.getPointerDown(0)) {
            console.log("Pointer is down");
        }

        // Check if pointer was pressed this frame
        if (this.context.input.getPointerPressed(0)) {
            console.log("Pointer was just pressed");
        }

        // Check if pointer was released this frame
        if (this.context.input.getPointerUp(0)) {
            console.log("Pointer was just released");
        }
    }
}
```

---

## Browser Events

You can also subscribe to native browser events:

```ts
import { Behaviour } from "@needle-tools/engine";

export class BrowserEvents extends Behaviour {
    onEnable() {
        window.addEventListener("click", this.onWindowClick);
    }

    onDisable() {
        window.removeEventListener("click", this.onWindowClick);
    }

    private onWindowClick = () => {
        console.log("Click anywhere on the page");
    }
}
```

:::warning
When using browser events directly, you need to handle platform differences yourself (mouse vs touch vs VR controllers). Needle Engine input events handle this automatically.
:::

---

## Requirements

For input events to work:

1. **Object must be visible** (`visible = true`)
2. **Object's layer** must not be set to "Ignore Raycast"
3. **GameObject must have a collider** - Only required when using physics-based raycasting. For regular pointer events, a mesh with geometry is sufficient.

---

## Related

- [Lifecycle Methods](./lifecycle-methods) - Component lifecycle
- [Handle User Input](../../how-to-guides/scripting/handle-input) - Input guide
- [Perform Raycasting](../../how-to-guides/scripting/perform-raycasting) - Manual raycasting
Source: https://engine.needle.tools/docs/reference/api/input-events.html

---
title: Component Lifecycle Methods
description: Complete reference for Needle Engine component lifecycle methods
---

# Component Lifecycle Methods

Complete reference for all lifecycle methods available in Needle Engine components.

:::tip Performance Best Practice
Only implement lifecycle methods you actually need. Empty `update()` loops on many components hurt performance!
:::

---

## Lifecycle Methods

Lifecycle methods are **only called if declared**. Don't add empty methods!

| Method | When Called | Use For |
| --- | --- | --- |
| `awake()` | Component created | Initial setup, references |
| `onEnable()` | Component enabled | Subscribe to events |
| `start()` | First frame after creation | Initialization logic |
| `earlyUpdate()` | Before default update | Pre-update calculations |
| `update()` | Every frame | Main logic loop |
| `lateUpdate()` | After all updates | Follow cameras, final adjustments |
| `onBeforeRender()` | Just before render | Last-minute visual updates |
| `onAfterRender()` | After render | Post-processing logic |
| `onDisable()` | Component disabled | Unsubscribe from events |
| `onDestroy()` | Component/Object destroyed | Cleanup resources |

---

## Method Details

### awake()

**Called:** When component is first created (before `start()`)

**Use for:**
- Setting up references
- Initializing variables
- Finding other components

**Example:**
```ts
awake() {
    this.renderer = this.gameObject.getComponent(Renderer);
}
```

---

### onEnable()

**Called:** When component is enabled or re-enabled

**Use for:**
- Subscribing to events
- Starting processes
- Resetting state

**Example:**
```ts
onEnable() {
    this.context.input.addEventListener(InputEvents.PointerDown, this.onPointerDown);
}
```

---

### start()

**Called:** First frame after component creation (after `awake()`, after all `awake()` calls)

**Use for:**
- Initialization that depends on other components
- Starting coroutines
- Initial state setup

**Example:**
```ts
start() {
    this.startCoroutine(this.myRoutine());
    console.log("Component initialized");
}
```

---

### earlyUpdate()

**Called:** Before `update()`, every frame

**Use for:**
- Pre-update calculations
- Input processing before main logic

**Example:**
```ts
earlyUpdate() {
    this.processInput();
}
```

---

### update()

**Called:** Every frame (main update loop)

**Use for:**
- Game logic
- Movement
- Animation
- State updates

**Example:**
```ts
update() {
    this.gameObject.position.x += this.speed * this.context.time.deltaTime;
}
```

---

### lateUpdate()

**Called:** After all `update()` calls, before render

**Use for:**
- Camera following
- Final position adjustments
- Calculations that depend on other objects' updates

**Example:**
```ts
lateUpdate() {
    // Make camera follow player (after player has moved)
    this.gameObject.position.copy(this.target.position);
}
```

---

### onBeforeRender()

**Called:** Just before the frame is rendered

**Use for:**
- Last-minute visual updates
- Shader parameter updates
- Material property changes

**Example:**
```ts
onBeforeRender() {
    this.material.opacity = this.calculateOpacity();
}
```

---

### onAfterRender()

**Called:** After the frame is rendered

**Use for:**
- Post-processing logic
- Statistics gathering
- Frame cleanup

**Example:**
```ts
onAfterRender() {
    this.frameCount++;
}
```

---

### onDisable()

**Called:** When component is disabled

**Use for:**
- Unsubscribing from events
- Stopping processes
- Cleanup (temporary)

**Example:**
```ts
onDisable() {
    this.context.input.removeEventListener(InputEvents.PointerDown, this.onPointerDown);
    this.stopAllCoroutines();
}
```

---

### onDestroy()

**Called:** When component or its GameObject is destroyed

**Use for:**
- Final cleanup
- Resource disposal
- Removing global references

**Example:**
```ts
onDestroy() {
    this.disposeResources();
}
```

---

## Execution Order

```
1. awake()           // All components
2. onEnable()        // All components
3. start()           // All components (first frame only)
4. earlyUpdate()     // Every frame
5. update()          // Every frame
6. lateUpdate()      // Every frame
7. onBeforeRender()  // Every frame
8. [RENDER]
9. onAfterRender()   // Every frame
```

When disabling:
```
onDisable()
```

When destroying:
```
onDisable()
onDestroy()
```

---

## Best Practices

### ‚úÖ DO

- Only implement methods you need
- Cache component references in `awake()` or `start()`
- Use `deltaTime` for frame-rate independent movement
- Unsubscribe from events in `onDisable()`
- Clean up resources in `onDestroy()`

### ‚ùå DON'T

- Don't add empty `update()` methods
- Don't search for components every frame (use `findObjectOfType` sparingly)
- Don't forget to unsubscribe from events
- Don't do heavy calculations in `update()` without optimization

---

## Related

- [Physics Events](./physics-events) - Collision and trigger events
- [Input Events](./input-events) - User input handling
- [XR Events](./xr-events) - WebXR-specific events
- [Lifecycle Hooks](../../how-to-guides/scripting/use-lifecycle-hooks) - Global hooks
- [Time API](./time) - Accessing time and deltaTime
Source: https://engine.needle.tools/docs/reference/api/lifecycle-methods.html

# Networking Events

**Complete reference for networking lifecycle events.**

The following events are available to listen to in your components. They describe common network events that you might want to react to, such as users joining or leaving rooms, room state changes, and connection events.

## Room Events

Events related to room lifecycle - joining, leaving, and state updates.

### JoinedRoom

Fired when *you* (the local user) have joined a networked room.

```ts
this.context.beginListen(RoomEvents.JoinedRoom, ({room, viewId, allowEditing, inRoom}) => {
    console.log("Joined room:", room);
    console.log("View ID:", viewId);
    console.log("Can edit:", allowEditing);
    console.log("Users in room:", inRoom);
});
```

**Event Data:**
- `room` (string) - Room ID
- `viewId` (string) - Your unique view identifier
- `allowEditing` (boolean) - Whether you can modify room state
- `inRoom` (string[]) - Array of connection IDs currently in the room

**Use Cases:**
- Initialize networking-dependent components
- Show "Connected" UI state
- Load user-specific data
- Set up presence indicators

---

### LeftRoom

Fired when *you* (the local user) have left a networked room.

```ts
this.context.beginListen(RoomEvents.LeftRoom, ({room}) => {
    console.log("Left room:", room);
});
```

**Event Data:**
- `room` (string) - Room ID you just left

**Use Cases:**
- Clean up networking resources
- Show "Disconnected" UI state
- Reset scene state if needed
- Remove presence indicators

---

### UserJoinedRoom

Fired when *another user* has joined your networked room.

```ts
this.context.beginListen(RoomEvents.UserJoinedRoom, ({userId}) => {
    console.log("User joined:", userId);
});
```

**Event Data:**
- `userId` (string) - Connection ID of the user who joined

**Use Cases:**
- Spawn player avatars
- Show join notifications
- Update player count UI
- Initialize player-specific objects

---

### UserLeftRoom

Fired when *another user* has left your networked room.

```ts
this.context.beginListen(RoomEvents.UserLeftRoom, ({userId}) => {
    console.log("User left:", userId);
});
```

**Event Data:**
- `userId` (string) - Connection ID of the user who left

**Use Cases:**
- Remove player avatars
- Show leave notifications
- Update player count UI
- Clean up player-specific objects

---

### RoomStateSent

Fired after all current room state has been sent to the client. This happens after you join a room.

```ts
this.context.beginListen(RoomEvents.RoomStateSent, () => {
    console.log("All room state received and applied");
});
```

**Event Data:** None

**Use Cases:**
- Know when initial synchronization is complete
- Start game logic after state is loaded
- Show "Ready" state to user
- Trigger animations or effects after sync

---

::: tip API Documentation
[See all Room Events in the API docs ‚Üí](https://engine.needle.tools/docs/api/RoomEvents)
:::

## Ownership Events

Events related to object ownership - requesting, gaining, and losing ownership of objects.

### Request Ownership

Send a request to gain ownership of an object:

```ts
this.context.connection.send("request-ownership", {
    guid: this.guid
});
```

### Request Has Owner

Check if an object currently has an owner:

```ts
this.context.connection.send("request-has-owner", {
    guid: this.guid
});
```

### Remove Ownership

Release ownership of an object:

```ts
this.context.connection.send("remove-ownership", {
    guid: this.guid
});
```

### Gained Ownership

Fired when you gain ownership of an object:

```ts
// Listen for gained-ownership event
this.context.beginListen("gained-ownership", ({guid, owner}) => {
    if (guid === this.guid) {
        console.log("You now own this object");
    }
});
```

### Lost Ownership

Fired when you lose ownership of an object:

```ts
// Listen for lost-ownership event
this.context.beginListen("lost-ownership", ({guid, owner}) => {
    if (guid === this.guid) {
        console.log("You no longer own this object");
    }
});
```

::: tip API Documentation
[See all Ownership Events in the API docs ‚Üí](https://engine.needle.tools/docs/api/OwnershipEvent)
:::

## Connection Events

Events related to the WebSocket connection itself.

### Connection Start Info

Fired when the WebSocket connection is established:

```ts
// This event uses the low-level connection API
this.context.connection.beginListen("connection-start-info", ({id}) => {
    console.log("Connected with ID:", id);
});
```

**Event Data:**
- `id` (string) - Your unique connection ID

**Use Cases:**
- Store your connection ID
- Initialize connection-dependent features
- Show "Connecting..." ‚Üí "Connected" transition

---

::: tip API Documentation
[See all Connection Events in the API docs ‚Üí](https://engine.needle.tools/docs/api/ConnectionEvents)
:::

## Utility Events

Built-in events for common networking operations.

### New Instance Created

Fired when `syncInstantiate()` creates a new instance:

```ts
this.context.beginListen("new-instance-created", (data) => {
    console.log("New instance created:", data.guid);
});
```

**Event Data:**
- `guid` (string) - GUID of the new instance
- `originalGuid` (string) - GUID of the original object
- `seed` (number) - Random seed for the instance
- `visible` (boolean) - Initial visibility
- `parent` (string) - Parent object GUID
- `position`, `rotation`, `scale` - Transform data
- `deleteStateOnDisconnect` (boolean) - Whether to delete on disconnect

---

### Instance Destroyed

Fired when `syncDestroy()` destroys an instance:

```ts
this.context.beginListen("instance-destroyed", (data) => {
    console.log("Instance destroyed:", data.guid);
});
```

**Event Data:**
- `guid` (string) - GUID of the destroyed instance
- `dontSave` (boolean) - Whether to persist the destruction

---

### Ping / Pong

Connection keepalive messages sent automatically:

```json
// Ping sent to server every few seconds
{
    "key": "ping",
    "data": {}
}

// Pong response from server
{
    "key": "pong",
    "data": {}
}
```

These are handled automatically - you typically don't need to listen for them.

---

### Delete State / Delete All State

Delete state from the room:

```ts
// Delete state for a specific object
this.context.connection.send("delete-state", {
    guid: "guid_to_delete"
});

// Delete ALL room state (use with caution!)
this.context.connection.send("delete-all-state", {});
```

## Usage Patterns

### Initialize After Joining

Wait for room join before setting up networking:

```ts
start() {
    this.context.beginListen(RoomEvents.JoinedRoom, this.onJoinedRoom);
}

private onJoinedRoom = () => {
    console.log("Room joined, initializing multiplayer features");
    this.initializeMultiplayer();
}

onDestroy() {
    this.context.stopListen(RoomEvents.JoinedRoom, this.onJoinedRoom);
}
```

### Track Connected Players

Maintain a list of connected users:

```ts
private connectedUsers: Set<string> = new Set();

start() {
    this.context.beginListen(RoomEvents.JoinedRoom, ({inRoom}) => {
        // Add all existing users
        inRoom.forEach(id => this.connectedUsers.add(id));
    });

    this.context.beginListen(RoomEvents.UserJoinedRoom, ({userId}) => {
        this.connectedUsers.add(userId);
        console.log("Player count:", this.connectedUsers.size);
    });

    this.context.beginListen(RoomEvents.UserLeftRoom, ({userId}) => {
        this.connectedUsers.delete(userId);
        console.log("Player count:", this.connectedUsers.size);
    });
}
```

### Request Ownership Before Modifying

Always check ownership before modifying networked objects:

```ts
private async tryModifyObject() {
    // Request ownership
    this.context.connection.send("request-ownership", {
        guid: this.guid
    });

    // Wait for ownership confirmation
    await new Promise(resolve => {
        const listener = ({guid, owner}) => {
            if (guid === this.guid) {
                this.context.stopListen("gained-ownership", listener);
                resolve(true);
            }
        };
        this.context.beginListen("gained-ownership", listener);
    });

    // Now we can safely modify the object
    this.modifyObject();
}
```

## Next Steps

**Learn more:**
- [Enable Networking](/docs/how-to-guides/networking/setup) - Set up multiplayer
- [Manual Networking](/docs/how-to-guides/networking/manual-networking) - Send custom messages
- [Understanding Networking](/docs/explanation/networking/architecture) - How it works

**API Reference:**
- [RoomEvents API](https://engine.needle.tools/docs/api/RoomEvents)
- [OwnershipEvent API](https://engine.needle.tools/docs/api/OwnershipEvent)
- [ConnectionEvents API](https://engine.needle.tools/docs/api/ConnectionEvents)
Source: https://engine.needle.tools/docs/reference/api/networking-events.html

---
title: Physics Event Methods
description: Reference for physics collision and trigger events
---

# Physics Event Methods

Respond to physics collisions and triggers (powered by Rapier physics engine).

---

## Event Methods

| Method | Parameters | When Called |
| --- | --- | --- |
| `onCollisionEnter` | `col:` [`Collision`](https://engine.needle.tools/docs/api/Collision) | Rigidbody **starts** colliding with another |
| `onCollisionStay` | `col:` [`Collision`](https://engine.needle.tools/docs/api/Collision) | Rigidbody **continues** colliding |
| `onCollisionExit` | `col:` [`Collision`](https://engine.needle.tools/docs/api/Collision) | Rigidbody **stops** colliding |
| `onTriggerEnter` | `col:` [`Collision`](https://engine.needle.tools/docs/api/Collision) | Collider **enters** a trigger zone |
| `onTriggerStay` | `col:` [`Collision`](https://engine.needle.tools/docs/api/Collision) | Collider **stays** in a trigger zone |
| `onTriggerExit` | `col:` [`Collision`](https://engine.needle.tools/docs/api/Collision) | Collider **exits** a trigger zone |

---

## Collision vs Trigger

**Collisions:**
- Require Rigidbody components
- Generate physical response (bounce, block)
- Used for solid objects that interact physically

**Triggers:**
- Mark collider as "Is Trigger" in Unity/Blender
- No physical response (objects pass through)
- Used for zones, pickups, detection areas

---

## Collision Object

The [`Collision`](https://engine.needle.tools/docs/api/Collision) parameter provides information about the collision:

```ts
interface Collision {
    // The other object involved in the collision
    collider: Collider;

    // Contact points (if available)
    contacts?: ContactPoint[];
}
```

---

## Example: Collision Detection

```ts
import { Behaviour, Collision } from "@needle-tools/engine";

export class Ball extends Behaviour {
    onCollisionEnter(col: Collision) {
        console.log("Ball hit:", col.collider.gameObject.name);
    }

    onCollisionStay(col: Collision) {
        // Called every frame while touching
    }

    onCollisionExit(col: Collision) {
        console.log("Ball stopped touching:", col.collider.gameObject.name);
    }
}
```

---

## Example: Trigger Zone

```ts
import { Behaviour, Collision } from "@needle-tools/engine";

export class TriggerZone extends Behaviour {
    onTriggerEnter(col: Collision) {
        console.log("Object entered zone:", col.collider.gameObject.name);

        // Check what type of object entered
        const player = col.collider.gameObject.getComponent(PlayerController);
        if (player) {
            this.onPlayerEntered(player);
        }
    }

    onTriggerExit(col: Collision) {
        console.log("Object exited zone:", col.collider.gameObject.name);
    }

    private onPlayerEntered(player: PlayerController) {
        // Handle player entering zone
    }
}
```

---

## Requirements

For physics events to work:

1. **GameObject must have a Collider component** (BoxCollider, SphereCollider, etc.)
2. **For collision events:** GameObject needs a Rigidbody component
3. **For trigger events:** Collider must be marked as "Is Trigger"

---

## Performance Tips

- Use triggers instead of collisions when physical response isn't needed
- Keep `onCollisionStay` and `onTriggerStay` logic lightweight (called every frame)
- Consider using layers to filter what collides with what

---

## Related

- [Lifecycle Methods](./lifecycle-methods) - Component lifecycle
- [Component Reference](../components/) - Built-in physics components
- [How to use Physics](../../how-to-guides/physics/) - Physics setup guide
Source: https://engine.needle.tools/docs/reference/api/physics-events.html

---
title: Time API
description: Reference for time and deltaTime in Needle Engine
---

# Time API

Access time data via `this.context.time` in components.

---

## Properties

| Property | Type | Description |
| --- | --- | --- |
| `time` | `number` | Scaled time since app started (affected by `timeScale`) |
| `deltaTime` | `number` | Time since last frame (use for smooth animations) |
| `frameCount` | `number` | Total frames rendered since app started |
| `realtimeSinceStartup` | `number` | Unscaled time since app started (ignores `timeScale`) |
| `timeScale` | `number` | Time multiplier (default `1.0`, set to `0.5` for slow-motion) |

---

## Frame-Rate Independent Movement

:::tip Always Use deltaTime
Multiply movement by `deltaTime` for smooth, frame-rate independent animation:

```ts
this.gameObject.position.x += speed * this.context.time.deltaTime;
```
:::

---

## Examples

### Basic Movement

```ts
import { Behaviour } from "@needle-tools/engine";

export class MoveRight extends Behaviour {
    speed: number = 5;

    update() {
        // Move 5 units per second (frame-rate independent)
        this.gameObject.position.x += this.speed * this.context.time.deltaTime;
    }
}
```

---

### Rotation

```ts
import { Behaviour } from "@needle-tools/engine";

export class Rotate extends Behaviour {
    rotationSpeed: number = 90; // degrees per second

    update() {
        // Convert degrees to radians and rotate
        const radiansPerSecond = this.rotationSpeed * (Math.PI / 180);
        this.gameObject.rotateY(radiansPerSecond * this.context.time.deltaTime);
    }
}
```

---

### Time-Based Logic

```ts
import { Behaviour } from "@needle-tools/engine";

export class TimedSpawner extends Behaviour {
    spawnInterval: number = 2.0; // seconds
    private nextSpawnTime: number = 0;

    update() {
        // Check if enough time has passed
        if (this.context.time.time >= this.nextSpawnTime) {
            this.spawnObject();
            this.nextSpawnTime = this.context.time.time + this.spawnInterval;
        }
    }

    private spawnObject() {
        console.log("Spawning at time:", this.context.time.time);
    }
}
```

---

### Slow Motion Effect

```ts
import { Behaviour } from "@needle-tools/engine";

export class SlowMotionController extends Behaviour {
    start() {
        // Normal speed
        this.context.time.timeScale = 1.0;
    }

    enableSlowMotion() {
        // Half speed
        this.context.time.timeScale = 0.5;
    }

    disableSlowMotion() {
        // Back to normal
        this.context.time.timeScale = 1.0;
    }

    pause() {
        // Freeze time
        this.context.time.timeScale = 0.0;
    }
}
```

---

### Frame Counting

```ts
import { Behaviour } from "@needle-tools/engine";

export class FrameCounter extends Behaviour {
    update() {
        // Log every 60 frames
        if (this.context.time.frameCount % 60 === 0) {
            console.log("Frame:", this.context.time.frameCount);
            console.log("Time:", this.context.time.time);
        }
    }
}
```

---

### Real Time (Unscaled)

```ts
import { Behaviour } from "@needle-tools/engine";

export class RealTimeCounter extends Behaviour {
    update() {
        // This continues even if timeScale is 0
        const realTime = this.context.time.realtimeSinceStartup;
        console.log("Real seconds elapsed:", realTime);
    }
}
```

---

## Scaled vs Unscaled Time

| Property | Affected by timeScale? | Use For |
| --- | --- | --- |
| `time` | ‚úÖ Yes | Game logic, animations |
| `deltaTime` | ‚úÖ Yes | Movement, rotation |
| `realtimeSinceStartup` | ‚ùå No | Profiling, UI timers, cooldowns that shouldn't pause |

---

## Common Patterns

### Smooth Lerp

```ts
const alpha = 5.0 * this.context.time.deltaTime; // Lerp factor
this.gameObject.position.lerp(targetPosition, alpha);
```

### Clamp Movement Speed

```ts
const maxSpeed = 10;
const movement = speed * this.context.time.deltaTime;
const clampedMovement = Math.min(movement, maxSpeed * this.context.time.deltaTime);
```

---

## Best Practices

### ‚úÖ DO
- Always use `deltaTime` for movement and animations
- Use `time` for time-based triggers
- Use `realtimeSinceStartup` for UI timers
- Cache `this.context.time` if accessing multiple properties

### ‚ùå DON'T
- Don't use fixed values for movement (not frame-rate independent)
- Don't forget to multiply by `deltaTime`
- Don't use `Date.now()` for game logic (use `context.time`)

---

## Related

- [Lifecycle Methods](./lifecycle-methods) - When to use time
- [Component Creation](../../how-to-guides/scripting/create-components) - Basic components
- [Coroutines](../../how-to-guides/scripting/use-coroutines) - Time-based sequences
Source: https://engine.needle.tools/docs/reference/api/time.html

---
title: XR Event Methods
description: Reference for WebXR AR/VR events
---

# XR Event Methods

Build immersive AR/VR experiences with WebXR event methods.

---

## Component XR Events

| Method | Parameters | When Called |
| --- | --- | --- |
| `supportsXR` | `mode: XRSessionMode` | **Optional:** Filter which XR modes to support (`immersive-vr`, `immersive-ar`) |
| `onBeforeXR` | `mode: XRSessionMode`<br/>`init: XRSessionInit` | Before XR session starts (modify init options) |
| `onEnterXR` | `args: NeedleXREventArgs` | Component **enters** XR session |
| `onUpdateXR` | `args: NeedleXREventArgs` | Every frame **during** XR session |
| `onLeaveXR` | `args: NeedleXREventArgs` | Component **exits** XR session |
| `onControllerAdded` | `args: NeedleXRControllerEventArgs` | VR controller **connected** or component joins session with controllers |
| `onControllerRemoved` | `args: NeedleXRControllerEventArgs` | VR controller **disconnected** or component becomes inactive |

---

## XR Session Modes

```ts
type XRSessionMode =
    | "immersive-vr"  // VR headset
    | "immersive-ar"  // AR device
    | "inline";       // Non-immersive (not commonly used)
```

---

## Example: Filter XR Support

Only enable component for VR (not AR):

```ts
import { Behaviour, XRSessionMode } from "@needle-tools/engine";

export class VROnlyComponent extends Behaviour {
    supportsXR(mode: XRSessionMode): boolean {
        // Only activate in VR sessions
        return mode === "immersive-vr";
    }

    onEnterXR(args: NeedleXREventArgs) {
        console.log("Entered VR mode");
    }
}
```

---

## Example: XR Session Lifecycle

```ts
import { Behaviour, NeedleXREventArgs } from "@needle-tools/engine";

export class XRLifecycle extends Behaviour {
    onEnterXR(args: NeedleXREventArgs) {
        console.log("Entered XR session", args.xr.session);
        this.enableVRUI();
    }

    onUpdateXR(args: NeedleXREventArgs) {
        // Called every frame in XR
        this.updateVRControls();
    }

    onLeaveXR(args: NeedleXREventArgs) {
        console.log("Exited XR session");
        this.disableVRUI();
    }

    private enableVRUI() {
        // Show VR-specific UI
    }

    private updateVRControls() {
        // Update VR interaction every frame
    }

    private disableVRUI() {
        // Hide VR UI
    }
}
```

---

## Example: VR Controller Events

```ts
import { Behaviour, NeedleXRControllerEventArgs } from "@needle-tools/engine";

export class VRControllerHandler extends Behaviour {
    onControllerAdded(args: NeedleXRControllerEventArgs) {
        console.log("Controller connected:", args.controller);

        // Access controller model
        const model = args.controller.controllerModel;

        // Check handedness
        if (args.controller.handedness === "left") {
            this.setupLeftController(args.controller);
        } else {
            this.setupRightController(args.controller);
        }
    }

    onControllerRemoved(args: NeedleXRControllerEventArgs) {
        console.log("Controller disconnected:", args.controller);
    }

    private setupLeftController(controller) {
        // Configure left controller
    }

    private setupRightController(controller) {
        // Configure right controller
    }
}
```

---

## Global XR Events

For global XR session events (outside components):

| Event | Type | Description |
| --- | --- | --- |
| `"needle-xrsession-start"` | `CustomEvent` | XR session starts (`details.session` = `NeedleXRSession`) |
| `"needle-xrsession-end"` | `CustomEvent` | XR session ends (`details.session` = `NeedleXRSession`) |
| `onXRSessionStart` | Hook | Global hook for session start (unsubscribe with `offXRSessionStart`) |

---

## Example: Global XR Events

```ts
// Using CustomEvent
window.addEventListener("needle-xrsession-start", (evt) => {
    console.log("XR Session started:", evt.detail.session);
});

// Using global hook
import { onXRSessionStart } from "@needle-tools/engine";

onXRSessionStart((args) => {
    console.log("XR Session started:", args.session);
});
```

---

## Modify XR Session Init Options

```ts
import { Behaviour, XRSessionMode } from "@needle-tools/engine";

export class XRSessionConfig extends Behaviour {
    onBeforeXR(mode: XRSessionMode, init: XRSessionInit) {
        // Request specific features
        if (mode === "immersive-ar") {
            init.requiredFeatures = ["hit-test", "anchors"];
            init.optionalFeatures = ["hand-tracking"];
        }
    }
}
```

---

## Related

- [XR Guide](/docs/how-to-guides/xr/) - Set up WebXR
- [Image Tracking](/docs/how-to-guides/xr/image-tracking) - AR image tracking
- [Lifecycle Methods](/docs/reference/api/lifecycle-methods) - Component lifecycle
Source: https://engine.needle.tools/docs/reference/api/xr-events.html

---
title: C# to TypeScript Translation Guide
description: Translate your C# knowledge to TypeScript for Needle Engine
---

# <logo-header logo="/imgs/csharp-logo.webp" alt="C#">C#</logo-header> to <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">TypeScript</logo-header>

Translate your Unity C# knowledge to TypeScript for web development with Needle Engine.

:::tip New to TypeScript?
Start with [TypeScript Essentials](./typescript-essentials) for core language concepts without C# comparisons.
:::

---

## Value Types vs Reference Types

### <logo-header logo="/imgs/csharp-logo.webp" alt="C#">C# - Value Types (Structs)</logo-header>

In C#, `Vector3` is a **struct** (value type)‚Äîit gets **copied** when passed to methods:

```csharp
void MyCallerMethod() {
    var position = new Vector3(0, 0, 0);
    MyExampleVectorMethod(position);
    Debug.Log("Position.x is " + position.x); // ‚úÖ Still 0 (copy was modified)
}

void MyExampleVectorMethod(Vector3 position) {
    position.x = 42; // Modifies the COPY, not the original
}
```

**Key behavior:** Assignment creates a copy:
```csharp
var myVector = new Vector3(1, 1, 1);
var myOtherVector = myVector;  // Creates a COPY
myOtherVector.x = 42;
// Logs: 1, 42 (two separate instances)
Debug.Log(myVector.x + ", " + myOtherVector.x);
```

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">TypeScript - Reference Types (Objects)</logo-header>

In JavaScript/TypeScript, **all objects are reference types**‚Äîincluding `Vector3`:

```ts
import { Vector3 } from 'three'

function myCallerMethod() {
    const position = new Vector3(0, 0, 0);
    myExampleVectorMethod(position);
    console.log("Position.x is " + position.x); // ‚ö†Ô∏è Now 42 (original modified!)
}

function myExampleVectorMethod(position: Vector3) {
    position.x = 42; // Modifies the ORIGINAL
}
```

**Key behavior:** Assignment creates a reference:
```ts
import { Vector3 } from 'three'

const myVector = new Vector3(1, 1, 1);
const myOtherVector = myVector;  // Creates a REFERENCE
myOtherVector.x = 42;
// Logs: 42, 42 (same instance!)
console.log(myVector.x, myOtherVector.x);
```

:::warning Critical Difference!
In TypeScript, **modifying a Vector modifies the original**. To create a copy, use `.clone()`:

```ts
const myVector = new Vector3(1, 1, 1);
const myOtherVector = myVector.clone(); // ‚úÖ Creates a true copy
myOtherVector.x = 42;
// Logs: 1, 42 (two separate instances)
console.log(myVector.x, myOtherVector.x);
```
:::

---

## Vector Math & Operators

### <logo-header logo="/imgs/csharp-logo.webp" alt="C#">C# - Operator Overloading</logo-header>

C# supports operator overloading for vectors:

```csharp
var myVector = new Vector3(1, 1, 1);
var myFactor = 100f;

myVector *= myFactor;          // ‚úÖ Operators work
myVector = myVector + new Vector3(5, 0, 0);  // ‚úÖ Addition works
// ‚Üí myVector is now (105, 100, 100)
```

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">TypeScript - Method Calls</logo-header>

JavaScript/TypeScript does **not** support operator overloading. Use methods instead:

```ts
import { Vector3 } from "three"

const myVector = new Vector3(1, 1, 1);
const myFactor = 100;

myVector.multiplyScalar(myFactor);           // Can't use *= operator
myVector.add(new Vector3(5, 0, 0));          // Can't use + operator
// ‚Üí myVector is now (105, 100, 100)
```

### Common Vector Operations

| Operation | Unity (C#) | Needle Engine (TypeScript) |
| --- | --- | --- |
| Multiply | `vector *= 2` | `vector.multiplyScalar(2)` |
| Add | `vector += other` | `vector.add(other)` |
| Subtract | `vector -= other` | `vector.sub(other)` |
| Length | `vector.magnitude` | `vector.length()` |
| Normalize | `vector.normalized` | `vector.normalize()` |
| Distance | `Vector3.Distance(a, b)` | `a.distanceTo(b)` |

:::tip three.js Vector Methods
Most three.js vector methods **modify the original vector**. For immutable operations, clone first:

```ts
const result = myVector.clone().multiplyScalar(2); // Original unchanged
```
:::

---

## Time & Delta Time

### <logo-header logo="/imgs/csharp-logo.webp" alt="C#">Unity Time</logo-header>

```csharp
void Update() {
    transform.position.x += speed * Time.deltaTime;
    float currentTime = Time.time;
}
```

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">Needle Engine Time</logo-header>

Access time data via `this.context.time`:

```ts
update() {
    this.gameObject.position.x += this.speed * this.context.time.deltaTime;
    const currentTime = this.context.time.time;
}
```

### Property Mapping

| Unity (C#) | Needle Engine (TypeScript) | Description |
| --- | --- | --- |
| `Time.time` | `this.context.time.time` | Scaled time since app started |
| `Time.deltaTime` | `this.context.time.deltaTime` | Time since last frame |
| `Time.frameCount` | `this.context.time.frameCount` | Total frames rendered |
| `Time.realtimeSinceStartup` | `this.context.time.realtimeSinceStartup` | Unscaled time |
| `Time.timeScale` | `this.context.time.timeScale` | Time multiplier |

:::tip Frame-Rate Independent Movement
Always multiply movement by `deltaTime`:
```ts
this.gameObject.position.x += speed * this.context.time.deltaTime;
```
:::

[Read more about Time](../../how-to-guides/scripting/use-lifecycle-hooks#time)

---

## Raycasting

### <logo-header logo="/imgs/csharp-logo.webp" alt="C#">Unity Physics.Raycast</logo-header>

```csharp
if (Physics.Raycast(origin, direction, out RaycastHit hit, maxDistance)) {
    Debug.Log("Hit: " + hit.collider.name);
}
```

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">Needle Engine Raycast</logo-header>

```ts
// Screen-space raycast from mouse/touch
const hits = this.context.physics.raycast();
if (hits.length > 0) {
    console.log("Hit:", hits[0].object.name);
}

// Custom ray with options
const hits = this.context.physics.raycast({
    maxDistance: 100,
    lineOfSight: true
});

// Physics-based (requires colliders)
const hit = this.context.physics.engine?.raycast();
```

**Key differences:**
- Unity: Requires colliders for all raycasts
- Needle Engine: Default raycasts hit visible geometry, optional physics-based raycasts require colliders

[Read more about Raycasting](../../how-to-guides/scripting/perform-raycasting)

---

## Input

### <logo-header logo="/imgs/csharp-logo.webp" alt="C#">Unity Input</logo-header>

```csharp
void Update() {
    if (Input.GetMouseButtonDown(0)) {
        Debug.Log("Click!");
    }

    if (Input.GetKey(KeyCode.Space)) {
        Debug.Log("Space pressed");
    }
}
```

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">Needle Engine Input</logo-header>

**Polling input state:**
```ts
update() {
    if (this.context.input.getPointerDown(0)) {
        console.log("Click!");
    }

    if (this.context.input.getKeyDown("Space")) {
        console.log("Space pressed");
    }
}
```

**Event subscription:**
```ts
import { InputEvents, NEPointerEvent } from "@needle-tools/engine";

onEnable() {
    this.context.input.addEventListener(InputEvents.PointerDown, this.onPointerDown);
}

onDisable() {
    this.context.input.removeEventListener(InputEvents.PointerDown, this.onPointerDown);
}

private onPointerDown = (evt: NEPointerEvent) => {
    console.log("Pointer down at:", evt.point);
}
```

[Read more about Input](../../how-to-guides/scripting/handle-input)

---

## InputSystem Callbacks

### <logo-header logo="/imgs/csharp-logo.webp" alt="C#">Unity IPointerClickHandler</logo-header>

```csharp
using UnityEngine.EventSystems;

public class Clickable : MonoBehaviour, IPointerClickHandler {
    public void OnPointerClick(PointerEventData eventData) {
        Debug.Log("Clicked!");
    }
}
```

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">Needle Engine Pointer Events</logo-header>

```ts
import { Behaviour, PointerEventData } from "@needle-tools/engine";

export class Clickable extends Behaviour {
    onPointerClick(args: PointerEventData) {
        console.log("Clicked at:", args.point);
    }
}
```

**Available events:**
- `onPointerDown`
- `onPointerUp`
- `onPointerEnter`
- `onPointerMove`
- `onPointerExit`
- `onPointerClick`

All receive a `PointerEventData` argument.

[Read more about Input Events](/docs/reference/api/input-events)

---

## Debug.Log

### <logo-header logo="/imgs/csharp-logo.webp" alt="C#">Unity Debug</logo-header>

```csharp
Debug.Log("Hello Unity");
Debug.LogWarning("Warning message");
Debug.LogError("Error message");
```

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">JavaScript Console</logo-header>

```ts
console.log("Hello web");
console.warn("Warning message");
console.error("Error message");

// Log multiple values
console.log("Score:", score, "Player:", player);
```

---

## Debug Gizmos

### <logo-header logo="/imgs/csharp-logo.webp" alt="C#">Unity Gizmos</logo-header>

```csharp
void OnDrawGizmos() {
    Gizmos.color = Color.red;
    Gizmos.DrawWireSphere(transform.position, 1.0f);
    Gizmos.DrawLine(start, end);
}
```

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">Needle Engine Gizmos</logo-header>

```ts
import { Gizmos, isDevEnvironment } from "@needle-tools/engine";

update() {
    if (isDevEnvironment()) {
        Gizmos.DrawWireSphere(this.gameObject.position, 1.0, 0xff0000, 1);
        Gizmos.DrawLine(start, end, 0x00ff00, 0);
    }
}
```

**Key differences:**

| Unity | Needle Engine |
| --- | --- |
| `OnDrawGizmos()` method | Call `Gizmos` from **anywhere** |
| `OnDrawGizmosSelected()` | Use `if(isDevEnvironment())` to filter |
| Only in Editor | Visible in browser (filter for production!) |

**Available methods:**
- `DrawArrow` - Arrow between two points
- `DrawBox` / `DrawBox3` - Wireframe boxes
- `DrawDirection` - Direction arrow from origin
- `DrawLine` - Line between two points
- `DrawRay` - Infinite ray from origin
- `DrawSphere` / `DrawWireSphere` - Solid/wireframe spheres

[See full Gizmos API](../../how-to-guides/scripting/use-gizmos)

---

## Useful Utility Methods

### Common Unity Methods

| Unity (C#) | Needle Engine (TypeScript) |
| --- | --- |
| Check if in Editor | `#if UNITY_EDITOR` | `isDevEnvironment()` |
| Get URL parameter | N/A | `getParam("debug")` |
| Check mobile device | `Application.isMobilePlatform` | `DeviceUtilities.isMobileDevice()` |
| Check iOS | `Application.platform == RuntimePlatform.IPhonePlayer` | `DeviceUtilities.isiOS()` |

**Example:**
```ts
import { getParam, isDevEnvironment, DeviceUtilities } from "@needle-tools/engine";

// Check URL parameter
if (getParam("debug")) {
    console.log("Debug mode enabled");
}

// Platform detection
if (DeviceUtilities.isMobileDevice()) {
    // Mobile-specific logic
}

// Development vs production
if (isDevEnvironment()) {
    // Show debug UI, gizmos, etc.
}
```

[Read more about Platform Detection](../../how-to-guides/scripting/detect-mobile-devices)

---

## Quick Reference Cheat Sheet

| Task | Unity (C#) | Needle Engine (TypeScript) |
| --- | --- | --- |
| **Component** | `MonoBehaviour` | `Behaviour` |
| **GameObject** | `GameObject` | `Object3D` |
| **Transform** | `transform.position` | `this.gameObject.position` |
| **World Position** | `transform.position` | `this.gameObject.worldPosition` |
| **Find Component** | `GetComponent<T>()` | `getComponent(T)` |
| **Time** | `Time.deltaTime` | `this.context.time.deltaTime` |
| **Input** | `Input.GetMouseButtonDown(0)` | `this.context.input.getPointerDown(0)` |
| **Raycast** | `Physics.Raycast(...)` | `this.context.physics.raycast(...)` |
| **Debug Log** | `Debug.Log(...)` | `console.log(...)` |
| **Gizmos** | `OnDrawGizmos()` | `Gizmos.Draw...()` |
| **Vector Add** | `vector += other` | `vector.add(other)` |
| **Vector Multiply** | `vector *= 2` | `vector.multiplyScalar(2)` |

---

## What's Next?

**Continue learning:**
- [Working with Unity Integration](./unity-integration) - Unity workflow and glTF export
- [Create Components](../../how-to-guides/scripting/create-components) - Build interactive components
- [Lifecycle Methods](../../reference/api/lifecycle-methods) - Complete lifecycle API

**Reference:**
- [TypeScript Essentials](./typescript-essentials) - Core TypeScript/JavaScript concepts
- [Component Reference](../../reference/components) - Built-in components
- [Scripting Examples](../../reference/scripting-examples) - Code examples
Source: https://engine.needle.tools/docs/tutorials/fundamentals/c-sharp-to-typescript.html

---
title: For Blender Artists
description: A guide for 3D artists and Blender users getting started with Needle Engine
---

# Needle Engine for Blender Artists

Welcome! If you're a 3D artist, designer, or Blender enthusiast, Needle Engine opens up exciting possibilities for bringing your creations to the web‚Äîwithout requiring coding skills.

:::tip What You'll Learn
- How Needle Engine works for artists and designers
- What you can create without writing code
- When and why you might want basic scripting
- How to make your 3D work accessible on any device
:::

---

## What is Needle Engine?

Think of Needle Engine as a **bridge between Blender and the web**. You create in Blender (the tool you already know and love), and Needle Engine makes it run beautifully in any web browser‚Äîon phones, tablets, laptops, VR headsets, anywhere.

**The magic:** Your 3D scenes become interactive websites that:
- ‚ú® Load fast (even complex scenes)
- üì± Work on any device automatically
- üéÆ Support interaction without coding
- üåê Can be shared with a simple URL
- ü•Ω Support VR and AR natively

No more "download this 20GB game engine runtime" or "this only works on Windows". Just a link that works everywhere.

---

## What Can You Create Without Coding?

Needle Engine includes powerful **built-in components** that let you add interactivity without writing a single line of code. Here's what you can do:

### üé¨ Animations & Playback

- **Play animations** on click, hover, or automatically
- **Control timeline** with buttons or scroll
- **Blend between animations** smoothly
- **Loop, ping-pong, or play once**

:::tip Example Use Cases
Portfolio showcases, product reveals, animated explainer scenes, character presentations
:::

### üé® Materials & Visuals

- **PBR materials** with full texture support
- **Real-time lighting** and shadows
- **Lightmaps** for beautiful pre-baked lighting
- **Post-processing** effects (bloom, ambient occlusion, etc.)
- **Particle systems** for effects

Your materials look exactly like they do in Blender's Cycles/Eevee viewport.

### üëÜ Interactive Elements

Built-in components for common interactions:

- **Buttons** - Click to trigger animations or events
- **Draggable objects** - Move objects around in 3D space
- **Hotspots** - Click to show info, images, or text
- **Audio** - Spatial 3D audio that plays in the scene
- **Video** - Play videos on surfaces or as UI elements

:::tip Example Use Cases
Product configurators, interactive tours, portfolio pieces, educational content
:::

### üì∏ Camera Control

- **Orbit camera** - Let users explore your scene
- **Fixed cameras** - Switch between predefined views
- **Animation paths** - Smooth camera movements
- **Auto-framing** - Keep objects in view on any screen size

### ü•Ω XR (VR & AR)

Enable VR and AR with literally one click:
- Works on Quest, Vive, Index, and more
- WebXR means no app downloads needed
- AR works on phones for placing objects in real space

:::tip Example Use Cases
Virtual galleries, architectural visualization, product placement previews
:::

### üåê Multiplayer & Sharing

- **Real-time collaboration** - Multiple users in the same scene
- **Avatar systems** - See other users
- **Voice chat** - Built-in spatial audio communication
- **Shared interactions** - See what others are doing

### üì¶ Optimization Tools

Needle Engine automatically handles:
- **Mesh compression** - Smaller file sizes
- **Texture compression** - Faster loading
- **Level of Detail (LOD)** - Better performance
- **Progressive loading** - Show content while it loads

---

## <logo-header logo="/blender/logo.png" alt="Blender">Your Workflow: Blender ‚Üí Web</logo-header>

Here's how you work with Needle Engine. Don't have the add-on yet? [Download the Blender Add-on](https://engine.needle.tools/downloads/blender?utm_source=needle_docs&utm_content=getting_started) and check out the [Blender Getting Started Guide](/docs/blender/).

### 1. Create in Blender (What You Know)
- Model, sculpt, texture, light‚Äîeverything you already do
- Set up cameras and animations
- Organize with collections

### 2. Add Interactivity (No Code Required)
- Add Needle Engine components from the side panel
- Configure interactions with dropdowns and checkboxes
- Preview instantly in your browser

### 3. Export & Share
- Click "Generate Project" or "Build Production"
- Get a folder with your web-ready 3D experience
- Upload to any website host
- Share the link‚Äîthat's it!

:::tip Real-Time Preview
Changes in Blender update instantly in your browser. No waiting for long exports or builds!
:::

---

## Example: Interactive Product Showcase

Let's see what you can build without coding:

**What You Create in Blender:**
- Model of a product (e.g., a watch, furniture, sculpture)
- Multiple material variants (colors, finishes)
- Camera orbiting around the product
- Smooth reveal animation

**Add with Components:**
- `Animator` (with AnimatorController graph) or `PlayableDirector` (uses Blender's timeline) - Plays your reveal animation
- `Orbit Controls` - Let users rotate the view
- `Button` - Switches between material variants
- `ViewBox` - Ensures it looks good on mobile and desktop
- `WebXR` - Enable AR for placing in real space

**Result:**
A professional, interactive 3D product viewer that works on any device, loads fast, and lets customers see your product in AR. All without writing code!

---

## For Artists Who Want More: Light Scripting

While you can do **a lot** without code, sometimes you want custom behavior. The good news: TypeScript (Needle's language) is much more designer-friendly than traditional programming.

### When You Might Want Scripting

- **Custom UI** - Specialized interfaces for your scene
- **Game mechanics** - Physics puzzles, simple games
- **Data visualization** - Loading external data
- **API integration** - Connect to databases or services
- **Complex interactions** - Behaviors beyond built-in components

### What Makes It Artist-Friendly?

1. **Visual Studio Code** - Free, friendly code editor with suggestions as you type
2. **Hot reloading** - See changes instantly without restarting
3. **Great error messages** - Helpful hints when something's wrong
4. **Huge community** - Web development has tons of tutorials
5. **Start simple** - Copy and modify examples

:::tip Learning Path
Many artists start with built-in components, then gradually learn scripting by modifying examples. There's no pressure‚Äîuse what you need!
:::

---

## Inspiration: What Can You Create?

Here are some ideas and possibilities for projects you can build with Needle Engine:

### Portfolio Showcases
- Character presentations with smooth camera movements
- Architecture walkthroughs with ambient audio
- Product catalogs with interactive variations

### Art Installations
- Interactive museum exhibits
- Public installations with AR components
- Collaborative art pieces with multiplayer

### Client Work
- Product configurators for e-commerce
- Real estate virtual tours
- Brand experiences and marketing sites

### Educational Content
- Anatomy viewers for medical training
- Historical reconstructions
- Interactive tutorials and explainers

---

## Why Artists Love Needle Engine

### üé® Creative Freedom
- Use your favorite 3D tools (Blender)
- No technical limitations on your creativity
- Full control over look and feel

### üöÄ Professional Results
- Fast loading, even on mobile
- Looks stunning on any device
- Rivals native apps in quality

### üíº Career Opportunities
- Expand beyond static renders
- Offer interactive experiences to clients
- Build a unique portfolio that stands out

### üåç Maximum Reach
- Works everywhere‚Äîno app stores, no downloads
- Accessible to anyone with a browser
- Easy to embed in existing websites

### üÜì Open & Affordable
- Free to start with personal projects
- No per-seat licensing for small teams
- Export glTF files that work anywhere

---

## Common Questions from Artists

### "I'm not a programmer. Is this really for me?"

**Yes!** Many Needle Engine users are artists and designers with no coding background. The built-in components cover most common needs, and when you do need custom behavior, the community is incredibly helpful.

### "Will my Blender materials work?"

**Absolutely.** PBR materials, image textures, normal maps, roughness, metallic‚Äîeverything transfers. Lightmaps work too for that extra quality boost.

### "How complex can my scenes be?"

Pretty complex! Needle Engine includes automatic optimization, LOD systems, and progressive loading. Scenes with hundreds of thousands of polygons run smoothly on phones.

### "Can I sell my interactive 3D work?"

**Yes!** Your creations are yours. Many artists offer interactive 3D experiences as a service or sell them on platforms like Gumroad.

### "What if I get stuck?"

There's a friendly Discord community, extensive documentation, video tutorials, and examples. Many users are artists helping other artists!

---

## Getting Started

Ready to bring your 3D art to the web?

### Installation (5 minutes)

1. **Install Blender Add-on**
   - [Download Needle Engine for Blender](https://engine.needle.tools/downloads/blender?utm_source=needle_docs&utm_content=getting_started)
   - Install like any Blender add-on
   - Activate in Preferences

2. **Download Sample Projects**
   - [Download Blender Samples](https://engine.needle.tools/downloads/blender/download-samples?utm_source=needle_docs&utm_content=blender)
   - Open sample .blend files to see working examples
   - Modify and experiment!

3. **Start Creating**
   - Begin with a simple scene
   - Add Needle components from the side panel
   - Click "Play in Browser" to preview

:::tip Start Small
Don't start with your most complex scene. Begin with something simple to learn the workflow, then level up!
:::

### Learning Resources

**For Visual Learners:**
- [Video Tutorials](https://www.youtube.com/@needle-tools) - Step-by-step guides
- [Sample Projects](https://engine.needle.tools/samples) - Explore working examples
- [Live Demos](https://samples.needle.tools/#showcase) - See what's possible

**For Reading:**
- [Blender Integration Guide](/docs/blender/) - Complete Blender workflow
- [Component Reference](/docs/reference/components) - All built-in components
- [How-To Guides](/docs/how-to-guides/) - Specific tasks

**Community:**
- [Discord Community](https://discord.needle.tools) - Ask questions, share work
- [Forum](https://forum.needle.tools) - Discussions and examples
- [Samples & Showcase](https://samples.needle.tools/#showcase) - Get inspired

---

## Inspiration: What Will You Create?

Needle Engine gives you **superpowers** as a 3D artist:

- üé® Your art becomes **interactive and alive**
- üåê Reaches **anyone, anywhere, instantly**
- üì± Works on **every device automatically**
- ü•Ω Supports **VR and AR natively**
- ‚ö° Loads **fast and runs smoothly**

Whether you're showcasing your portfolio, creating client work, building an art installation, or just exploring creative possibilities‚ÄîNeedle Engine makes your 3D work accessible to the world.

**The best part?** You don't need to be a programmer. You're a 3D artist, and that's exactly what Needle Engine needs.

---

## Next Steps

Start your journey:

1. **Install the Add-on** - [Download from needle.tools](https://needle.tools)
2. **Watch a Quick Start Video** - [YouTube](https://www.youtube.com/@needle-tools)
3. **Open a Sample Project** - See working examples in Blender
4. **Join the Community** - [Discord](https://discord.needle.tools) for help and inspiration
5. **Create Something Amazing** - Your first interactive 3D experience!

:::tip Share Your Work!
When you create something, share it in the Discord! The community loves seeing what artists create, and you'll get helpful feedback and encouragement.
:::

---

**Ready to bring your 3D art to life on the web? Let's go! üöÄ**

[Install Needle Engine ‚Üí](https://needle.tools) ‚Ä¢ [Watch Video Tutorial ‚Üí](https://www.youtube.com/@needle-tools) ‚Ä¢ [Join Discord ‚Üí](https://discord.needle.tools)
Source: https://engine.needle.tools/docs/tutorials/fundamentals/for-blender-artists.html

---
title: Needle Engine for Unity Developers
description: Complete guide for Unity developers learning Needle Engine - from Unity integration to TypeScript scripting
---

# <logo-header logo="/imgs/unity-logo.webp" alt="Unity">For Unity Developers</logo-header>

From <logo-header logo="/imgs/unity-logo.webp" alt="Unity"></logo-header><logo-header logo="/imgs/csharp-logo.webp" alt="C#">Unity</logo-header> to <logo-header logo="/imgs/threejs-logo.webp" alt="three.js">three.js</logo-header> with <logo-header logo="/imgs/needle-logo.webp" alt="Needle Engine">Needle Engine</logo-header>

Needle Engine provides tight integration with the Unity Editor, allowing developers and designers to work together in a familiar environment and deliver **fast, performant, and lightweight web experiences**.

**Who is this guide for?**
- Unity developers learning web development
- Web developers understanding Needle Engine's Unity integration
- Teams bridging Unity and three.js workflows

:::tip Getting Started
Make sure you have Needle Engine installed in Unity: [Unity Installation](/docs/unity/)
:::

---

## The Basics

### <logo-header logo="/imgs/threejs-logo.webp" alt="three.js">Built on three.js</logo-header>

Needle Engine is a 3D web engine built on [three.js](https://threejs.org/), one of the most popular WebGL rendering libraries.

**Key concept:** In Needle Engine, a `gameObject` **is** a three.js `Object3D`. These terms are interchangeable.

**Benefits:**
- Full three.js compatibility - use any three.js code or library
- Access to the entire three.js ecosystem
- No learning curve if you already know three.js

:::important How Needle Engine Works
Needle Engine does **NOT** compile C# code to WebAssembly.

**Instead:**
- Unity defines scene structure, components, and data
- Export process converts to glTF format
- TypeScript/JavaScript powers runtime behavior

**Why?** Fast iteration speed and maximum flexibility for web experiences. Read more: [Vision](../../explanation/core-concepts/vision) ‚Ä¢ [Technical Overview](../../explanation/architecture/technical-overview)
:::

:::details How to create a new Unity project with Needle Engine? (Video)
<video-embed src="https://www.youtube.com/watch?v=gZX_sqrne8U" limit_height />
:::

---

## Learning Path

This tutorial is split into two focused guides to help you learn efficiently:

### 1. <logo-header logo="/imgs/unity-logo.webp" alt="Unity">Working with Unity Integration</logo-header>

**Start here** to understand how Needle Engine integrates with Unity:

- How the Unity workflow translates to web
- Creating and structuring components
- Understanding glTF export
- Managing web projects and packages
- Editor sync and hot reload

**[Read: Working with Unity Integration ‚Üí](./unity-integration)**

**What you'll learn:**
- Unity Editor workflow with Needle Engine
- Component system and `@serializable` decorator
- GameObject/Object3D hierarchy and scene structure
- Type mappings (Unity ‚Üí three.js)
- glTF export process (what gets exported, what doesn't)
- Web project structure on disk
- Package management (npm vs Unity Package Manager)
- Build tools and framework integration

---

### 2. <logo-header logo="/imgs/csharp-logo.webp" alt="C#">C#</logo-header> to <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">TypeScript</logo-header> Translation

**Continue here** to translate your C# knowledge to TypeScript:

- Value types vs reference types (structs vs objects)
- Vector math without operator overloading
- Time, input, and raycasting APIs
- Debug logging and gizmos
- Common utility methods

**[Read: C# to TypeScript Translation ‚Üí](./c-sharp-to-typescript)**

**What you'll learn:**
- Critical differences in how vectors work (copy vs reference)
- Using method calls instead of operators (`vector.add()` not `vector +`)
- Accessing time via `this.context.time`
- Input polling and event subscription
- Raycasting with and without physics
- Console logging and runtime gizmos
- Platform detection utilities

---

## Quick Reference

**Core Type Mappings:**

| Unity Type | Needle Engine Type | Notes |
| --- | --- | --- |
| `MonoBehaviour` | `Behaviour` | Base class for components |
| `GameObject` | `Object3D` | Same as three.js `Object3D` |
| `Transform` | `Object3D` | No separate Transform component |
| `Time.deltaTime` | `this.context.time.deltaTime` | Access via context |
| `Input` | `this.context.input` | Access via context |
| `Physics.Raycast` | `this.context.physics.raycast()` | Access via context |
| `UnityEvent` | `EventList` | Use `@serializable(EventList)` |
| `Color` | `RGBAColor` | Custom type with alpha |

:::tip Key Difference
In Unity, `position` is **world space** by default. In three.js/Needle Engine, `position` is **local space**.

Use `worldPosition` for world coordinates!
:::

---

## New to TypeScript?

If you're not familiar with TypeScript or JavaScript fundamentals, start here:

**[TypeScript Essentials ‚Üí](./typescript-essentials)**

Learn the core language concepts:
- Variables (`let`, `const`, `var`)
- Functions and arrow functions
- Objects and classes
- Imports and modules
- How references work in JavaScript

---

## What's Next?

**After completing both guides:**

- [Create Components](../../how-to-guides/scripting/create-components) - Build interactive components
- [Lifecycle Methods](../../reference/api/lifecycle-methods) - Complete lifecycle API reference
- [Component Reference](../../reference/components) - Built-in components
- [Scripting Examples](../../reference/scripting-examples) - Code examples and patterns

**Additional Resources:**

- [three.js Documentation](https://threejs.org/docs/) - Core rendering library
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html) - Language reference
- [Needle Engine Samples](https://engine.needle.tools/samples/) - Example projects
Source: https://engine.needle.tools/docs/tutorials/fundamentals/for-unity-developers.html

---
title: TypeScript Essentials
description: Learn TypeScript basics for web development with Needle Engine
sidebarDepth: 2
---

# TypeScript Essentials

<logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">TypeScript</logo-header> ‚Ä¢ <logo-header logo="/imgs/javascript-logo.webp" alt="JavaScript">JavaScript</logo-header>

Learn the fundamentals of TypeScript and JavaScript‚Äîthe languages that power Needle Engine in the browser.

:::tip Coming from Unity?
If you're a Unity developer familiar with C#, check out [For Unity Developers](./for-unity-developers) for a comparison-focused guide.
:::

:::tip Already know TypeScript?
Skip ahead to [Needle Engine Scripting](/docs/how-to-guides/scripting/create-components) to start building!
:::

---

## What is TypeScript?

TypeScript is a programming language that adds **type safety** to JavaScript. It helps you catch errors before your code runs, making development faster and more reliable.

**Key benefits:**
- üõ°Ô∏è **Catch errors early** - Find mistakes while writing code, not after deployment
- üîç **Better editor support** - Autocomplete, inline documentation, refactoring tools
- üìö **Self-documenting** - Types make code easier to understand and maintain
- üåê **Runs everywhere** - Compiles to JavaScript, works in all browsers

:::info How It Works
TypeScript code is **compiled to JavaScript** before running in the browser. The TypeScript compiler checks your code for errors during this compilation step, then outputs plain JavaScript that browsers can execute.
:::

---

## Learning Resources

**For beginners:**
- [TypeScript Tutorial](https://www.typescripttutorial.net/) - Step-by-step guide
- [Learn TypeScript](https://www.tutorialsteacher.com/typescript) - Interactive lessons

**Official documentation:**
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html) - Complete reference

---

## JavaScript vs TypeScript

### <logo-header logo="/imgs/javascript-logo.webp" alt="JavaScript">JavaScript</logo-header>

JavaScript is the language that runs in all web browsers. It's **dynamically typed**, meaning:

**Example of JavaScript's flexibility:**
```js
let score = 100;              // score is a number
score = "one hundred";        // now it's text - no error!
score = score - 10;           // üí• Crashes at runtime: can't subtract from text
```

This code is valid JavaScript syntax, but crashes when it runs in the browser.

**Characteristics:**
- ‚úÖ Very flexible - variables can change types
- ‚ùå Errors only appear when code runs
- ‚ùå No autocomplete for object properties
- ‚ùå Easy to make typos that cause runtime crashes

### <logo-header logo="/imgs/typescript-logo.webp" alt="TypeScript">TypeScript</logo-header>

TypeScript adds **type checking** to JavaScript. It catches errors before your code runs:

**Same example in TypeScript:**
```ts
let score: number = 100;      // score must be a number
score = "one hundred";        // ‚ùå TypeScript error immediately!
score = score - 10;           // Never runs - error caught first
```

TypeScript shows you the error *while you type*, not when users visit your site.

**Characteristics:**
- ‚úÖ Catches errors before deployment
- ‚úÖ Full autocomplete and inline documentation
- ‚úÖ Refactoring tools (rename symbols safely)
- ‚úÖ Self-documenting code

:::tip Why We Use TypeScript
TypeScript helps you find bugs **before users do**. It's especially valuable for larger projects and teams, where catching errors early saves hours of debugging.
::: 

## Understanding Types

Types describe what kind of data a variable can hold. Think of them as labels that help prevent mistakes.

### Common Types

**Basic types:**
```ts
let score: number = 100;           // Numbers (integers, decimals)
let playerName: string = "Alice";  // Text
let isActive: boolean = true;      // true or false
let position: Vector3;             // Custom type from three.js
```

**Type inference** - TypeScript can figure out types automatically:
```ts
let score = 100;                   // TypeScript knows this is a number
score = "hello";                   // ‚ùå Error: can't assign text to number
```

### Why Types Matter

Types prevent common mistakes:

```ts
// Without types (JavaScript):
let health = 100;
health = "full";                   // No error until runtime crash!

// With types (TypeScript):
let health: number = 100;
health = "full";                   // ‚ùå Error immediately while typing!
```

:::warning Don't Bypass Type Safety
You might see `//@ts-ignore` or `any` types in code. These disable type checking and should be avoided‚Äîthey remove the safety that TypeScript provides!
:::

### Type Annotations

Sometimes you need to explicitly declare a type:

```ts
// When TypeScript can't infer the type:
let player: Player;                // Declared but not assigned yet

// When you want to be explicit:
let speed: number = 10;            // Clear what type this should be
```

## Variables

Variables store data that your program can use and change. In TypeScript, you declare variables with `let` or `const`.

### `let` - Changeable Variables

Use `let` when the value will change:

```ts
let score = 0;              // Start at 0
score = 10;                 // Update to 10
score = score + 5;          // Add 5 ‚Üí now 15
```

### `const` - Fixed Variables

Use `const` when the value shouldn't change:

```ts
const maxHealth = 100;      // Set once
maxHealth = 200;            // ‚ùå Error: can't reassign const
```

:::tip When to Use `const`
Use `const` by default. Only use `let` when you know the variable needs to change. This makes your code clearer and prevents accidental changes.
:::

### `const` with Objects

`const` prevents *reassignment*, but you can still modify object properties:

```ts
import { Vector3 } from "three";

const position = new Vector3(0, 0, 0);
position.x = 100;           // ‚úÖ OK: Modifying a property
position.y = 50;            // ‚úÖ OK: Modifying another property

position = new Vector3();   // ‚ùå Error: Can't reassign the variable itself
```

:::warning Avoid `var`
You might see `var` in older JavaScript code. **Don't use it**‚Äîalways use `let` or `const` instead. `var` has confusing scoping rules that cause bugs. [Learn why ‚Üí](https://stackoverflow.com/a/11444416)
:::

## Imports & Modules

Modern JavaScript/TypeScript organizes code into **modules**‚Äîseparate files that export and import functionality.

### Importing Code

To use code from another file or package, you import it:

**Named imports (most common):**
```ts
import { Vector3, Object3D } from 'three';
import { Behaviour, serializable } from '@needle-tools/engine';

// Now you can use these:
const position = new Vector3(0, 1, 0);
```

**Default imports:**
```ts
import MyComponent from './MyComponent';
```

**Namespace imports:**
```ts
import * as THREE from 'three';

// Access everything through the namespace:
const myVector = new THREE.Vector3(1, 2, 3);
```

### Exporting Code

To make your code available to other files, export it:

```ts
// Export a class
export class MyComponent extends Behaviour {
    // ...
}

// Export a function
export function calculateScore(points: number) {
    return points * 10;
}

// Export a constant
export const MAX_PLAYERS = 4;
```

:::tip Named vs Namespace Imports
**Named imports** are preferred‚Äîthey're clearer and help build tools create smaller bundles. Use namespace imports only when you need many items from one package.
:::

## How Objects Work (References)

In JavaScript/TypeScript, when you assign an object to a variable, you're creating a **reference** (like a pointer or shortcut) to that object, not a copy.

### The Problem

```ts
import { Vector3 } from 'three';

const position = new Vector3(1, 2, 3);
const otherPosition = position;     // ‚ö†Ô∏è Creates a reference, not a copy!

otherPosition.x = 100;              // Modifies the original
console.log(position.x);            // 100 - both variables point to same object!
```

Both `position` and `otherPosition` refer to the **same object** in memory.

### The Solution: Clone Objects

To create a true copy, use `.clone()`:

```ts
import { Vector3 } from 'three';

const position = new Vector3(1, 2, 3);
const otherPosition = position.clone();  // ‚úÖ Creates a new copy

otherPosition.x = 100;                   // Modifies only the copy
console.log(position.x);                 // Still 1 - original unchanged!
```

### When to Clone

Clone when you need an independent copy:

```ts
// ‚ùå Wrong: Modifies original
function movePlayer(position: Vector3) {
    position.x += 10;  // Changes the player's actual position!
}

// ‚úÖ Right: Works with a copy
function calculateNextPosition(position: Vector3) {
    const newPos = position.clone();
    newPos.x += 10;  // Original unchanged
    return newPos;
}
```

:::tip Remember
- Simple types (`number`, `string`, `boolean`) are always copied
- Objects (including `Vector3`, arrays, custom classes) are **references**
- Use `.clone()` when you need an independent copy
:::

## Working with Vectors

Vectors represent positions, directions, and other 3D data. In Needle Engine, we use three.js vectors.

### Creating Vectors

```ts
import { Vector3 } from 'three';

const position = new Vector3(0, 1, 0);      // x, y, z coordinates
const direction = new Vector3(1, 0, 0);     // Points right
```

### Vector Math Operations

Unlike simple numbers, you can't use `+`, `-`, `*` operators with vectors. Use methods instead:

```ts
import { Vector3 } from 'three';

const position = new Vector3(1, 1, 1);

// Multiply by a number
position.multiplyScalar(2);                 // Now (2, 2, 2)

// Add another vector
position.add(new Vector3(5, 0, 0));         // Now (7, 2, 2)

// Subtract a vector
position.sub(new Vector3(1, 0, 0));         // Now (6, 2, 2)
```

### Common Vector Methods

```ts
import { Vector3 } from 'three';

const position = new Vector3(3, 4, 0);

// Get length (magnitude)
const distance = position.length();         // 5

// Normalize (make length = 1)
position.normalize();                       // Now (0.6, 0.8, 0)

// Distance between two points
const target = new Vector3(10, 4, 0);
const dist = position.distanceTo(target);  // 9.4
```

:::warning Methods Modify the Original
Most vector methods **change the original vector**. To keep the original, clone first:

```ts
const original = new Vector3(1, 2, 3);
const doubled = original.clone().multiplyScalar(2);  // Original unchanged
```
:::

## Comparing Values

JavaScript/TypeScript has two ways to check if values are equal: `===` and `==`.

### Strict Equality (`===`) - Use This!

Strict equality checks if values are **exactly** the same:

```ts
const score = 100;

score === 100       // ‚úÖ true
score === "100"     // ‚ùå false (number vs string)
score === 99        // ‚ùå false

// Checking for null or undefined
const player = null;
player === null       // ‚úÖ true
player === undefined  // ‚ùå false (different values)
```

### Loose Equality (`==`) - Rarely Needed

Loose equality performs **type conversion** before comparing:

```ts
const score = 100;

score == 100        // ‚úÖ true
score == "100"      // ‚úÖ true (converts string to number!)
0 == false          // ‚úÖ true (converts false to 0!)
"" == false         // ‚úÖ true (both convert to false!)

// Useful for checking both null AND undefined:
const player = null;
player == null      // ‚úÖ true (matches both null and undefined)
```

### Comparison Table

| Expression | `===` (Strict) | `==` (Loose) |
| --- | --- | --- |
| `100 === 100` | ‚úÖ true | ‚úÖ true |
| `100 === "100"` | ‚ùå false | ‚úÖ true |
| `0 === false` | ‚ùå false | ‚úÖ true |
| `null === undefined` | ‚ùå false | ‚úÖ true |

:::tip Always Use `===`
Use strict equality (`===`) by default. It's more predictable and avoids surprising type conversions. Only use `==` when you specifically need to check for both `null` and `undefined` together.
:::

## Functions and `this`

Functions are blocks of reusable code. In TypeScript, there are two ways to write them, and they handle `this` differently.

### Regular Functions

Traditional function syntax:

```ts
function greet(name: string) {
    return "Hello, " + name;
}

const message = greet("Alice");  // "Hello, Alice"
```

### Arrow Functions (Recommended)

Shorter syntax with automatic `this` binding:

```ts
const greet = (name: string) => {
    return "Hello, " + name;
}

// Even shorter for single expressions:
const greet = (name: string) => "Hello, " + name;
```

### The `this` Problem

In JavaScript, `this` can change depending on how a function is called. This causes problems with event handlers:

```ts
import { Behaviour } from "@needle-tools/engine";

export class Counter extends Behaviour {
    count = 0;

    // ‚ùå Problem: Regular function
    increment() {
        this.count++;  // 'this' might be undefined!
    }

    start() {
        // When used as event handler, 'this' is lost:
        button.addEventListener('click', this.increment);  // ‚ùå Breaks!
    }
}
```

### Solution: Arrow Functions

Arrow functions **automatically bind `this`** to your class:

```ts
import { Behaviour } from "@needle-tools/engine";

export class Counter extends Behaviour {
    count = 0;

    // ‚úÖ Solution: Arrow function
    increment = () => {
        this.count++;  // 'this' always works correctly!
    }

    start() {
        // Arrow function keeps correct 'this':
        button.addEventListener('click', this.increment);  // ‚úÖ Works!
    }
}
```

### When to Use Each

**Use arrow functions for:**
- Event handlers
- Callbacks
- Methods that need access to `this`

**Use regular functions for:**
- Top-level utility functions
- Functions that don't use `this`

```ts
// Utility function - regular function is fine
function calculateDistance(a: number, b: number) {
    return Math.abs(a - b);
}

// Event handler - use arrow function
class MyComponent extends Behaviour {
    onClick = () => {
        console.log(this);  // Works correctly
    }
}
```

:::tip Keep It Simple
**Use arrow functions for methods in your classes**‚Äîthey're simpler and avoid `this` problems. You can always use regular functions for standalone utilities.
:::

---

## Quick Reference

Here's a cheat sheet of what you've learned:

```ts
// Variables
let changeable = 100;              // Use let for values that change
const fixed = 100;                 // Use const by default

// Types
let score: number = 100;
let name: string = "Alice";
let active: boolean = true;

// Imports
import { Vector3 } from 'three';
import { Behaviour } from '@needle-tools/engine';

// Vectors
const pos = new Vector3(0, 1, 0);
pos.add(new Vector3(1, 0, 0));     // Now (1, 1, 0)
const copy = pos.clone();          // Create independent copy

// Equality
if (score === 100) { }             // Use === (strict equality)

// Functions
const greet = (name: string) => {  // Arrow functions for methods
    return "Hello, " + name;
}
```

---

## What's Next?

Now that you understand TypeScript basics, you're ready to start building with Needle Engine!

**Start creating:**
- [Create Your First Component](/docs/how-to-guides/scripting/create-components) - Build interactive behaviors
- [Handle User Input](/docs/how-to-guides/scripting/handle-input) - Respond to mouse, touch, and keyboard
- [Use Lifecycle Hooks](/docs/how-to-guides/scripting/use-lifecycle-hooks) - Update loops and component lifecycle

**Explore more:**
- [How-To Guides](/docs/how-to-guides/) - Task-oriented guides for common scenarios
- [Scripting Examples](/docs/reference/scripting-examples) - Copy-paste code examples
- [API Reference](/docs/reference/) - Complete API documentation

**Coming from Unity?**
- [For Unity Developers](./for-unity-developers) - C# to TypeScript comparison guide
Source: https://engine.needle.tools/docs/tutorials/fundamentals/typescript-essentials.html

---
title: Working with Unity Integration
description: Learn how Needle Engine integrates with Unity - visual features, scene structure, and the export workflow
---

# <logo-header logo="/imgs/unity-logo.webp" alt="Unity">Working with Unity Integration</logo-header>

Learn how Needle Engine brings Unity's powerful visual tools to the web‚Äîno code required for many features!

:::tip Before You Start
Make sure you have Needle Engine installed in Unity. See [Unity Installation](/docs/unity/) for setup instructions.
:::

---

## How Needle Engine Works with Unity

Needle Engine provides tight integration with the Unity Editor, allowing you to:
- **Design visually** in Unity's familiar interface
- **Use built-in Unity features** (shaders, lightmaps, animation, physics)
- **Export to optimized web formats** automatically
- **See changes instantly** with hot reload

:::important Key Concept: Unity + glTF + Web
Needle Engine does **NOT** compile C# code to WebAssembly.

**The workflow:**
1. **Unity Editor** - Design scenes, set up components, configure visual features
2. **glTF Export** - Scene converts to glTF format automatically
3. **Web Runtime** - Browser loads and displays your scene

**Why?** Small file sizes, fast loading, and works on any device with a browser.

Read more: [Vision](../../explanation/core-concepts/vision) ‚Ä¢ [Technical Overview](../../explanation/architecture/technical-overview)
:::

:::details Video: Getting Started with Unity (16 minutes)
<video-embed src="https://www.youtube.com/watch?v=3dB-d1Jo_Mk" limit_height />
:::

---

## What Works Out of the Box

Many powerful features work without writing code!

### üé¨ Animation

**Animate visually** with Unity's powerful animation tools:

<img src="https://user-images.githubusercontent.com/5083203/186011302-176524b3-e8e5-4e6e-9b77-7faf3561bb15.png" alt="Unity Animator" />

#### Animator State Machines

Create complex animation behaviors without code:
- Set up **Animation Controllers** in Unity
- Define **states** and **transitions**
- Use **parameters** to control animations
- Add **layers** for animation blending

All exported and working on the web automatically!

#### Timeline Sequencing

Create cinematic sequences and cutscenes:
- **Timeline** - Sequence animations, audio, and events
- **Playable Director** - Control playback

Perfect for product showcases, architectural walkthroughs, and interactive stories.

[Read more: Animation Components](/docs/reference/components#animation)

---

### ‚öôÔ∏è Physics

**Visual physics setup** - no coding required for basic interactions:

**Add physics components in Unity:**
- **Rigidbody** - Objects respond to gravity and forces
- **Colliders** - Define collision shapes (Box, Sphere, Mesh)
- **Physics Materials** - Bounce, friction properties
- **Joints** - Connect rigidbodies with constraints

**Configure visually:**
- Mass, drag, and gravity settings
- Collision layers and masks
- Trigger zones (Is Trigger checkbox)
- Constraints (freeze position/rotation)

Everything exports and works on the web with the Rapier physics engine!

[Read more: Physics Setup](/docs/how-to-guides/scripting/use-physics)

---

### <logo-header logo="/imgs/unity-logo.webp" alt="Unity">Shaders & Materials</logo-header>

**Create beautiful materials visually** with Unity's tools:

<img src="https://user-images.githubusercontent.com/5083203/186012027-9bbe3944-fa56-41fa-bfbb-c989fa87aebb.png" alt="Shader Graph Example" />

- **PBR Materials** - Standard/URP materials export automatically
- **Shader Graph** - Node-based shader creation without code
- **Custom Shaders** - Export shader variants and properties

**What you can adjust:**
- Colors, textures, and material properties
- Metallic, roughness, emission
- Transparency and rendering modes
- Shader properties (exposed as material properties)

Artists can create shaders in Unity and Needle Engine handles the conversion to web-compatible shaders automatically.

[Read more: Materials & Shaders](/docs/how-to-guides/export/#physically-based-materials-pbr)

---

### üí° Lightmaps

**Bake beautiful lighting** in Unity and it appears on the web automatically:

![lightmaps](https://user-images.githubusercontent.com/5083203/186163693-093c7ae2-96eb-4d75-b98f-bf19f78032ff.gif)

**Setup (no code required):**
1. Mark objects as **Static** in Unity
2. Add lights or use emissive materials
3. Click **Generate Lighting**
4. Needle Engine exports lightmaps automatically

**Works with:**
- Unity's built-in lightmapper
- Third-party solutions like [Bakery](https://assetstore.unity.com/packages/tools/level-design/bakery-gpu-lightmapper-122218)
- Multiple scenes with independent lightmaps

#### Recommended Unity Lightmap Settings

For best performance and quality on the web:

- **Lightmap Encoding:** Normal Quality (adjust in Project Settings > Player)
- **Progressive GPU** (faster and usually accurate enough for small scenes)
- **Non-Directional Lightmaps**
- **Max Lightmap Size:** 2k (you can go higher, but expect large files)
- **Max 4√ó 2k lightmaps per scene** (you can go higher, but expect large files)
- **Compress Lightmaps:** OFF (increases quality; otherwise compressed again at export)

![lightmap settings](https://user-images.githubusercontent.com/5083203/185956392-f4031f45-ad13-4e6d-a14c-c8ec5c1fcfd4.png)

**Working with multiple scenes:** Disable "Auto Generate" and bake lightmaps explicitly. Otherwise, Unity will discard temporary lightmaps on scene change.

#### Mixing Baked and Non-Baked Objects

For best results when mixing baked and non-baked objects, use these Unity lighting settings:

```
Environment Lighting: Skybox
Ambient Intensity: 1
Ambient Color: black
```

**Unity 2021.3+:**  
![Unity 2021.3+ settings](https://user-images.githubusercontent.com/2693840/186947184-2446672f-420c-47e8-8f7d-970a7d52bf35.png)

**Unity 2020.3+:**  
![Unity 2020.3+ settings](https://user-images.githubusercontent.com/2693840/186947203-2d7d96c3-f566-44b4-889c-4103fac505d4.png)

If you have no baked objects in your scene, these settings also work:
```
Environment Lighting: Color
Ambient Color: any
```

What you see in Unity is what you get on the web!

[Read more: Lightmaps](/docs/how-to-guides/export/#exporting-lightmaps)

---

### üé® Post-Processing

**Add professional visual effects** with post-processing:

- **Bloom** - Glowing highlights
- **SSAO** - Ambient occlusion for depth
- **Depth of Field** - Focus effects
- **Color Correction** - Adjust tone and mood
- **Tonemapping** - Control exposure and contrast

Add a **Volume** component to your camera and configure effects visually in Unity. Effects work on all devices!

<sample src="https://engine.needle.tools/samples-uploads/postprocessing/" />

[See all post-processing components](/docs/reference/components#postprocessing)

---

### üé® Particle Systems

**Create stunning visual effects:**

Unity's Particle System works on the web! Configure particles visually:
- Emission rates and bursts
- Particle lifetime and size
- Colors and gradients
- Forces and velocity
- Collision and sub-emitters

Great for fire, smoke, sparkles, rain, and magical effects.

---

### üñºÔ∏è UI Canvas

**Build interactive UI** without code:

Unity's **Canvas** system works on the web:
- Buttons, text, images, and input fields
- Layout groups for responsive design
- Screen space and world space UI
- Event triggers for interactions

Perfect for HUDs, menus, and interactive elements.

[Read more: UI Components](/docs/reference/components#ui)

---

### üë• Multiplayer (No Code)

**Add multiplayer** with built-in components:

- **SyncedRoom** - Automatic room creation and joining
- **SyncedTransform** - Sync object positions automatically
- **SyncedCamera** - See other users' viewpoints
- **Voip** - Voice chat with spatial audio

Just add components in Unity - no networking code needed!

[Read more: Networking Setup](/docs/how-to-guides/networking/setup)

---

### ü•Ω XR/AR Support

**VR and AR** with visual setup:

- **WebXR** component - Enable VR/AR mode
- **XR Rig** - Configure VR camera and controllers
- **AR Session Root** - AR placement and scale
- **XR Flag** - Show/hide objects in VR/AR

Works on Meta Quest, Apple Vision Pro, and AR on mobile devices!

[Read more: XR Setup](/docs/how-to-guides/xr/)

---

## Scene Structure & GameObjects

### GameObject Hierarchy

Your Unity hierarchy exports directly to the web:
- Parent-child relationships maintained
- Transform data (position, rotation, scale)
- Object names preserved
- Active state and visibility

**Key concept:** In three.js/Needle Engine, `GameObject` and `Transform` are the same object (`Object3D`).

### Components

**Built-in Unity components** that work on the web:
- Camera
- Light (Directional, Point, Spot)
- MeshRenderer / SkinnedMeshRenderer
- MeshFilter
- AudioSource
- And many more!

[See all built-in components](/docs/reference/components)

---

## Quick Reference: Unity ‚Üí Needle Engine

| Unity Concept | Needle Engine | Notes |
| --- | --- | --- |
| GameObject | Object3D | Same object in three.js |
| Transform | Object3D | No separate Transform component |
| MonoBehaviour | Behaviour | Base class for components |
| C# Scripts | TypeScript/JavaScript | Runtime behavior |
| Static (Lightmap) | Automatic export | Just mark as Static |
| Animator Controller | Animator component | State machines work! |
| Physics Material | PhysicsMaterial | Friction/bounce settings |
| Canvas UI | Canvas component | World and screen space |
| UnityEvent | EventList | Use @serializable(EventList) |
| `position` | **Local space** | Use `worldPosition` for world |

---

## glTF Export

When you save your Unity scene, Needle Engine automatically exports to **glTF format** (`.glb` or `.gltf`).

### What Gets Exported

**Visual Assets:**
- Meshes and geometry
- Materials and textures
- Lightmaps and skyboxes
- Animations and blend shapes
- Particle systems
- Audio files

**Scene Data:**
- GameObject hierarchy
- Transform data
- Component configurations
- References between objects

**Optimization:**
- Automatic texture compression (KTX2)
- Mesh compression (Draco)
- Progressive loading for large scenes
- LOD (Level of Detail) support

[Read more: Export & Optimization](/docs/how-to-guides/export/)

---

## Web Project Structure

When Needle Engine creates a web project, you get:

```
YourUnityProject/
‚îî‚îÄ‚îÄ Assets/

YourWebProject/              ‚Üê Generated web project
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îî‚îÄ‚îÄ scene.glb            ‚Üê Exported glTF scene
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.ts              ‚Üê Entry point
‚îÇ   ‚îî‚îÄ‚îÄ scripts/             ‚Üê Custom components (optional)
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ vite.config.js
```

**Project location:** By default, created next to your Unity project. Configure in the Needle Engine component.

---

## Editor Sync & Hot Reload

**See changes instantly** without rebuilding:

Add the **EditorSync** component to enable live sync:

1. Make changes in Unity (move objects, adjust materials, change properties)
2. Save the scene (Ctrl+S / Cmd+S)
3. Browser updates automatically!

**What syncs:**
- Transform changes
- Material properties
- Component field values
- Hierarchy changes

**Code hot-reload:** TypeScript changes also reload automatically when you save.

:::details Video: From Unity Project to Live Sync with three.js (4 minutes)
<video-embed src="https://www.youtube.com/watch?v=gZX_sqrne8U" limit_height />
:::

[Read more: Editor Sync](/docs/unity/editor-sync)

---

## Adding Custom Behavior (Optional)

While many features work without code, you can add custom interactivity with TypeScript:

**TypeScript workflow:**
1. Write TypeScript components in `src/scripts/`
2. C# stubs generate automatically in Unity
3. Add components to GameObjects visually
4. Configure properties in the Inspector

**Common use cases:**
- Custom interactions (click, hover)
- Game logic and rules
- Data loading and APIs
- Complex animations
- Custom UI behavior

**Learn scripting:**
- [Create Components](/docs/how-to-guides/scripting/create-components) - Write custom components
- [C# to TypeScript Translation](/docs/tutorials/fundamentals/c-sharp-to-typescript) - For Unity developers
- [TypeScript Essentials](/docs/tutorials/fundamentals/typescript-essentials) - Language basics

---

## Framework Integration

Needle Engine works with any web framework:

- **Vue.js** - Reactive UI framework
- **React** - Component-based UI
- **Svelte** - Lightweight and fast
- **Next.js** - React with server rendering
- **And more!**

The default template uses **Vite** for fast development.

[See framework samples](https://engine.needle.tools/samples/?tag=framework)

---

## What's Next?

### Continue Learning

**For Unity Users:**
- [Unity Getting Started](/docs/unity/getting-started) - Step-by-step setup tutorial
- [For Unity Developers](/docs/tutorials/fundamentals/for-unity-developers) - Complete learning path

**Add Custom Behavior:**
- [Create Components](/docs/how-to-guides/scripting/create-components) - Write interactive code
- [C# to TypeScript](/docs/tutorials/fundamentals/c-sharp-to-typescript) - Translate your C# knowledge

**Explore Features:**
- [Component Reference](/docs/reference/components) - All built-in components
- [Samples & Showcase](https://engine.needle.tools/samples/) - See what's possible

### Get Help

- [FAQ](/docs/reference/faq) - Common questions
- [Discord Community](https://discord.needle.tools) - Live support
- [Forum](https://forum.needle.tools) - In-depth discussions
Source: https://engine.needle.tools/docs/tutorials/fundamentals/unity-integration.html

